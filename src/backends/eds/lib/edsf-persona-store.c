/* edsf-persona-store.c generated by valac 0.20.1.30-1b1d, the Vala compiler
 * generated from edsf-persona-store.vala, do not modify */

/*
 * Copyright (C) 2011 Collabora Ltd.
 * Copyright (C) 2013 Philip Withnall
 *
 * This library is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, either version 2.1 of the License, or
 * (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with this library.  If not, see <http://www.gnu.org/licenses/>.
 *
 * Authors:
 *       Travis Reitter <travis.reitter@collabora.co.uk>
 *       Philip Withnall <philip.withnall@collabora.co.uk>
 *       Marco Barisione <marco.barisione@collabora.co.uk>
 *       Raul Gutierrez Segales <raul.gutierrez.segales@collabora.co.uk>
 */

#include <glib.h>
#include <glib-object.h>
#include <gio/gio.h>
#include <libedataserver/libedataserver.h>
#include <folks/folks.h>
#include <gee.h>
#include <stdlib.h>
#include <string.h>
#include <libebook/libebook.h>
#include <libebook-contacts/libebook-contacts.h>
#include <folks/small-set.h>
#include <glib/gi18n-lib.h>
#include <folks-internal.h>
#include <folks/small-set-internal.h>
#include <gobject/gvaluecollector.h>


#define EDSF_TYPE_PERSONA_STORE (edsf_persona_store_get_type ())
#define EDSF_PERSONA_STORE(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), EDSF_TYPE_PERSONA_STORE, EdsfPersonaStore))
#define EDSF_PERSONA_STORE_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), EDSF_TYPE_PERSONA_STORE, EdsfPersonaStoreClass))
#define EDSF_IS_PERSONA_STORE(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), EDSF_TYPE_PERSONA_STORE))
#define EDSF_IS_PERSONA_STORE_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), EDSF_TYPE_PERSONA_STORE))
#define EDSF_PERSONA_STORE_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), EDSF_TYPE_PERSONA_STORE, EdsfPersonaStoreClass))

typedef struct _EdsfPersonaStore EdsfPersonaStore;
typedef struct _EdsfPersonaStoreClass EdsfPersonaStoreClass;
typedef struct _EdsfPersonaStorePrivate EdsfPersonaStorePrivate;

#define EDSF_TYPE_PERSONA (edsf_persona_get_type ())
#define EDSF_PERSONA(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), EDSF_TYPE_PERSONA, EdsfPersona))
#define EDSF_PERSONA_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), EDSF_TYPE_PERSONA, EdsfPersonaClass))
#define EDSF_IS_PERSONA(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), EDSF_TYPE_PERSONA))
#define EDSF_IS_PERSONA_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), EDSF_TYPE_PERSONA))
#define EDSF_PERSONA_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), EDSF_TYPE_PERSONA, EdsfPersonaClass))

typedef struct _EdsfPersona EdsfPersona;
typedef struct _EdsfPersonaClass EdsfPersonaClass;

#define EDSF_PERSONA_STORE_TYPE_IDLE_TASK (edsf_persona_store_idle_task_get_type ())
#define EDSF_PERSONA_STORE_IDLE_TASK(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), EDSF_PERSONA_STORE_TYPE_IDLE_TASK, EdsfPersonaStoreIdleTask))
#define EDSF_PERSONA_STORE_IDLE_TASK_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), EDSF_PERSONA_STORE_TYPE_IDLE_TASK, EdsfPersonaStoreIdleTaskClass))
#define EDSF_PERSONA_STORE_IS_IDLE_TASK(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), EDSF_PERSONA_STORE_TYPE_IDLE_TASK))
#define EDSF_PERSONA_STORE_IS_IDLE_TASK_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), EDSF_PERSONA_STORE_TYPE_IDLE_TASK))
#define EDSF_PERSONA_STORE_IDLE_TASK_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), EDSF_PERSONA_STORE_TYPE_IDLE_TASK, EdsfPersonaStoreIdleTaskClass))

typedef struct _EdsfPersonaStoreIdleTask EdsfPersonaStoreIdleTask;
typedef struct _EdsfPersonaStoreIdleTaskClass EdsfPersonaStoreIdleTaskClass;
#define _g_object_unref0(var) ((var == NULL) ? NULL : (var = (g_object_unref (var), NULL)))
#define _g_error_free0(var) ((var == NULL) ? NULL : (var = (g_error_free (var), NULL)))
#define _g_free0(var) (var = (g_free (var), NULL))
typedef struct _EdsfPersonaStoreCreateAddressBookData EdsfPersonaStoreCreateAddressBookData;
typedef struct _EdsfPersonaStoreRemoveAddressBookData EdsfPersonaStoreRemoveAddressBookData;
#define _g_hash_table_unref0(var) ((var == NULL) ? NULL : (var = (g_hash_table_unref (var), NULL)))
#define _g_date_time_unref0(var) ((var == NULL) ? NULL : (var = (g_date_time_unref (var), NULL)))
typedef struct _EdsfPersonaStoreAddPersonaFromDetailsData EdsfPersonaStoreAddPersonaFromDetailsData;
typedef struct _EdsfPersonaStoreRemovePersonaData EdsfPersonaStoreRemovePersonaData;
typedef struct _EdsfPersonaStorePrepareData EdsfPersonaStorePrepareData;
typedef struct _EdsfPersonaStoreOpenAddressBookData EdsfPersonaStoreOpenAddressBookData;
typedef struct _Block2Data Block2Data;
typedef struct _Block3Data Block3Data;
typedef struct _EdsfPersonaStoreCommitModifiedPropertyData EdsfPersonaStoreCommitModifiedPropertyData;
typedef struct _EdsfPersonaStoreSetAvatarData EdsfPersonaStoreSetAvatarData;
typedef struct _EdsfPersonaStoreSetWebServiceAddressesData EdsfPersonaStoreSetWebServiceAddressesData;
#define __vala_EVCardAttributeParam_free0(var) ((var == NULL) ? NULL : (var = (_vala_EVCardAttributeParam_free (var), NULL)))
#define __vala_EVCardAttribute_free0(var) ((var == NULL) ? NULL : (var = (_vala_EVCardAttribute_free (var), NULL)))
typedef struct _EdsfPersonaStoreSetUrlsData EdsfPersonaStoreSetUrlsData;

#define EDSF_PERSONA_TYPE_URL_TYPE_MAPPING (edsf_persona_url_type_mapping_get_type ())
typedef struct _EdsfPersonaUrlTypeMapping EdsfPersonaUrlTypeMapping;
typedef struct _EdsfPersonaStoreSetLocalIdsData EdsfPersonaStoreSetLocalIdsData;
typedef struct _EdsfPersonaStoreSetIsFavouriteData EdsfPersonaStoreSetIsFavouriteData;
#define __vala_EContactPhoto_free0(var) ((var == NULL) ? NULL : (var = (_vala_EContactPhoto_free (var), NULL)))
typedef struct _EdsfPersonaStoreSetContactAvatarData EdsfPersonaStoreSetContactAvatarData;
typedef struct _EdsfPersonaStoreSetEmailsData EdsfPersonaStoreSetEmailsData;
typedef struct _EdsfPersonaStoreSetPhonesData EdsfPersonaStoreSetPhonesData;
typedef struct _EdsfPersonaStoreSetPostalAddressesData EdsfPersonaStoreSetPostalAddressesData;
#define __g_list_free___vala_EVCardAttribute_free0_0(var) ((var == NULL) ? NULL : (var = (_g_list_free___vala_EVCardAttribute_free0_ (var), NULL)))
typedef struct _EdsfPersonaStoreSetFullNameData EdsfPersonaStoreSetFullNameData;
typedef struct _EdsfPersonaStoreSetNicknameData EdsfPersonaStoreSetNicknameData;
typedef struct _EdsfPersonaStoreSetNotesData EdsfPersonaStoreSetNotesData;
typedef struct _EdsfPersonaStoreSetBirthdayData EdsfPersonaStoreSetBirthdayData;
#define __vala_EContactDate_free0(var) ((var == NULL) ? NULL : (var = (_vala_EContactDate_free (var), NULL)))
typedef struct _EdsfPersonaStoreSetRolesData EdsfPersonaStoreSetRolesData;
typedef struct _EdsfPersonaStoreSetStructuredNameData EdsfPersonaStoreSetStructuredNameData;
#define __vala_EContactName_free0(var) ((var == NULL) ? NULL : (var = (_vala_EContactName_free (var), NULL)))
typedef struct _EdsfPersonaStoreSetImFdsData EdsfPersonaStoreSetImFdsData;
#define _g_list_free0(var) ((var == NULL) ? NULL : (var = (g_list_free (var), NULL)))
typedef struct _EdsfPersonaStoreSetGroupsData EdsfPersonaStoreSetGroupsData;
typedef struct _EdsfPersonaStoreSetSystemGroupsData EdsfPersonaStoreSetSystemGroupsData;
#define __g_list_free__g_free0_0(var) ((var == NULL) ? NULL : (var = (_g_list_free__g_free0_ (var), NULL)))
typedef struct _EdsfPersonaStoreSetGenderData EdsfPersonaStoreSetGenderData;
typedef struct _EdsfPersonaStoreSetAntiLinksData EdsfPersonaStoreSetAntiLinksData;
typedef struct _EdsfPersonaStoreSetLocationData EdsfPersonaStoreSetLocationData;
#define __vala_EContactGeo_free0(var) ((var == NULL) ? NULL : (var = (_vala_EContactGeo_free (var), NULL)))
typedef struct _EdsfPersonaStoreIdleTaskPrivate EdsfPersonaStoreIdleTaskPrivate;
#define _edsf_persona_store_idle_task_unref0(var) ((var == NULL) ? NULL : (var = (edsf_persona_store_idle_task_unref (var), NULL)))
typedef struct _Block4Data Block4Data;
typedef struct _Block5Data Block5Data;
typedef struct _Block6Data Block6Data;
typedef struct _Block7Data Block7Data;
typedef struct _EdsfPersonaStoreParamSpecIdleTask EdsfPersonaStoreParamSpecIdleTask;
#define _vala_assert(expr, msg) if G_LIKELY (expr) ; else g_assertion_message_expr (G_LOG_DOMAIN, __FILE__, __LINE__, G_STRFUNC, msg);

struct _EdsfPersonaStore {
	FolksPersonaStore parent_instance;
	EdsfPersonaStorePrivate * priv;
};

struct _EdsfPersonaStoreClass {
	FolksPersonaStoreClass parent_class;
};

struct _EdsfPersonaStorePrivate {
	GeeHashMap* _personas;
	GStaticRecMutex __lock__personas;
	GeeMap* _personas_ro;
	gboolean _is_prepared;
	gboolean _prepare_pending;
	gboolean _is_quiescent;
	GeeHashSet* _pending_personas;
	EBookClient* _addressbook;
	EBookClientView* _ebookview;
	ESourceRegistry* _source_registry;
	gchar* _query_str;
	gchar** _always_writeable_properties;
	gint _always_writeable_properties_length1;
	gint __always_writeable_properties_size_;
	ESource* _source;
	GError* _open_address_book_error;
	GSourceFunc _open_address_book_callback;
	gpointer _open_address_book_callback_target;
	GDestroyNotify _open_address_book_callback_target_destroy_notify;
	GeeQueue* _idle_tasks;
	guint _idle_handle;
};

struct _EdsfPersonaStoreCreateAddressBookData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	gchar* id;
	const gchar* _tmp0_;
	ESource* new_source;
	const gchar* _tmp1_;
	ESource* _tmp2_;
	ESource* _tmp3_;
	ESource* _tmp4_;
	const gchar* _tmp5_;
	ESourceAddressBook* ab_extension;
	ESource* _tmp6_;
	ESourceExtension* _tmp7_;
	ESourceAddressBook* _tmp8_;
	ESourceAddressBook* _tmp9_;
	ESourceRegistry* registry;
	ESourceRegistry* _tmp10_;
	ESourceRegistry* _tmp11_;
	ESource* _tmp12_;
	GError * _inner_error_;
};

struct _EdsfPersonaStoreRemoveAddressBookData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	EdsfPersonaStore* store;
	EdsfPersonaStore* _tmp0_;
	ESource* _tmp1_;
	GError * _inner_error_;
};

struct _EdsfPersonaStoreAddPersonaFromDetailsData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	EdsfPersonaStore* self;
	GHashTable* details;
	FolksPersona* result;
	gboolean _tmp0_;
	GError* _tmp1_;
	EContact* contact;
	EContact* _tmp2_;
	GHashTableIter iter;
	GHashTable* _tmp3_;
	const gchar* k;
	GValue* _v;
	gboolean is_fav;
	GeeSet* groups;
	FolksSmallSet* _tmp4_;
	gconstpointer _tmp5_;
	gconstpointer _tmp6_;
	gboolean _tmp7_;
	GValue* _tmp8_;
	GValue v;
	GValue* _tmp9_;
	const gchar* _tmp10_;
	const gchar* _tmp11_;
	gchar* full_name;
	const gchar* _tmp12_;
	gchar* _tmp13_;
	gboolean _tmp14_;
	const gchar* _tmp15_;
	const gchar* _tmp16_;
	gboolean _tmp17_;
	EContact* _tmp18_;
	EContactField _tmp19_;
	const gchar* _tmp20_;
	const gchar* _tmp21_;
	const gchar* _tmp22_;
	gchar* nickname;
	const gchar* _tmp23_;
	gchar* _tmp24_;
	gboolean _tmp25_;
	const gchar* _tmp26_;
	const gchar* _tmp27_;
	gboolean _tmp28_;
	EContact* _tmp29_;
	EContactField _tmp30_;
	const gchar* _tmp31_;
	const gchar* _tmp32_;
	const gchar* _tmp33_;
	GeeSet* email_addresses;
	GObject* _tmp34_;
	GeeSet* _tmp35_;
	EContact* _tmp36_;
	GeeSet* _tmp37_;
	const gchar* _tmp38_;
	const gchar* _tmp39_;
	GLoadableIcon* avatar;
	GObject* _tmp40_;
	GLoadableIcon* _tmp41_;
	EContact* _tmp42_;
	GLoadableIcon* _tmp43_;
	GError* e1;
	GError* _tmp44_;
	const gchar* _tmp45_;
	const gchar* _tmp46_;
	const gchar* _tmp47_;
	GeeMultiMap* im_fds;
	GObject* _tmp48_;
	GeeMultiMap* _tmp49_;
	EContact* _tmp50_;
	GeeMultiMap* _tmp51_;
	const gchar* _tmp52_;
	const gchar* _tmp53_;
	GeeSet* phone_numbers;
	GObject* _tmp54_;
	GeeSet* _tmp55_;
	EContact* _tmp56_;
	GeeSet* _tmp57_;
	const gchar* _tmp58_;
	const gchar* _tmp59_;
	GeeSet* postal_fds;
	GObject* _tmp60_;
	GeeSet* _tmp61_;
	EContact* _tmp62_;
	GeeSet* _tmp63_;
	const gchar* _tmp64_;
	const gchar* _tmp65_;
	FolksStructuredName* sname;
	GObject* _tmp66_;
	FolksStructuredName* _tmp67_;
	EContact* _tmp68_;
	FolksStructuredName* _tmp69_;
	const gchar* _tmp70_;
	const gchar* _tmp71_;
	GeeSet* local_ids;
	GObject* _tmp72_;
	GeeSet* _tmp73_;
	EContact* _tmp74_;
	GeeSet* _tmp75_;
	const gchar* _tmp76_;
	const gchar* _tmp77_;
	FolksLocation* location;
	GObject* _tmp78_;
	FolksLocation* _tmp79_;
	EContact* _tmp80_;
	FolksLocation* _tmp81_;
	const gchar* _tmp82_;
	const gchar* _tmp83_;
	GeeHashMultiMap* web_service_addresses;
	GObject* _tmp84_;
	GeeHashMultiMap* _tmp85_;
	EContact* _tmp86_;
	GeeHashMultiMap* _tmp87_;
	const gchar* _tmp88_;
	const gchar* _tmp89_;
	GeeSet* notes;
	GObject* _tmp90_;
	GeeSet* _tmp91_;
	EContact* _tmp92_;
	GeeSet* _tmp93_;
	const gchar* _tmp94_;
	const gchar* _tmp95_;
	FolksGender gender;
	gint _tmp96_;
	EContact* _tmp97_;
	FolksGender _tmp98_;
	const gchar* _tmp99_;
	const gchar* _tmp100_;
	GeeSet* urls;
	GObject* _tmp101_;
	GeeSet* _tmp102_;
	EContact* _tmp103_;
	GeeSet* _tmp104_;
	const gchar* _tmp105_;
	const gchar* _tmp106_;
	GDateTime* birthday;
	void* _tmp107_;
	GDateTime* _tmp108_;
	EContact* _tmp109_;
	GDateTime* _tmp110_;
	const gchar* _tmp111_;
	const gchar* _tmp112_;
	GeeSet* roles;
	GObject* _tmp113_;
	GeeSet* _tmp114_;
	EContact* _tmp115_;
	GeeSet* _tmp116_;
	const gchar* _tmp117_;
	const gchar* _tmp118_;
	GObject* _tmp119_;
	GeeSet* _tmp120_;
	EContact* _tmp121_;
	GeeSet* _tmp122_;
	gboolean _tmp123_;
	const gchar* _tmp124_;
	const gchar* _tmp125_;
	gboolean _tmp126_;
	EContact* _tmp127_;
	gboolean _tmp128_;
	EContact* _tmp129_;
	GeeSet* _tmp130_;
	gboolean _tmp131_;
	EdsfPersona* _persona;
	gchar* added_uid;
	gboolean _result_;
	EBookClient* _tmp132_;
	EContact* _tmp133_;
	gchar* _tmp134_;
	gboolean _tmp135_;
	gboolean _tmp136_;
	const gchar* _tmp137_;
	GeeHashMap* _tmp138_;
	gchar* iid;
	const gchar* _tmp139_;
	const gchar* _tmp140_;
	const gchar* _tmp141_;
	gchar* _tmp142_;
	GeeHashMap* _tmp143_;
	const gchar* _tmp144_;
	gpointer _tmp145_;
	EdsfPersona* _tmp146_;
	EdsfPersona* persona;
	EContact* _tmp147_;
	EContactField _tmp148_;
	const gchar* _tmp149_;
	EContact* _tmp150_;
	EdsfPersona* _tmp151_;
	GeeHashMap* _tmp152_;
	EdsfPersona* _tmp153_;
	const gchar* _tmp154_;
	const gchar* _tmp155_;
	EdsfPersona* _tmp156_;
	FolksSmallSet* added_personas;
	FolksSmallSet* _tmp157_;
	FolksSmallSet* _tmp158_;
	EdsfPersona* _tmp159_;
	FolksSmallSet* _tmp160_;
	EdsfPersona* _tmp161_;
	EdsfPersona* _tmp162_;
	GeeHashMap* _tmp163_;
	GError* _tmp164_;
	GError* e;
	GError* _tmp165_;
	const gchar* _tmp166_;
	GError * _inner_error_;
};

struct _EdsfPersonaStoreRemovePersonaData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	EdsfPersonaStore* self;
	FolksPersona* persona;
	gboolean _tmp0_;
	GError* _tmp1_;
	EBookClient* _tmp2_;
	FolksPersona* _tmp3_;
	EContact* _tmp4_;
	EContact* _tmp5_;
	GError* e;
	GError* _tmp6_;
	GError* _tmp7_;
	gboolean _tmp8_;
	gboolean _tmp9_;
	gboolean _tmp10_;
	GError* _tmp11_;
	GError* _tmp12_;
	gboolean _tmp13_;
	GError* _tmp14_;
	gboolean _tmp15_;
	GError* _tmp16_;
	gboolean _tmp17_;
	GError* _tmp18_;
	GQuark _tmp19_;
	GQuark _tmp20_;
	GError* _tmp21_;
	gint _tmp22_;
	const gchar* _tmp23_;
	const gchar* _tmp24_;
	const gchar* _tmp25_;
	FolksPersona* _tmp26_;
	const gchar* _tmp27_;
	const gchar* _tmp28_;
	GError* _tmp29_;
	const gchar* _tmp30_;
	FolksPersona* _tmp31_;
	const gchar* _tmp32_;
	const gchar* _tmp33_;
	GError* _tmp34_;
	const gchar* _tmp35_;
	GError* _tmp36_;
	const gchar* _tmp37_;
	GError* _tmp38_;
	const gchar* _tmp39_;
	GError* _tmp40_;
	const gchar* _tmp41_;
	FolksPersona* _tmp42_;
	const gchar* _tmp43_;
	const gchar* _tmp44_;
	GError* _tmp45_;
	const gchar* _tmp46_;
	GError* _tmp47_;
	GError * _inner_error_;
};

struct _EdsfPersonaStorePrepareData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	EdsfPersonaStore* self;
	const gchar* _tmp0_;
	const gchar* _tmp1_;
	gboolean _tmp2_;
	gboolean _tmp3_;
	gboolean _tmp4_;
	gboolean _tmp5_;
	ESourceRegistry* _tmp6_;
	ESourceRegistry* _tmp7_;
	ESourceRegistry* _tmp8_;
	ESourceRegistry* _tmp9_;
	ESourceRegistry* _tmp10_;
	EBookClient* _tmp11_;
	ESource* _tmp12_;
	EBookClient* _tmp13_;
	EBookClient* _tmp14_;
	EBookClient* _tmp15_;
	const gchar* _tmp16_;
	const gchar* _tmp17_;
	const gchar* _tmp18_;
	const gchar* _tmp19_;
	GError* e1;
	GError* _tmp20_;
	gboolean _tmp21_;
	gboolean _tmp22_;
	gboolean _tmp23_;
	gboolean _tmp24_;
	GError* _tmp25_;
	GError* _tmp26_;
	gboolean _tmp27_;
	GError* _tmp28_;
	gboolean _tmp29_;
	GError* _tmp30_;
	gboolean _tmp31_;
	GError* _tmp32_;
	gboolean _tmp33_;
	GError* _tmp34_;
	GQuark _tmp35_;
	GQuark _tmp36_;
	GError* _tmp37_;
	gint _tmp38_;
	const gchar* _tmp39_;
	const gchar* _tmp40_;
	const gchar* _tmp41_;
	GError* _tmp42_;
	const gchar* _tmp43_;
	const gchar* _tmp44_;
	const gchar* _tmp45_;
	GError* _tmp46_;
	const gchar* _tmp47_;
	GError* _tmp48_;
	const gchar* _tmp49_;
	const gchar* _tmp50_;
	const gchar* _tmp51_;
	GError* _tmp52_;
	const gchar* _tmp53_;
	GError* _tmp54_;
	gchar* supported_fields;
	EBookClient* _tmp55_;
	gchar* _tmp56_;
	const gchar* _tmp57_;
	const gchar* _tmp58_;
	FolksSmallSet* prop_set;
	FolksSmallSet* _tmp59_;
	const gchar* _tmp60_;
	gchar** fields;
	const gchar* _tmp61_;
	gchar** _tmp62_;
	gchar** _tmp63_;
	gint fields_length1;
	gint _fields_size_;
	FolksSmallSet* _tmp64_;
	const gchar* _tmp65_;
	FolksSmallSet* _tmp66_;
	const gchar* _tmp67_;
	FolksSmallSet* _tmp68_;
	const gchar* _tmp69_;
	FolksSmallSet* _tmp70_;
	const gchar* _tmp71_;
	FolksSmallSet* _tmp72_;
	const gchar* _tmp73_;
	gchar** _tmp74_;
	gint _tmp74__length1;
	gchar** field_collection;
	gint field_collection_length1;
	gint _field_collection_size_;
	gint field_it;
	const gchar* field;
	gchar* prop;
	const gchar* _tmp75_;
	FolksPersonaDetail _tmp76_;
	const gchar* _tmp77_;
	gchar* _tmp78_;
	const gchar* _tmp79_;
	FolksSmallSet* _tmp80_;
	gchar* _tmp81_;
	gchar* _tmp82_;
	FolksSmallSet* _tmp83_;
	gint _tmp84_;
	gint _tmp85_;
	gchar** _tmp86_;
	guint i;
	FolksSmallSet* _final_prop_list;
	FolksSmallSet* _tmp87_;
	FolksSmallSet* _tmp88_;
	gint _final_prop_size;
	FolksSmallSet* _tmp89_;
	gint _tmp90_;
	gint _tmp91_;
	gint _final_prop_index;
	gint _tmp92_;
	gint _tmp93_;
	gint _tmp94_;
	gchar* final_prop;
	FolksSmallSet* _tmp95_;
	gint _tmp96_;
	gconstpointer _tmp97_;
	gchar* _tmp98_;
	gchar** _tmp99_;
	gint _tmp99__length1;
	guint _tmp100_;
	const gchar* _tmp101_;
	gchar* _tmp102_;
	gchar* _tmp103_;
	GError* e2;
	const gchar* _tmp104_;
	GError* _tmp105_;
	const gchar* _tmp106_;
	GError* _tmp107_;
	gboolean do_initial_query;
	gchar* capabilities;
	EBookClient* _tmp108_;
	gchar* _tmp109_;
	const gchar* _tmp110_;
	const gchar* _tmp111_;
	const gchar* _tmp112_;
	gchar** caps;
	const gchar* _tmp113_;
	gchar** _tmp114_;
	gchar** _tmp115_;
	gint caps_length1;
	gint _caps_size_;
	gchar** _tmp116_;
	gint _tmp116__length1;
	GError* e4;
	const gchar* _tmp117_;
	GError* _tmp118_;
	const gchar* _tmp119_;
	GError* _tmp120_;
	gboolean got_view;
	gboolean _tmp121_;
	EBookClient* _tmp122_;
	const gchar* _tmp123_;
	EBookClientView* _tmp124_;
	gboolean _tmp125_;
	const gchar* _tmp126_;
	const gchar* _tmp127_;
	gboolean _tmp128_;
	const gchar* _tmp129_;
	const gchar* _tmp130_;
	const gchar* _tmp131_;
	GError* _tmp132_;
	EBookClientView* _tmp133_;
	EBookClientView* _tmp134_;
	EBookClientView* _tmp135_;
	EBookClientView* _tmp136_;
	EBookClientView* _tmp137_;
	GError* e3;
	GError* _tmp138_;
	gboolean _tmp139_;
	gboolean _tmp140_;
	gboolean _tmp141_;
	gboolean _tmp142_;
	GError* _tmp143_;
	GError* _tmp144_;
	gboolean _tmp145_;
	GError* _tmp146_;
	gboolean _tmp147_;
	GError* _tmp148_;
	gboolean _tmp149_;
	GError* _tmp150_;
	gboolean _tmp151_;
	GError* _tmp152_;
	GQuark _tmp153_;
	GQuark _tmp154_;
	GError* _tmp155_;
	gint _tmp156_;
	const gchar* _tmp157_;
	const gchar* _tmp158_;
	const gchar* _tmp159_;
	GError* _tmp160_;
	const gchar* _tmp161_;
	const gchar* _tmp162_;
	const gchar* _tmp163_;
	GError* _tmp164_;
	const gchar* _tmp165_;
	GError* _tmp166_;
	const gchar* _tmp167_;
	const gchar* _tmp168_;
	const gchar* _tmp169_;
	GError* _tmp170_;
	const gchar* _tmp171_;
	GError* _tmp172_;
	gboolean _tmp173_;
	gboolean _tmp174_;
	gboolean _tmp175_;
	gboolean _tmp176_;
	GeeHashSet* _tmp177_;
	GError * _inner_error_;
};

struct _EdsfPersonaStoreOpenAddressBookData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	EdsfPersonaStore* self;
	GError* err_out;
	EBookClient* _tmp0_;
	const gchar* _tmp1_;
	const gchar* _tmp2_;
	gulong signal_id;
	EBookClient* _tmp3_;
	gulong _tmp4_;
	EBookClient* _tmp5_;
	GError* _tmp6_;
	GError* _tmp7_;
	GError* _tmp8_;
	GError* e1;
	gboolean _tmp9_;
	GError* _tmp10_;
	GQuark _tmp11_;
	GQuark _tmp12_;
	GError* _tmp13_;
	gint _tmp14_;
	gboolean _tmp15_;
	EBookClient* _tmp16_;
	const gchar* _tmp17_;
	const gchar* _tmp18_;
	GError* _tmp19_;
	GError* _tmp20_;
	GError* _tmp21_;
	GError* _tmp22_;
	GError* _tmp23_;
	GError* _tmp24_;
	GError* _tmp25_;
	EBookClient* _tmp26_;
	gulong _tmp27_;
	gboolean _tmp28_;
	EBookClient* _tmp29_;
	gboolean _tmp30_;
	GError* _tmp31_;
	gboolean _tmp32_;
	GQuark _tmp33_;
	const gchar* _tmp34_;
	const gchar* _tmp35_;
	GError* _tmp36_;
	GError * _inner_error_;
};

struct _Block2Data {
	int _ref_count_;
	EdsfPersonaStore * self;
	gpointer _async_data_;
};

struct _Block3Data {
	int _ref_count_;
	Block2Data * _data2_;
	gboolean received_notification;
	gboolean has_yielded;
};

struct _EdsfPersonaStoreCommitModifiedPropertyData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	EdsfPersonaStore* self;
	EdsfPersona* persona;
	gchar* property_name;
	Block2Data* _data2_;
	EBookClient* _tmp0_;
	EContact* contact;
	EdsfPersona* _tmp1_;
	EContact* _tmp2_;
	EContact* _tmp3_;
	EContact* _tmp4_;
	gulong signal_id;
	guint timeout_id;
	Block3Data* _data3_;
	EdsfPersona* _tmp5_;
	const gchar* _tmp6_;
	gchar* _tmp7_;
	gulong _tmp8_;
	EBookClient* _tmp9_;
	EContact* _tmp10_;
	guint _tmp11_;
	gboolean _tmp12_;
	gboolean _tmp13_;
	const gchar* _tmp14_;
	const gchar* _tmp15_;
	GError* _tmp16_;
	GError* e;
	const gchar* _tmp17_;
	GError* _tmp18_;
	GError* _tmp19_;
	gulong _tmp20_;
	EdsfPersona* _tmp21_;
	gulong _tmp22_;
	guint _tmp23_;
	guint _tmp24_;
	GError * _inner_error_;
};

struct _EdsfPersonaStoreSetAvatarData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	EdsfPersonaStore* self;
	EdsfPersona* persona;
	GLoadableIcon* avatar;
	gchar** _tmp0_;
	gint _tmp0__length1;
	const gchar* _tmp1_;
	GError* _tmp2_;
	gboolean _tmp3_;
	gboolean _tmp4_;
	EdsfPersona* _tmp5_;
	GLoadableIcon* _tmp6_;
	GLoadableIcon* _tmp7_;
	GLoadableIcon* _tmp8_;
	gboolean _tmp9_;
	gboolean _tmp10_;
	EdsfPersona* _tmp11_;
	GLoadableIcon* _tmp12_;
	GLoadableIcon* _tmp13_;
	EdsfPersona* _tmp14_;
	GLoadableIcon* _tmp15_;
	GLoadableIcon* _tmp16_;
	GLoadableIcon* _tmp17_;
	gboolean _tmp18_;
	gboolean _tmp19_;
	gboolean _tmp20_;
	EdsfPersona* _tmp21_;
	EContact* _tmp22_;
	EContact* _tmp23_;
	GLoadableIcon* _tmp24_;
	EdsfPersona* _tmp25_;
	GError * _inner_error_;
};

struct _EdsfPersonaStoreSetWebServiceAddressesData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	EdsfPersonaStore* self;
	EdsfPersona* persona;
	GeeMultiMap* web_service_addresses;
	gchar** _tmp0_;
	gint _tmp0__length1;
	const gchar* _tmp1_;
	GError* _tmp2_;
	EdsfPersona* _tmp3_;
	GeeMultiMap* _tmp4_;
	GeeMultiMap* _tmp5_;
	GeeMultiMap* _tmp6_;
	gboolean _tmp7_;
	EdsfPersona* _tmp8_;
	EContact* _tmp9_;
	EContact* _tmp10_;
	GeeMultiMap* _tmp11_;
	EdsfPersona* _tmp12_;
	GError * _inner_error_;
};

struct _EdsfPersonaStoreSetUrlsData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	EdsfPersonaStore* self;
	EdsfPersona* persona;
	GeeSet* urls;
	gchar** _tmp0_;
	gint _tmp0__length1;
	const gchar* _tmp1_;
	GError* _tmp2_;
	EdsfPersona* _tmp3_;
	GeeSet* _tmp4_;
	GeeSet* _tmp5_;
	GeeSet* _tmp6_;
	gboolean _tmp7_;
	EdsfPersona* _tmp8_;
	EContact* _tmp9_;
	EContact* _tmp10_;
	GeeSet* _tmp11_;
	EdsfPersona* _tmp12_;
	GError * _inner_error_;
};

struct _EdsfPersonaUrlTypeMapping {
	gchar* vcard_field_name;
	gchar* folks_type;
};

struct _EdsfPersonaStoreSetLocalIdsData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	EdsfPersonaStore* self;
	EdsfPersona* persona;
	GeeSet* local_ids;
	gchar** _tmp0_;
	gint _tmp0__length1;
	const gchar* _tmp1_;
	GError* _tmp2_;
	GeeSet* _tmp3_;
	EdsfPersona* _tmp4_;
	GeeSet* _tmp5_;
	GeeSet* _tmp6_;
	gboolean _tmp7_;
	EdsfPersona* _tmp8_;
	EContact* _tmp9_;
	EContact* _tmp10_;
	GeeSet* _tmp11_;
	EdsfPersona* _tmp12_;
	GError * _inner_error_;
};

struct _EdsfPersonaStoreSetIsFavouriteData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	EdsfPersonaStore* self;
	EdsfPersona* persona;
	gboolean is_favourite;
	gchar** _tmp0_;
	gint _tmp0__length1;
	const gchar* _tmp1_;
	GError* _tmp2_;
	gboolean _tmp3_;
	EdsfPersona* _tmp4_;
	gboolean _tmp5_;
	gboolean _tmp6_;
	EdsfPersona* _tmp7_;
	EContact* _tmp8_;
	EContact* _tmp9_;
	gboolean _tmp10_;
	EdsfPersona* _tmp11_;
	EContact* _tmp12_;
	EContact* _tmp13_;
	EdsfPersona* _tmp14_;
	GeeSet* _tmp15_;
	GeeSet* _tmp16_;
	gboolean _tmp17_;
	EdsfPersona* _tmp18_;
	GError * _inner_error_;
};

struct _EdsfPersonaStoreSetContactAvatarData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	EdsfPersonaStore* self;
	EContact* contact;
	GLoadableIcon* avatar;
	GLoadableIcon* _tmp0_;
	EContact* _tmp1_;
	EContactPhoto* cp;
	EContactPhoto* _tmp2_;
	EContactPhoto* _tmp3_;
	GInputStream* input_s;
	GLoadableIcon* _tmp4_;
	GInputStream* _tmp5_;
	guint8* image_data;
	guint8* _tmp6_;
	gint image_data_length1;
	gint _image_data_size_;
	guint8* buffer;
	guint8* _tmp7_;
	gint buffer_length1;
	gint _buffer_size_;
	gssize size_read;
	GInputStream* _tmp8_;
	guint8* _tmp9_;
	gint _tmp9__length1;
	gssize _tmp10_;
	gssize _tmp11_;
	gint read_cur;
	guint8* _tmp12_;
	gint _tmp12__length1;
	gint _tmp13_;
	gssize _tmp14_;
	gint _tmp15_;
	guint8* _tmp16_;
	gint _tmp16__length1;
	gint _tmp17_;
	guint8* _tmp18_;
	gint _tmp18__length1;
	gssize _tmp19_;
	EContactPhoto* _tmp20_;
	guint8* _tmp21_;
	gint _tmp21__length1;
	gboolean uncertain;
	gchar* mime_type;
	guint8* _tmp22_;
	gint _tmp22__length1;
	gboolean _tmp23_;
	gchar* _tmp24_;
	gboolean _tmp25_;
	EContactPhoto* _tmp26_;
	const gchar* _tmp27_;
	EContact* _tmp28_;
	EContactPhoto* _tmp29_;
	GError* e1;
	const gchar* _tmp30_;
	GError* _tmp31_;
	const gchar* _tmp32_;
	GError* _tmp33_;
	GError * _inner_error_;
};

struct _EdsfPersonaStoreSetEmailsData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	EdsfPersonaStore* self;
	EdsfPersona* persona;
	GeeSet* emails;
	gchar** _tmp0_;
	gint _tmp0__length1;
	const gchar* _tmp1_;
	GError* _tmp2_;
	GeeSet* _tmp3_;
	EdsfPersona* _tmp4_;
	GeeSet* _tmp5_;
	GeeSet* _tmp6_;
	gboolean _tmp7_;
	EdsfPersona* _tmp8_;
	EContact* _tmp9_;
	EContact* _tmp10_;
	GeeSet* _tmp11_;
	EdsfPersona* _tmp12_;
	GError * _inner_error_;
};

struct _EdsfPersonaStoreSetPhonesData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	EdsfPersonaStore* self;
	EdsfPersona* persona;
	GeeSet* phones;
	gchar** _tmp0_;
	gint _tmp0__length1;
	const gchar* _tmp1_;
	GError* _tmp2_;
	GeeSet* _tmp3_;
	EdsfPersona* _tmp4_;
	GeeSet* _tmp5_;
	GeeSet* _tmp6_;
	gboolean _tmp7_;
	EdsfPersona* _tmp8_;
	EContact* _tmp9_;
	EContact* _tmp10_;
	GeeSet* _tmp11_;
	EdsfPersona* _tmp12_;
	GError * _inner_error_;
};

struct _EdsfPersonaStoreSetPostalAddressesData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	EdsfPersonaStore* self;
	EdsfPersona* persona;
	GeeSet* postal_fds;
	gchar** _tmp0_;
	gint _tmp0__length1;
	const gchar* _tmp1_;
	GError* _tmp2_;
	GeeSet* _tmp3_;
	EdsfPersona* _tmp4_;
	GeeSet* _tmp5_;
	GeeSet* _tmp6_;
	gboolean _tmp7_;
	EdsfPersona* _tmp8_;
	EContact* _tmp9_;
	EContact* _tmp10_;
	GeeSet* _tmp11_;
	EdsfPersona* _tmp12_;
	GError * _inner_error_;
};

typedef void (*EdsfPersonaStoreFieldToAttribute) (EVCardAttribute* attr, gconstpointer value, void* user_data);
struct _EdsfPersonaStoreSetFullNameData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	EdsfPersonaStore* self;
	EdsfPersona* persona;
	gchar* full_name;
	gchar** _tmp0_;
	gint _tmp0__length1;
	const gchar* _tmp1_;
	GError* _tmp2_;
	gchar* _full_name;
	const gchar* _tmp3_;
	gchar* _tmp4_;
	const gchar* _tmp5_;
	EdsfPersona* _tmp6_;
	const gchar* _tmp7_;
	const gchar* _tmp8_;
	const gchar* _tmp9_;
	EdsfPersona* _tmp10_;
	EContact* _tmp11_;
	EContact* _tmp12_;
	EContactField _tmp13_;
	const gchar* _tmp14_;
	EdsfPersona* _tmp15_;
	GError * _inner_error_;
};

struct _EdsfPersonaStoreSetNicknameData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	EdsfPersonaStore* self;
	EdsfPersona* persona;
	gchar* nickname;
	gchar** _tmp0_;
	gint _tmp0__length1;
	const gchar* _tmp1_;
	GError* _tmp2_;
	gchar* _nickname;
	const gchar* _tmp3_;
	gchar* _tmp4_;
	const gchar* _tmp5_;
	EdsfPersona* _tmp6_;
	const gchar* _tmp7_;
	const gchar* _tmp8_;
	const gchar* _tmp9_;
	EdsfPersona* _tmp10_;
	EContact* _tmp11_;
	EContact* _tmp12_;
	EContactField _tmp13_;
	const gchar* _tmp14_;
	EdsfPersona* _tmp15_;
	GError * _inner_error_;
};

struct _EdsfPersonaStoreSetNotesData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	EdsfPersonaStore* self;
	EdsfPersona* persona;
	GeeSet* notes;
	gchar** _tmp0_;
	gint _tmp0__length1;
	const gchar* _tmp1_;
	GError* _tmp2_;
	GeeSet* _tmp3_;
	EdsfPersona* _tmp4_;
	GeeSet* _tmp5_;
	GeeSet* _tmp6_;
	gboolean _tmp7_;
	EdsfPersona* _tmp8_;
	EContact* _tmp9_;
	EContact* _tmp10_;
	GeeSet* _tmp11_;
	EdsfPersona* _tmp12_;
	GError * _inner_error_;
};

struct _EdsfPersonaStoreSetBirthdayData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	EdsfPersonaStore* self;
	EdsfPersona* persona;
	GDateTime* bday;
	gchar** _tmp0_;
	gint _tmp0__length1;
	const gchar* _tmp1_;
	GError* _tmp2_;
	gboolean _tmp3_;
	gboolean _tmp4_;
	EdsfPersona* _tmp5_;
	GDateTime* _tmp6_;
	GDateTime* _tmp7_;
	GDateTime* _tmp8_;
	gboolean _tmp9_;
	EdsfPersona* _tmp10_;
	GDateTime* _tmp11_;
	GDateTime* _tmp12_;
	GDateTime* _tmp13_;
	gboolean _tmp14_;
	gboolean _tmp15_;
	gboolean _tmp16_;
	EdsfPersona* _tmp17_;
	GDateTime* _tmp18_;
	GDateTime* _tmp19_;
	GDateTime* _tmp20_;
	gboolean _tmp21_;
	EdsfPersona* _tmp22_;
	EContact* _tmp23_;
	EContact* _tmp24_;
	GDateTime* _tmp25_;
	EdsfPersona* _tmp26_;
	GError * _inner_error_;
};

struct _EdsfPersonaStoreSetRolesData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	EdsfPersonaStore* self;
	EdsfPersona* persona;
	GeeSet* roles;
	gchar** _tmp0_;
	gint _tmp0__length1;
	const gchar* _tmp1_;
	GError* _tmp2_;
	GeeSet* _tmp3_;
	EdsfPersona* _tmp4_;
	GeeSet* _tmp5_;
	GeeSet* _tmp6_;
	gboolean _tmp7_;
	EdsfPersona* _tmp8_;
	EContact* _tmp9_;
	EContact* _tmp10_;
	GeeSet* _tmp11_;
	EdsfPersona* _tmp12_;
	GError * _inner_error_;
};

struct _EdsfPersonaStoreSetStructuredNameData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	EdsfPersonaStore* self;
	EdsfPersona* persona;
	FolksStructuredName* sname;
	gchar** _tmp0_;
	gint _tmp0__length1;
	const gchar* _tmp1_;
	GError* _tmp2_;
	gboolean _tmp3_;
	gboolean _tmp4_;
	EdsfPersona* _tmp5_;
	FolksStructuredName* _tmp6_;
	FolksStructuredName* _tmp7_;
	FolksStructuredName* _tmp8_;
	gboolean _tmp9_;
	EdsfPersona* _tmp10_;
	FolksStructuredName* _tmp11_;
	FolksStructuredName* _tmp12_;
	FolksStructuredName* _tmp13_;
	gboolean _tmp14_;
	gboolean _tmp15_;
	gboolean _tmp16_;
	EdsfPersona* _tmp17_;
	FolksStructuredName* _tmp18_;
	FolksStructuredName* _tmp19_;
	FolksStructuredName* _tmp20_;
	gboolean _tmp21_;
	EdsfPersona* _tmp22_;
	EContact* _tmp23_;
	EContact* _tmp24_;
	FolksStructuredName* _tmp25_;
	EdsfPersona* _tmp26_;
	GError * _inner_error_;
};

struct _EdsfPersonaStoreSetImFdsData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	EdsfPersonaStore* self;
	EdsfPersona* persona;
	GeeMultiMap* im_fds;
	gchar** _tmp0_;
	gint _tmp0__length1;
	const gchar* _tmp1_;
	GError* _tmp2_;
	EdsfPersona* _tmp3_;
	GeeMultiMap* _tmp4_;
	GeeMultiMap* _tmp5_;
	GeeMultiMap* _tmp6_;
	gboolean _tmp7_;
	EdsfPersona* _tmp8_;
	EContact* _tmp9_;
	EContact* _tmp10_;
	GeeMultiMap* _tmp11_;
	EdsfPersona* _tmp12_;
	GError * _inner_error_;
};

struct _EdsfPersonaStoreSetGroupsData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	EdsfPersonaStore* self;
	EdsfPersona* persona;
	GeeSet* groups;
	gchar** _tmp0_;
	gint _tmp0__length1;
	const gchar* _tmp1_;
	GError* _tmp2_;
	GeeSet* _tmp3_;
	EdsfPersona* _tmp4_;
	GeeSet* _tmp5_;
	GeeSet* _tmp6_;
	gboolean _tmp7_;
	EdsfPersona* _tmp8_;
	EContact* _tmp9_;
	EContact* _tmp10_;
	GeeSet* _tmp11_;
	EdsfPersona* _tmp12_;
	gboolean _tmp13_;
	gboolean _tmp14_;
	EdsfPersona* _tmp15_;
	GError * _inner_error_;
};

struct _EdsfPersonaStoreSetSystemGroupsData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	EdsfPersonaStore* self;
	EdsfPersona* persona;
	GeeSet* system_groups;
	gboolean _tmp0_;
	const gchar* _tmp1_;
	GError* _tmp2_;
	GeeSet* _tmp3_;
	EdsfPersona* _tmp4_;
	GeeSet* _tmp5_;
	GeeSet* _tmp6_;
	gboolean _tmp7_;
	EdsfPersona* _tmp8_;
	EContact* _tmp9_;
	EContact* _tmp10_;
	GeeSet* _tmp11_;
	EdsfPersona* _tmp12_;
	GError * _inner_error_;
};

struct _EdsfPersonaStoreSetGenderData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	EdsfPersonaStore* self;
	EdsfPersona* persona;
	FolksGender gender;
	gchar** _tmp0_;
	gint _tmp0__length1;
	const gchar* _tmp1_;
	GError* _tmp2_;
	FolksGender _tmp3_;
	EdsfPersona* _tmp4_;
	FolksGender _tmp5_;
	FolksGender _tmp6_;
	EdsfPersona* _tmp7_;
	EContact* _tmp8_;
	EContact* _tmp9_;
	FolksGender _tmp10_;
	EdsfPersona* _tmp11_;
	GError * _inner_error_;
};

struct _EdsfPersonaStoreSetAntiLinksData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	EdsfPersonaStore* self;
	EdsfPersona* persona;
	GeeSet* anti_links;
	gchar** _tmp0_;
	gint _tmp0__length1;
	const gchar* _tmp1_;
	GError* _tmp2_;
	GeeSet* _tmp3_;
	EdsfPersona* _tmp4_;
	GeeSet* _tmp5_;
	GeeSet* _tmp6_;
	gboolean _tmp7_;
	EdsfPersona* _tmp8_;
	EContact* _tmp9_;
	EContact* _tmp10_;
	GeeSet* _tmp11_;
	EdsfPersona* _tmp12_;
	GError * _inner_error_;
};

struct _EdsfPersonaStoreSetLocationData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	EdsfPersonaStore* self;
	EdsfPersona* persona;
	FolksLocation* location;
	gchar** _tmp0_;
	gint _tmp0__length1;
	const gchar* _tmp1_;
	GError* _tmp2_;
	EdsfPersona* _tmp3_;
	EContact* _tmp4_;
	EContact* _tmp5_;
	FolksLocation* _tmp6_;
	EdsfPersona* _tmp7_;
	GError * _inner_error_;
};

struct _EdsfPersonaStoreIdleTask {
	GTypeInstance parent_instance;
	volatile int ref_count;
	EdsfPersonaStoreIdleTaskPrivate * priv;
	GSourceFunc callback;
	gpointer callback_target;
	GDestroyNotify callback_target_destroy_notify;
};

struct _EdsfPersonaStoreIdleTaskClass {
	GTypeClass parent_class;
	void (*finalize) (EdsfPersonaStoreIdleTask *self);
};

struct _Block4Data {
	int _ref_count_;
	EdsfPersonaStore * self;
	GeeLinkedList* copy;
};

struct _Block5Data {
	int _ref_count_;
	EdsfPersonaStore * self;
	GeeLinkedList* copy;
};

struct _Block6Data {
	int _ref_count_;
	EdsfPersonaStore * self;
	GeeLinkedList* copy;
};

struct _Block7Data {
	int _ref_count_;
	EdsfPersonaStore * self;
	GError* err;
};

struct _EdsfPersonaStoreParamSpecIdleTask {
	GParamSpec parent_instance;
};


static gpointer edsf_persona_store_parent_class = NULL;
static gchar** edsf_persona_store__always_writeable_properties_empty;
static gint edsf_persona_store__always_writeable_properties_empty_length1;
static gchar** edsf_persona_store__always_writeable_properties_empty = NULL;
static gint edsf_persona_store__always_writeable_properties_empty_length1 = 0;
static gint _edsf_persona_store__always_writeable_properties_empty_size_ = 0;
static gpointer edsf_persona_store_idle_task_parent_class = NULL;

void e_source_registry_new (GCancellable* cancellable, GAsyncReadyCallback _callback_, gpointer _user_data_);
ESourceRegistry* e_source_registry_new_finish (GAsyncResult* _res_, GError** error);
GType edsf_persona_store_get_type (void) G_GNUC_CONST;
GType edsf_persona_get_type (void) G_GNUC_CONST;
static gpointer edsf_persona_store_idle_task_ref (gpointer instance);
static void edsf_persona_store_idle_task_unref (gpointer instance);
static GParamSpec* edsf_persona_store_param_spec_idle_task (const gchar* name, const gchar* nick, const gchar* blurb, GType object_type, GParamFlags flags) G_GNUC_UNUSED;
static void edsf_persona_store_value_set_idle_task (GValue* value, gpointer v_object) G_GNUC_UNUSED;
static void edsf_persona_store_value_take_idle_task (GValue* value, gpointer v_object) G_GNUC_UNUSED;
static gpointer edsf_persona_store_value_get_idle_task (const GValue* value) G_GNUC_UNUSED;
static GType edsf_persona_store_idle_task_get_type (void) G_GNUC_CONST G_GNUC_UNUSED;
#define EDSF_PERSONA_STORE_GET_PRIVATE(o) (G_TYPE_INSTANCE_GET_PRIVATE ((o), EDSF_TYPE_PERSONA_STORE, EdsfPersonaStorePrivate))
enum  {
	EDSF_PERSONA_STORE_DUMMY_PROPERTY,
	EDSF_PERSONA_STORE_TYPE_ID,
	EDSF_PERSONA_STORE_CAN_ADD_PERSONAS,
	EDSF_PERSONA_STORE_CAN_ALIAS_PERSONAS,
	EDSF_PERSONA_STORE_CAN_GROUP_PERSONAS,
	EDSF_PERSONA_STORE_CAN_REMOVE_PERSONAS,
	EDSF_PERSONA_STORE_IS_PREPARED,
	EDSF_PERSONA_STORE_ALWAYS_WRITEABLE_PROPERTIES,
	EDSF_PERSONA_STORE_IS_QUIESCENT,
	EDSF_PERSONA_STORE_PERSONAS,
	EDSF_PERSONA_STORE_SOURCE
};
static void _edsf_persona_store_contacts_added_cb (EdsfPersonaStore* self, GList* contacts);
static void __edsf_persona_store_contacts_added_cb_e_book_client_view_objects_added (EBookClientView* _sender, GList* object, gpointer self);
static void _edsf_persona_store_contacts_removed_cb (EdsfPersonaStore* self, GList* contacts_ids);
static void __edsf_persona_store_contacts_removed_cb_e_book_client_view_objects_removed (EBookClientView* _sender, GList* object, gpointer self);
static void _edsf_persona_store_contacts_changed_cb (EdsfPersonaStore* self, GList* contacts);
static void __edsf_persona_store_contacts_changed_cb_e_book_client_view_objects_modified (EBookClientView* _sender, GList* object, gpointer self);
static void _edsf_persona_store_contacts_complete_cb (EdsfPersonaStore* self, GError* err);
static void __edsf_persona_store_contacts_complete_cb_e_book_client_view_complete (EBookClientView* _sender, GError* _error_, gpointer self);
static void _edsf_persona_store_address_book_notify_read_only_cb (EdsfPersonaStore* self, GObject* address_book, GParamSpec* pspec);
static void __edsf_persona_store_address_book_notify_read_only_cb_g_object_notify (GObject* _sender, GParamSpec* pspec, gpointer self);
static void _edsf_persona_store_source_registry_changed_cb (EdsfPersonaStore* self, ESource* list);
static void __edsf_persona_store_source_registry_changed_cb_e_source_registry_source_removed (ESourceRegistry* _sender, ESource* source, gpointer self);
static void __edsf_persona_store_source_registry_changed_cb_e_source_registry_source_disabled (ESourceRegistry* _sender, ESource* source, gpointer self);
#define EDSF_PERSONA_STORE__property_change_timeout ((guint) 30)
#define EDSF_PERSONA_STORE_android_favourite_group_name "Starred in Android"
#define EDSF_PERSONA_STORE_anti_links_attribute_name "X-FOLKS-ANTI-LINKS"
static void edsf_persona_store_create_address_book_data_free (gpointer _data);
void edsf_persona_store_create_address_book (const gchar* id, GAsyncReadyCallback _callback_, gpointer _user_data_);
void edsf_persona_store_create_address_book_finish (GAsyncResult* _res_, GError** error);
static gboolean edsf_persona_store_create_address_book_co (EdsfPersonaStoreCreateAddressBookData* _data_);
static void edsf_persona_store_create_address_book_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
static void edsf_persona_store_remove_address_book_data_free (gpointer _data);
void edsf_persona_store_remove_address_book (EdsfPersonaStore* store, GAsyncReadyCallback _callback_, gpointer _user_data_);
void edsf_persona_store_remove_address_book_finish (GAsyncResult* _res_, GError** error);
static gboolean edsf_persona_store_remove_address_book_co (EdsfPersonaStoreRemoveAddressBookData* _data_);
ESource* edsf_persona_store_get_source (EdsfPersonaStore* self);
static void edsf_persona_store_remove_address_book_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
static void _edsf_persona_store_update_trust_level (EdsfPersonaStore* self);
EdsfPersonaStore* edsf_persona_store_new (ESource* s) G_GNUC_DEPRECATED;
EdsfPersonaStore* edsf_persona_store_construct (GType object_type, ESource* s);
EdsfPersonaStore* edsf_persona_store_new_with_source_registry (ESourceRegistry* r, ESource* s);
EdsfPersonaStore* edsf_persona_store_construct_with_source_registry (GType object_type, ESourceRegistry* r, ESource* s);
static void edsf_persona_store_real_add_persona_from_details_data_free (gpointer _data);
static void edsf_persona_store_real_add_persona_from_details (FolksPersonaStore* base, GHashTable* details, GAsyncReadyCallback _callback_, gpointer _user_data_);
static gboolean edsf_persona_store_real_add_persona_from_details_co (EdsfPersonaStoreAddPersonaFromDetailsData* _data_);
static void _edsf_persona_store_set_contact_attributes_string (EdsfPersonaStore* self, EContact* contact, GeeSet* new_attributes, const gchar* attrib_name, EContactField field_id);
static void _edsf_persona_store_set_contact_avatar (EdsfPersonaStore* self, EContact* contact, GLoadableIcon* avatar, GAsyncReadyCallback _callback_, gpointer _user_data_);
static void _edsf_persona_store_set_contact_avatar_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error);
static void edsf_persona_store_add_persona_from_details_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
static void _edsf_persona_store_set_contact_im_fds (EdsfPersonaStore* self, EContact* contact, GeeMultiMap* im_fds);
static void _edsf_persona_store_set_contact_postal_addresses (EdsfPersonaStore* self, EContact* contact, GeeSet* postal_fds);
static void _edsf_persona_store_set_contact_name (EdsfPersonaStore* self, EContact* contact, FolksStructuredName* _sname);
static void _edsf_persona_store_set_contact_local_ids (EdsfPersonaStore* self, EContact* contact, GeeSet* local_ids);
static void _edsf_persona_store_set_contact_location (EdsfPersonaStore* self, EContact* contact, FolksLocation* location);
static void _edsf_persona_store_set_contact_web_service_addresses (EdsfPersonaStore* self, EContact* contact, GeeMultiMap* web_service_addresses);
static void _edsf_persona_store_set_contact_notes (EdsfPersonaStore* self, EContact* contact, GeeSet* notes);
static void _edsf_persona_store_set_contact_gender (EdsfPersonaStore* self, EContact* contact, FolksGender gender);
static void _edsf_persona_store_set_contact_urls (EdsfPersonaStore* self, EContact* contact, GeeSet* urls);
static void _edsf_persona_store_set_contact_birthday (EdsfPersonaStore* self, EContact* contact, GDateTime* _bday);
static void _edsf_persona_store_set_contact_roles (EdsfPersonaStore* self, EContact* contact, GeeSet* roles);
static void _edsf_persona_store_set_contact_groups (EdsfPersonaStore* self, EContact* contact, GeeSet* groups, gboolean is_favourite);
static void _edsf_persona_store_set_contact_is_favourite (EdsfPersonaStore* self, EContact* contact, gboolean is_favourite);
gchar* edsf_persona_build_iid (const gchar* store_id, const gchar* contact_id);
EdsfPersona* edsf_persona_new (EdsfPersonaStore* store, EContact* contact);
EdsfPersona* edsf_persona_construct (GType object_type, EdsfPersonaStore* store, EContact* contact);
static void edsf_persona_store_real_remove_persona_data_free (gpointer _data);
static void edsf_persona_store_real_remove_persona (FolksPersonaStore* base, FolksPersona* persona, GAsyncReadyCallback _callback_, gpointer _user_data_);
static gboolean edsf_persona_store_real_remove_persona_co (EdsfPersonaStoreRemovePersonaData* _data_);
EContact* edsf_persona_get_contact (EdsfPersona* self);
static void edsf_persona_store_remove_persona_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
static void edsf_persona_store_real_prepare_data_free (gpointer _data);
static void edsf_persona_store_real_prepare (FolksPersonaStore* base, GAsyncReadyCallback _callback_, gpointer _user_data_);
static gboolean edsf_persona_store_real_prepare_co (EdsfPersonaStorePrepareData* _data_);
static void edsf_persona_store_prepare_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
static void _edsf_persona_store_open_address_book (EdsfPersonaStore* self, GAsyncReadyCallback _callback_, gpointer _user_data_);
static void _edsf_persona_store_open_address_book_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error);
static void _edsf_persona_store_notify_if_default (EdsfPersonaStore* self);
static FolksPersonaDetail _edsf_persona_store_eds_field_name_to_folks_persona_detail (EdsfPersonaStore* self, const gchar* eds_field_name);
static gboolean _vala_string_array_contains (gchar** stack, int stack_length, gchar* needle);
static void _edsf_persona_store_open_address_book_data_free (gpointer _data);
static gboolean _edsf_persona_store_open_address_book_co (EdsfPersonaStoreOpenAddressBookData* _data_);
static void _edsf_persona_store_address_book_opened_cb (EdsfPersonaStore* self, GError* err, EBookClient* address_book);
static void _edsf_persona_store_open_address_book_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
static gboolean __edsf_persona_store_open_address_book_co_gsource_func (gpointer self);
static void _edsf_persona_store_commit_modified_property_data_free (gpointer _data);
static void _edsf_persona_store_commit_modified_property (EdsfPersonaStore* self, EdsfPersona* persona, const gchar* property_name, GAsyncReadyCallback _callback_, gpointer _user_data_);
static void _edsf_persona_store_commit_modified_property_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error);
static gboolean _edsf_persona_store_commit_modified_property_co (EdsfPersonaStoreCommitModifiedPropertyData* _data_);
static Block2Data* block2_data_ref (Block2Data* _data2_);
static void block2_data_unref (void * _userdata_);
static Block3Data* block3_data_ref (Block3Data* _data3_);
static void block3_data_unref (void * _userdata_);
static void ___lambda9_ (Block3Data* _data3_, GObject* obj, GParamSpec* pspec);
static void ____lambda9__g_object_notify (GObject* _sender, GParamSpec* pspec, gpointer self);
static void _edsf_persona_store_commit_modified_property_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
static gboolean ___lambda10_ (Block3Data* _data3_);
static gboolean ____lambda10__gsource_func (gpointer self);
static GError* edsf_persona_store_e_client_error_to_property_error (EdsfPersonaStore* self, const gchar* property_name, GError* error_in);
static void _edsf_persona_store_remove_attribute (EdsfPersonaStore* self, EContact* contact, const gchar* attr_name);
static void _edsf_persona_store_set_avatar_data_free (gpointer _data);
void _edsf_persona_store_set_avatar (EdsfPersonaStore* self, EdsfPersona* persona, GLoadableIcon* avatar, GAsyncReadyCallback _callback_, gpointer _user_data_);
void _edsf_persona_store_set_avatar_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error);
static gboolean _edsf_persona_store_set_avatar_co (EdsfPersonaStoreSetAvatarData* _data_);
static void _edsf_persona_store_set_avatar_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
static void _edsf_persona_store_set_web_service_addresses_data_free (gpointer _data);
void _edsf_persona_store_set_web_service_addresses (EdsfPersonaStore* self, EdsfPersona* persona, GeeMultiMap* web_service_addresses, GAsyncReadyCallback _callback_, gpointer _user_data_);
void _edsf_persona_store_set_web_service_addresses_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error);
static gboolean _edsf_persona_store_set_web_service_addresses_co (EdsfPersonaStoreSetWebServiceAddressesData* _data_);
static void _edsf_persona_store_set_web_service_addresses_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
static EVCardAttributeParam* _vala_EVCardAttributeParam_copy (EVCardAttributeParam* self);
static void _vala_EVCardAttributeParam_free (EVCardAttributeParam* self);
static void _vala_EVCardAttribute_free (EVCardAttribute* self);
static void _edsf_persona_store_set_urls_data_free (gpointer _data);
void _edsf_persona_store_set_urls (EdsfPersonaStore* self, EdsfPersona* persona, GeeSet* urls, GAsyncReadyCallback _callback_, gpointer _user_data_);
void _edsf_persona_store_set_urls_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error);
static gboolean _edsf_persona_store_set_urls_co (EdsfPersonaStoreSetUrlsData* _data_);
static void _edsf_persona_store_set_urls_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
static GType edsf_persona_url_type_mapping_get_type (void) G_GNUC_CONST G_GNUC_UNUSED;
static EdsfPersonaUrlTypeMapping* edsf_persona_url_type_mapping_dup (const EdsfPersonaUrlTypeMapping* self);
static void edsf_persona_url_type_mapping_free (EdsfPersonaUrlTypeMapping* self);
static void edsf_persona_url_type_mapping_copy (const EdsfPersonaUrlTypeMapping* self, EdsfPersonaUrlTypeMapping* dest);
static void edsf_persona_url_type_mapping_destroy (EdsfPersonaUrlTypeMapping* self);
static void _edsf_persona_store_set_local_ids_data_free (gpointer _data);
void _edsf_persona_store_set_local_ids (EdsfPersonaStore* self, EdsfPersona* persona, GeeSet* local_ids, GAsyncReadyCallback _callback_, gpointer _user_data_);
void _edsf_persona_store_set_local_ids_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error);
static gboolean _edsf_persona_store_set_local_ids_co (EdsfPersonaStoreSetLocalIdsData* _data_);
static void _edsf_persona_store_set_local_ids_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
static void _edsf_persona_store_set_is_favourite_data_free (gpointer _data);
void _edsf_persona_store_set_is_favourite (EdsfPersonaStore* self, EdsfPersona* persona, gboolean is_favourite, GAsyncReadyCallback _callback_, gpointer _user_data_);
void _edsf_persona_store_set_is_favourite_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error);
static gboolean _edsf_persona_store_set_is_favourite_co (EdsfPersonaStoreSetIsFavouriteData* _data_);
static void _edsf_persona_store_set_is_favourite_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
static void _edsf_persona_store_set_contact_avatar_data_free (gpointer _data);
static gboolean _edsf_persona_store_set_contact_avatar_co (EdsfPersonaStoreSetContactAvatarData* _data_);
static void _edsf_persona_store_set_contact_avatar_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
static void _vala_EContactPhoto_free (EContactPhoto* self);
static void _edsf_persona_store_set_emails_data_free (gpointer _data);
void _edsf_persona_store_set_emails (EdsfPersonaStore* self, EdsfPersona* persona, GeeSet* emails, GAsyncReadyCallback _callback_, gpointer _user_data_);
void _edsf_persona_store_set_emails_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error);
static gboolean _edsf_persona_store_set_emails_co (EdsfPersonaStoreSetEmailsData* _data_);
static void _edsf_persona_store_set_emails_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
static void _edsf_persona_store_set_phones_data_free (gpointer _data);
void _edsf_persona_store_set_phones (EdsfPersonaStore* self, EdsfPersona* persona, GeeSet* phones, GAsyncReadyCallback _callback_, gpointer _user_data_);
void _edsf_persona_store_set_phones_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error);
static gboolean _edsf_persona_store_set_phones_co (EdsfPersonaStoreSetPhonesData* _data_);
static void _edsf_persona_store_set_phones_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
static void _edsf_persona_store_set_postal_addresses_data_free (gpointer _data);
void _edsf_persona_store_set_postal_addresses (EdsfPersonaStore* self, EdsfPersona* persona, GeeSet* postal_fds, GAsyncReadyCallback _callback_, gpointer _user_data_);
void _edsf_persona_store_set_postal_addresses_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error);
static gboolean _edsf_persona_store_set_postal_addresses_co (EdsfPersonaStoreSetPostalAddressesData* _data_);
static void _edsf_persona_store_set_postal_addresses_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
static void _edsf_persona_store_set_contact_attributes (EdsfPersonaStore* self, GType t_type, GBoxedCopyFunc t_dup_func, GDestroyNotify t_destroy_func, EContact* contact, GeeSet* new_attributes, EdsfPersonaStoreFieldToAttribute fill_attribute, void* fill_attribute_target, const gchar* attrib_name, EContactField field_id);
static void __lambda3_ (EdsfPersonaStore* self, EVCardAttribute* attr, FolksPostalAddress* address);
static void ___lambda3__edsf_persona_store_field_to_attribute (EVCardAttribute* attr, gconstpointer value, gpointer self);
static void __vala_EVCardAttribute_free0_ (gpointer var);
static void _g_list_free___vala_EVCardAttribute_free0_ (GList* self);
static void __lambda2_ (EdsfPersonaStore* self, EVCardAttribute* attr, const gchar* value);
static void ___lambda2__edsf_persona_store_field_to_attribute (EVCardAttribute* attr, gconstpointer value, gpointer self);
static void _edsf_persona_store_set_full_name_data_free (gpointer _data);
void _edsf_persona_store_set_full_name (EdsfPersonaStore* self, EdsfPersona* persona, const gchar* full_name, GAsyncReadyCallback _callback_, gpointer _user_data_);
void _edsf_persona_store_set_full_name_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error);
static gboolean _edsf_persona_store_set_full_name_co (EdsfPersonaStoreSetFullNameData* _data_);
static void _edsf_persona_store_set_full_name_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
static void _edsf_persona_store_set_nickname_data_free (gpointer _data);
void _edsf_persona_store_set_nickname (EdsfPersonaStore* self, EdsfPersona* persona, const gchar* nickname, GAsyncReadyCallback _callback_, gpointer _user_data_);
void _edsf_persona_store_set_nickname_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error);
static gboolean _edsf_persona_store_set_nickname_co (EdsfPersonaStoreSetNicknameData* _data_);
static void _edsf_persona_store_set_nickname_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
static void _edsf_persona_store_set_notes_data_free (gpointer _data);
void _edsf_persona_store_set_notes (EdsfPersonaStore* self, EdsfPersona* persona, GeeSet* notes, GAsyncReadyCallback _callback_, gpointer _user_data_);
void _edsf_persona_store_set_notes_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error);
static gboolean _edsf_persona_store_set_notes_co (EdsfPersonaStoreSetNotesData* _data_);
static void _edsf_persona_store_set_notes_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
static void _edsf_persona_store_set_birthday_data_free (gpointer _data);
void _edsf_persona_store_set_birthday (EdsfPersonaStore* self, EdsfPersona* persona, GDateTime* bday, GAsyncReadyCallback _callback_, gpointer _user_data_);
void _edsf_persona_store_set_birthday_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error);
static gboolean _edsf_persona_store_set_birthday_co (EdsfPersonaStoreSetBirthdayData* _data_);
static void _edsf_persona_store_set_birthday_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
static void _vala_EContactDate_free (EContactDate* self);
static EContactDate* _vala_EContactDate_copy (EContactDate* self);
static void _edsf_persona_store_set_roles_data_free (gpointer _data);
void _edsf_persona_store_set_roles (EdsfPersonaStore* self, EdsfPersona* persona, GeeSet* roles, GAsyncReadyCallback _callback_, gpointer _user_data_);
void _edsf_persona_store_set_roles_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error);
static gboolean _edsf_persona_store_set_roles_co (EdsfPersonaStoreSetRolesData* _data_);
static void _edsf_persona_store_set_roles_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
static void _edsf_persona_store_set_structured_name_data_free (gpointer _data);
void _edsf_persona_store_set_structured_name (EdsfPersonaStore* self, EdsfPersona* persona, FolksStructuredName* sname, GAsyncReadyCallback _callback_, gpointer _user_data_);
void _edsf_persona_store_set_structured_name_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error);
static gboolean _edsf_persona_store_set_structured_name_co (EdsfPersonaStoreSetStructuredNameData* _data_);
static void _edsf_persona_store_set_structured_name_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
static void _vala_EContactName_free (EContactName* self);
static void _edsf_persona_store_set_im_fds_data_free (gpointer _data);
void _edsf_persona_store_set_im_fds (EdsfPersonaStore* self, EdsfPersona* persona, GeeMultiMap* im_fds, GAsyncReadyCallback _callback_, gpointer _user_data_);
void _edsf_persona_store_set_im_fds_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error);
static gboolean _edsf_persona_store_set_im_fds_co (EdsfPersonaStoreSetImFdsData* _data_);
static void _edsf_persona_store_set_im_fds_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
GHashTable* _edsf_persona_get_im_eds_map (void);
static void _edsf_persona_store_set_groups_data_free (gpointer _data);
void _edsf_persona_store_set_groups (EdsfPersonaStore* self, EdsfPersona* persona, GeeSet* groups, GAsyncReadyCallback _callback_, gpointer _user_data_);
void _edsf_persona_store_set_groups_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error);
static gboolean _edsf_persona_store_set_groups_co (EdsfPersonaStoreSetGroupsData* _data_);
static void _edsf_persona_store_set_groups_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
static void _edsf_persona_store_set_system_groups_data_free (gpointer _data);
void _edsf_persona_store_set_system_groups (EdsfPersonaStore* self, EdsfPersona* persona, GeeSet* system_groups, GAsyncReadyCallback _callback_, gpointer _user_data_);
void _edsf_persona_store_set_system_groups_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error);
static gboolean _edsf_persona_store_set_system_groups_co (EdsfPersonaStoreSetSystemGroupsData* _data_);
gboolean _edsf_persona_store_is_google_contacts_address_book (EdsfPersonaStore* self);
GeeSet* edsf_persona_get_system_groups (EdsfPersona* self);
static void _edsf_persona_store_set_contact_system_groups (EdsfPersonaStore* self, EContact* contact, GeeSet* system_groups);
static void _edsf_persona_store_set_system_groups_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
static void _g_free0_ (gpointer var);
static void _g_list_free__g_free0_ (GList* self);
static EVCardAttribute* _vala_EVCardAttribute_copy (EVCardAttribute* self);
static void _edsf_persona_store_set_gender_data_free (gpointer _data);
void _edsf_persona_store_set_gender (EdsfPersonaStore* self, EdsfPersona* persona, FolksGender gender, GAsyncReadyCallback _callback_, gpointer _user_data_);
void _edsf_persona_store_set_gender_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error);
static gboolean _edsf_persona_store_set_gender_co (EdsfPersonaStoreSetGenderData* _data_);
static void _edsf_persona_store_set_gender_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
#define EDSF_PERSONA_gender_attribute_name "X-GENDER"
#define EDSF_PERSONA_gender_male "M"
#define EDSF_PERSONA_gender_female "F"
static void _edsf_persona_store_set_anti_links_data_free (gpointer _data);
void _edsf_persona_store_set_anti_links (EdsfPersonaStore* self, EdsfPersona* persona, GeeSet* anti_links, GAsyncReadyCallback _callback_, gpointer _user_data_);
void _edsf_persona_store_set_anti_links_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error);
static gboolean _edsf_persona_store_set_anti_links_co (EdsfPersonaStoreSetAntiLinksData* _data_);
static void _edsf_persona_store_set_contact_anti_links (EdsfPersonaStore* self, EContact* contact, GeeSet* anti_links);
static void _edsf_persona_store_set_anti_links_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
static void _edsf_persona_store_set_location_data_free (gpointer _data);
void _edsf_persona_store_set_location (EdsfPersonaStore* self, EdsfPersona* persona, FolksLocation* location, GAsyncReadyCallback _callback_, gpointer _user_data_);
void _edsf_persona_store_set_location_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error);
static gboolean _edsf_persona_store_set_location_co (EdsfPersonaStoreSetLocationData* _data_);
static void _edsf_persona_store_set_location_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
static void _vala_EContactGeo_free (EContactGeo* self);
static void _edsf_persona_store_idle_queue (EdsfPersonaStore* self, GSourceFunc callback, void* callback_target, GDestroyNotify callback_target_destroy_notify);
static EdsfPersonaStoreIdleTask* edsf_persona_store_idle_task_new (void);
static EdsfPersonaStoreIdleTask* edsf_persona_store_idle_task_construct (GType object_type);
static gboolean _edsf_persona_store_idle_process (EdsfPersonaStore* self);
static gboolean __edsf_persona_store_idle_process_gsource_func (gpointer self);
static GeeLinkedList* _edsf_persona_store_copy_contacts (EdsfPersonaStore* self, GList* contacts);
static GeeLinkedList* _edsf_persona_store_copy_contacts_ids (EdsfPersonaStore* self, GList* contacts_ids);
static Block4Data* block4_data_ref (Block4Data* _data4_);
static void block4_data_unref (void * _userdata_);
static gboolean __lambda4_ (Block4Data* _data4_);
static gboolean _edsf_persona_store_contacts_added_idle (EdsfPersonaStore* self, GeeList* contacts);
static gboolean ___lambda4__gsource_func (gpointer self);
gchar* edsf_persona_build_iid_from_contact (const gchar* store_id, EContact* contact);
static Block5Data* block5_data_ref (Block5Data* _data5_);
static void block5_data_unref (void * _userdata_);
static gboolean __lambda6_ (Block5Data* _data5_);
static gboolean _edsf_persona_store_contacts_changed_idle (EdsfPersonaStore* self, GeeList* contacts);
static gboolean ___lambda6__gsource_func (gpointer self);
void _edsf_persona_update (EdsfPersona* self, EContact* updated_contact);
static Block6Data* block6_data_ref (Block6Data* _data6_);
static void block6_data_unref (void * _userdata_);
static gboolean __lambda5_ (Block6Data* _data6_);
static gboolean _edsf_persona_store_contacts_removed_idle (EdsfPersonaStore* self, GeeList* contacts_ids);
static gboolean ___lambda5__gsource_func (gpointer self);
static Block7Data* block7_data_ref (Block7Data* _data7_);
static void block7_data_unref (void * _userdata_);
static gboolean __lambda11_ (Block7Data* _data7_);
static gboolean _edsf_persona_store_contacts_complete_idle_cb (EdsfPersonaStore* self, GError* err);
static gboolean ___lambda11__gsource_func (gpointer self);
static gboolean _edsf_persona_store_backend_name_matches (EdsfPersonaStore* self, const gchar* backend_name);
static gboolean _edsf_persona_store_is_in_source_registry (EdsfPersonaStore* self);
static void _edsf_persona_store_source_changed_cb (EdsfPersonaStore* self);
static void edsf_persona_store_set_source (EdsfPersonaStore* self, ESource* value);
static GObject * edsf_persona_store_constructor (GType type, guint n_construct_properties, GObjectConstructParam * construct_properties);
static void __edsf_persona_store_source_changed_cb_e_source_changed (ESource* _sender, gpointer self);
enum  {
	EDSF_PERSONA_STORE_IDLE_TASK_DUMMY_PROPERTY
};
static void edsf_persona_store_idle_task_finalize (EdsfPersonaStoreIdleTask* obj);
static void edsf_persona_store_finalize (GObject* obj);
static void _vala_edsf_persona_store_get_property (GObject * object, guint property_id, GValue * value, GParamSpec * pspec);
static void _vala_edsf_persona_store_set_property (GObject * object, guint property_id, const GValue * value, GParamSpec * pspec);
static void _vala_array_destroy (gpointer array, gint array_length, GDestroyNotify destroy_func);
static void _vala_array_free (gpointer array, gint array_length, GDestroyNotify destroy_func);
static gint _vala_array_length (gpointer array);

extern const EdsfPersonaUrlTypeMapping EDSF_PERSONA__url_properties[4];

static void __edsf_persona_store_contacts_added_cb_e_book_client_view_objects_added (EBookClientView* _sender, GList* object, gpointer self) {
	_edsf_persona_store_contacts_added_cb (self, object);
}


static void __edsf_persona_store_contacts_removed_cb_e_book_client_view_objects_removed (EBookClientView* _sender, GList* object, gpointer self) {
	_edsf_persona_store_contacts_removed_cb (self, object);
}


static void __edsf_persona_store_contacts_changed_cb_e_book_client_view_objects_modified (EBookClientView* _sender, GList* object, gpointer self) {
	_edsf_persona_store_contacts_changed_cb (self, object);
}


static void __edsf_persona_store_contacts_complete_cb_e_book_client_view_complete (EBookClientView* _sender, GError* _error_, gpointer self) {
	_edsf_persona_store_contacts_complete_cb (self, _error_);
}


static void __edsf_persona_store_address_book_notify_read_only_cb_g_object_notify (GObject* _sender, GParamSpec* pspec, gpointer self) {
	_edsf_persona_store_address_book_notify_read_only_cb (self, _sender, pspec);
}


static void __edsf_persona_store_source_registry_changed_cb_e_source_registry_source_removed (ESourceRegistry* _sender, ESource* source, gpointer self) {
	_edsf_persona_store_source_registry_changed_cb (self, source);
}


static void __edsf_persona_store_source_registry_changed_cb_e_source_registry_source_disabled (ESourceRegistry* _sender, ESource* source, gpointer self) {
	_edsf_persona_store_source_registry_changed_cb (self, source);
}


static void edsf_persona_store_create_address_book_data_free (gpointer _data) {
	EdsfPersonaStoreCreateAddressBookData* _data_;
	_data_ = _data;
	_g_free0 (_data_->id);
	g_slice_free (EdsfPersonaStoreCreateAddressBookData, _data_);
}


void edsf_persona_store_create_address_book (const gchar* id, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	EdsfPersonaStoreCreateAddressBookData* _data_;
	const gchar* _tmp0_;
	gchar* _tmp1_;
	_data_ = g_slice_new0 (EdsfPersonaStoreCreateAddressBookData);
	_data_->_async_result = g_simple_async_result_new (NULL, _callback_, _user_data_, edsf_persona_store_create_address_book);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, edsf_persona_store_create_address_book_data_free);
	_tmp0_ = id;
	_tmp1_ = g_strdup (_tmp0_);
	_g_free0 (_data_->id);
	_data_->id = _tmp1_;
	edsf_persona_store_create_address_book_co (_data_);
}


void edsf_persona_store_create_address_book_finish (GAsyncResult* _res_, GError** error) {
	EdsfPersonaStoreCreateAddressBookData* _data_;
	if (g_simple_async_result_propagate_error (G_SIMPLE_ASYNC_RESULT (_res_), error)) {
		return;
	}
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


/**
   * Create a new address book with the given ID.
   *
   * A new Address Book will be created with the given ID and the EDS
   * SourceRegistry will notice the new Address Book source and will emit
   * source_added with the new {@link E.Source} object which {@link Eds.Backend}
   * will then create a new {@link Edsf.PersonaStore} from.
   *
   * @param id the name and id for the new address book
   * @throws GLib.Error if an error occurred while creating or committing to
   * the {@link E.SourceRegistry}
   *
   * @since 0.9.0
   */
static gpointer _g_object_ref0 (gpointer self) {
	return self ? g_object_ref (self) : NULL;
}


static void edsf_persona_store_create_address_book_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	EdsfPersonaStoreCreateAddressBookData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	edsf_persona_store_create_address_book_co (_data_);
}


static gboolean edsf_persona_store_create_address_book_co (EdsfPersonaStoreCreateAddressBookData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		case 2:
		goto _state_2;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_tmp0_ = _data_->id;
	g_debug ("edsf-persona-store.vala:94: Creating addressbook %s", _data_->_tmp0_);
	_data_->_tmp1_ = _data_->id;
	_data_->_tmp2_ = e_source_new_with_uid (_data_->_tmp1_, NULL, &_data_->_inner_error_);
	_data_->new_source = _data_->_tmp2_;
	if (_data_->_inner_error_ != NULL) {
		g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
		g_error_free (_data_->_inner_error_);
		if (_data_->_state_ == 0) {
			g_simple_async_result_complete_in_idle (_data_->_async_result);
		} else {
			g_simple_async_result_complete (_data_->_async_result);
		}
		g_object_unref (_data_->_async_result);
		return FALSE;
	}
	_data_->_tmp3_ = _data_->new_source;
	e_source_set_parent (_data_->_tmp3_, "local-stub");
	_data_->_tmp4_ = _data_->new_source;
	_data_->_tmp5_ = _data_->id;
	e_source_set_display_name (_data_->_tmp4_, _data_->_tmp5_);
	_data_->_tmp6_ = _data_->new_source;
	_data_->_tmp7_ = NULL;
	_data_->_tmp7_ = e_source_get_extension (_data_->_tmp6_, "Address Book");
	_data_->_tmp8_ = _g_object_ref0 (G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp7_, e_source_address_book_get_type (), ESourceAddressBook));
	_data_->ab_extension = _data_->_tmp8_;
	_data_->_tmp9_ = _data_->ab_extension;
	e_source_backend_set_backend_name ((ESourceBackend*) _data_->_tmp9_, "local");
	_data_->_state_ = 1;
	e_source_registry_new (NULL, edsf_persona_store_create_address_book_ready, _data_);
	return FALSE;
	_state_1:
	_data_->_tmp10_ = NULL;
	_data_->_tmp10_ = e_source_registry_new_finish (_data_->_res_, &_data_->_inner_error_);
	_data_->registry = _data_->_tmp10_;
	if (_data_->_inner_error_ != NULL) {
		g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
		g_error_free (_data_->_inner_error_);
		_g_object_unref0 (_data_->ab_extension);
		_g_object_unref0 (_data_->new_source);
		if (_data_->_state_ == 0) {
			g_simple_async_result_complete_in_idle (_data_->_async_result);
		} else {
			g_simple_async_result_complete (_data_->_async_result);
		}
		g_object_unref (_data_->_async_result);
		return FALSE;
	}
	_data_->_tmp11_ = _data_->registry;
	_data_->_tmp12_ = _data_->new_source;
	_data_->_state_ = 2;
	e_source_registry_commit_source (_data_->_tmp11_, _data_->_tmp12_, NULL, edsf_persona_store_create_address_book_ready, _data_);
	return FALSE;
	_state_2:
	e_source_registry_commit_source_finish (_data_->_tmp11_, _data_->_res_, &_data_->_inner_error_);
	if (_data_->_inner_error_ != NULL) {
		g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
		g_error_free (_data_->_inner_error_);
		_g_object_unref0 (_data_->registry);
		_g_object_unref0 (_data_->ab_extension);
		_g_object_unref0 (_data_->new_source);
		if (_data_->_state_ == 0) {
			g_simple_async_result_complete_in_idle (_data_->_async_result);
		} else {
			g_simple_async_result_complete (_data_->_async_result);
		}
		g_object_unref (_data_->_async_result);
		return FALSE;
	}
	_g_object_unref0 (_data_->registry);
	_g_object_unref0 (_data_->ab_extension);
	_g_object_unref0 (_data_->new_source);
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static void edsf_persona_store_remove_address_book_data_free (gpointer _data) {
	EdsfPersonaStoreRemoveAddressBookData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->store);
	g_slice_free (EdsfPersonaStoreRemoveAddressBookData, _data_);
}


void edsf_persona_store_remove_address_book (EdsfPersonaStore* store, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	EdsfPersonaStoreRemoveAddressBookData* _data_;
	EdsfPersonaStore* _tmp0_;
	EdsfPersonaStore* _tmp1_;
	_data_ = g_slice_new0 (EdsfPersonaStoreRemoveAddressBookData);
	_data_->_async_result = g_simple_async_result_new (NULL, _callback_, _user_data_, edsf_persona_store_remove_address_book);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, edsf_persona_store_remove_address_book_data_free);
	_tmp0_ = store;
	_tmp1_ = _g_object_ref0 (_tmp0_);
	_g_object_unref0 (_data_->store);
	_data_->store = _tmp1_;
	edsf_persona_store_remove_address_book_co (_data_);
}


void edsf_persona_store_remove_address_book_finish (GAsyncResult* _res_, GError** error) {
	EdsfPersonaStoreRemoveAddressBookData* _data_;
	if (g_simple_async_result_propagate_error (G_SIMPLE_ASYNC_RESULT (_res_), error)) {
		return;
	}
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


/**
   * Remove a persona store's address book permamently.
   *
   * This is a utility function to remove an {@link Edsf.PersonaStore}'s address
   * book from the disk permanently.  This simply wraps the EDS API to do 
   * the same.
   *
   * @param store the PersonaStore to delete the address book for.
   * @throws GLib.Error if an error occurred in {@link E.Source.remove}
   *
   * @since 0.9.0
   */
static void edsf_persona_store_remove_address_book_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	EdsfPersonaStoreRemoveAddressBookData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	edsf_persona_store_remove_address_book_co (_data_);
}


static gboolean edsf_persona_store_remove_address_book_co (EdsfPersonaStoreRemoveAddressBookData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_tmp0_ = _data_->store;
	_data_->_tmp1_ = _data_->_tmp0_->priv->_source;
	_data_->_state_ = 1;
	e_source_remove (_data_->_tmp1_, NULL, edsf_persona_store_remove_address_book_ready, _data_);
	return FALSE;
	_state_1:
	e_source_remove_finish (_data_->_tmp1_, _data_->_res_, &_data_->_inner_error_);
	if (_data_->_inner_error_ != NULL) {
		g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
		g_error_free (_data_->_inner_error_);
		if (_data_->_state_ == 0) {
			g_simple_async_result_complete_in_idle (_data_->_async_result);
		} else {
			g_simple_async_result_complete (_data_->_async_result);
		}
		g_object_unref (_data_->_async_result);
		return FALSE;
	}
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static void _edsf_persona_store_address_book_notify_read_only_cb (EdsfPersonaStore* self, GObject* address_book, GParamSpec* pspec) {
	g_return_if_fail (self != NULL);
	g_return_if_fail (address_book != NULL);
	g_return_if_fail (pspec != NULL);
	_edsf_persona_store_update_trust_level (self);
	g_object_notify ((GObject*) self, "can-add-personas");
	g_object_notify ((GObject*) self, "can-remove-personas");
}


/**
   * Create a new PersonaStore.
   *
   * Create a new persona store to store the {@link Persona}s for the contacts
   *
   * @param s the e-d-s source being represented by the persona store
   *
   * @since 0.6.0
   */
EdsfPersonaStore* edsf_persona_store_construct (GType object_type, ESource* s) {
	EdsfPersonaStore * self = NULL;
	gchar* eds_uid = NULL;
	ESource* _tmp0_;
	const gchar* _tmp1_ = NULL;
	gchar* _tmp2_;
	gchar* eds_name = NULL;
	ESource* _tmp3_;
	const gchar* _tmp4_ = NULL;
	gchar* _tmp5_;
	ESource* _tmp6_;
	g_return_val_if_fail (s != NULL, NULL);
	_tmp0_ = s;
	_tmp1_ = e_source_get_uid (_tmp0_);
	_tmp2_ = g_strdup (_tmp1_);
	eds_uid = _tmp2_;
	_tmp3_ = s;
	_tmp4_ = e_source_get_display_name (_tmp3_);
	_tmp5_ = g_strdup (_tmp4_);
	eds_name = _tmp5_;
	_tmp6_ = s;
	self = (EdsfPersonaStore*) g_object_new (object_type, "id", eds_uid, "display-name", eds_name, "source", _tmp6_, NULL);
	_g_object_unref0 (self->priv->_source_registry);
	self->priv->_source_registry = NULL;
	_g_free0 (eds_name);
	_g_free0 (eds_uid);
	return self;
}


EdsfPersonaStore* edsf_persona_store_new (ESource* s) {
	return edsf_persona_store_construct (EDSF_TYPE_PERSONA_STORE, s);
}


/**
   * Create a new PersonaStore.
   *
   * Create a new persona store to store the {@link Persona}s for the contacts
   * in ``s``. Passing a re-used source registry to the constructor (compared to
   * the old {@link Edsf.PersonaStore} constructor) saves a lot of time and
   * D-Bus round trips.
   *
   * @param r the EDS source registry giving access to all EDS sources
   * @param s the EDS source being represented by the persona store
   *
   * @since 0.7.2
   */
EdsfPersonaStore* edsf_persona_store_construct_with_source_registry (GType object_type, ESourceRegistry* r, ESource* s) {
	EdsfPersonaStore * self = NULL;
	gchar* eds_uid = NULL;
	ESource* _tmp0_;
	const gchar* _tmp1_ = NULL;
	gchar* _tmp2_;
	ESource* _tmp3_;
	ESourceRegistry* _tmp4_;
	ESourceRegistry* _tmp5_;
	g_return_val_if_fail (r != NULL, NULL);
	g_return_val_if_fail (s != NULL, NULL);
	_tmp0_ = s;
	_tmp1_ = e_source_get_uid (_tmp0_);
	_tmp2_ = g_strdup (_tmp1_);
	eds_uid = _tmp2_;
	_tmp3_ = s;
	self = (EdsfPersonaStore*) g_object_new (object_type, "id", eds_uid, "display-name", eds_uid, "source", _tmp3_, NULL);
	_tmp4_ = r;
	_tmp5_ = _g_object_ref0 (_tmp4_);
	_g_object_unref0 (self->priv->_source_registry);
	self->priv->_source_registry = _tmp5_;
	_g_free0 (eds_uid);
	return self;
}


EdsfPersonaStore* edsf_persona_store_new_with_source_registry (ESourceRegistry* r, ESource* s) {
	return edsf_persona_store_construct_with_source_registry (EDSF_TYPE_PERSONA_STORE, r, s);
}


static void edsf_persona_store_real_add_persona_from_details_data_free (gpointer _data) {
	EdsfPersonaStoreAddPersonaFromDetailsData* _data_;
	_data_ = _data;
	_g_hash_table_unref0 (_data_->details);
	_g_object_unref0 (_data_->result);
	_g_object_unref0 (_data_->self);
	g_slice_free (EdsfPersonaStoreAddPersonaFromDetailsData, _data_);
}


static gpointer _g_hash_table_ref0 (gpointer self) {
	return self ? g_hash_table_ref (self) : NULL;
}


static void edsf_persona_store_real_add_persona_from_details (FolksPersonaStore* base, GHashTable* details, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	EdsfPersonaStore * self;
	EdsfPersonaStoreAddPersonaFromDetailsData* _data_;
	EdsfPersonaStore* _tmp0_;
	GHashTable* _tmp1_;
	GHashTable* _tmp2_;
	self = (EdsfPersonaStore*) base;
	_data_ = g_slice_new0 (EdsfPersonaStoreAddPersonaFromDetailsData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, edsf_persona_store_real_add_persona_from_details);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, edsf_persona_store_real_add_persona_from_details_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	_tmp1_ = details;
	_tmp2_ = _g_hash_table_ref0 (_tmp1_);
	_g_hash_table_unref0 (_data_->details);
	_data_->details = _tmp2_;
	edsf_persona_store_real_add_persona_from_details_co (_data_);
}


static FolksPersona* edsf_persona_store_real_add_persona_from_details_finish (FolksPersonaStore* base, GAsyncResult* _res_, GError** error) {
	FolksPersona* result;
	EdsfPersonaStoreAddPersonaFromDetailsData* _data_;
	if (g_simple_async_result_propagate_error (G_SIMPLE_ASYNC_RESULT (_res_), error)) {
		return NULL;
	}
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
	result = _data_->result;
	_data_->result = NULL;
	return result;
}


/**
   * Add a new {@link Persona} to the PersonaStore.
   *
   * Accepted keys for ``details`` are:
   * - PersonaStore.detail_key (PersonaDetail.AVATAR)
   * - PersonaStore.detail_key (PersonaDetail.BIRTHDAY)
   * - PersonaStore.detail_key (PersonaDetail.EMAIL_ADDRESSES)
   * - PersonaStore.detail_key (PersonaDetail.FULL_NAME)
   * - PersonaStore.detail_key (PersonaDetail.GENDER)
   * - PersonaStore.detail_key (PersonaDetail.IM_ADDRESSES)
   * - PersonaStore.detail_key (PersonaDetail.IS_FAVOURITE)
   * - PersonaStore.detail_key (PersonaDetail.NICKNAME)
   * - PersonaStore.detail_key (PersonaDetail.PHONE_NUMBERS)
   * - PersonaStore.detail_key (PersonaDetail.POSTAL_ADDRESSES)
   * - PersonaStore.detail_key (PersonaDetail.ROLES)
   * - PersonaStore.detail_key (PersonaDetail.STRUCTURED_NAME)
   * - PersonaStore.detail_key (PersonaDetail.LOCAL_IDS)
   * - PersonaStore.detail_key (PersonaDetail.LOCATION)
   * - PersonaStore.detail_key (PersonaDetail.WEB_SERVICE_ADDRESSES)
   * - PersonaStore.detail_key (PersonaDetail.NOTES)
   * - PersonaStore.detail_key (PersonaDetail.URLS)
   * - PersonaStore.detail_key (PersonaDetail.GROUPS)
   *
   * See {@link Folks.PersonaStore.add_persona_from_details}.
   *
   * @throws Folks.PersonaStoreError.STORE_OFFLINE if the store hasnt been
   * prepared
   * @throws Folks.PersonaStoreError.CREATE_FAILED if creating the persona in
   * the EDS store failed
   *
   * @since 0.6.0
   */
static void edsf_persona_store_add_persona_from_details_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	EdsfPersonaStoreAddPersonaFromDetailsData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	edsf_persona_store_real_add_persona_from_details_co (_data_);
}


static gpointer _g_date_time_ref0 (gpointer self) {
	return self ? g_date_time_ref (self) : NULL;
}


static gboolean edsf_persona_store_real_add_persona_from_details_co (EdsfPersonaStoreAddPersonaFromDetailsData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		case 2:
		goto _state_2;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_tmp0_ = _data_->self->priv->_is_prepared;
	if (!_data_->_tmp0_) {
		_data_->_tmp1_ = g_error_new_literal (FOLKS_PERSONA_STORE_ERROR, FOLKS_PERSONA_STORE_ERROR_STORE_OFFLINE, "Persona store has not yet been prepared.");
		_data_->_inner_error_ = _data_->_tmp1_;
		if (_data_->_inner_error_->domain == FOLKS_PERSONA_STORE_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	_data_->_tmp2_ = e_contact_new ();
	_data_->contact = _data_->_tmp2_;
	_data_->_tmp3_ = _data_->details;
	g_hash_table_iter_init (&_data_->iter, _data_->_tmp3_);
	_data_->is_fav = FALSE;
	_data_->_tmp4_ = folks_small_set_new (G_TYPE_STRING, (GBoxedCopyFunc) g_strdup, g_free, NULL, NULL, NULL, NULL, NULL, NULL);
	_data_->groups = (GeeSet*) _data_->_tmp4_;
	while (TRUE) {
		_data_->_tmp5_ = NULL;
		_data_->_tmp6_ = NULL;
		_data_->_tmp7_ = FALSE;
		_data_->_tmp7_ = g_hash_table_iter_next (&_data_->iter, &_data_->_tmp5_, &_data_->_tmp6_);
		_data_->k = _data_->_tmp5_;
		_data_->_v = _data_->_tmp6_;
		if (!(_data_->_tmp7_ == TRUE)) {
			break;
		}
		_data_->_tmp8_ = _data_->_v;
		if (_data_->_tmp8_ == NULL) {
			continue;
		}
		_data_->_tmp9_ = _data_->_v;
		_data_->v = (GValue) (*_data_->_tmp9_);
		_data_->_tmp10_ = _data_->k;
		_data_->_tmp11_ = NULL;
		_data_->_tmp11_ = folks_persona_store_detail_key (FOLKS_PERSONA_DETAIL_FULL_NAME);
		if (g_strcmp0 (_data_->_tmp10_, _data_->_tmp11_) == 0) {
			_data_->_tmp12_ = NULL;
			_data_->_tmp12_ = g_value_get_string (&_data_->v);
			_data_->_tmp13_ = g_strdup (_data_->_tmp12_);
			_data_->full_name = _data_->_tmp13_;
			_data_->_tmp15_ = _data_->full_name;
			if (_data_->_tmp15_ != NULL) {
				_data_->_tmp16_ = _data_->full_name;
				_data_->_tmp14_ = g_strcmp0 ((const gchar*) _data_->_tmp16_, "") == 0;
			} else {
				_data_->_tmp14_ = FALSE;
			}
			_data_->_tmp17_ = _data_->_tmp14_;
			if (_data_->_tmp17_) {
				_g_free0 (_data_->full_name);
				_data_->full_name = NULL;
			}
			_data_->_tmp18_ = _data_->contact;
			_data_->_tmp19_ = 0;
			_data_->_tmp19_ = e_contact_field_id ("full_name");
			_data_->_tmp20_ = _data_->full_name;
			e_contact_set (_data_->_tmp18_, _data_->_tmp19_, _data_->_tmp20_);
			_g_free0 (_data_->full_name);
		} else {
			_data_->_tmp21_ = _data_->k;
			_data_->_tmp22_ = NULL;
			_data_->_tmp22_ = folks_persona_store_detail_key (FOLKS_PERSONA_DETAIL_NICKNAME);
			if (g_strcmp0 (_data_->_tmp21_, _data_->_tmp22_) == 0) {
				_data_->_tmp23_ = NULL;
				_data_->_tmp23_ = g_value_get_string (&_data_->v);
				_data_->_tmp24_ = g_strdup (_data_->_tmp23_);
				_data_->nickname = _data_->_tmp24_;
				_data_->_tmp26_ = _data_->nickname;
				if (_data_->_tmp26_ != NULL) {
					_data_->_tmp27_ = _data_->nickname;
					_data_->_tmp25_ = g_strcmp0 ((const gchar*) _data_->_tmp27_, "") == 0;
				} else {
					_data_->_tmp25_ = FALSE;
				}
				_data_->_tmp28_ = _data_->_tmp25_;
				if (_data_->_tmp28_) {
					_g_free0 (_data_->nickname);
					_data_->nickname = NULL;
				}
				_data_->_tmp29_ = _data_->contact;
				_data_->_tmp30_ = 0;
				_data_->_tmp30_ = e_contact_field_id ("nickname");
				_data_->_tmp31_ = _data_->nickname;
				e_contact_set (_data_->_tmp29_, _data_->_tmp30_, _data_->_tmp31_);
				_g_free0 (_data_->nickname);
			} else {
				_data_->_tmp32_ = _data_->k;
				_data_->_tmp33_ = NULL;
				_data_->_tmp33_ = folks_persona_store_detail_key (FOLKS_PERSONA_DETAIL_EMAIL_ADDRESSES);
				if (g_strcmp0 (_data_->_tmp32_, _data_->_tmp33_) == 0) {
					_data_->_tmp34_ = NULL;
					_data_->_tmp34_ = g_value_get_object (&_data_->v);
					_data_->_tmp35_ = _g_object_ref0 (G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp34_, GEE_TYPE_SET, GeeSet));
					_data_->email_addresses = _data_->_tmp35_;
					_data_->_tmp36_ = _data_->contact;
					_data_->_tmp37_ = _data_->email_addresses;
					_edsf_persona_store_set_contact_attributes_string (_data_->self, _data_->_tmp36_, _data_->_tmp37_, "EMAIL", E_CONTACT_EMAIL);
					_g_object_unref0 (_data_->email_addresses);
				} else {
					_data_->_tmp38_ = _data_->k;
					_data_->_tmp39_ = NULL;
					_data_->_tmp39_ = folks_persona_store_detail_key (FOLKS_PERSONA_DETAIL_AVATAR);
					if (g_strcmp0 (_data_->_tmp38_, _data_->_tmp39_) == 0) {
						{
							_data_->_tmp40_ = NULL;
							_data_->_tmp40_ = g_value_get_object (&_data_->v);
							_data_->_tmp41_ = _g_object_ref0 (G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp40_, g_loadable_icon_get_type (), GLoadableIcon));
							_data_->avatar = _data_->_tmp41_;
							_data_->_tmp42_ = _data_->contact;
							_data_->_tmp43_ = _data_->avatar;
							_data_->_state_ = 1;
							_edsf_persona_store_set_contact_avatar (_data_->self, _data_->_tmp42_, _data_->_tmp43_, edsf_persona_store_add_persona_from_details_ready, _data_);
							return FALSE;
							_state_1:
							_edsf_persona_store_set_contact_avatar_finish (_data_->self, _data_->_res_, &_data_->_inner_error_);
							if (_data_->_inner_error_ != NULL) {
								_g_object_unref0 (_data_->avatar);
								if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
									goto __catch6_folks_property_error;
								}
								_g_object_unref0 (_data_->avatar);
								_g_object_unref0 (_data_->groups);
								_g_object_unref0 (_data_->contact);
								g_critical ("file %s: line %d: unexpected error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
								g_clear_error (&_data_->_inner_error_);
								return FALSE;
							}
							_g_object_unref0 (_data_->avatar);
						}
						goto __finally6;
						__catch6_folks_property_error:
						{
							_data_->e1 = _data_->_inner_error_;
							_data_->_inner_error_ = NULL;
							_data_->_tmp44_ = _data_->e1;
							_data_->_tmp45_ = _data_->_tmp44_->message;
							g_warning ("edsf-persona-store.vala:470: Couldn't set avatar on the EContact: %s", _data_->_tmp45_);
							_g_error_free0 (_data_->e1);
						}
						__finally6:
						if (_data_->_inner_error_ != NULL) {
							if (_data_->_inner_error_->domain == FOLKS_PERSONA_STORE_ERROR) {
								g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
								g_error_free (_data_->_inner_error_);
								_g_object_unref0 (_data_->groups);
								_g_object_unref0 (_data_->contact);
								if (_data_->_state_ == 0) {
									g_simple_async_result_complete_in_idle (_data_->_async_result);
								} else {
									g_simple_async_result_complete (_data_->_async_result);
								}
								g_object_unref (_data_->_async_result);
								return FALSE;
							} else {
								_g_object_unref0 (_data_->groups);
								_g_object_unref0 (_data_->contact);
								g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
								g_clear_error (&_data_->_inner_error_);
								return FALSE;
							}
						}
					} else {
						_data_->_tmp46_ = _data_->k;
						_data_->_tmp47_ = NULL;
						_data_->_tmp47_ = folks_persona_store_detail_key (FOLKS_PERSONA_DETAIL_IM_ADDRESSES);
						if (g_strcmp0 (_data_->_tmp46_, _data_->_tmp47_) == 0) {
							_data_->_tmp48_ = NULL;
							_data_->_tmp48_ = g_value_get_object (&_data_->v);
							_data_->_tmp49_ = _g_object_ref0 (G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp48_, GEE_TYPE_MULTI_MAP, GeeMultiMap));
							_data_->im_fds = _data_->_tmp49_;
							_data_->_tmp50_ = _data_->contact;
							_data_->_tmp51_ = _data_->im_fds;
							_edsf_persona_store_set_contact_im_fds (_data_->self, _data_->_tmp50_, _data_->_tmp51_);
							_g_object_unref0 (_data_->im_fds);
						} else {
							_data_->_tmp52_ = _data_->k;
							_data_->_tmp53_ = NULL;
							_data_->_tmp53_ = folks_persona_store_detail_key (FOLKS_PERSONA_DETAIL_PHONE_NUMBERS);
							if (g_strcmp0 (_data_->_tmp52_, _data_->_tmp53_) == 0) {
								_data_->_tmp54_ = NULL;
								_data_->_tmp54_ = g_value_get_object (&_data_->v);
								_data_->_tmp55_ = _g_object_ref0 (G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp54_, GEE_TYPE_SET, GeeSet));
								_data_->phone_numbers = _data_->_tmp55_;
								_data_->_tmp56_ = _data_->contact;
								_data_->_tmp57_ = _data_->phone_numbers;
								_edsf_persona_store_set_contact_attributes_string (_data_->self, _data_->_tmp56_, _data_->_tmp57_, "TEL", E_CONTACT_TEL);
								_g_object_unref0 (_data_->phone_numbers);
							} else {
								_data_->_tmp58_ = _data_->k;
								_data_->_tmp59_ = NULL;
								_data_->_tmp59_ = folks_persona_store_detail_key (FOLKS_PERSONA_DETAIL_POSTAL_ADDRESSES);
								if (g_strcmp0 (_data_->_tmp58_, _data_->_tmp59_) == 0) {
									_data_->_tmp60_ = NULL;
									_data_->_tmp60_ = g_value_get_object (&_data_->v);
									_data_->_tmp61_ = _g_object_ref0 (G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp60_, GEE_TYPE_SET, GeeSet));
									_data_->postal_fds = _data_->_tmp61_;
									_data_->_tmp62_ = _data_->contact;
									_data_->_tmp63_ = _data_->postal_fds;
									_edsf_persona_store_set_contact_postal_addresses (_data_->self, _data_->_tmp62_, _data_->_tmp63_);
									_g_object_unref0 (_data_->postal_fds);
								} else {
									_data_->_tmp64_ = _data_->k;
									_data_->_tmp65_ = NULL;
									_data_->_tmp65_ = folks_persona_store_detail_key (FOLKS_PERSONA_DETAIL_STRUCTURED_NAME);
									if (g_strcmp0 (_data_->_tmp64_, _data_->_tmp65_) == 0) {
										_data_->_tmp66_ = NULL;
										_data_->_tmp66_ = g_value_get_object (&_data_->v);
										_data_->_tmp67_ = _g_object_ref0 (G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp66_, FOLKS_TYPE_STRUCTURED_NAME, FolksStructuredName));
										_data_->sname = _data_->_tmp67_;
										_data_->_tmp68_ = _data_->contact;
										_data_->_tmp69_ = _data_->sname;
										_edsf_persona_store_set_contact_name (_data_->self, _data_->_tmp68_, _data_->_tmp69_);
										_g_object_unref0 (_data_->sname);
									} else {
										_data_->_tmp70_ = _data_->k;
										_data_->_tmp71_ = NULL;
										_data_->_tmp71_ = folks_persona_store_detail_key (FOLKS_PERSONA_DETAIL_LOCAL_IDS);
										if (g_strcmp0 (_data_->_tmp70_, _data_->_tmp71_) == 0) {
											_data_->_tmp72_ = NULL;
											_data_->_tmp72_ = g_value_get_object (&_data_->v);
											_data_->_tmp73_ = _g_object_ref0 (G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp72_, GEE_TYPE_SET, GeeSet));
											_data_->local_ids = _data_->_tmp73_;
											_data_->_tmp74_ = _data_->contact;
											_data_->_tmp75_ = _data_->local_ids;
											_edsf_persona_store_set_contact_local_ids (_data_->self, _data_->_tmp74_, _data_->_tmp75_);
											_g_object_unref0 (_data_->local_ids);
										} else {
											_data_->_tmp76_ = _data_->k;
											_data_->_tmp77_ = NULL;
											_data_->_tmp77_ = folks_persona_store_detail_key (FOLKS_PERSONA_DETAIL_LOCATION);
											if (g_strcmp0 (_data_->_tmp76_, _data_->_tmp77_) == 0) {
												_data_->_tmp78_ = NULL;
												_data_->_tmp78_ = g_value_get_object (&_data_->v);
												_data_->_tmp79_ = _g_object_ref0 (G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp78_, FOLKS_TYPE_LOCATION, FolksLocation));
												_data_->location = _data_->_tmp79_;
												_data_->_tmp80_ = _data_->contact;
												_data_->_tmp81_ = _data_->location;
												_edsf_persona_store_set_contact_location (_data_->self, _data_->_tmp80_, _data_->_tmp81_);
												_g_object_unref0 (_data_->location);
											} else {
												_data_->_tmp82_ = _data_->k;
												_data_->_tmp83_ = NULL;
												_data_->_tmp83_ = folks_persona_store_detail_key (FOLKS_PERSONA_DETAIL_WEB_SERVICE_ADDRESSES);
												if (g_strcmp0 (_data_->_tmp82_, _data_->_tmp83_) == 0) {
													_data_->_tmp84_ = NULL;
													_data_->_tmp84_ = g_value_get_object (&_data_->v);
													_data_->_tmp85_ = _g_object_ref0 (G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp84_, GEE_TYPE_HASH_MULTI_MAP, GeeHashMultiMap));
													_data_->web_service_addresses = _data_->_tmp85_;
													_data_->_tmp86_ = _data_->contact;
													_data_->_tmp87_ = _data_->web_service_addresses;
													_edsf_persona_store_set_contact_web_service_addresses (_data_->self, _data_->_tmp86_, (GeeMultiMap*) _data_->_tmp87_);
													_g_object_unref0 (_data_->web_service_addresses);
												} else {
													_data_->_tmp88_ = _data_->k;
													_data_->_tmp89_ = NULL;
													_data_->_tmp89_ = folks_persona_store_detail_key (FOLKS_PERSONA_DETAIL_NOTES);
													if (g_strcmp0 (_data_->_tmp88_, _data_->_tmp89_) == 0) {
														_data_->_tmp90_ = NULL;
														_data_->_tmp90_ = g_value_get_object (&_data_->v);
														_data_->_tmp91_ = _g_object_ref0 (G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp90_, GEE_TYPE_SET, GeeSet));
														_data_->notes = _data_->_tmp91_;
														_data_->_tmp92_ = _data_->contact;
														_data_->_tmp93_ = _data_->notes;
														_edsf_persona_store_set_contact_notes (_data_->self, _data_->_tmp92_, _data_->_tmp93_);
														_g_object_unref0 (_data_->notes);
													} else {
														_data_->_tmp94_ = _data_->k;
														_data_->_tmp95_ = NULL;
														_data_->_tmp95_ = folks_persona_store_detail_key (FOLKS_PERSONA_DETAIL_GENDER);
														if (g_strcmp0 (_data_->_tmp94_, _data_->_tmp95_) == 0) {
															_data_->_tmp96_ = 0;
															_data_->_tmp96_ = g_value_get_enum (&_data_->v);
															_data_->gender = (FolksGender) _data_->_tmp96_;
															_data_->_tmp97_ = _data_->contact;
															_data_->_tmp98_ = _data_->gender;
															_edsf_persona_store_set_contact_gender (_data_->self, _data_->_tmp97_, _data_->_tmp98_);
														} else {
															_data_->_tmp99_ = _data_->k;
															_data_->_tmp100_ = NULL;
															_data_->_tmp100_ = folks_persona_store_detail_key (FOLKS_PERSONA_DETAIL_URLS);
															if (g_strcmp0 (_data_->_tmp99_, _data_->_tmp100_) == 0) {
																_data_->_tmp101_ = NULL;
																_data_->_tmp101_ = g_value_get_object (&_data_->v);
																_data_->_tmp102_ = _g_object_ref0 (G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp101_, GEE_TYPE_SET, GeeSet));
																_data_->urls = _data_->_tmp102_;
																_data_->_tmp103_ = _data_->contact;
																_data_->_tmp104_ = _data_->urls;
																_edsf_persona_store_set_contact_urls (_data_->self, _data_->_tmp103_, _data_->_tmp104_);
																_g_object_unref0 (_data_->urls);
															} else {
																_data_->_tmp105_ = _data_->k;
																_data_->_tmp106_ = NULL;
																_data_->_tmp106_ = folks_persona_store_detail_key (FOLKS_PERSONA_DETAIL_BIRTHDAY);
																if (g_strcmp0 (_data_->_tmp105_, _data_->_tmp106_) == 0) {
																	_data_->_tmp107_ = NULL;
																	_data_->_tmp107_ = g_value_get_boxed (&_data_->v);
																	_data_->_tmp108_ = _g_date_time_ref0 ((GDateTime*) _data_->_tmp107_);
																	_data_->birthday = _data_->_tmp108_;
																	_data_->_tmp109_ = _data_->contact;
																	_data_->_tmp110_ = _data_->birthday;
																	_edsf_persona_store_set_contact_birthday (_data_->self, _data_->_tmp109_, _data_->_tmp110_);
																	_g_date_time_unref0 (_data_->birthday);
																} else {
																	_data_->_tmp111_ = _data_->k;
																	_data_->_tmp112_ = NULL;
																	_data_->_tmp112_ = folks_persona_store_detail_key (FOLKS_PERSONA_DETAIL_ROLES);
																	if (g_strcmp0 (_data_->_tmp111_, _data_->_tmp112_) == 0) {
																		_data_->_tmp113_ = NULL;
																		_data_->_tmp113_ = g_value_get_object (&_data_->v);
																		_data_->_tmp114_ = _g_object_ref0 (G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp113_, GEE_TYPE_SET, GeeSet));
																		_data_->roles = _data_->_tmp114_;
																		_data_->_tmp115_ = _data_->contact;
																		_data_->_tmp116_ = _data_->roles;
																		_edsf_persona_store_set_contact_roles (_data_->self, _data_->_tmp115_, _data_->_tmp116_);
																		_g_object_unref0 (_data_->roles);
																	} else {
																		_data_->_tmp117_ = _data_->k;
																		_data_->_tmp118_ = NULL;
																		_data_->_tmp118_ = folks_persona_store_detail_key (FOLKS_PERSONA_DETAIL_GROUPS);
																		if (g_strcmp0 (_data_->_tmp117_, _data_->_tmp118_) == 0) {
																			_data_->_tmp119_ = NULL;
																			_data_->_tmp119_ = g_value_get_object (&_data_->v);
																			_data_->_tmp120_ = _g_object_ref0 (G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp119_, GEE_TYPE_SET, GeeSet));
																			_g_object_unref0 (_data_->groups);
																			_data_->groups = _data_->_tmp120_;
																			_data_->_tmp121_ = _data_->contact;
																			_data_->_tmp122_ = _data_->groups;
																			_data_->_tmp123_ = _data_->is_fav;
																			_edsf_persona_store_set_contact_groups (_data_->self, _data_->_tmp121_, _data_->_tmp122_, _data_->_tmp123_);
																		} else {
																			_data_->_tmp124_ = _data_->k;
																			_data_->_tmp125_ = NULL;
																			_data_->_tmp125_ = folks_persona_store_detail_key (FOLKS_PERSONA_DETAIL_IS_FAVOURITE);
																			if (g_strcmp0 (_data_->_tmp124_, _data_->_tmp125_) == 0) {
																				_data_->_tmp126_ = FALSE;
																				_data_->_tmp126_ = g_value_get_boolean (&_data_->v);
																				_data_->is_fav = _data_->_tmp126_;
																				_data_->_tmp127_ = _data_->contact;
																				_data_->_tmp128_ = _data_->is_fav;
																				_edsf_persona_store_set_contact_is_favourite (_data_->self, _data_->_tmp127_, _data_->_tmp128_);
																				_data_->_tmp129_ = _data_->contact;
																				_data_->_tmp130_ = _data_->groups;
																				_data_->_tmp131_ = _data_->is_fav;
																				_edsf_persona_store_set_contact_groups (_data_->self, _data_->_tmp129_, _data_->_tmp130_, _data_->_tmp131_);
																			}
																		}
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
	_data_->_persona = NULL;
	{
		_data_->_tmp132_ = _data_->self->priv->_addressbook;
		_data_->_tmp133_ = _data_->contact;
		_data_->_tmp134_ = NULL;
		_data_->_state_ = 2;
		e_book_client_add_contact (G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp132_, e_book_client_get_type (), EBookClient), _data_->_tmp133_, NULL, edsf_persona_store_add_persona_from_details_ready, _data_);
		return FALSE;
		_state_2:
		_data_->_tmp135_ = FALSE;
		_data_->_tmp135_ = e_book_client_add_contact_finish (G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp132_, e_book_client_get_type (), EBookClient), _data_->_res_, &_data_->_tmp134_, &_data_->_inner_error_);
		_g_free0 (_data_->added_uid);
		_data_->added_uid = _data_->_tmp134_;
		_data_->_result_ = _data_->_tmp135_;
		if (_data_->_inner_error_ != NULL) {
			_g_free0 (_data_->added_uid);
			goto __catch7_g_error;
		}
		_data_->_tmp136_ = _data_->_result_;
		if (_data_->_tmp136_) {
			_data_->_tmp137_ = _data_->added_uid;
			g_debug ("edsf-persona-store.vala:576: Created contact with uid: %s\n", _data_->_tmp137_);
			{
				_data_->_tmp138_ = _data_->self->priv->_personas;
				g_static_rec_mutex_lock (&_data_->self->priv->__lock__personas);
				{
					_data_->_tmp139_ = folks_persona_store_get_id ((FolksPersonaStore*) _data_->self);
					_data_->_tmp140_ = _data_->_tmp139_;
					_data_->_tmp141_ = _data_->added_uid;
					_data_->_tmp142_ = NULL;
					_data_->_tmp142_ = edsf_persona_build_iid (_data_->_tmp140_, _data_->_tmp141_);
					_data_->iid = _data_->_tmp142_;
					_data_->_tmp143_ = _data_->self->priv->_personas;
					_data_->_tmp144_ = _data_->iid;
					_data_->_tmp145_ = NULL;
					_data_->_tmp145_ = gee_abstract_map_get ((GeeAbstractMap*) _data_->_tmp143_, _data_->_tmp144_);
					_g_object_unref0 (_data_->_persona);
					_data_->_persona = (EdsfPersona*) _data_->_tmp145_;
					_data_->_tmp146_ = _data_->_persona;
					if (_data_->_tmp146_ == NULL) {
						_data_->_tmp147_ = _data_->contact;
						_data_->_tmp148_ = 0;
						_data_->_tmp148_ = e_contact_field_id ("id");
						_data_->_tmp149_ = _data_->added_uid;
						e_contact_set (_data_->_tmp147_, _data_->_tmp148_, _data_->_tmp149_);
						_data_->_tmp150_ = _data_->contact;
						_data_->_tmp151_ = edsf_persona_new (_data_->self, _data_->_tmp150_);
						_g_object_unref0 (_data_->persona);
						_data_->persona = _data_->_tmp151_;
						_data_->_tmp152_ = _data_->self->priv->_personas;
						_data_->_tmp153_ = _data_->persona;
						_data_->_tmp154_ = folks_persona_get_iid ((FolksPersona*) _data_->_tmp153_);
						_data_->_tmp155_ = _data_->_tmp154_;
						_data_->_tmp156_ = _data_->persona;
						gee_abstract_map_set ((GeeAbstractMap*) _data_->_tmp152_, _data_->_tmp155_, _data_->_tmp156_);
						_data_->_tmp157_ = folks_small_set_new (EDSF_TYPE_PERSONA, (GBoxedCopyFunc) g_object_ref, g_object_unref, NULL, NULL, NULL, NULL, NULL, NULL);
						_data_->added_personas = _data_->_tmp157_;
						_data_->_tmp158_ = _data_->added_personas;
						_data_->_tmp159_ = _data_->persona;
						gee_abstract_collection_add ((GeeAbstractCollection*) _data_->_tmp158_, _data_->_tmp159_);
						_data_->_tmp160_ = _data_->added_personas;
						_folks_persona_store_emit_personas_changed ((FolksPersonaStore*) _data_->self, (GeeSet*) _data_->_tmp160_, NULL, NULL, NULL, FOLKS_GROUP_DETAILS_CHANGE_REASON_NONE);
						_data_->_tmp161_ = _data_->persona;
						_data_->_tmp162_ = _g_object_ref0 (_data_->_tmp161_);
						_g_object_unref0 (_data_->_persona);
						_data_->_persona = _data_->_tmp162_;
						_g_object_unref0 (_data_->added_personas);
						_g_object_unref0 (_data_->persona);
					}
					_g_free0 (_data_->iid);
				}
				__finally8:
				{
					_data_->_tmp163_ = _data_->self->priv->_personas;
					g_static_rec_mutex_unlock (&_data_->self->priv->__lock__personas);
				}
				if (_data_->_inner_error_ != NULL) {
					_g_free0 (_data_->added_uid);
					goto __catch7_g_error;
				}
			}
		} else {
			_data_->_tmp164_ = g_error_new_literal (FOLKS_PERSONA_STORE_ERROR, FOLKS_PERSONA_STORE_ERROR_CREATE_FAILED, "BookClient.add_contact () failed.");
			_data_->_inner_error_ = _data_->_tmp164_;
			_g_free0 (_data_->added_uid);
			goto __catch7_g_error;
		}
		_g_free0 (_data_->added_uid);
	}
	goto __finally7;
	__catch7_g_error:
	{
		_data_->e = _data_->_inner_error_;
		_data_->_inner_error_ = NULL;
		_data_->_tmp165_ = _data_->e;
		_data_->_tmp166_ = _data_->_tmp165_->message;
		g_warning ("edsf-persona-store.vala:604: add_persona_from_details: %s\n", _data_->_tmp166_);
		_g_error_free0 (_data_->e);
	}
	__finally7:
	if (_data_->_inner_error_ != NULL) {
		if (_data_->_inner_error_->domain == FOLKS_PERSONA_STORE_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			_g_object_unref0 (_data_->_persona);
			_g_object_unref0 (_data_->groups);
			_g_object_unref0 (_data_->contact);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			_g_object_unref0 (_data_->_persona);
			_g_object_unref0 (_data_->groups);
			_g_object_unref0 (_data_->contact);
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	_data_->result = (FolksPersona*) _data_->_persona;
	_g_object_unref0 (_data_->groups);
	_g_object_unref0 (_data_->contact);
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
	_g_object_unref0 (_data_->_persona);
	_g_object_unref0 (_data_->groups);
	_g_object_unref0 (_data_->contact);
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static void edsf_persona_store_real_remove_persona_data_free (gpointer _data) {
	EdsfPersonaStoreRemovePersonaData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->persona);
	_g_object_unref0 (_data_->self);
	g_slice_free (EdsfPersonaStoreRemovePersonaData, _data_);
}


static void edsf_persona_store_real_remove_persona (FolksPersonaStore* base, FolksPersona* persona, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	EdsfPersonaStore * self;
	EdsfPersonaStoreRemovePersonaData* _data_;
	EdsfPersonaStore* _tmp0_;
	FolksPersona* _tmp1_;
	FolksPersona* _tmp2_;
	self = (EdsfPersonaStore*) base;
	_data_ = g_slice_new0 (EdsfPersonaStoreRemovePersonaData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, edsf_persona_store_real_remove_persona);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, edsf_persona_store_real_remove_persona_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	_tmp1_ = persona;
	_tmp2_ = _g_object_ref0 (_tmp1_);
	_g_object_unref0 (_data_->persona);
	_data_->persona = _tmp2_;
	edsf_persona_store_real_remove_persona_co (_data_);
}


static void edsf_persona_store_real_remove_persona_finish (FolksPersonaStore* base, GAsyncResult* _res_, GError** error) {
	EdsfPersonaStoreRemovePersonaData* _data_;
	if (g_simple_async_result_propagate_error (G_SIMPLE_ASYNC_RESULT (_res_), error)) {
		return;
	}
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


/**
   * Remove a {@link Persona} from the PersonaStore.
   *
   * See {@link Folks.PersonaStore.remove_persona}.
   *
   * @param persona the persona that should be removed
   * @throws Folks.PersonaStoreError.STORE_OFFLINE if the store hasnt been
   * prepared or has gone offline
   * @throws Folks.PersonaStoreError.PERMISSION_DENIED if the store denied
   * permission to delete the contact
   * @throws Folks.PersonaStoreError.READ_ONLY if the store is read only
   * @throws Folks.PersonaStoreError.REMOVE_FAILED if any other errors happened
   * in the store
   *
   * @since 0.6.0
   */
static void edsf_persona_store_remove_persona_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	EdsfPersonaStoreRemovePersonaData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	edsf_persona_store_real_remove_persona_co (_data_);
}


static gboolean edsf_persona_store_real_remove_persona_co (EdsfPersonaStoreRemovePersonaData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_tmp0_ = _data_->self->priv->_is_prepared;
	if (!_data_->_tmp0_) {
		_data_->_tmp1_ = g_error_new_literal (FOLKS_PERSONA_STORE_ERROR, FOLKS_PERSONA_STORE_ERROR_STORE_OFFLINE, "Persona store has not yet been prepared.");
		_data_->_inner_error_ = _data_->_tmp1_;
		if (_data_->_inner_error_->domain == FOLKS_PERSONA_STORE_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	{
		_data_->_tmp2_ = _data_->self->priv->_addressbook;
		_data_->_tmp3_ = _data_->persona;
		_data_->_tmp4_ = edsf_persona_get_contact (G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp3_, EDSF_TYPE_PERSONA, EdsfPersona));
		_data_->_tmp5_ = _data_->_tmp4_;
		_data_->_state_ = 1;
		e_book_client_remove_contact (G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp2_, e_book_client_get_type (), EBookClient), _data_->_tmp5_, NULL, edsf_persona_store_remove_persona_ready, _data_);
		return FALSE;
		_state_1:
		e_book_client_remove_contact_finish (G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp2_, e_book_client_get_type (), EBookClient), _data_->_res_, &_data_->_inner_error_);
		if (_data_->_inner_error_ != NULL) {
			goto __catch9_g_error;
		}
	}
	goto __finally9;
	__catch9_g_error:
	{
		_data_->e = _data_->_inner_error_;
		_data_->_inner_error_ = NULL;
		_data_->_tmp6_ = _data_->e;
		if (_data_->_tmp6_->domain == E_BOOK_CLIENT_ERROR) {
			_data_->_tmp7_ = _data_->e;
			if (g_error_matches (_data_->_tmp7_, E_BOOK_CLIENT_ERROR, E_BOOK_CLIENT_ERROR_CONTACT_NOT_FOUND)) {
				_g_error_free0 (_data_->e);
				if (_data_->_state_ == 0) {
					g_simple_async_result_complete_in_idle (_data_->_async_result);
				} else {
					g_simple_async_result_complete (_data_->_async_result);
				}
				g_object_unref (_data_->_async_result);
				return FALSE;
			}
			_data_->_tmp11_ = _data_->e;
			if (g_error_matches (_data_->_tmp11_, E_BOOK_CLIENT_ERROR, E_BOOK_CLIENT_ERROR_NO_SUCH_BOOK)) {
				_data_->_tmp10_ = TRUE;
			} else {
				_data_->_tmp12_ = _data_->e;
				_data_->_tmp10_ = g_error_matches (_data_->_tmp12_, E_BOOK_CLIENT_ERROR, E_BOOK_CLIENT_ERROR_CONTACT_ID_ALREADY_EXISTS);
			}
			_data_->_tmp13_ = _data_->_tmp10_;
			if (_data_->_tmp13_) {
				_data_->_tmp9_ = TRUE;
			} else {
				_data_->_tmp14_ = _data_->e;
				_data_->_tmp9_ = g_error_matches (_data_->_tmp14_, E_BOOK_CLIENT_ERROR, E_BOOK_CLIENT_ERROR_NO_SUCH_SOURCE);
			}
			_data_->_tmp15_ = _data_->_tmp9_;
			if (_data_->_tmp15_) {
				_data_->_tmp8_ = TRUE;
			} else {
				_data_->_tmp16_ = _data_->e;
				_data_->_tmp8_ = g_error_matches (_data_->_tmp16_, E_BOOK_CLIENT_ERROR, E_BOOK_CLIENT_ERROR_NO_SPACE);
			}
			_data_->_tmp17_ = _data_->_tmp8_;
			if (_data_->_tmp17_) {
			}
		} else {
			_data_->_tmp18_ = _data_->e;
			_data_->_tmp19_ = _data_->_tmp18_->domain;
			_data_->_tmp20_ = 0U;
			_data_->_tmp20_ = e_client_error_quark ();
			if (_data_->_tmp19_ == _data_->_tmp20_) {
				_data_->_tmp21_ = _data_->e;
				_data_->_tmp22_ = _data_->_tmp21_->code;
				switch ((EClientError) _data_->_tmp22_) {
					case E_CLIENT_ERROR_REPOSITORY_OFFLINE:
					{
						_data_->_tmp23_ = NULL;
						_data_->_tmp23_ = _ ("Address book %s is offline, so contact %s cannot be removed.");
						_data_->_tmp24_ = folks_persona_store_get_id ((FolksPersonaStore*) _data_->self);
						_data_->_tmp25_ = _data_->_tmp24_;
						_data_->_tmp26_ = _data_->persona;
						_data_->_tmp27_ = folks_persona_get_uid (_data_->_tmp26_);
						_data_->_tmp28_ = _data_->_tmp27_;
						_data_->_tmp29_ = g_error_new (FOLKS_PERSONA_STORE_ERROR, FOLKS_PERSONA_STORE_ERROR_STORE_OFFLINE, _data_->_tmp23_, _data_->_tmp25_, _data_->_tmp28_);
						_data_->_inner_error_ = _data_->_tmp29_;
						_g_error_free0 (_data_->e);
						goto __finally9;
					}
					case E_CLIENT_ERROR_PERMISSION_DENIED:
					{
						_data_->_tmp30_ = NULL;
						_data_->_tmp30_ = _ ("Permission denied to remove contact %s: %s");
						_data_->_tmp31_ = _data_->persona;
						_data_->_tmp32_ = folks_persona_get_uid (_data_->_tmp31_);
						_data_->_tmp33_ = _data_->_tmp32_;
						_data_->_tmp34_ = _data_->e;
						_data_->_tmp35_ = _data_->_tmp34_->message;
						_data_->_tmp36_ = g_error_new (FOLKS_PERSONA_STORE_ERROR, FOLKS_PERSONA_STORE_ERROR_PERMISSION_DENIED, _data_->_tmp30_, _data_->_tmp33_, _data_->_tmp35_);
						_data_->_inner_error_ = _data_->_tmp36_;
						_g_error_free0 (_data_->e);
						goto __finally9;
					}
					case E_CLIENT_ERROR_NOT_SUPPORTED:
					{
						_data_->_tmp37_ = NULL;
						_data_->_tmp37_ = _ ("Removing contacts isn't supported by this persona store: %s");
						_data_->_tmp38_ = _data_->e;
						_data_->_tmp39_ = _data_->_tmp38_->message;
						_data_->_tmp40_ = g_error_new (FOLKS_PERSONA_STORE_ERROR, FOLKS_PERSONA_STORE_ERROR_READ_ONLY, _data_->_tmp37_, _data_->_tmp39_);
						_data_->_inner_error_ = _data_->_tmp40_;
						_g_error_free0 (_data_->e);
						goto __finally9;
					}
					default:
					case E_CLIENT_ERROR_AUTHENTICATION_REQUIRED:
					case E_CLIENT_ERROR_INVALID_ARG:
					case E_CLIENT_ERROR_BUSY:
					case E_CLIENT_ERROR_DBUS_ERROR:
					case E_CLIENT_ERROR_OTHER_ERROR:
					case E_CLIENT_ERROR_COULD_NOT_CANCEL:
					case E_CLIENT_ERROR_AUTHENTICATION_FAILED:
					case E_CLIENT_ERROR_TLS_NOT_AVAILABLE:
					case E_CLIENT_ERROR_OFFLINE_UNAVAILABLE:
					case E_CLIENT_ERROR_UNSUPPORTED_AUTHENTICATION_METHOD:
					case E_CLIENT_ERROR_SEARCH_SIZE_LIMIT_EXCEEDED:
					case E_CLIENT_ERROR_SEARCH_TIME_LIMIT_EXCEEDED:
					case E_CLIENT_ERROR_INVALID_QUERY:
					case E_CLIENT_ERROR_QUERY_REFUSED:
					{
						break;
					}
				}
			}
		}
		_data_->_tmp41_ = NULL;
		_data_->_tmp41_ = _ ("Can't remove contact %s: %s");
		_data_->_tmp42_ = _data_->persona;
		_data_->_tmp43_ = folks_persona_get_uid (_data_->_tmp42_);
		_data_->_tmp44_ = _data_->_tmp43_;
		_data_->_tmp45_ = _data_->e;
		_data_->_tmp46_ = _data_->_tmp45_->message;
		_data_->_tmp47_ = g_error_new (FOLKS_PERSONA_STORE_ERROR, FOLKS_PERSONA_STORE_ERROR_REMOVE_FAILED, _data_->_tmp41_, _data_->_tmp44_, _data_->_tmp46_);
		_data_->_inner_error_ = _data_->_tmp47_;
		_g_error_free0 (_data_->e);
		goto __finally9;
	}
	__finally9:
	if (_data_->_inner_error_ != NULL) {
		if (_data_->_inner_error_->domain == FOLKS_PERSONA_STORE_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static void edsf_persona_store_real_prepare_data_free (gpointer _data) {
	EdsfPersonaStorePrepareData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->self);
	g_slice_free (EdsfPersonaStorePrepareData, _data_);
}


static void edsf_persona_store_real_prepare (FolksPersonaStore* base, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	EdsfPersonaStore * self;
	EdsfPersonaStorePrepareData* _data_;
	EdsfPersonaStore* _tmp0_;
	self = (EdsfPersonaStore*) base;
	_data_ = g_slice_new0 (EdsfPersonaStorePrepareData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, edsf_persona_store_real_prepare);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, edsf_persona_store_real_prepare_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	edsf_persona_store_real_prepare_co (_data_);
}


static void edsf_persona_store_real_prepare_finish (FolksPersonaStore* base, GAsyncResult* _res_, GError** error) {
	EdsfPersonaStorePrepareData* _data_;
	if (g_simple_async_result_propagate_error (G_SIMPLE_ASYNC_RESULT (_res_), error)) {
		return;
	}
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


/**
   * Prepare the PersonaStore for use.
   *
   * See {@link Folks.PersonaStore.prepare}.
   *
   * @throws Folks.PersonaStoreError.STORE_OFFLINE if the EDS store is offline
   * @throws Folks.PersonaStoreError.PERMISSION_DENIED if permission was denied
   * to open the EDS store
   * @throws Folks.PersonaStoreError.INVALID_ARGUMENT if any other error
   * occurred in the EDS store
   *
   * @since 0.6.0
   */
static void edsf_persona_store_prepare_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	EdsfPersonaStorePrepareData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	edsf_persona_store_real_prepare_co (_data_);
}


static gboolean _vala_string_array_contains (gchar** stack, int stack_length, gchar* needle) {
	int i;
	for (i = 0; i < stack_length; i++) {
		if (g_strcmp0 (stack[i], needle) == 0) {
			return TRUE;
		}
	}
	return FALSE;
}


static gboolean edsf_persona_store_real_prepare_co (EdsfPersonaStorePrepareData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		case 2:
		goto _state_2;
		case 3:
		goto _state_3;
		case 4:
		goto _state_4;
		case 5:
		goto _state_5;
		case 6:
		goto _state_6;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_tmp0_ = folks_persona_store_get_id ((FolksPersonaStore*) _data_->self);
	_data_->_tmp1_ = _data_->_tmp0_;
	folks_internal_profiling_start ("preparing Edsf.PersonaStore (ID: %s)", _data_->_tmp1_, NULL);
	_data_->_tmp3_ = _data_->self->priv->_is_prepared;
	if (_data_->_tmp3_ == TRUE) {
		_data_->_tmp2_ = TRUE;
	} else {
		_data_->_tmp4_ = _data_->self->priv->_prepare_pending;
		_data_->_tmp2_ = _data_->_tmp4_ == TRUE;
	}
	_data_->_tmp5_ = _data_->_tmp2_;
	if (_data_->_tmp5_) {
		if (_data_->_state_ == 0) {
			g_simple_async_result_complete_in_idle (_data_->_async_result);
		} else {
			g_simple_async_result_complete (_data_->_async_result);
		}
		g_object_unref (_data_->_async_result);
		return FALSE;
	}
	{
		_data_->self->priv->_prepare_pending = TRUE;
		{
			_data_->_tmp6_ = _data_->self->priv->_source_registry;
			if (_data_->_tmp6_ == NULL) {
				_data_->_state_ = 1;
				e_source_registry_new (NULL, edsf_persona_store_prepare_ready, _data_);
				return FALSE;
				_state_1:
				_data_->_tmp8_ = NULL;
				_data_->_tmp8_ = e_source_registry_new_finish (_data_->_res_, &_data_->_inner_error_);
				_data_->_tmp7_ = _data_->_tmp8_;
				if (_data_->_inner_error_ != NULL) {
					goto __catch11_g_error;
				}
				_g_object_unref0 (_data_->self->priv->_source_registry);
				_data_->self->priv->_source_registry = _data_->_tmp7_;
			}
			_data_->_tmp9_ = _data_->self->priv->_source_registry;
			g_signal_connect_object (G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp9_, e_source_registry_get_type (), ESourceRegistry), "source-removed", (GCallback) __edsf_persona_store_source_registry_changed_cb_e_source_registry_source_removed, _data_->self, 0);
			_data_->_tmp10_ = _data_->self->priv->_source_registry;
			g_signal_connect_object (G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp10_, e_source_registry_get_type (), ESourceRegistry), "source-disabled", (GCallback) __edsf_persona_store_source_registry_changed_cb_e_source_registry_source_disabled, _data_->self, 0);
			_data_->_tmp12_ = _data_->self->priv->_source;
			_data_->_state_ = 2;
			e_book_client_connect (_data_->_tmp12_, NULL, edsf_persona_store_prepare_ready, _data_);
			return FALSE;
			_state_2:
			_data_->_tmp13_ = NULL;
			_data_->_tmp13_ = e_book_client_connect_finish (_data_->_res_, &_data_->_inner_error_);
			_data_->_tmp11_ = _data_->_tmp13_;
			if (_data_->_inner_error_ != NULL) {
				goto __catch11_g_error;
			}
			_g_object_unref0 (_data_->self->priv->_addressbook);
			_data_->self->priv->_addressbook = _data_->_tmp11_;
			_data_->_tmp14_ = _data_->self->priv->_addressbook;
			g_signal_connect_object ((GObject*) G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp14_, e_book_client_get_type (), EBookClient), "notify::readonly", (GCallback) __edsf_persona_store_address_book_notify_read_only_cb_g_object_notify, _data_->self, 0);
			_data_->_state_ = 3;
			_edsf_persona_store_open_address_book (_data_->self, edsf_persona_store_prepare_ready, _data_);
			return FALSE;
			_state_3:
			_edsf_persona_store_open_address_book_finish (_data_->self, _data_->_res_, &_data_->_inner_error_);
			if (_data_->_inner_error_ != NULL) {
				goto __catch11_g_error;
			}
			_data_->_tmp15_ = _data_->self->priv->_addressbook;
			_data_->_tmp16_ = folks_persona_store_get_id ((FolksPersonaStore*) _data_->self);
			_data_->_tmp17_ = _data_->_tmp16_;
			g_debug ("Successfully finished opening address book %p for " "persona store %s (%p).", _data_->_tmp15_, _data_->_tmp17_, _data_->self);
			_data_->_tmp18_ = folks_persona_store_get_id ((FolksPersonaStore*) _data_->self);
			_data_->_tmp19_ = _data_->_tmp18_;
			folks_internal_profiling_point ("opened address book in " "Edsf.PersonaStore (ID: %s)", _data_->_tmp19_, NULL);
			_edsf_persona_store_notify_if_default (_data_->self);
			_edsf_persona_store_update_trust_level (_data_->self);
		}
		goto __finally11;
		__catch11_g_error:
		{
			_data_->e1 = _data_->_inner_error_;
			_data_->_inner_error_ = NULL;
			g_signal_emit_by_name ((FolksPersonaStore*) _data_->self, "removed");
			_data_->_tmp20_ = _data_->e1;
			if (_data_->_tmp20_->domain == E_BOOK_CLIENT_ERROR) {
				_data_->_tmp25_ = _data_->e1;
				if (g_error_matches (_data_->_tmp25_, E_BOOK_CLIENT_ERROR, E_BOOK_CLIENT_ERROR_NO_SUCH_BOOK)) {
					_data_->_tmp24_ = TRUE;
				} else {
					_data_->_tmp26_ = _data_->e1;
					_data_->_tmp24_ = g_error_matches (_data_->_tmp26_, E_BOOK_CLIENT_ERROR, E_BOOK_CLIENT_ERROR_NO_SUCH_SOURCE);
				}
				_data_->_tmp27_ = _data_->_tmp24_;
				if (_data_->_tmp27_) {
					_data_->_tmp23_ = TRUE;
				} else {
					_data_->_tmp28_ = _data_->e1;
					_data_->_tmp23_ = g_error_matches (_data_->_tmp28_, E_BOOK_CLIENT_ERROR, E_BOOK_CLIENT_ERROR_CONTACT_NOT_FOUND);
				}
				_data_->_tmp29_ = _data_->_tmp23_;
				if (_data_->_tmp29_) {
					_data_->_tmp22_ = TRUE;
				} else {
					_data_->_tmp30_ = _data_->e1;
					_data_->_tmp22_ = g_error_matches (_data_->_tmp30_, E_BOOK_CLIENT_ERROR, E_BOOK_CLIENT_ERROR_CONTACT_ID_ALREADY_EXISTS);
				}
				_data_->_tmp31_ = _data_->_tmp22_;
				if (_data_->_tmp31_) {
					_data_->_tmp21_ = TRUE;
				} else {
					_data_->_tmp32_ = _data_->e1;
					_data_->_tmp21_ = g_error_matches (_data_->_tmp32_, E_BOOK_CLIENT_ERROR, E_BOOK_CLIENT_ERROR_NO_SPACE);
				}
				_data_->_tmp33_ = _data_->_tmp21_;
				if (_data_->_tmp33_) {
				}
			} else {
				_data_->_tmp34_ = _data_->e1;
				_data_->_tmp35_ = _data_->_tmp34_->domain;
				_data_->_tmp36_ = 0U;
				_data_->_tmp36_ = e_client_error_quark ();
				if (_data_->_tmp35_ == _data_->_tmp36_) {
					_data_->_tmp37_ = _data_->e1;
					_data_->_tmp38_ = _data_->_tmp37_->code;
					switch ((EClientError) _data_->_tmp38_) {
						case E_CLIENT_ERROR_REPOSITORY_OFFLINE:
						{
							_data_->_tmp39_ = NULL;
							_data_->_tmp39_ = _ ("Address book %s is offline.");
							_data_->_tmp40_ = folks_persona_store_get_id ((FolksPersonaStore*) _data_->self);
							_data_->_tmp41_ = _data_->_tmp40_;
							_data_->_tmp42_ = g_error_new (FOLKS_PERSONA_STORE_ERROR, FOLKS_PERSONA_STORE_ERROR_STORE_OFFLINE, _data_->_tmp39_, _data_->_tmp41_);
							_data_->_inner_error_ = _data_->_tmp42_;
							_g_error_free0 (_data_->e1);
							goto __finally11;
						}
						case E_CLIENT_ERROR_PERMISSION_DENIED:
						{
							_data_->_tmp43_ = NULL;
							_data_->_tmp43_ = _ ("Permission denied to open address book %s: %s");
							_data_->_tmp44_ = folks_persona_store_get_id ((FolksPersonaStore*) _data_->self);
							_data_->_tmp45_ = _data_->_tmp44_;
							_data_->_tmp46_ = _data_->e1;
							_data_->_tmp47_ = _data_->_tmp46_->message;
							_data_->_tmp48_ = g_error_new (FOLKS_PERSONA_STORE_ERROR, FOLKS_PERSONA_STORE_ERROR_PERMISSION_DENIED, _data_->_tmp43_, _data_->_tmp45_, _data_->_tmp47_);
							_data_->_inner_error_ = _data_->_tmp48_;
							_g_error_free0 (_data_->e1);
							goto __finally11;
						}
						default:
						case E_CLIENT_ERROR_AUTHENTICATION_REQUIRED:
						case E_CLIENT_ERROR_NOT_SUPPORTED:
						case E_CLIENT_ERROR_INVALID_ARG:
						case E_CLIENT_ERROR_BUSY:
						case E_CLIENT_ERROR_DBUS_ERROR:
						case E_CLIENT_ERROR_OTHER_ERROR:
						case E_CLIENT_ERROR_COULD_NOT_CANCEL:
						case E_CLIENT_ERROR_AUTHENTICATION_FAILED:
						case E_CLIENT_ERROR_TLS_NOT_AVAILABLE:
						case E_CLIENT_ERROR_OFFLINE_UNAVAILABLE:
						case E_CLIENT_ERROR_UNSUPPORTED_AUTHENTICATION_METHOD:
						case E_CLIENT_ERROR_SEARCH_SIZE_LIMIT_EXCEEDED:
						case E_CLIENT_ERROR_SEARCH_TIME_LIMIT_EXCEEDED:
						case E_CLIENT_ERROR_INVALID_QUERY:
						case E_CLIENT_ERROR_QUERY_REFUSED:
						{
							break;
						}
					}
				}
			}
			_data_->_tmp49_ = NULL;
			_data_->_tmp49_ = _ ("Couldn't open address book %s: %s");
			_data_->_tmp50_ = folks_persona_store_get_id ((FolksPersonaStore*) _data_->self);
			_data_->_tmp51_ = _data_->_tmp50_;
			_data_->_tmp52_ = _data_->e1;
			_data_->_tmp53_ = _data_->_tmp52_->message;
			_data_->_tmp54_ = g_error_new (FOLKS_PERSONA_STORE_ERROR, FOLKS_PERSONA_STORE_ERROR_INVALID_ARGUMENT, _data_->_tmp49_, _data_->_tmp51_, _data_->_tmp53_);
			_data_->_inner_error_ = _data_->_tmp54_;
			_g_error_free0 (_data_->e1);
			goto __finally11;
		}
		__finally11:
		if (_data_->_inner_error_ != NULL) {
			goto __finally10;
		}
		{
			_data_->supported_fields = NULL;
			_data_->_tmp55_ = _data_->self->priv->_addressbook;
			_data_->_tmp56_ = NULL;
			_data_->_state_ = 4;
			e_client_get_backend_property ((EClient*) G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp55_, e_book_client_get_type (), EBookClient), "supported-fields", NULL, edsf_persona_store_prepare_ready, _data_);
			return FALSE;
			_state_4:
			e_client_get_backend_property_finish ((EClient*) G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp55_, e_book_client_get_type (), EBookClient), _data_->_res_, &_data_->_tmp56_, &_data_->_inner_error_);
			_g_free0 (_data_->supported_fields);
			_data_->supported_fields = _data_->_tmp56_;
			if (_data_->_inner_error_ != NULL) {
				_g_free0 (_data_->supported_fields);
				goto __catch12_g_error;
			}
			_data_->_tmp57_ = folks_persona_store_get_id ((FolksPersonaStore*) _data_->self);
			_data_->_tmp58_ = _data_->_tmp57_;
			folks_internal_profiling_point ("got supported fields in " "Edsf.PersonaStore (ID: %s)", _data_->_tmp58_, NULL);
			_data_->_tmp59_ = folks_small_set_new (G_TYPE_STRING, (GBoxedCopyFunc) g_strdup, g_free, NULL, NULL, NULL, NULL, NULL, NULL);
			_data_->prop_set = _data_->_tmp59_;
			_data_->_tmp60_ = _data_->supported_fields;
			if (_data_->_tmp60_ != NULL) {
				_data_->_tmp61_ = _data_->supported_fields;
				_data_->_tmp63_ = NULL;
				_data_->_tmp63_ = _data_->_tmp62_ = g_strsplit ((const gchar*) _data_->_tmp61_, ",", 0);
				_data_->fields = _data_->_tmp63_;
				_data_->fields_length1 = _vala_array_length (_data_->_tmp62_);
				_data_->_fields_size_ = _data_->fields_length1;
				_data_->_tmp64_ = _data_->prop_set;
				_data_->_tmp65_ = NULL;
				_data_->_tmp65_ = folks_persona_store_detail_key (FOLKS_PERSONA_DETAIL_LOCAL_IDS);
				gee_abstract_collection_add ((GeeAbstractCollection*) _data_->_tmp64_, (const gchar*) _data_->_tmp65_);
				_data_->_tmp66_ = _data_->prop_set;
				_data_->_tmp67_ = NULL;
				_data_->_tmp67_ = folks_persona_store_detail_key (FOLKS_PERSONA_DETAIL_WEB_SERVICE_ADDRESSES);
				gee_abstract_collection_add ((GeeAbstractCollection*) _data_->_tmp66_, (const gchar*) _data_->_tmp67_);
				_data_->_tmp68_ = _data_->prop_set;
				_data_->_tmp69_ = NULL;
				_data_->_tmp69_ = folks_persona_store_detail_key (FOLKS_PERSONA_DETAIL_GENDER);
				gee_abstract_collection_add ((GeeAbstractCollection*) _data_->_tmp68_, (const gchar*) _data_->_tmp69_);
				_data_->_tmp70_ = _data_->prop_set;
				_data_->_tmp71_ = NULL;
				_data_->_tmp71_ = folks_persona_store_detail_key (FOLKS_PERSONA_DETAIL_IS_FAVOURITE);
				gee_abstract_collection_add ((GeeAbstractCollection*) _data_->_tmp70_, (const gchar*) _data_->_tmp71_);
				_data_->_tmp72_ = _data_->prop_set;
				_data_->_tmp73_ = NULL;
				_data_->_tmp73_ = folks_persona_store_detail_key (FOLKS_PERSONA_DETAIL_ANTI_LINKS);
				gee_abstract_collection_add ((GeeAbstractCollection*) _data_->_tmp72_, (const gchar*) _data_->_tmp73_);
				_data_->_tmp74_ = _data_->fields;
				_data_->_tmp74__length1 = _data_->fields_length1;
				{
					_data_->field_collection_length1 = 0;
					_data_->_field_collection_size_ = 0;
					_data_->field_collection = _data_->_tmp74_;
					_data_->field_collection_length1 = _data_->_tmp74__length1;
					for (_data_->field_it = 0; _data_->field_it < _data_->_tmp74__length1; _data_->field_it = _data_->field_it + 1) {
						_data_->field = _data_->field_collection[_data_->field_it];
						{
							_data_->_tmp75_ = _data_->field;
							_data_->_tmp76_ = 0;
							_data_->_tmp76_ = _edsf_persona_store_eds_field_name_to_folks_persona_detail (_data_->self, _data_->_tmp75_);
							_data_->_tmp77_ = NULL;
							_data_->_tmp77_ = folks_persona_store_detail_key (_data_->_tmp76_);
							_data_->_tmp78_ = g_strdup (_data_->_tmp77_);
							_data_->prop = _data_->_tmp78_;
							_data_->_tmp79_ = _data_->prop;
							if (_data_->_tmp79_ != NULL) {
								_data_->_tmp80_ = _data_->prop_set;
								_data_->_tmp81_ = _data_->prop;
								_data_->prop = NULL;
								_data_->_tmp82_ = (gchar*) _data_->_tmp81_;
								gee_abstract_collection_add ((GeeAbstractCollection*) _data_->_tmp80_, _data_->_tmp82_);
								_g_free0 (_data_->_tmp82_);
							}
							_g_free0 (_data_->prop);
						}
					}
				}
				_data_->fields = (_vala_array_free (_data_->fields, _data_->fields_length1, (GDestroyNotify) g_free), NULL);
			}
			_data_->_tmp83_ = _data_->prop_set;
			_data_->_tmp84_ = gee_collection_get_size ((GeeCollection*) _data_->_tmp83_);
			_data_->_tmp85_ = _data_->_tmp84_;
			_data_->_tmp86_ = NULL;
			_data_->_tmp86_ = g_new0 (gchar*, _data_->_tmp85_ + 1);
			_data_->self->priv->_always_writeable_properties = (_vala_array_free (_data_->self->priv->_always_writeable_properties, _data_->self->priv->_always_writeable_properties_length1, (GDestroyNotify) g_free), NULL);
			_data_->self->priv->_always_writeable_properties = _data_->_tmp86_;
			_data_->self->priv->_always_writeable_properties_length1 = _data_->_tmp85_;
			_data_->self->priv->__always_writeable_properties_size_ = _data_->self->priv->_always_writeable_properties_length1;
			_data_->i = (guint) 0;
			{
				_data_->_tmp87_ = _data_->prop_set;
				_data_->_tmp88_ = _g_object_ref0 (_data_->_tmp87_);
				_data_->_final_prop_list = _data_->_tmp88_;
				_data_->_tmp89_ = _data_->_final_prop_list;
				_data_->_tmp90_ = gee_collection_get_size ((GeeCollection*) _data_->_tmp89_);
				_data_->_tmp91_ = _data_->_tmp90_;
				_data_->_final_prop_size = _data_->_tmp91_;
				_data_->_final_prop_index = -1;
				while (TRUE) {
					_data_->_tmp92_ = _data_->_final_prop_index;
					_data_->_final_prop_index = _data_->_tmp92_ + 1;
					_data_->_tmp93_ = _data_->_final_prop_index;
					_data_->_tmp94_ = _data_->_final_prop_size;
					if (!(_data_->_tmp93_ < _data_->_tmp94_)) {
						break;
					}
					_data_->_tmp95_ = _data_->_final_prop_list;
					_data_->_tmp96_ = _data_->_final_prop_index;
					_data_->_tmp97_ = NULL;
					_data_->_tmp97_ = folks_small_set_get (_data_->_tmp95_, _data_->_tmp96_);
					_data_->_tmp98_ = g_strdup ((const gchar*) _data_->_tmp97_);
					_data_->final_prop = _data_->_tmp98_;
					_data_->_tmp99_ = _data_->self->priv->_always_writeable_properties;
					_data_->_tmp99__length1 = _data_->self->priv->_always_writeable_properties_length1;
					_data_->_tmp100_ = _data_->i;
					_data_->i = _data_->_tmp100_ + 1;
					_data_->_tmp101_ = _data_->final_prop;
					_data_->_tmp102_ = g_strdup (_data_->_tmp101_);
					_g_free0 (_data_->_tmp99_[_data_->_tmp100_]);
					_data_->_tmp99_[_data_->_tmp100_] = _data_->_tmp102_;
					_data_->_tmp103_ = _data_->_tmp99_[_data_->_tmp100_];
					_g_free0 (_data_->final_prop);
				}
				_g_object_unref0 (_data_->_final_prop_list);
			}
			_g_object_unref0 (_data_->prop_set);
			_g_free0 (_data_->supported_fields);
		}
		goto __finally12;
		__catch12_g_error:
		{
			_data_->e2 = _data_->_inner_error_;
			_data_->_inner_error_ = NULL;
			g_signal_emit_by_name ((FolksPersonaStore*) _data_->self, "removed");
			_data_->_tmp104_ = NULL;
			_data_->_tmp104_ = _ ("Couldn't get address book capabilities: %s");
			_data_->_tmp105_ = _data_->e2;
			_data_->_tmp106_ = _data_->_tmp105_->message;
			_data_->_tmp107_ = g_error_new (FOLKS_PERSONA_STORE_ERROR, FOLKS_PERSONA_STORE_ERROR_INVALID_ARGUMENT, _data_->_tmp104_, _data_->_tmp106_);
			_data_->_inner_error_ = _data_->_tmp107_;
			_g_error_free0 (_data_->e2);
			goto __finally12;
		}
		__finally12:
		if (_data_->_inner_error_ != NULL) {
			goto __finally10;
		}
		_data_->do_initial_query = FALSE;
		{
			_data_->capabilities = NULL;
			_data_->_tmp108_ = _data_->self->priv->_addressbook;
			_data_->_tmp109_ = NULL;
			_data_->_state_ = 5;
			e_client_get_backend_property ((EClient*) G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp108_, e_book_client_get_type (), EBookClient), "capabilities", NULL, edsf_persona_store_prepare_ready, _data_);
			return FALSE;
			_state_5:
			e_client_get_backend_property_finish ((EClient*) G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp108_, e_book_client_get_type (), EBookClient), _data_->_res_, &_data_->_tmp109_, &_data_->_inner_error_);
			_g_free0 (_data_->capabilities);
			_data_->capabilities = _data_->_tmp109_;
			if (_data_->_inner_error_ != NULL) {
				_g_free0 (_data_->capabilities);
				goto __catch13_g_error;
			}
			_data_->_tmp110_ = folks_persona_store_get_id ((FolksPersonaStore*) _data_->self);
			_data_->_tmp111_ = _data_->_tmp110_;
			folks_internal_profiling_point ("got capabilities in " "Edsf.PersonaStore (ID: %s)", _data_->_tmp111_, NULL);
			_data_->_tmp112_ = _data_->capabilities;
			if (_data_->_tmp112_ != NULL) {
				_data_->_tmp113_ = _data_->capabilities;
				_data_->_tmp115_ = NULL;
				_data_->_tmp115_ = _data_->_tmp114_ = g_strsplit ((const gchar*) _data_->_tmp113_, ",", 0);
				_data_->caps = _data_->_tmp115_;
				_data_->caps_length1 = _vala_array_length (_data_->_tmp114_);
				_data_->_caps_size_ = _data_->caps_length1;
				_data_->_tmp116_ = _data_->caps;
				_data_->_tmp116__length1 = _data_->caps_length1;
				_data_->do_initial_query = _vala_string_array_contains (_data_->_tmp116_, _data_->_tmp116__length1, "do-initial-query");
				_data_->caps = (_vala_array_free (_data_->caps, _data_->caps_length1, (GDestroyNotify) g_free), NULL);
			}
			_g_free0 (_data_->capabilities);
		}
		goto __finally13;
		__catch13_g_error:
		{
			_data_->e4 = _data_->_inner_error_;
			_data_->_inner_error_ = NULL;
			g_signal_emit_by_name ((FolksPersonaStore*) _data_->self, "removed");
			_data_->_tmp117_ = NULL;
			_data_->_tmp117_ = _ ("Couldn't get address book capabilities: %s");
			_data_->_tmp118_ = _data_->e4;
			_data_->_tmp119_ = _data_->_tmp118_->message;
			_data_->_tmp120_ = g_error_new (FOLKS_PERSONA_STORE_ERROR, FOLKS_PERSONA_STORE_ERROR_INVALID_ARGUMENT, _data_->_tmp117_, _data_->_tmp119_);
			_data_->_inner_error_ = _data_->_tmp120_;
			_g_error_free0 (_data_->e4);
			goto __finally13;
		}
		__finally13:
		if (_data_->_inner_error_ != NULL) {
			goto __finally10;
		}
		_data_->got_view = FALSE;
		{
			_data_->_tmp122_ = _data_->self->priv->_addressbook;
			_data_->_tmp123_ = _data_->self->priv->_query_str;
			_data_->_tmp124_ = NULL;
			_data_->_state_ = 6;
			e_book_client_get_view (G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp122_, e_book_client_get_type (), EBookClient), _data_->_tmp123_, NULL, edsf_persona_store_prepare_ready, _data_);
			return FALSE;
			_state_6:
			_data_->_tmp125_ = FALSE;
			_data_->_tmp125_ = e_book_client_get_view_finish (G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp122_, e_book_client_get_type (), EBookClient), _data_->_res_, &_data_->_tmp124_, &_data_->_inner_error_);
			_g_object_unref0 (_data_->self->priv->_ebookview);
			_data_->self->priv->_ebookview = _data_->_tmp124_;
			_data_->_tmp121_ = _data_->_tmp125_;
			if (_data_->_inner_error_ != NULL) {
				goto __catch14_g_error;
			}
			_data_->got_view = _data_->_tmp121_;
			_data_->_tmp126_ = folks_persona_store_get_id ((FolksPersonaStore*) _data_->self);
			_data_->_tmp127_ = _data_->_tmp126_;
			folks_internal_profiling_point ("opened book view in " "Edsf.PersonaStore (ID: %s)", _data_->_tmp127_, NULL);
			_data_->_tmp128_ = _data_->got_view;
			if (_data_->_tmp128_ == FALSE) {
				_data_->_tmp129_ = NULL;
				_data_->_tmp129_ = _ ("Couldn't get view for address book %s.");
				_data_->_tmp130_ = folks_persona_store_get_id ((FolksPersonaStore*) _data_->self);
				_data_->_tmp131_ = _data_->_tmp130_;
				_data_->_tmp132_ = g_error_new (FOLKS_PERSONA_STORE_ERROR, FOLKS_PERSONA_STORE_ERROR_INVALID_ARGUMENT, _data_->_tmp129_, _data_->_tmp131_);
				_data_->_inner_error_ = _data_->_tmp132_;
				goto __catch14_g_error;
			}
			_data_->_tmp133_ = _data_->self->priv->_ebookview;
			g_signal_connect_object (G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp133_, e_book_client_view_get_type (), EBookClientView), "objects-added", (GCallback) __edsf_persona_store_contacts_added_cb_e_book_client_view_objects_added, _data_->self, 0);
			_data_->_tmp134_ = _data_->self->priv->_ebookview;
			g_signal_connect_object (G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp134_, e_book_client_view_get_type (), EBookClientView), "objects-removed", (GCallback) __edsf_persona_store_contacts_removed_cb_e_book_client_view_objects_removed, _data_->self, 0);
			_data_->_tmp135_ = _data_->self->priv->_ebookview;
			g_signal_connect_object (G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp135_, e_book_client_view_get_type (), EBookClientView), "objects-modified", (GCallback) __edsf_persona_store_contacts_changed_cb_e_book_client_view_objects_modified, _data_->self, 0);
			_data_->_tmp136_ = _data_->self->priv->_ebookview;
			g_signal_connect_object (G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp136_, e_book_client_view_get_type (), EBookClientView), "complete", (GCallback) __edsf_persona_store_contacts_complete_cb_e_book_client_view_complete, _data_->self, 0);
			_data_->_tmp137_ = _data_->self->priv->_ebookview;
			e_book_client_view_start (G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp137_, e_book_client_view_get_type (), EBookClientView), &_data_->_inner_error_);
			if (_data_->_inner_error_ != NULL) {
				goto __catch14_g_error;
			}
		}
		goto __finally14;
		__catch14_g_error:
		{
			_data_->e3 = _data_->_inner_error_;
			_data_->_inner_error_ = NULL;
			g_signal_emit_by_name ((FolksPersonaStore*) _data_->self, "removed");
			_data_->_tmp138_ = _data_->e3;
			if (_data_->_tmp138_->domain == E_BOOK_CLIENT_ERROR) {
				_data_->_tmp143_ = _data_->e3;
				if (g_error_matches (_data_->_tmp143_, E_BOOK_CLIENT_ERROR, E_BOOK_CLIENT_ERROR_NO_SUCH_BOOK)) {
					_data_->_tmp142_ = TRUE;
				} else {
					_data_->_tmp144_ = _data_->e3;
					_data_->_tmp142_ = g_error_matches (_data_->_tmp144_, E_BOOK_CLIENT_ERROR, E_BOOK_CLIENT_ERROR_NO_SUCH_SOURCE);
				}
				_data_->_tmp145_ = _data_->_tmp142_;
				if (_data_->_tmp145_) {
					_data_->_tmp141_ = TRUE;
				} else {
					_data_->_tmp146_ = _data_->e3;
					_data_->_tmp141_ = g_error_matches (_data_->_tmp146_, E_BOOK_CLIENT_ERROR, E_BOOK_CLIENT_ERROR_CONTACT_NOT_FOUND);
				}
				_data_->_tmp147_ = _data_->_tmp141_;
				if (_data_->_tmp147_) {
					_data_->_tmp140_ = TRUE;
				} else {
					_data_->_tmp148_ = _data_->e3;
					_data_->_tmp140_ = g_error_matches (_data_->_tmp148_, E_BOOK_CLIENT_ERROR, E_BOOK_CLIENT_ERROR_CONTACT_ID_ALREADY_EXISTS);
				}
				_data_->_tmp149_ = _data_->_tmp140_;
				if (_data_->_tmp149_) {
					_data_->_tmp139_ = TRUE;
				} else {
					_data_->_tmp150_ = _data_->e3;
					_data_->_tmp139_ = g_error_matches (_data_->_tmp150_, E_BOOK_CLIENT_ERROR, E_BOOK_CLIENT_ERROR_NO_SPACE);
				}
				_data_->_tmp151_ = _data_->_tmp139_;
				if (_data_->_tmp151_) {
				}
			} else {
				_data_->_tmp152_ = _data_->e3;
				_data_->_tmp153_ = _data_->_tmp152_->domain;
				_data_->_tmp154_ = 0U;
				_data_->_tmp154_ = e_client_error_quark ();
				if (_data_->_tmp153_ == _data_->_tmp154_) {
					_data_->_tmp155_ = _data_->e3;
					_data_->_tmp156_ = _data_->_tmp155_->code;
					switch ((EClientError) _data_->_tmp156_) {
						case E_CLIENT_ERROR_REPOSITORY_OFFLINE:
						{
							_data_->_tmp157_ = NULL;
							_data_->_tmp157_ = _ ("Address book %s is offline.");
							_data_->_tmp158_ = folks_persona_store_get_id ((FolksPersonaStore*) _data_->self);
							_data_->_tmp159_ = _data_->_tmp158_;
							_data_->_tmp160_ = g_error_new (FOLKS_PERSONA_STORE_ERROR, FOLKS_PERSONA_STORE_ERROR_STORE_OFFLINE, _data_->_tmp157_, _data_->_tmp159_);
							_data_->_inner_error_ = _data_->_tmp160_;
							_g_error_free0 (_data_->e3);
							goto __finally14;
						}
						case E_CLIENT_ERROR_PERMISSION_DENIED:
						{
							_data_->_tmp161_ = NULL;
							_data_->_tmp161_ = _ ("Permission denied to open address book %s: %s");
							_data_->_tmp162_ = folks_persona_store_get_id ((FolksPersonaStore*) _data_->self);
							_data_->_tmp163_ = _data_->_tmp162_;
							_data_->_tmp164_ = _data_->e3;
							_data_->_tmp165_ = _data_->_tmp164_->message;
							_data_->_tmp166_ = g_error_new (FOLKS_PERSONA_STORE_ERROR, FOLKS_PERSONA_STORE_ERROR_PERMISSION_DENIED, _data_->_tmp161_, _data_->_tmp163_, _data_->_tmp165_);
							_data_->_inner_error_ = _data_->_tmp166_;
							_g_error_free0 (_data_->e3);
							goto __finally14;
						}
						default:
						case E_CLIENT_ERROR_AUTHENTICATION_REQUIRED:
						case E_CLIENT_ERROR_NOT_SUPPORTED:
						case E_CLIENT_ERROR_INVALID_ARG:
						case E_CLIENT_ERROR_BUSY:
						case E_CLIENT_ERROR_DBUS_ERROR:
						case E_CLIENT_ERROR_OTHER_ERROR:
						case E_CLIENT_ERROR_SEARCH_SIZE_LIMIT_EXCEEDED:
						case E_CLIENT_ERROR_SEARCH_TIME_LIMIT_EXCEEDED:
						case E_CLIENT_ERROR_QUERY_REFUSED:
						case E_CLIENT_ERROR_COULD_NOT_CANCEL:
						case E_CLIENT_ERROR_AUTHENTICATION_FAILED:
						case E_CLIENT_ERROR_TLS_NOT_AVAILABLE:
						case E_CLIENT_ERROR_OFFLINE_UNAVAILABLE:
						case E_CLIENT_ERROR_UNSUPPORTED_AUTHENTICATION_METHOD:
						case E_CLIENT_ERROR_INVALID_QUERY:
						{
							break;
						}
					}
				}
			}
			_data_->_tmp167_ = NULL;
			_data_->_tmp167_ = _ ("Couldn't get view for address book %s: %s");
			_data_->_tmp168_ = folks_persona_store_get_id ((FolksPersonaStore*) _data_->self);
			_data_->_tmp169_ = _data_->_tmp168_;
			_data_->_tmp170_ = _data_->e3;
			_data_->_tmp171_ = _data_->_tmp170_->message;
			_data_->_tmp172_ = g_error_new (FOLKS_PERSONA_STORE_ERROR, FOLKS_PERSONA_STORE_ERROR_INVALID_ARGUMENT, _data_->_tmp167_, _data_->_tmp169_, _data_->_tmp171_);
			_data_->_inner_error_ = _data_->_tmp172_;
			_g_error_free0 (_data_->e3);
			goto __finally14;
		}
		__finally14:
		if (_data_->_inner_error_ != NULL) {
			goto __finally10;
		}
		_data_->self->priv->_is_prepared = TRUE;
		g_object_notify ((GObject*) _data_->self, "is-prepared");
		_data_->_tmp174_ = _data_->do_initial_query;
		if (_data_->_tmp174_ == FALSE) {
			_data_->_tmp175_ = _data_->self->priv->_is_quiescent;
			_data_->_tmp173_ = _data_->_tmp175_ == FALSE;
		} else {
			_data_->_tmp173_ = FALSE;
		}
		_data_->_tmp176_ = _data_->_tmp173_;
		if (_data_->_tmp176_) {
			_data_->_tmp177_ = _data_->self->priv->_pending_personas;
			_vala_assert (_data_->_tmp177_ == NULL, "this._pending_personas == null");
			_data_->self->priv->_is_quiescent = TRUE;
			g_object_notify ((GObject*) _data_->self, "is-quiescent");
		}
	}
	__finally10:
	{
		_data_->self->priv->_prepare_pending = FALSE;
	}
	if (_data_->_inner_error_ != NULL) {
		if (_data_->_inner_error_->domain == FOLKS_PERSONA_STORE_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	folks_internal_profiling_end ("preparing Edsf.PersonaStore", NULL);
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static void _edsf_persona_store_open_address_book_data_free (gpointer _data) {
	EdsfPersonaStoreOpenAddressBookData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->self);
	g_slice_free (EdsfPersonaStoreOpenAddressBookData, _data_);
}


static void _edsf_persona_store_open_address_book (EdsfPersonaStore* self, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	EdsfPersonaStoreOpenAddressBookData* _data_;
	EdsfPersonaStore* _tmp0_;
	_data_ = g_slice_new0 (EdsfPersonaStoreOpenAddressBookData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, _edsf_persona_store_open_address_book);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, _edsf_persona_store_open_address_book_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	_edsf_persona_store_open_address_book_co (_data_);
}


static void _edsf_persona_store_open_address_book_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error) {
	EdsfPersonaStoreOpenAddressBookData* _data_;
	if (g_simple_async_result_propagate_error (G_SIMPLE_ASYNC_RESULT (_res_), error)) {
		return;
	}
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


static void _edsf_persona_store_open_address_book_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	EdsfPersonaStoreOpenAddressBookData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	_edsf_persona_store_open_address_book_co (_data_);
}


static gpointer _g_error_copy0 (gpointer self) {
	return self ? g_error_copy (self) : NULL;
}


static gboolean __edsf_persona_store_open_address_book_co_gsource_func (gpointer self) {
	gboolean result;
	result = _edsf_persona_store_open_address_book_co (self);
	return result;
}


static gboolean _edsf_persona_store_open_address_book_co (EdsfPersonaStoreOpenAddressBookData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		case 2:
		goto _state_2;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->err_out = NULL;
	_data_->_tmp0_ = _data_->self->priv->_addressbook;
	_data_->_tmp1_ = folks_persona_store_get_id ((FolksPersonaStore*) _data_->self);
	_data_->_tmp2_ = _data_->_tmp1_;
	g_debug ("edsf-persona-store.vala:1067: Opening address book %p for persona stor" \
"e %s (%p)", _data_->_tmp0_, _data_->_tmp2_, _data_->self);
	_data_->_tmp3_ = _data_->self->priv->_addressbook;
	_data_->_tmp4_ = 0UL;
	_data_->_tmp4_ = g_signal_connect_swapped (G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp3_, e_book_client_get_type (), EBookClient), "opened", (GCallback) _edsf_persona_store_address_book_opened_cb, _data_->self);
	_data_->signal_id = _data_->_tmp4_;
	{
		_g_error_free0 (_data_->self->priv->_open_address_book_error);
		_data_->self->priv->_open_address_book_error = NULL;
		_data_->_tmp5_ = _data_->self->priv->_addressbook;
		_data_->_state_ = 1;
		e_client_open ((EClient*) G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp5_, e_book_client_get_type (), EBookClient), FALSE, NULL, _edsf_persona_store_open_address_book_ready, _data_);
		return FALSE;
		_state_1:
		e_client_open_finish ((EClient*) G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp5_, e_book_client_get_type (), EBookClient), _data_->_res_, &_data_->_inner_error_);
		if (_data_->_inner_error_ != NULL) {
			goto __catch15_g_error;
		}
		_data_->_tmp6_ = _data_->self->priv->_open_address_book_error;
		if (_data_->_tmp6_ != NULL) {
			_data_->_tmp7_ = _data_->self->priv->_open_address_book_error;
			_data_->_tmp8_ = _g_error_copy0 (_data_->_tmp7_);
			_data_->_inner_error_ = _data_->_tmp8_;
			goto __catch15_g_error;
		}
	}
	goto __finally15;
	__catch15_g_error:
	{
		_data_->e1 = _data_->_inner_error_;
		_data_->_inner_error_ = NULL;
		_data_->_tmp10_ = _data_->e1;
		_data_->_tmp11_ = _data_->_tmp10_->domain;
		_data_->_tmp12_ = 0U;
		_data_->_tmp12_ = e_client_error_quark ();
		if (_data_->_tmp11_ == _data_->_tmp12_) {
			_data_->_tmp13_ = _data_->e1;
			_data_->_tmp14_ = _data_->_tmp13_->code;
			_data_->_tmp9_ = ((EClientError) _data_->_tmp14_) == E_CLIENT_ERROR_BUSY;
		} else {
			_data_->_tmp9_ = FALSE;
		}
		_data_->_tmp15_ = _data_->_tmp9_;
		if (_data_->_tmp15_) {
			(_data_->self->priv->_open_address_book_callback_target_destroy_notify == NULL) ? NULL : (_data_->self->priv->_open_address_book_callback_target_destroy_notify (_data_->self->priv->_open_address_book_callback_target), NULL);
			_data_->self->priv->_open_address_book_callback = NULL;
			_data_->self->priv->_open_address_book_callback_target = NULL;
			_data_->self->priv->_open_address_book_callback_target_destroy_notify = NULL;
			_data_->self->priv->_open_address_book_callback = __edsf_persona_store_open_address_book_co_gsource_func;
			_data_->self->priv->_open_address_book_callback_target = _data_;
			_data_->self->priv->_open_address_book_callback_target_destroy_notify = NULL;
			_g_error_free0 (_data_->self->priv->_open_address_book_error);
			_data_->self->priv->_open_address_book_error = NULL;
			_data_->_tmp16_ = _data_->self->priv->_addressbook;
			_data_->_tmp17_ = folks_persona_store_get_id ((FolksPersonaStore*) _data_->self);
			_data_->_tmp18_ = _data_->_tmp17_;
			g_debug ("Yielding on opening address book %p for persona store " "%s (%p)", _data_->_tmp16_, _data_->_tmp18_, _data_->self);
			_data_->_state_ = 2;
			return FALSE;
			_state_2:
			;
			_data_->_tmp19_ = _data_->self->priv->_open_address_book_error;
			_data_->_tmp20_ = _g_error_copy0 (_data_->_tmp19_);
			_g_error_free0 (_data_->err_out);
			_data_->err_out = _data_->_tmp20_;
		} else {
			_data_->_tmp21_ = _data_->e1;
			_data_->_tmp22_ = _g_error_copy0 (_data_->_tmp21_);
			_g_error_free0 (_data_->err_out);
			_data_->err_out = _data_->_tmp22_;
		}
		_data_->_tmp23_ = _data_->err_out;
		if (_data_->_tmp23_ != NULL) {
			_data_->_tmp24_ = _data_->err_out;
			_data_->_tmp25_ = _g_error_copy0 (_data_->_tmp24_);
			_data_->_inner_error_ = _data_->_tmp25_;
			_g_error_free0 (_data_->e1);
			goto __finally15;
		}
		_g_error_free0 (_data_->e1);
	}
	__finally15:
	{
		_data_->_tmp26_ = _data_->self->priv->_addressbook;
		_data_->_tmp27_ = _data_->signal_id;
		g_signal_handler_disconnect ((GObject*) G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp26_, e_book_client_get_type (), EBookClient), _data_->_tmp27_);
		_data_->_tmp29_ = _data_->self->priv->_addressbook;
		_data_->_tmp30_ = FALSE;
		_data_->_tmp30_ = e_client_is_opened ((EClient*) G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp29_, e_book_client_get_type (), EBookClient));
		if (_data_->_tmp30_ == FALSE) {
			_data_->_tmp31_ = _data_->err_out;
			_data_->_tmp28_ = _data_->_tmp31_ == NULL;
		} else {
			_data_->_tmp28_ = FALSE;
		}
		_data_->_tmp32_ = _data_->_tmp28_;
		if (_data_->_tmp32_) {
			_data_->_tmp33_ = 0U;
			_data_->_tmp33_ = e_client_error_quark ();
			_data_->_tmp34_ = folks_persona_store_get_id ((FolksPersonaStore*) _data_->self);
			_data_->_tmp35_ = _data_->_tmp34_;
			_data_->_tmp36_ = g_error_new (_data_->_tmp33_, (gint) E_CLIENT_ERROR_OTHER_ERROR, "Misbehaving EDS backend: %s.", _data_->_tmp35_);
			_g_error_free0 (_data_->err_out);
			_data_->err_out = _data_->_tmp36_;
		}
	}
	if (_data_->_inner_error_ != NULL) {
		g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
		g_error_free (_data_->_inner_error_);
		_g_error_free0 (_data_->err_out);
		if (_data_->_state_ == 0) {
			g_simple_async_result_complete_in_idle (_data_->_async_result);
		} else {
			g_simple_async_result_complete (_data_->_async_result);
		}
		g_object_unref (_data_->_async_result);
		return FALSE;
	}
	_g_error_free0 (_data_->err_out);
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static void _edsf_persona_store_address_book_opened_cb (EdsfPersonaStore* self, GError* err, EBookClient* address_book) {
	const gchar* _tmp0_;
	const gchar* _tmp1_;
	EBookClient* _tmp2_;
	GError* _tmp3_;
	GError* _tmp4_;
	GError* _tmp5_;
	GSourceFunc _tmp6_;
	void* _tmp6__target;
	g_return_if_fail (self != NULL);
	g_return_if_fail (address_book != NULL);
	_tmp0_ = folks_persona_store_get_id ((FolksPersonaStore*) self);
	_tmp1_ = _tmp0_;
	_tmp2_ = address_book;
	_tmp3_ = err;
	g_debug ("_address_book_opened_cb for store %s (%p), address book %p " "and error %p", _tmp1_, self, _tmp2_, (void*) _tmp3_);
	_tmp4_ = err;
	_tmp5_ = _g_error_copy0 (_tmp4_);
	_g_error_free0 (self->priv->_open_address_book_error);
	self->priv->_open_address_book_error = _tmp5_;
	_tmp6_ = self->priv->_open_address_book_callback;
	_tmp6__target = self->priv->_open_address_book_callback_target;
	if (_tmp6_ != NULL) {
		GSourceFunc _tmp7_;
		void* _tmp7__target;
		_tmp7_ = self->priv->_open_address_book_callback;
		_tmp7__target = self->priv->_open_address_book_callback_target;
		_tmp7_ (_tmp7__target);
	}
}


static FolksPersonaDetail _edsf_persona_store_eds_field_name_to_folks_persona_detail (EdsfPersonaStore* self, const gchar* eds_field_name) {
	FolksPersonaDetail result = 0;
	EContactField eds_field_id = 0;
	const gchar* _tmp0_;
	EContactField _tmp1_ = 0;
	EContactField _tmp2_;
	g_return_val_if_fail (self != NULL, 0);
	g_return_val_if_fail (eds_field_name != NULL, 0);
	_tmp0_ = eds_field_name;
	_tmp1_ = e_contact_field_id (_tmp0_);
	eds_field_id = _tmp1_;
	_tmp2_ = eds_field_id;
	switch (_tmp2_) {
		case E_CONTACT_FULL_NAME:
		{
			result = FOLKS_PERSONA_DETAIL_FULL_NAME;
			return result;
		}
		case E_CONTACT_GIVEN_NAME:
		case E_CONTACT_FAMILY_NAME:
		case E_CONTACT_NAME:
		{
			result = FOLKS_PERSONA_DETAIL_STRUCTURED_NAME;
			return result;
		}
		case E_CONTACT_GEO:
		{
			result = FOLKS_PERSONA_DETAIL_LOCATION;
			return result;
		}
		case E_CONTACT_NICKNAME:
		{
			result = FOLKS_PERSONA_DETAIL_NICKNAME;
			return result;
		}
		case E_CONTACT_EMAIL_1:
		case E_CONTACT_EMAIL_2:
		case E_CONTACT_EMAIL_3:
		case E_CONTACT_EMAIL_4:
		case E_CONTACT_EMAIL:
		{
			result = FOLKS_PERSONA_DETAIL_EMAIL_ADDRESSES;
			return result;
		}
		case E_CONTACT_ADDRESS_LABEL_HOME:
		case E_CONTACT_ADDRESS_LABEL_WORK:
		case E_CONTACT_ADDRESS_LABEL_OTHER:
		case E_CONTACT_ADDRESS:
		case E_CONTACT_ADDRESS_HOME:
		case E_CONTACT_ADDRESS_WORK:
		case E_CONTACT_ADDRESS_OTHER:
		{
			result = FOLKS_PERSONA_DETAIL_POSTAL_ADDRESSES;
			return result;
		}
		case E_CONTACT_PHONE_ASSISTANT:
		case E_CONTACT_PHONE_BUSINESS:
		case E_CONTACT_PHONE_BUSINESS_2:
		case E_CONTACT_PHONE_BUSINESS_FAX:
		case E_CONTACT_PHONE_CALLBACK:
		case E_CONTACT_PHONE_CAR:
		case E_CONTACT_PHONE_COMPANY:
		case E_CONTACT_PHONE_HOME:
		case E_CONTACT_PHONE_HOME_2:
		case E_CONTACT_PHONE_HOME_FAX:
		case E_CONTACT_PHONE_ISDN:
		case E_CONTACT_PHONE_MOBILE:
		case E_CONTACT_PHONE_OTHER:
		case E_CONTACT_PHONE_OTHER_FAX:
		case E_CONTACT_PHONE_PAGER:
		case E_CONTACT_PHONE_PRIMARY:
		case E_CONTACT_PHONE_RADIO:
		case E_CONTACT_PHONE_TELEX:
		case E_CONTACT_PHONE_TTYTDD:
		case E_CONTACT_TEL:
		case E_CONTACT_SIP:
		{
			result = FOLKS_PERSONA_DETAIL_PHONE_NUMBERS;
			return result;
		}
		case E_CONTACT_ORG:
		case E_CONTACT_ORG_UNIT:
		case E_CONTACT_OFFICE:
		case E_CONTACT_TITLE:
		case E_CONTACT_ROLE:
		case E_CONTACT_MANAGER:
		case E_CONTACT_ASSISTANT:
		{
			result = FOLKS_PERSONA_DETAIL_ROLES;
			return result;
		}
		case E_CONTACT_HOMEPAGE_URL:
		case E_CONTACT_BLOG_URL:
		case E_CONTACT_FREEBUSY_URL:
		case E_CONTACT_VIDEO_URL:
		{
			result = FOLKS_PERSONA_DETAIL_URLS;
			return result;
		}
		case E_CONTACT_CATEGORIES:
		case E_CONTACT_CATEGORY_LIST:
		{
			result = FOLKS_PERSONA_DETAIL_GROUPS;
			return result;
		}
		case E_CONTACT_NOTE:
		{
			result = FOLKS_PERSONA_DETAIL_NOTES;
			return result;
		}
		case E_CONTACT_IM_AIM_HOME_1:
		case E_CONTACT_IM_AIM_HOME_2:
		case E_CONTACT_IM_AIM_HOME_3:
		case E_CONTACT_IM_AIM_WORK_1:
		case E_CONTACT_IM_AIM_WORK_2:
		case E_CONTACT_IM_AIM_WORK_3:
		case E_CONTACT_IM_GROUPWISE_HOME_1:
		case E_CONTACT_IM_GROUPWISE_HOME_2:
		case E_CONTACT_IM_GROUPWISE_HOME_3:
		case E_CONTACT_IM_GROUPWISE_WORK_1:
		case E_CONTACT_IM_GROUPWISE_WORK_2:
		case E_CONTACT_IM_GROUPWISE_WORK_3:
		case E_CONTACT_IM_JABBER_HOME_1:
		case E_CONTACT_IM_JABBER_HOME_2:
		case E_CONTACT_IM_JABBER_HOME_3:
		case E_CONTACT_IM_JABBER_WORK_1:
		case E_CONTACT_IM_JABBER_WORK_2:
		case E_CONTACT_IM_JABBER_WORK_3:
		case E_CONTACT_IM_YAHOO_HOME_1:
		case E_CONTACT_IM_YAHOO_HOME_2:
		case E_CONTACT_IM_YAHOO_HOME_3:
		case E_CONTACT_IM_YAHOO_WORK_1:
		case E_CONTACT_IM_YAHOO_WORK_2:
		case E_CONTACT_IM_YAHOO_WORK_3:
		case E_CONTACT_IM_MSN_HOME_1:
		case E_CONTACT_IM_MSN_HOME_2:
		case E_CONTACT_IM_MSN_HOME_3:
		case E_CONTACT_IM_MSN_WORK_1:
		case E_CONTACT_IM_MSN_WORK_2:
		case E_CONTACT_IM_MSN_WORK_3:
		case E_CONTACT_IM_ICQ_HOME_1:
		case E_CONTACT_IM_ICQ_HOME_2:
		case E_CONTACT_IM_ICQ_HOME_3:
		case E_CONTACT_IM_ICQ_WORK_1:
		case E_CONTACT_IM_ICQ_WORK_2:
		case E_CONTACT_IM_ICQ_WORK_3:
		case E_CONTACT_IM_AIM:
		case E_CONTACT_IM_GROUPWISE:
		case E_CONTACT_IM_JABBER:
		case E_CONTACT_IM_YAHOO:
		case E_CONTACT_IM_MSN:
		case E_CONTACT_IM_ICQ:
		case E_CONTACT_IM_GADUGADU_HOME_1:
		case E_CONTACT_IM_GADUGADU_HOME_2:
		case E_CONTACT_IM_GADUGADU_HOME_3:
		case E_CONTACT_IM_GADUGADU_WORK_1:
		case E_CONTACT_IM_GADUGADU_WORK_2:
		case E_CONTACT_IM_GADUGADU_WORK_3:
		case E_CONTACT_IM_GADUGADU:
		case E_CONTACT_IM_SKYPE_HOME_1:
		case E_CONTACT_IM_SKYPE_HOME_2:
		case E_CONTACT_IM_SKYPE_HOME_3:
		case E_CONTACT_IM_SKYPE_WORK_1:
		case E_CONTACT_IM_SKYPE_WORK_2:
		case E_CONTACT_IM_SKYPE_WORK_3:
		case E_CONTACT_IM_SKYPE:
		case E_CONTACT_IM_GOOGLE_TALK_HOME_1:
		case E_CONTACT_IM_GOOGLE_TALK_HOME_2:
		case E_CONTACT_IM_GOOGLE_TALK_HOME_3:
		case E_CONTACT_IM_GOOGLE_TALK_WORK_1:
		case E_CONTACT_IM_GOOGLE_TALK_WORK_2:
		case E_CONTACT_IM_GOOGLE_TALK_WORK_3:
		case E_CONTACT_IM_GOOGLE_TALK:
		{
			result = FOLKS_PERSONA_DETAIL_IM_ADDRESSES;
			return result;
		}
		case E_CONTACT_PHOTO:
		{
			result = FOLKS_PERSONA_DETAIL_AVATAR;
			return result;
		}
		case E_CONTACT_BIRTH_DATE:
		{
			result = FOLKS_PERSONA_DETAIL_BIRTHDAY;
			return result;
		}
		case E_CONTACT_UID:
		case E_CONTACT_REV:
		case E_CONTACT_BOOK_UID:
		case E_CONTACT_NAME_OR_ORG:
		{
			result = FOLKS_PERSONA_DETAIL_INVALID;
			return result;
		}
		default:
		case E_CONTACT_FILE_AS:
		case E_CONTACT_MAILER:
		case E_CONTACT_CALENDAR_URI:
		case E_CONTACT_ICS_CALENDAR:
		case E_CONTACT_SPOUSE:
		case E_CONTACT_LOGO:
		case E_CONTACT_WANTS_HTML:
		case E_CONTACT_IS_LIST:
		case E_CONTACT_LIST_SHOW_ADDRESSES:
		case E_CONTACT_ANNIVERSARY:
		case E_CONTACT_X509_CERT:
		{
			const gchar* _tmp3_;
			_tmp3_ = eds_field_name;
			g_debug ("edsf-persona-store.vala:1316: Unsupported/Unknown EDS field name '%s'.", _tmp3_);
			result = FOLKS_PERSONA_DETAIL_INVALID;
			return result;
		}
	}
}


static void _edsf_persona_store_commit_modified_property_data_free (gpointer _data) {
	EdsfPersonaStoreCommitModifiedPropertyData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->persona);
	_g_free0 (_data_->property_name);
	_g_object_unref0 (_data_->self);
	g_slice_free (EdsfPersonaStoreCommitModifiedPropertyData, _data_);
}


static void _edsf_persona_store_commit_modified_property (EdsfPersonaStore* self, EdsfPersona* persona, const gchar* property_name, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	EdsfPersonaStoreCommitModifiedPropertyData* _data_;
	EdsfPersonaStore* _tmp0_;
	EdsfPersona* _tmp1_;
	EdsfPersona* _tmp2_;
	const gchar* _tmp3_;
	gchar* _tmp4_;
	_data_ = g_slice_new0 (EdsfPersonaStoreCommitModifiedPropertyData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, _edsf_persona_store_commit_modified_property);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, _edsf_persona_store_commit_modified_property_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	_tmp1_ = persona;
	_tmp2_ = _g_object_ref0 (_tmp1_);
	_g_object_unref0 (_data_->persona);
	_data_->persona = _tmp2_;
	_tmp3_ = property_name;
	_tmp4_ = g_strdup (_tmp3_);
	_g_free0 (_data_->property_name);
	_data_->property_name = _tmp4_;
	_edsf_persona_store_commit_modified_property_co (_data_);
}


static void _edsf_persona_store_commit_modified_property_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error) {
	EdsfPersonaStoreCommitModifiedPropertyData* _data_;
	if (g_simple_async_result_propagate_error (G_SIMPLE_ASYNC_RESULT (_res_), error)) {
		return;
	}
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


static Block2Data* block2_data_ref (Block2Data* _data2_) {
	g_atomic_int_inc (&_data2_->_ref_count_);
	return _data2_;
}


static void block2_data_unref (void * _userdata_) {
	Block2Data* _data2_;
	_data2_ = (Block2Data*) _userdata_;
	if (g_atomic_int_dec_and_test (&_data2_->_ref_count_)) {
		EdsfPersonaStore * self;
		self = _data2_->self;
		_g_object_unref0 (self);
		g_slice_free (Block2Data, _data2_);
	}
}


static Block3Data* block3_data_ref (Block3Data* _data3_) {
	g_atomic_int_inc (&_data3_->_ref_count_);
	return _data3_;
}


static void block3_data_unref (void * _userdata_) {
	Block3Data* _data3_;
	_data3_ = (Block3Data*) _userdata_;
	if (g_atomic_int_dec_and_test (&_data3_->_ref_count_)) {
		EdsfPersonaStore * self;
		self = _data3_->_data2_->self;
		block2_data_unref (_data3_->_data2_);
		_data3_->_data2_ = NULL;
		g_slice_free (Block3Data, _data3_);
	}
}


static void ___lambda9_ (Block3Data* _data3_, GObject* obj, GParamSpec* pspec) {
	Block2Data* _data2_;
	EdsfPersonaStore * self;
	gboolean _tmp0_;
	_data2_ = _data3_->_data2_;
	self = _data2_->self;
	g_return_if_fail (obj != NULL);
	g_return_if_fail (pspec != NULL);
	_data3_->received_notification = TRUE;
	_tmp0_ = _data3_->has_yielded;
	if (_tmp0_ == TRUE) {
		_edsf_persona_store_commit_modified_property_co (_data2_->_async_data_);
	}
}


static void ____lambda9__g_object_notify (GObject* _sender, GParamSpec* pspec, gpointer self) {
	___lambda9_ (self, _sender, pspec);
}


static void _edsf_persona_store_commit_modified_property_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	EdsfPersonaStoreCommitModifiedPropertyData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	_edsf_persona_store_commit_modified_property_co (_data_);
}


static gboolean ___lambda10_ (Block3Data* _data3_) {
	Block2Data* _data2_;
	EdsfPersonaStore * self;
	gboolean result = FALSE;
	gboolean _tmp0_;
	_data2_ = _data3_->_data2_;
	self = _data2_->self;
	_tmp0_ = _data3_->has_yielded;
	if (_tmp0_ == TRUE) {
		_edsf_persona_store_commit_modified_property_co (_data2_->_async_data_);
	}
	result = FALSE;
	return result;
}


static gboolean ____lambda10__gsource_func (gpointer self) {
	gboolean result;
	result = ___lambda10_ (self);
	return result;
}


static gboolean _edsf_persona_store_commit_modified_property_co (EdsfPersonaStoreCommitModifiedPropertyData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		case 2:
		goto _state_2;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_data2_ = g_slice_new0 (Block2Data);
	_data_->_data2_->_ref_count_ = 1;
	_data_->_data2_->self = g_object_ref (_data_->self);
	_data_->_data2_->_async_data_ = _data_;
	_data_->_tmp0_ = _data_->self->priv->_addressbook;
	_vala_assert (_data_->_tmp0_ != NULL, "this._addressbook != null");
	_data_->_tmp1_ = _data_->persona;
	_data_->_tmp2_ = edsf_persona_get_contact (_data_->_tmp1_);
	_data_->_tmp3_ = _data_->_tmp2_;
	_data_->_tmp4_ = _g_object_ref0 (_data_->_tmp3_);
	_data_->contact = _data_->_tmp4_;
	_data_->signal_id = (gulong) 0;
	_data_->timeout_id = (guint) 0;
	{
		_data_->_data3_ = g_slice_new0 (Block3Data);
		_data_->_data3_->_ref_count_ = 1;
		_data_->_data3_->_data2_ = block2_data_ref (_data_->_data2_);
		_data_->_data3_->received_notification = FALSE;
		_data_->_data3_->has_yielded = FALSE;
		_data_->_tmp5_ = _data_->persona;
		_data_->_tmp6_ = _data_->property_name;
		_data_->_tmp7_ = g_strconcat ("notify::", _data_->_tmp6_, NULL);
		_data_->_tmp8_ = 0UL;
		_data_->_tmp8_ = g_signal_connect_data ((GObject*) _data_->_tmp5_, _data_->_tmp7_, (GCallback) ____lambda9__g_object_notify, block3_data_ref (_data_->_data3_), (GClosureNotify) block3_data_unref, 0);
		_data_->signal_id = _data_->_tmp8_;
		_g_free0 (_data_->_tmp7_);
		_data_->_tmp9_ = _data_->self->priv->_addressbook;
		_data_->_tmp10_ = _data_->contact;
		_data_->_state_ = 1;
		e_book_client_modify_contact (G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp9_, e_book_client_get_type (), EBookClient), _data_->_tmp10_, NULL, _edsf_persona_store_commit_modified_property_ready, _data_);
		return FALSE;
		_state_1:
		e_book_client_modify_contact_finish (G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp9_, e_book_client_get_type (), EBookClient), _data_->_res_, &_data_->_inner_error_);
		if (_data_->_inner_error_ != NULL) {
			block3_data_unref (_data_->_data3_);
			_data_->_data3_ = NULL;
			goto __catch16_g_error;
		}
		_data_->_tmp11_ = 0U;
		_data_->_tmp11_ = g_timeout_add_seconds_full (G_PRIORITY_LOW, EDSF_PERSONA_STORE__property_change_timeout, ____lambda10__gsource_func, block3_data_ref (_data_->_data3_), block3_data_unref);
		_data_->timeout_id = _data_->_tmp11_;
		_data_->_tmp12_ = _data_->_data3_->received_notification;
		if (_data_->_tmp12_ == FALSE) {
			_data_->_data3_->has_yielded = TRUE;
			_data_->_state_ = 2;
			return FALSE;
			_state_2:
			;
		}
		_data_->_tmp13_ = _data_->_data3_->received_notification;
		if (_data_->_tmp13_ == FALSE) {
			_data_->_tmp14_ = NULL;
			_data_->_tmp14_ = _ ("Changing the %s property failed due to reaching the timeout.");
			_data_->_tmp15_ = _data_->property_name;
			_data_->_tmp16_ = g_error_new (FOLKS_PROPERTY_ERROR, FOLKS_PROPERTY_ERROR_UNKNOWN_ERROR, _data_->_tmp14_, _data_->_tmp15_);
			_data_->_inner_error_ = _data_->_tmp16_;
			block3_data_unref (_data_->_data3_);
			_data_->_data3_ = NULL;
			goto __catch16_g_error;
		}
		block3_data_unref (_data_->_data3_);
		_data_->_data3_ = NULL;
	}
	goto __finally16;
	__catch16_g_error:
	{
		_data_->e = _data_->_inner_error_;
		_data_->_inner_error_ = NULL;
		_data_->_tmp17_ = _data_->property_name;
		_data_->_tmp18_ = _data_->e;
		_data_->_tmp19_ = NULL;
		_data_->_tmp19_ = edsf_persona_store_e_client_error_to_property_error (_data_->self, _data_->_tmp17_, _data_->_tmp18_);
		_data_->_inner_error_ = _data_->_tmp19_;
		_g_error_free0 (_data_->e);
		goto __finally16;
	}
	__finally16:
	{
		_data_->_tmp20_ = _data_->signal_id;
		if (_data_->_tmp20_ != ((gulong) 0)) {
			_data_->_tmp21_ = _data_->persona;
			_data_->_tmp22_ = _data_->signal_id;
			g_signal_handler_disconnect ((GObject*) _data_->_tmp21_, _data_->_tmp22_);
		}
		_data_->_tmp23_ = _data_->timeout_id;
		if (_data_->_tmp23_ != ((guint) 0)) {
			_data_->_tmp24_ = _data_->timeout_id;
			g_source_remove (_data_->_tmp24_);
		}
	}
	if (_data_->_inner_error_ != NULL) {
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			_g_object_unref0 (_data_->contact);
			block2_data_unref (_data_->_data2_);
			_data_->_data2_ = NULL;
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			_g_object_unref0 (_data_->contact);
			block2_data_unref (_data_->_data2_);
			_data_->_data2_ = NULL;
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	_g_object_unref0 (_data_->contact);
	block2_data_unref (_data_->_data2_);
	_data_->_data2_ = NULL;
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static void _edsf_persona_store_remove_attribute (EdsfPersonaStore* self, EContact* contact, const gchar* attr_name) {
	EVCardAttribute* attr = NULL;
	EContact* _tmp0_;
	const gchar* _tmp1_;
	EVCardAttribute* _tmp2_ = NULL;
	EVCardAttribute* _tmp3_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (contact != NULL);
	g_return_if_fail (attr_name != NULL);
	_tmp0_ = contact;
	_tmp1_ = attr_name;
	_tmp2_ = e_vcard_get_attribute ((EVCard*) _tmp0_, _tmp1_);
	attr = _tmp2_;
	_tmp3_ = attr;
	if (_tmp3_ != NULL) {
		EContact* _tmp4_;
		EVCardAttribute* _tmp5_;
		_tmp4_ = contact;
		_tmp5_ = attr;
		e_vcard_remove_attribute ((EVCard*) _tmp4_, (EVCardAttribute*) _tmp5_);
	}
}


static void _edsf_persona_store_set_avatar_data_free (gpointer _data) {
	EdsfPersonaStoreSetAvatarData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->persona);
	_g_object_unref0 (_data_->avatar);
	_g_object_unref0 (_data_->self);
	g_slice_free (EdsfPersonaStoreSetAvatarData, _data_);
}


void _edsf_persona_store_set_avatar (EdsfPersonaStore* self, EdsfPersona* persona, GLoadableIcon* avatar, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	EdsfPersonaStoreSetAvatarData* _data_;
	EdsfPersonaStore* _tmp0_;
	EdsfPersona* _tmp1_;
	EdsfPersona* _tmp2_;
	GLoadableIcon* _tmp3_;
	GLoadableIcon* _tmp4_;
	_data_ = g_slice_new0 (EdsfPersonaStoreSetAvatarData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, _edsf_persona_store_set_avatar);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, _edsf_persona_store_set_avatar_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	_tmp1_ = persona;
	_tmp2_ = _g_object_ref0 (_tmp1_);
	_g_object_unref0 (_data_->persona);
	_data_->persona = _tmp2_;
	_tmp3_ = avatar;
	_tmp4_ = _g_object_ref0 (_tmp3_);
	_g_object_unref0 (_data_->avatar);
	_data_->avatar = _tmp4_;
	_edsf_persona_store_set_avatar_co (_data_);
}


void _edsf_persona_store_set_avatar_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error) {
	EdsfPersonaStoreSetAvatarData* _data_;
	if (g_simple_async_result_propagate_error (G_SIMPLE_ASYNC_RESULT (_res_), error)) {
		return;
	}
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


static void _edsf_persona_store_set_avatar_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	EdsfPersonaStoreSetAvatarData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	_edsf_persona_store_set_avatar_co (_data_);
}


static gboolean _edsf_persona_store_set_avatar_co (EdsfPersonaStoreSetAvatarData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		case 2:
		goto _state_2;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_tmp0_ = _data_->self->priv->_always_writeable_properties;
	_data_->_tmp0__length1 = _data_->self->priv->_always_writeable_properties_length1;
	if (!_vala_string_array_contains (_data_->_tmp0_, _data_->_tmp0__length1, "avatar")) {
		_data_->_tmp1_ = NULL;
		_data_->_tmp1_ = _ ("Avatar is not writeable on this contact.");
		_data_->_tmp2_ = g_error_new_literal (FOLKS_PROPERTY_ERROR, FOLKS_PROPERTY_ERROR_NOT_WRITEABLE, _data_->_tmp1_);
		_data_->_inner_error_ = _data_->_tmp2_;
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	_data_->_tmp5_ = _data_->persona;
	_data_->_tmp6_ = folks_avatar_details_get_avatar ((FolksAvatarDetails*) _data_->_tmp5_);
	_data_->_tmp7_ = _data_->_tmp6_;
	if (_data_->_tmp7_ == NULL) {
		_data_->_tmp8_ = _data_->avatar;
		_data_->_tmp4_ = _data_->_tmp8_ == NULL;
	} else {
		_data_->_tmp4_ = FALSE;
	}
	_data_->_tmp9_ = _data_->_tmp4_;
	if (_data_->_tmp9_) {
		_data_->_tmp3_ = TRUE;
	} else {
		_data_->_tmp11_ = _data_->persona;
		_data_->_tmp12_ = folks_avatar_details_get_avatar ((FolksAvatarDetails*) _data_->_tmp11_);
		_data_->_tmp13_ = _data_->_tmp12_;
		if (_data_->_tmp13_ != NULL) {
			_data_->_tmp14_ = _data_->persona;
			_data_->_tmp15_ = folks_avatar_details_get_avatar ((FolksAvatarDetails*) _data_->_tmp14_);
			_data_->_tmp16_ = _data_->_tmp15_;
			_data_->_tmp17_ = _data_->avatar;
			_data_->_tmp18_ = FALSE;
			_data_->_tmp18_ = g_icon_equal ((GIcon*) G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp16_, g_loadable_icon_get_type (), GLoadableIcon), (GIcon*) _data_->_tmp17_);
			_data_->_tmp10_ = _data_->_tmp18_;
		} else {
			_data_->_tmp10_ = FALSE;
		}
		_data_->_tmp19_ = _data_->_tmp10_;
		_data_->_tmp3_ = _data_->_tmp19_;
	}
	_data_->_tmp20_ = _data_->_tmp3_;
	if (_data_->_tmp20_) {
		if (_data_->_state_ == 0) {
			g_simple_async_result_complete_in_idle (_data_->_async_result);
		} else {
			g_simple_async_result_complete (_data_->_async_result);
		}
		g_object_unref (_data_->_async_result);
		return FALSE;
	}
	_data_->_tmp21_ = _data_->persona;
	_data_->_tmp22_ = edsf_persona_get_contact (_data_->_tmp21_);
	_data_->_tmp23_ = _data_->_tmp22_;
	_data_->_tmp24_ = _data_->avatar;
	_data_->_state_ = 1;
	_edsf_persona_store_set_contact_avatar (_data_->self, _data_->_tmp23_, _data_->_tmp24_, _edsf_persona_store_set_avatar_ready, _data_);
	return FALSE;
	_state_1:
	_edsf_persona_store_set_contact_avatar_finish (_data_->self, _data_->_res_, &_data_->_inner_error_);
	if (_data_->_inner_error_ != NULL) {
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	_data_->_tmp25_ = _data_->persona;
	_data_->_state_ = 2;
	_edsf_persona_store_commit_modified_property (_data_->self, _data_->_tmp25_, "avatar", _edsf_persona_store_set_avatar_ready, _data_);
	return FALSE;
	_state_2:
	_edsf_persona_store_commit_modified_property_finish (_data_->self, _data_->_res_, &_data_->_inner_error_);
	if (_data_->_inner_error_ != NULL) {
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static void _edsf_persona_store_set_web_service_addresses_data_free (gpointer _data) {
	EdsfPersonaStoreSetWebServiceAddressesData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->persona);
	_g_object_unref0 (_data_->web_service_addresses);
	_g_object_unref0 (_data_->self);
	g_slice_free (EdsfPersonaStoreSetWebServiceAddressesData, _data_);
}


void _edsf_persona_store_set_web_service_addresses (EdsfPersonaStore* self, EdsfPersona* persona, GeeMultiMap* web_service_addresses, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	EdsfPersonaStoreSetWebServiceAddressesData* _data_;
	EdsfPersonaStore* _tmp0_;
	EdsfPersona* _tmp1_;
	EdsfPersona* _tmp2_;
	GeeMultiMap* _tmp3_;
	GeeMultiMap* _tmp4_;
	_data_ = g_slice_new0 (EdsfPersonaStoreSetWebServiceAddressesData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, _edsf_persona_store_set_web_service_addresses);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, _edsf_persona_store_set_web_service_addresses_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	_tmp1_ = persona;
	_tmp2_ = _g_object_ref0 (_tmp1_);
	_g_object_unref0 (_data_->persona);
	_data_->persona = _tmp2_;
	_tmp3_ = web_service_addresses;
	_tmp4_ = _g_object_ref0 (_tmp3_);
	_g_object_unref0 (_data_->web_service_addresses);
	_data_->web_service_addresses = _tmp4_;
	_edsf_persona_store_set_web_service_addresses_co (_data_);
}


void _edsf_persona_store_set_web_service_addresses_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error) {
	EdsfPersonaStoreSetWebServiceAddressesData* _data_;
	if (g_simple_async_result_propagate_error (G_SIMPLE_ASYNC_RESULT (_res_), error)) {
		return;
	}
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


static void _edsf_persona_store_set_web_service_addresses_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	EdsfPersonaStoreSetWebServiceAddressesData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	_edsf_persona_store_set_web_service_addresses_co (_data_);
}


static gboolean _edsf_persona_store_set_web_service_addresses_co (EdsfPersonaStoreSetWebServiceAddressesData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_tmp0_ = _data_->self->priv->_always_writeable_properties;
	_data_->_tmp0__length1 = _data_->self->priv->_always_writeable_properties_length1;
	if (!_vala_string_array_contains (_data_->_tmp0_, _data_->_tmp0__length1, "web-service-addresses")) {
		_data_->_tmp1_ = NULL;
		_data_->_tmp1_ = _ ("Web service addresses are not writeable on this contact.");
		_data_->_tmp2_ = g_error_new_literal (FOLKS_PROPERTY_ERROR, FOLKS_PROPERTY_ERROR_NOT_WRITEABLE, _data_->_tmp1_);
		_data_->_inner_error_ = _data_->_tmp2_;
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	_data_->_tmp3_ = _data_->persona;
	_data_->_tmp4_ = folks_web_service_details_get_web_service_addresses ((FolksWebServiceDetails*) _data_->_tmp3_);
	_data_->_tmp5_ = _data_->_tmp4_;
	_data_->_tmp6_ = _data_->web_service_addresses;
	_data_->_tmp7_ = FALSE;
	_data_->_tmp7_ = folks_utils_multi_map_str_afd_equal (_data_->_tmp5_, _data_->_tmp6_);
	if (_data_->_tmp7_) {
		if (_data_->_state_ == 0) {
			g_simple_async_result_complete_in_idle (_data_->_async_result);
		} else {
			g_simple_async_result_complete (_data_->_async_result);
		}
		g_object_unref (_data_->_async_result);
		return FALSE;
	}
	_data_->_tmp8_ = _data_->persona;
	_data_->_tmp9_ = edsf_persona_get_contact (_data_->_tmp8_);
	_data_->_tmp10_ = _data_->_tmp9_;
	_data_->_tmp11_ = _data_->web_service_addresses;
	_edsf_persona_store_set_contact_web_service_addresses (_data_->self, _data_->_tmp10_, _data_->_tmp11_);
	_data_->_tmp12_ = _data_->persona;
	_data_->_state_ = 1;
	_edsf_persona_store_commit_modified_property (_data_->self, _data_->_tmp12_, "web-service-addresses", _edsf_persona_store_set_web_service_addresses_ready, _data_);
	return FALSE;
	_state_1:
	_edsf_persona_store_commit_modified_property_finish (_data_->self, _data_->_res_, &_data_->_inner_error_);
	if (_data_->_inner_error_ != NULL) {
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static EVCardAttributeParam* _vala_EVCardAttributeParam_copy (EVCardAttributeParam* self) {
	return g_boxed_copy (e_vcard_attribute_param_get_type (), self);
}


static gpointer __vala_EVCardAttributeParam_copy0 (gpointer self) {
	return self ? _vala_EVCardAttributeParam_copy (self) : NULL;
}


static void _vala_EVCardAttributeParam_free (EVCardAttributeParam* self) {
	g_boxed_free (e_vcard_attribute_param_get_type (), self);
}


static void _vala_EVCardAttribute_free (EVCardAttribute* self) {
	g_boxed_free (e_vcard_attribute_get_type (), self);
}


static void _edsf_persona_store_set_contact_web_service_addresses (EdsfPersonaStore* self, EContact* contact, GeeMultiMap* web_service_addresses) {
	EContact* _tmp0_;
	EVCardAttribute* attr_n = NULL;
	EVCardAttribute* _tmp1_;
	EContact* _tmp30_;
	EVCardAttribute* _tmp31_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (contact != NULL);
	g_return_if_fail (web_service_addresses != NULL);
	_tmp0_ = contact;
	_edsf_persona_store_remove_attribute (self, _tmp0_, "X-FOLKS-WEB-SERVICES-IDS");
	_tmp1_ = e_vcard_attribute_new (NULL, "X-FOLKS-WEB-SERVICES-IDS");
	attr_n = _tmp1_;
	{
		GeeIterator* _service_it = NULL;
		GeeMultiMap* _tmp2_;
		GeeSet* _tmp3_ = NULL;
		GeeSet* _tmp4_;
		GeeIterator* _tmp5_ = NULL;
		GeeIterator* _tmp6_;
		_tmp2_ = web_service_addresses;
		_tmp3_ = gee_multi_map_get_keys (_tmp2_);
		_tmp4_ = _tmp3_;
		_tmp5_ = gee_iterable_iterator ((GeeIterable*) _tmp4_);
		_tmp6_ = _tmp5_;
		_g_object_unref0 (_tmp4_);
		_service_it = _tmp6_;
		while (TRUE) {
			GeeIterator* _tmp7_;
			gboolean _tmp8_ = FALSE;
			gchar* service = NULL;
			GeeIterator* _tmp9_;
			gpointer _tmp10_ = NULL;
			EVCardAttributeParam* param = NULL;
			const gchar* _tmp11_;
			EVCardAttributeParam* _tmp12_;
			EVCardAttribute* _tmp27_;
			EVCardAttributeParam* _tmp28_;
			EVCardAttributeParam* _tmp29_;
			_tmp7_ = _service_it;
			_tmp8_ = gee_iterator_next (_tmp7_);
			if (!_tmp8_) {
				break;
			}
			_tmp9_ = _service_it;
			_tmp10_ = gee_iterator_get (_tmp9_);
			service = (gchar*) _tmp10_;
			_tmp11_ = service;
			_tmp12_ = e_vcard_attribute_param_new (_tmp11_);
			param = _tmp12_;
			{
				GeeIterator* _ws_fd_it = NULL;
				GeeMultiMap* _tmp13_;
				const gchar* _tmp14_;
				GeeCollection* _tmp15_ = NULL;
				GeeCollection* _tmp16_;
				GeeIterator* _tmp17_ = NULL;
				GeeIterator* _tmp18_;
				_tmp13_ = web_service_addresses;
				_tmp14_ = service;
				_tmp15_ = gee_multi_map_get (_tmp13_, _tmp14_);
				_tmp16_ = _tmp15_;
				_tmp17_ = gee_iterable_iterator ((GeeIterable*) _tmp16_);
				_tmp18_ = _tmp17_;
				_g_object_unref0 (_tmp16_);
				_ws_fd_it = _tmp18_;
				while (TRUE) {
					GeeIterator* _tmp19_;
					gboolean _tmp20_ = FALSE;
					FolksWebServiceFieldDetails* ws_fd = NULL;
					GeeIterator* _tmp21_;
					gpointer _tmp22_ = NULL;
					EVCardAttributeParam* _tmp23_;
					FolksWebServiceFieldDetails* _tmp24_;
					gconstpointer _tmp25_;
					const gchar* _tmp26_;
					_tmp19_ = _ws_fd_it;
					_tmp20_ = gee_iterator_next (_tmp19_);
					if (!_tmp20_) {
						break;
					}
					_tmp21_ = _ws_fd_it;
					_tmp22_ = gee_iterator_get (_tmp21_);
					ws_fd = (FolksWebServiceFieldDetails*) _tmp22_;
					_tmp23_ = param;
					_tmp24_ = ws_fd;
					_tmp25_ = folks_abstract_field_details_get_value ((FolksAbstractFieldDetails*) _tmp24_);
					_tmp26_ = _tmp25_;
					e_vcard_attribute_param_add_value (_tmp23_, (const gchar*) _tmp26_);
					_g_object_unref0 (ws_fd);
				}
				_g_object_unref0 (_ws_fd_it);
			}
			_tmp27_ = attr_n;
			_tmp28_ = param;
			_tmp29_ = __vala_EVCardAttributeParam_copy0 (_tmp28_);
			e_vcard_attribute_add_param (_tmp27_, _tmp29_);
			__vala_EVCardAttributeParam_free0 (param);
			_g_free0 (service);
		}
		_g_object_unref0 (_service_it);
	}
	_tmp30_ = contact;
	_tmp31_ = attr_n;
	attr_n = NULL;
	e_vcard_add_attribute ((EVCard*) _tmp30_, _tmp31_);
	__vala_EVCardAttribute_free0 (attr_n);
}


static void _edsf_persona_store_set_urls_data_free (gpointer _data) {
	EdsfPersonaStoreSetUrlsData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->persona);
	_g_object_unref0 (_data_->urls);
	_g_object_unref0 (_data_->self);
	g_slice_free (EdsfPersonaStoreSetUrlsData, _data_);
}


void _edsf_persona_store_set_urls (EdsfPersonaStore* self, EdsfPersona* persona, GeeSet* urls, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	EdsfPersonaStoreSetUrlsData* _data_;
	EdsfPersonaStore* _tmp0_;
	EdsfPersona* _tmp1_;
	EdsfPersona* _tmp2_;
	GeeSet* _tmp3_;
	GeeSet* _tmp4_;
	_data_ = g_slice_new0 (EdsfPersonaStoreSetUrlsData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, _edsf_persona_store_set_urls);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, _edsf_persona_store_set_urls_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	_tmp1_ = persona;
	_tmp2_ = _g_object_ref0 (_tmp1_);
	_g_object_unref0 (_data_->persona);
	_data_->persona = _tmp2_;
	_tmp3_ = urls;
	_tmp4_ = _g_object_ref0 (_tmp3_);
	_g_object_unref0 (_data_->urls);
	_data_->urls = _tmp4_;
	_edsf_persona_store_set_urls_co (_data_);
}


void _edsf_persona_store_set_urls_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error) {
	EdsfPersonaStoreSetUrlsData* _data_;
	if (g_simple_async_result_propagate_error (G_SIMPLE_ASYNC_RESULT (_res_), error)) {
		return;
	}
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


static void _edsf_persona_store_set_urls_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	EdsfPersonaStoreSetUrlsData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	_edsf_persona_store_set_urls_co (_data_);
}


static gboolean _edsf_persona_store_set_urls_co (EdsfPersonaStoreSetUrlsData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_tmp0_ = _data_->self->priv->_always_writeable_properties;
	_data_->_tmp0__length1 = _data_->self->priv->_always_writeable_properties_length1;
	if (!_vala_string_array_contains (_data_->_tmp0_, _data_->_tmp0__length1, "urls")) {
		_data_->_tmp1_ = NULL;
		_data_->_tmp1_ = _ ("URLs are not writeable on this contact.");
		_data_->_tmp2_ = g_error_new_literal (FOLKS_PROPERTY_ERROR, FOLKS_PROPERTY_ERROR_NOT_WRITEABLE, _data_->_tmp1_);
		_data_->_inner_error_ = _data_->_tmp2_;
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	_data_->_tmp3_ = _data_->persona;
	_data_->_tmp4_ = folks_url_details_get_urls ((FolksUrlDetails*) _data_->_tmp3_);
	_data_->_tmp5_ = _data_->_tmp4_;
	_data_->_tmp6_ = _data_->urls;
	_data_->_tmp7_ = FALSE;
	_data_->_tmp7_ = folks_utils_set_afd_equal (_data_->_tmp5_, _data_->_tmp6_);
	if (_data_->_tmp7_) {
		if (_data_->_state_ == 0) {
			g_simple_async_result_complete_in_idle (_data_->_async_result);
		} else {
			g_simple_async_result_complete (_data_->_async_result);
		}
		g_object_unref (_data_->_async_result);
		return FALSE;
	}
	_data_->_tmp8_ = _data_->persona;
	_data_->_tmp9_ = edsf_persona_get_contact (_data_->_tmp8_);
	_data_->_tmp10_ = _data_->_tmp9_;
	_data_->_tmp11_ = _data_->urls;
	_edsf_persona_store_set_contact_urls (_data_->self, _data_->_tmp10_, _data_->_tmp11_);
	_data_->_tmp12_ = _data_->persona;
	_data_->_state_ = 1;
	_edsf_persona_store_commit_modified_property (_data_->self, _data_->_tmp12_, "urls", _edsf_persona_store_set_urls_ready, _data_);
	return FALSE;
	_state_1:
	_edsf_persona_store_commit_modified_property_finish (_data_->self, _data_->_res_, &_data_->_inner_error_);
	if (_data_->_inner_error_ != NULL) {
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static void _edsf_persona_store_set_contact_urls (EdsfPersonaStore* self, EContact* contact, GeeSet* urls) {
	EVCard* vcard = NULL;
	EContact* _tmp0_;
	EVCard* _tmp1_;
	EVCard* _tmp2_;
	EContact* _tmp3_;
	EContact* _tmp4_;
	EContact* _tmp5_;
	EContact* _tmp6_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (contact != NULL);
	g_return_if_fail (urls != NULL);
	_tmp0_ = contact;
	_tmp1_ = _g_object_ref0 (G_TYPE_CHECK_INSTANCE_CAST (_tmp0_, e_vcard_get_type (), EVCard));
	vcard = _tmp1_;
	_tmp2_ = vcard;
	e_vcard_remove_attributes (_tmp2_, NULL, "X-URIS");
	_tmp3_ = contact;
	e_contact_set (_tmp3_, E_CONTACT_HOMEPAGE_URL, NULL);
	_tmp4_ = contact;
	e_contact_set (_tmp4_, E_CONTACT_VIDEO_URL, NULL);
	_tmp5_ = contact;
	e_contact_set (_tmp5_, E_CONTACT_BLOG_URL, NULL);
	_tmp6_ = contact;
	e_contact_set (_tmp6_, E_CONTACT_FREEBUSY_URL, NULL);
	{
		GeeIterator* _u_it = NULL;
		GeeSet* _tmp7_;
		GeeIterator* _tmp8_ = NULL;
		_tmp7_ = urls;
		_tmp8_ = gee_iterable_iterator ((GeeIterable*) _tmp7_);
		_u_it = _tmp8_;
		while (TRUE) {
			GeeIterator* _tmp9_;
			gboolean _tmp10_ = FALSE;
			FolksUrlFieldDetails* u = NULL;
			GeeIterator* _tmp11_;
			gpointer _tmp12_ = NULL;
			gboolean set_attr_already = FALSE;
			EVCardAttribute* attr = NULL;
			EVCardAttribute* _tmp13_;
			EVCardAttribute* _tmp14_;
			FolksUrlFieldDetails* _tmp15_;
			gconstpointer _tmp16_;
			const gchar* _tmp17_;
			gboolean _tmp67_;
			EContact* _tmp68_;
			EVCardAttribute* _tmp69_;
			_tmp9_ = _u_it;
			_tmp10_ = gee_iterator_next (_tmp9_);
			if (!_tmp10_) {
				break;
			}
			_tmp11_ = _u_it;
			_tmp12_ = gee_iterator_get (_tmp11_);
			u = (FolksUrlFieldDetails*) _tmp12_;
			set_attr_already = FALSE;
			_tmp13_ = e_vcard_attribute_new (NULL, "X-URIS");
			attr = _tmp13_;
			_tmp14_ = attr;
			_tmp15_ = u;
			_tmp16_ = folks_abstract_field_details_get_value ((FolksAbstractFieldDetails*) _tmp15_);
			_tmp17_ = _tmp16_;
			e_vcard_attribute_add_value (_tmp14_, (const gchar*) _tmp17_);
			{
				GeeIterator* _param_name_it = NULL;
				FolksUrlFieldDetails* _tmp18_;
				GeeMultiMap* _tmp19_;
				GeeMultiMap* _tmp20_;
				GeeSet* _tmp21_ = NULL;
				GeeSet* _tmp22_;
				GeeIterator* _tmp23_ = NULL;
				GeeIterator* _tmp24_;
				_tmp18_ = u;
				_tmp19_ = folks_abstract_field_details_get_parameters ((FolksAbstractFieldDetails*) _tmp18_);
				_tmp20_ = _tmp19_;
				_tmp21_ = gee_multi_map_get_keys (_tmp20_);
				_tmp22_ = _tmp21_;
				_tmp23_ = gee_iterable_iterator ((GeeIterable*) _tmp22_);
				_tmp24_ = _tmp23_;
				_g_object_unref0 (_tmp22_);
				_param_name_it = _tmp24_;
				while (TRUE) {
					GeeIterator* _tmp25_;
					gboolean _tmp26_ = FALSE;
					gchar* param_name = NULL;
					GeeIterator* _tmp27_;
					gpointer _tmp28_ = NULL;
					EVCardAttributeParam* param = NULL;
					const gchar* _tmp29_;
					gchar* _tmp30_ = NULL;
					gchar* _tmp31_;
					EVCardAttributeParam* _tmp32_;
					EVCardAttributeParam* _tmp33_;
					gboolean _tmp63_;
					EVCardAttribute* _tmp64_;
					EVCardAttributeParam* _tmp65_;
					EVCardAttributeParam* _tmp66_;
					_tmp25_ = _param_name_it;
					_tmp26_ = gee_iterator_next (_tmp25_);
					if (!_tmp26_) {
						break;
					}
					_tmp27_ = _param_name_it;
					_tmp28_ = gee_iterator_get (_tmp27_);
					param_name = (gchar*) _tmp28_;
					_tmp29_ = param_name;
					_tmp30_ = g_utf8_strup (_tmp29_, (gssize) (-1));
					_tmp31_ = _tmp30_;
					_tmp32_ = e_vcard_attribute_param_new (_tmp31_);
					_tmp33_ = _tmp32_;
					_g_free0 (_tmp31_);
					param = _tmp33_;
					{
						GeeIterator* _param_val_it = NULL;
						FolksUrlFieldDetails* _tmp34_;
						GeeMultiMap* _tmp35_;
						GeeMultiMap* _tmp36_;
						const gchar* _tmp37_;
						GeeCollection* _tmp38_ = NULL;
						GeeCollection* _tmp39_;
						GeeIterator* _tmp40_ = NULL;
						GeeIterator* _tmp41_;
						_tmp34_ = u;
						_tmp35_ = folks_abstract_field_details_get_parameters ((FolksAbstractFieldDetails*) _tmp34_);
						_tmp36_ = _tmp35_;
						_tmp37_ = param_name;
						_tmp38_ = gee_multi_map_get (_tmp36_, _tmp37_);
						_tmp39_ = _tmp38_;
						_tmp40_ = gee_iterable_iterator ((GeeIterable*) _tmp39_);
						_tmp41_ = _tmp40_;
						_g_object_unref0 (_tmp39_);
						_param_val_it = _tmp41_;
						while (TRUE) {
							GeeIterator* _tmp42_;
							gboolean _tmp43_ = FALSE;
							gchar* param_val = NULL;
							GeeIterator* _tmp44_;
							gpointer _tmp45_ = NULL;
							const gchar* _tmp46_;
							gboolean _tmp60_;
							EVCardAttributeParam* _tmp61_;
							const gchar* _tmp62_;
							_tmp42_ = _param_val_it;
							_tmp43_ = gee_iterator_next (_tmp42_);
							if (!_tmp43_) {
								break;
							}
							_tmp44_ = _param_val_it;
							_tmp45_ = gee_iterator_get (_tmp44_);
							param_val = (gchar*) _tmp45_;
							_tmp46_ = param_name;
							if (g_strcmp0 (_tmp46_, FOLKS_ABSTRACT_FIELD_DETAILS_PARAM_TYPE) == 0) {
								{
									EdsfPersonaUrlTypeMapping* mapping_collection = NULL;
									gint mapping_collection_length1 = 0;
									gint _mapping_collection_size_ = 0;
									gint mapping_it = 0;
									mapping_collection = EDSF_PERSONA__url_properties;
									mapping_collection_length1 = G_N_ELEMENTS (EDSF_PERSONA__url_properties);
									for (mapping_it = 0; mapping_it < G_N_ELEMENTS (EDSF_PERSONA__url_properties); mapping_it = mapping_it + 1) {
										EdsfPersonaUrlTypeMapping mapping = {0};
										mapping = mapping_collection[mapping_it];
										{
											const gchar* _tmp47_;
											gchar* _tmp48_ = NULL;
											gchar* _tmp49_;
											EdsfPersonaUrlTypeMapping _tmp50_;
											const gchar* _tmp51_;
											gboolean _tmp52_;
											_tmp47_ = param_val;
											_tmp48_ = g_utf8_strdown (_tmp47_, (gssize) (-1));
											_tmp49_ = _tmp48_;
											_tmp50_ = mapping;
											_tmp51_ = _tmp50_.folks_type;
											_tmp52_ = g_strcmp0 (_tmp49_, _tmp51_) == 0;
											_g_free0 (_tmp49_);
											if (_tmp52_) {
												EContact* _tmp53_;
												EdsfPersonaUrlTypeMapping _tmp54_;
												const gchar* _tmp55_;
												EContactField _tmp56_ = 0;
												FolksUrlFieldDetails* _tmp57_;
												gconstpointer _tmp58_;
												const gchar* _tmp59_;
												_tmp53_ = contact;
												_tmp54_ = mapping;
												_tmp55_ = _tmp54_.vcard_field_name;
												_tmp56_ = e_contact_field_id (_tmp55_);
												_tmp57_ = u;
												_tmp58_ = folks_abstract_field_details_get_value ((FolksAbstractFieldDetails*) _tmp57_);
												_tmp59_ = _tmp58_;
												e_contact_set (_tmp53_, _tmp56_, (const gchar*) _tmp59_);
												set_attr_already = TRUE;
												break;
											}
										}
									}
								}
							}
							_tmp60_ = set_attr_already;
							if (_tmp60_ == TRUE) {
								_g_free0 (param_val);
								break;
							}
							_tmp61_ = param;
							_tmp62_ = param_val;
							e_vcard_attribute_param_add_value (_tmp61_, _tmp62_);
							_g_free0 (param_val);
						}
						_g_object_unref0 (_param_val_it);
					}
					_tmp63_ = set_attr_already;
					if (_tmp63_ == TRUE) {
						__vala_EVCardAttributeParam_free0 (param);
						_g_free0 (param_name);
						break;
					}
					_tmp64_ = attr;
					_tmp65_ = param;
					_tmp66_ = __vala_EVCardAttributeParam_copy0 (_tmp65_);
					e_vcard_attribute_add_param (_tmp64_, _tmp66_);
					__vala_EVCardAttributeParam_free0 (param);
					_g_free0 (param_name);
				}
				_g_object_unref0 (_param_name_it);
			}
			_tmp67_ = set_attr_already;
			if (_tmp67_ == TRUE) {
				__vala_EVCardAttribute_free0 (attr);
				_g_object_unref0 (u);
				continue;
			}
			_tmp68_ = contact;
			_tmp69_ = attr;
			attr = NULL;
			e_vcard_add_attribute ((EVCard*) _tmp68_, _tmp69_);
			__vala_EVCardAttribute_free0 (attr);
			_g_object_unref0 (u);
		}
		_g_object_unref0 (_u_it);
	}
	_g_object_unref0 (vcard);
}


static void _edsf_persona_store_set_local_ids_data_free (gpointer _data) {
	EdsfPersonaStoreSetLocalIdsData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->persona);
	_g_object_unref0 (_data_->local_ids);
	_g_object_unref0 (_data_->self);
	g_slice_free (EdsfPersonaStoreSetLocalIdsData, _data_);
}


void _edsf_persona_store_set_local_ids (EdsfPersonaStore* self, EdsfPersona* persona, GeeSet* local_ids, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	EdsfPersonaStoreSetLocalIdsData* _data_;
	EdsfPersonaStore* _tmp0_;
	EdsfPersona* _tmp1_;
	EdsfPersona* _tmp2_;
	GeeSet* _tmp3_;
	GeeSet* _tmp4_;
	_data_ = g_slice_new0 (EdsfPersonaStoreSetLocalIdsData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, _edsf_persona_store_set_local_ids);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, _edsf_persona_store_set_local_ids_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	_tmp1_ = persona;
	_tmp2_ = _g_object_ref0 (_tmp1_);
	_g_object_unref0 (_data_->persona);
	_data_->persona = _tmp2_;
	_tmp3_ = local_ids;
	_tmp4_ = _g_object_ref0 (_tmp3_);
	_g_object_unref0 (_data_->local_ids);
	_data_->local_ids = _tmp4_;
	_edsf_persona_store_set_local_ids_co (_data_);
}


void _edsf_persona_store_set_local_ids_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error) {
	EdsfPersonaStoreSetLocalIdsData* _data_;
	if (g_simple_async_result_propagate_error (G_SIMPLE_ASYNC_RESULT (_res_), error)) {
		return;
	}
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


static void _edsf_persona_store_set_local_ids_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	EdsfPersonaStoreSetLocalIdsData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	_edsf_persona_store_set_local_ids_co (_data_);
}


static gboolean _edsf_persona_store_set_local_ids_co (EdsfPersonaStoreSetLocalIdsData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_tmp0_ = _data_->self->priv->_always_writeable_properties;
	_data_->_tmp0__length1 = _data_->self->priv->_always_writeable_properties_length1;
	if (!_vala_string_array_contains (_data_->_tmp0_, _data_->_tmp0__length1, "local-ids")) {
		_data_->_tmp1_ = NULL;
		_data_->_tmp1_ = _ ("Local IDs are not writeable on this contact.");
		_data_->_tmp2_ = g_error_new_literal (FOLKS_PROPERTY_ERROR, FOLKS_PROPERTY_ERROR_NOT_WRITEABLE, _data_->_tmp1_);
		_data_->_inner_error_ = _data_->_tmp2_;
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	_data_->_tmp3_ = _data_->local_ids;
	_data_->_tmp4_ = _data_->persona;
	_data_->_tmp5_ = folks_local_id_details_get_local_ids ((FolksLocalIdDetails*) _data_->_tmp4_);
	_data_->_tmp6_ = _data_->_tmp5_;
	_data_->_tmp7_ = FALSE;
	_data_->_tmp7_ = folks_internal_equal_sets (G_TYPE_STRING, (GBoxedCopyFunc) g_strdup, g_free, _data_->_tmp3_, _data_->_tmp6_);
	if (_data_->_tmp7_) {
		if (_data_->_state_ == 0) {
			g_simple_async_result_complete_in_idle (_data_->_async_result);
		} else {
			g_simple_async_result_complete (_data_->_async_result);
		}
		g_object_unref (_data_->_async_result);
		return FALSE;
	}
	_data_->_tmp8_ = _data_->persona;
	_data_->_tmp9_ = edsf_persona_get_contact (_data_->_tmp8_);
	_data_->_tmp10_ = _data_->_tmp9_;
	_data_->_tmp11_ = _data_->local_ids;
	_edsf_persona_store_set_contact_local_ids (_data_->self, _data_->_tmp10_, _data_->_tmp11_);
	_data_->_tmp12_ = _data_->persona;
	_data_->_state_ = 1;
	_edsf_persona_store_commit_modified_property (_data_->self, _data_->_tmp12_, "local-ids", _edsf_persona_store_set_local_ids_ready, _data_);
	return FALSE;
	_state_1:
	_edsf_persona_store_commit_modified_property_finish (_data_->self, _data_->_res_, &_data_->_inner_error_);
	if (_data_->_inner_error_ != NULL) {
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static void _edsf_persona_store_set_contact_local_ids (EdsfPersonaStore* self, EContact* contact, GeeSet* local_ids) {
	EContact* _tmp0_;
	EVCardAttribute* new_attr = NULL;
	EVCardAttribute* _tmp1_;
	EContact* _tmp10_;
	EVCardAttribute* _tmp11_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (contact != NULL);
	g_return_if_fail (local_ids != NULL);
	_tmp0_ = contact;
	_edsf_persona_store_remove_attribute (self, _tmp0_, "X-FOLKS-CONTACTS-IDS");
	_tmp1_ = e_vcard_attribute_new (NULL, "X-FOLKS-CONTACTS-IDS");
	new_attr = _tmp1_;
	{
		GeeIterator* _local_id_it = NULL;
		GeeSet* _tmp2_;
		GeeIterator* _tmp3_ = NULL;
		_tmp2_ = local_ids;
		_tmp3_ = gee_iterable_iterator ((GeeIterable*) _tmp2_);
		_local_id_it = _tmp3_;
		while (TRUE) {
			GeeIterator* _tmp4_;
			gboolean _tmp5_ = FALSE;
			gchar* local_id = NULL;
			GeeIterator* _tmp6_;
			gpointer _tmp7_ = NULL;
			EVCardAttribute* _tmp8_;
			const gchar* _tmp9_;
			_tmp4_ = _local_id_it;
			_tmp5_ = gee_iterator_next (_tmp4_);
			if (!_tmp5_) {
				break;
			}
			_tmp6_ = _local_id_it;
			_tmp7_ = gee_iterator_get (_tmp6_);
			local_id = (gchar*) _tmp7_;
			_tmp8_ = new_attr;
			_tmp9_ = local_id;
			e_vcard_attribute_add_value (_tmp8_, _tmp9_);
			_g_free0 (local_id);
		}
		_g_object_unref0 (_local_id_it);
	}
	_tmp10_ = contact;
	_tmp11_ = new_attr;
	new_attr = NULL;
	e_vcard_add_attribute ((EVCard*) _tmp10_, _tmp11_);
	__vala_EVCardAttribute_free0 (new_attr);
}


static void _edsf_persona_store_set_is_favourite_data_free (gpointer _data) {
	EdsfPersonaStoreSetIsFavouriteData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->persona);
	_g_object_unref0 (_data_->self);
	g_slice_free (EdsfPersonaStoreSetIsFavouriteData, _data_);
}


void _edsf_persona_store_set_is_favourite (EdsfPersonaStore* self, EdsfPersona* persona, gboolean is_favourite, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	EdsfPersonaStoreSetIsFavouriteData* _data_;
	EdsfPersonaStore* _tmp0_;
	EdsfPersona* _tmp1_;
	EdsfPersona* _tmp2_;
	gboolean _tmp3_;
	_data_ = g_slice_new0 (EdsfPersonaStoreSetIsFavouriteData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, _edsf_persona_store_set_is_favourite);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, _edsf_persona_store_set_is_favourite_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	_tmp1_ = persona;
	_tmp2_ = _g_object_ref0 (_tmp1_);
	_g_object_unref0 (_data_->persona);
	_data_->persona = _tmp2_;
	_tmp3_ = is_favourite;
	_data_->is_favourite = _tmp3_;
	_edsf_persona_store_set_is_favourite_co (_data_);
}


void _edsf_persona_store_set_is_favourite_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error) {
	EdsfPersonaStoreSetIsFavouriteData* _data_;
	if (g_simple_async_result_propagate_error (G_SIMPLE_ASYNC_RESULT (_res_), error)) {
		return;
	}
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


static void _edsf_persona_store_set_is_favourite_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	EdsfPersonaStoreSetIsFavouriteData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	_edsf_persona_store_set_is_favourite_co (_data_);
}


static gboolean _edsf_persona_store_set_is_favourite_co (EdsfPersonaStoreSetIsFavouriteData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_tmp0_ = _data_->self->priv->_always_writeable_properties;
	_data_->_tmp0__length1 = _data_->self->priv->_always_writeable_properties_length1;
	if (!_vala_string_array_contains (_data_->_tmp0_, _data_->_tmp0__length1, "is-favourite")) {
		_data_->_tmp1_ = NULL;
		_data_->_tmp1_ = _ ("The contact cannot be marked as favourite.");
		_data_->_tmp2_ = g_error_new_literal (FOLKS_PROPERTY_ERROR, FOLKS_PROPERTY_ERROR_NOT_WRITEABLE, _data_->_tmp1_);
		_data_->_inner_error_ = _data_->_tmp2_;
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	_data_->_tmp3_ = _data_->is_favourite;
	_data_->_tmp4_ = _data_->persona;
	_data_->_tmp5_ = folks_favourite_details_get_is_favourite ((FolksFavouriteDetails*) _data_->_tmp4_);
	_data_->_tmp6_ = _data_->_tmp5_;
	if (_data_->_tmp3_ == _data_->_tmp6_) {
		if (_data_->_state_ == 0) {
			g_simple_async_result_complete_in_idle (_data_->_async_result);
		} else {
			g_simple_async_result_complete (_data_->_async_result);
		}
		g_object_unref (_data_->_async_result);
		return FALSE;
	}
	_data_->_tmp7_ = _data_->persona;
	_data_->_tmp8_ = edsf_persona_get_contact (_data_->_tmp7_);
	_data_->_tmp9_ = _data_->_tmp8_;
	_data_->_tmp10_ = _data_->is_favourite;
	_edsf_persona_store_set_contact_is_favourite (_data_->self, _data_->_tmp9_, _data_->_tmp10_);
	_data_->_tmp11_ = _data_->persona;
	_data_->_tmp12_ = edsf_persona_get_contact (_data_->_tmp11_);
	_data_->_tmp13_ = _data_->_tmp12_;
	_data_->_tmp14_ = _data_->persona;
	_data_->_tmp15_ = folks_group_details_get_groups ((FolksGroupDetails*) _data_->_tmp14_);
	_data_->_tmp16_ = _data_->_tmp15_;
	_data_->_tmp17_ = _data_->is_favourite;
	_edsf_persona_store_set_contact_groups (_data_->self, _data_->_tmp13_, _data_->_tmp16_, _data_->_tmp17_);
	_data_->_tmp18_ = _data_->persona;
	_data_->_state_ = 1;
	_edsf_persona_store_commit_modified_property (_data_->self, _data_->_tmp18_, "is-favourite", _edsf_persona_store_set_is_favourite_ready, _data_);
	return FALSE;
	_state_1:
	_edsf_persona_store_commit_modified_property_finish (_data_->self, _data_->_res_, &_data_->_inner_error_);
	if (_data_->_inner_error_ != NULL) {
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static void _edsf_persona_store_set_contact_is_favourite (EdsfPersonaStore* self, EContact* contact, gboolean is_favourite) {
	EContact* _tmp0_;
	gboolean _tmp1_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (contact != NULL);
	_tmp0_ = contact;
	_edsf_persona_store_remove_attribute (self, _tmp0_, "X-FOLKS-FAVOURITE");
	_tmp1_ = is_favourite;
	if (_tmp1_) {
		EVCardAttribute* new_attr = NULL;
		EVCardAttribute* _tmp2_;
		EVCardAttribute* _tmp3_;
		EContact* _tmp4_;
		EVCardAttribute* _tmp5_;
		_tmp2_ = e_vcard_attribute_new (NULL, "X-FOLKS-FAVOURITE");
		new_attr = _tmp2_;
		_tmp3_ = new_attr;
		e_vcard_attribute_add_value (_tmp3_, "true");
		_tmp4_ = contact;
		_tmp5_ = new_attr;
		new_attr = NULL;
		e_vcard_add_attribute ((EVCard*) _tmp4_, _tmp5_);
		__vala_EVCardAttribute_free0 (new_attr);
	}
}


static void _edsf_persona_store_set_contact_avatar_data_free (gpointer _data) {
	EdsfPersonaStoreSetContactAvatarData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->contact);
	_g_object_unref0 (_data_->avatar);
	_g_object_unref0 (_data_->self);
	g_slice_free (EdsfPersonaStoreSetContactAvatarData, _data_);
}


static void _edsf_persona_store_set_contact_avatar (EdsfPersonaStore* self, EContact* contact, GLoadableIcon* avatar, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	EdsfPersonaStoreSetContactAvatarData* _data_;
	EdsfPersonaStore* _tmp0_;
	EContact* _tmp1_;
	EContact* _tmp2_;
	GLoadableIcon* _tmp3_;
	GLoadableIcon* _tmp4_;
	_data_ = g_slice_new0 (EdsfPersonaStoreSetContactAvatarData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, _edsf_persona_store_set_contact_avatar);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, _edsf_persona_store_set_contact_avatar_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	_tmp1_ = contact;
	_tmp2_ = _g_object_ref0 (_tmp1_);
	_g_object_unref0 (_data_->contact);
	_data_->contact = _tmp2_;
	_tmp3_ = avatar;
	_tmp4_ = _g_object_ref0 (_tmp3_);
	_g_object_unref0 (_data_->avatar);
	_data_->avatar = _tmp4_;
	_edsf_persona_store_set_contact_avatar_co (_data_);
}


static void _edsf_persona_store_set_contact_avatar_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error) {
	EdsfPersonaStoreSetContactAvatarData* _data_;
	if (g_simple_async_result_propagate_error (G_SIMPLE_ASYNC_RESULT (_res_), error)) {
		return;
	}
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


static void _edsf_persona_store_set_contact_avatar_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	EdsfPersonaStoreSetContactAvatarData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	_edsf_persona_store_set_contact_avatar_co (_data_);
}


static void _vala_EContactPhoto_free (EContactPhoto* self) {
	g_boxed_free (e_contact_photo_get_type (), self);
}


static gboolean _edsf_persona_store_set_contact_avatar_co (EdsfPersonaStoreSetContactAvatarData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		case 2:
		goto _state_2;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_tmp0_ = _data_->avatar;
	if (_data_->_tmp0_ == NULL) {
		_data_->_tmp1_ = _data_->contact;
		_edsf_persona_store_remove_attribute (_data_->self, _data_->_tmp1_, "PHOTO");
	} else {
		{
			_data_->_tmp2_ = e_contact_photo_new ();
			_data_->cp = _data_->_tmp2_;
			_data_->_tmp3_ = _data_->cp;
			_data_->_tmp3_->type = E_CONTACT_PHOTO_TYPE_INLINED;
			_data_->_tmp4_ = _data_->avatar;
			_data_->_state_ = 1;
			g_loadable_icon_load_async (G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp4_, g_loadable_icon_get_type (), GLoadableIcon), -1, NULL, _edsf_persona_store_set_contact_avatar_ready, _data_);
			return FALSE;
			_state_1:
			_data_->_tmp5_ = NULL;
			_data_->_tmp5_ = g_loadable_icon_load_finish (G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp4_, g_loadable_icon_get_type (), GLoadableIcon), _data_->_res_, NULL, &_data_->_inner_error_);
			_data_->input_s = _data_->_tmp5_;
			if (_data_->_inner_error_ != NULL) {
				__vala_EContactPhoto_free0 (_data_->cp);
				goto __catch17_g_error;
			}
			_data_->_tmp6_ = NULL;
			_data_->_tmp6_ = g_new0 (guint8, 0);
			_data_->image_data = _data_->_tmp6_;
			_data_->image_data_length1 = 0;
			_data_->_image_data_size_ = _data_->image_data_length1;
			_data_->_tmp7_ = NULL;
			_data_->_tmp7_ = g_new0 (guint8, 4096);
			_data_->buffer = _data_->_tmp7_;
			_data_->buffer_length1 = 4096;
			_data_->_buffer_size_ = _data_->buffer_length1;
			while (TRUE) {
				_data_->_tmp8_ = _data_->input_s;
				_data_->_tmp9_ = _data_->buffer;
				_data_->_tmp9__length1 = _data_->buffer_length1;
				_data_->_state_ = 2;
				g_input_stream_read_async (_data_->_tmp8_, (void*) _data_->_tmp9_, (gsize) _data_->_tmp9__length1, G_PRIORITY_DEFAULT, NULL, _edsf_persona_store_set_contact_avatar_ready, _data_);
				return FALSE;
				_state_2:
				_data_->_tmp10_ = 0L;
				_data_->_tmp10_ = g_input_stream_read_finish (_data_->_tmp8_, _data_->_res_, &_data_->_inner_error_);
				_data_->size_read = _data_->_tmp10_;
				if (_data_->_inner_error_ != NULL) {
					_data_->buffer = (g_free (_data_->buffer), NULL);
					_data_->image_data = (g_free (_data_->image_data), NULL);
					_g_object_unref0 (_data_->input_s);
					__vala_EContactPhoto_free0 (_data_->cp);
					goto __catch17_g_error;
				}
				_data_->_tmp11_ = _data_->size_read;
				if (_data_->_tmp11_ <= ((gssize) 0)) {
					break;
				}
				_data_->_tmp12_ = _data_->image_data;
				_data_->_tmp12__length1 = _data_->image_data_length1;
				_data_->read_cur = _data_->_tmp12__length1;
				_data_->_tmp13_ = _data_->read_cur;
				_data_->_tmp14_ = _data_->size_read;
				_data_->_tmp15_ = 0;
				_data_->_tmp15_ = _data_->_tmp13_ + ((gint) _data_->_tmp14_);
				_data_->image_data = g_renew (guint8, _data_->image_data, _data_->_tmp13_ + ((gint) _data_->_tmp14_));
				(_data_->_tmp15_ > _data_->image_data_length1) ? memset (_data_->image_data + _data_->image_data_length1, 0, sizeof (guint8) * (_data_->_tmp15_ - _data_->image_data_length1)) : NULL;
				_data_->image_data_length1 = _data_->_tmp15_;
				_data_->_image_data_size_ = _data_->_tmp15_;
				_data_->_tmp16_ = _data_->image_data;
				_data_->_tmp16__length1 = _data_->image_data_length1;
				_data_->_tmp17_ = _data_->read_cur;
				_data_->_tmp18_ = _data_->buffer;
				_data_->_tmp18__length1 = _data_->buffer_length1;
				_data_->_tmp19_ = _data_->size_read;
				memcpy (&_data_->_tmp16_[_data_->_tmp17_], _data_->_tmp18_, (gsize) _data_->_tmp19_);
			}
			_data_->_tmp20_ = _data_->cp;
			_data_->_tmp21_ = _data_->image_data;
			_data_->_tmp21__length1 = _data_->image_data_length1;
			e_contact_photo_set_inlined (_data_->_tmp20_, _data_->_tmp21_, (gsize) _data_->_tmp21__length1);
			_data_->uncertain = FALSE;
			_data_->_tmp22_ = _data_->image_data;
			_data_->_tmp22__length1 = _data_->image_data_length1;
			_data_->_tmp23_ = FALSE;
			_data_->_tmp24_ = NULL;
			_data_->_tmp24_ = g_content_type_guess (NULL, _data_->_tmp22_, (gsize) _data_->_tmp22__length1, &_data_->_tmp23_);
			_data_->uncertain = _data_->_tmp23_;
			_data_->mime_type = _data_->_tmp24_;
			_data_->_tmp25_ = _data_->uncertain;
			if (!_data_->_tmp25_) {
				_data_->_tmp26_ = _data_->cp;
				_data_->_tmp27_ = _data_->mime_type;
				e_contact_photo_set_mime_type (_data_->_tmp26_, _data_->_tmp27_);
			}
			_data_->_tmp28_ = _data_->contact;
			_data_->_tmp29_ = _data_->cp;
			e_contact_set (_data_->_tmp28_, E_CONTACT_PHOTO, _data_->_tmp29_);
			_g_free0 (_data_->mime_type);
			_data_->buffer = (g_free (_data_->buffer), NULL);
			_data_->image_data = (g_free (_data_->image_data), NULL);
			_g_object_unref0 (_data_->input_s);
			__vala_EContactPhoto_free0 (_data_->cp);
		}
		goto __finally17;
		__catch17_g_error:
		{
			_data_->e1 = _data_->_inner_error_;
			_data_->_inner_error_ = NULL;
			_data_->_tmp30_ = NULL;
			_data_->_tmp30_ = _ ("Can't update avatar: %s");
			_data_->_tmp31_ = _data_->e1;
			_data_->_tmp32_ = _data_->_tmp31_->message;
			_data_->_tmp33_ = g_error_new (FOLKS_PROPERTY_ERROR, FOLKS_PROPERTY_ERROR_INVALID_VALUE, _data_->_tmp30_, _data_->_tmp32_);
			_data_->_inner_error_ = _data_->_tmp33_;
			_g_error_free0 (_data_->e1);
			goto __finally17;
		}
		__finally17:
		if (_data_->_inner_error_ != NULL) {
			if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
				g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
				g_error_free (_data_->_inner_error_);
				if (_data_->_state_ == 0) {
					g_simple_async_result_complete_in_idle (_data_->_async_result);
				} else {
					g_simple_async_result_complete (_data_->_async_result);
				}
				g_object_unref (_data_->_async_result);
				return FALSE;
			} else {
				g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
				g_clear_error (&_data_->_inner_error_);
				return FALSE;
			}
		}
	}
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static void _edsf_persona_store_set_emails_data_free (gpointer _data) {
	EdsfPersonaStoreSetEmailsData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->persona);
	_g_object_unref0 (_data_->emails);
	_g_object_unref0 (_data_->self);
	g_slice_free (EdsfPersonaStoreSetEmailsData, _data_);
}


void _edsf_persona_store_set_emails (EdsfPersonaStore* self, EdsfPersona* persona, GeeSet* emails, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	EdsfPersonaStoreSetEmailsData* _data_;
	EdsfPersonaStore* _tmp0_;
	EdsfPersona* _tmp1_;
	EdsfPersona* _tmp2_;
	GeeSet* _tmp3_;
	GeeSet* _tmp4_;
	_data_ = g_slice_new0 (EdsfPersonaStoreSetEmailsData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, _edsf_persona_store_set_emails);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, _edsf_persona_store_set_emails_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	_tmp1_ = persona;
	_tmp2_ = _g_object_ref0 (_tmp1_);
	_g_object_unref0 (_data_->persona);
	_data_->persona = _tmp2_;
	_tmp3_ = emails;
	_tmp4_ = _g_object_ref0 (_tmp3_);
	_g_object_unref0 (_data_->emails);
	_data_->emails = _tmp4_;
	_edsf_persona_store_set_emails_co (_data_);
}


void _edsf_persona_store_set_emails_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error) {
	EdsfPersonaStoreSetEmailsData* _data_;
	if (g_simple_async_result_propagate_error (G_SIMPLE_ASYNC_RESULT (_res_), error)) {
		return;
	}
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


static void _edsf_persona_store_set_emails_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	EdsfPersonaStoreSetEmailsData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	_edsf_persona_store_set_emails_co (_data_);
}


static gboolean _edsf_persona_store_set_emails_co (EdsfPersonaStoreSetEmailsData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_tmp0_ = _data_->self->priv->_always_writeable_properties;
	_data_->_tmp0__length1 = _data_->self->priv->_always_writeable_properties_length1;
	if (!_vala_string_array_contains (_data_->_tmp0_, _data_->_tmp0__length1, "email-addresses")) {
		_data_->_tmp1_ = NULL;
		_data_->_tmp1_ = _ ("E-mail addresses are not writeable on this contact.");
		_data_->_tmp2_ = g_error_new_literal (FOLKS_PROPERTY_ERROR, FOLKS_PROPERTY_ERROR_NOT_WRITEABLE, _data_->_tmp1_);
		_data_->_inner_error_ = _data_->_tmp2_;
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	_data_->_tmp3_ = _data_->emails;
	_data_->_tmp4_ = _data_->persona;
	_data_->_tmp5_ = folks_email_details_get_email_addresses ((FolksEmailDetails*) _data_->_tmp4_);
	_data_->_tmp6_ = _data_->_tmp5_;
	_data_->_tmp7_ = FALSE;
	_data_->_tmp7_ = folks_internal_equal_sets (FOLKS_TYPE_EMAIL_FIELD_DETAILS, (GBoxedCopyFunc) g_object_ref, g_object_unref, _data_->_tmp3_, _data_->_tmp6_);
	if (_data_->_tmp7_) {
		if (_data_->_state_ == 0) {
			g_simple_async_result_complete_in_idle (_data_->_async_result);
		} else {
			g_simple_async_result_complete (_data_->_async_result);
		}
		g_object_unref (_data_->_async_result);
		return FALSE;
	}
	_data_->_tmp8_ = _data_->persona;
	_data_->_tmp9_ = edsf_persona_get_contact (_data_->_tmp8_);
	_data_->_tmp10_ = _data_->_tmp9_;
	_data_->_tmp11_ = _data_->emails;
	_edsf_persona_store_set_contact_attributes_string (_data_->self, _data_->_tmp10_, _data_->_tmp11_, "EMAIL", E_CONTACT_EMAIL);
	_data_->_tmp12_ = _data_->persona;
	_data_->_state_ = 1;
	_edsf_persona_store_commit_modified_property (_data_->self, _data_->_tmp12_, "email-addresses", _edsf_persona_store_set_emails_ready, _data_);
	return FALSE;
	_state_1:
	_edsf_persona_store_commit_modified_property_finish (_data_->self, _data_->_res_, &_data_->_inner_error_);
	if (_data_->_inner_error_ != NULL) {
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static void _edsf_persona_store_set_phones_data_free (gpointer _data) {
	EdsfPersonaStoreSetPhonesData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->persona);
	_g_object_unref0 (_data_->phones);
	_g_object_unref0 (_data_->self);
	g_slice_free (EdsfPersonaStoreSetPhonesData, _data_);
}


void _edsf_persona_store_set_phones (EdsfPersonaStore* self, EdsfPersona* persona, GeeSet* phones, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	EdsfPersonaStoreSetPhonesData* _data_;
	EdsfPersonaStore* _tmp0_;
	EdsfPersona* _tmp1_;
	EdsfPersona* _tmp2_;
	GeeSet* _tmp3_;
	GeeSet* _tmp4_;
	_data_ = g_slice_new0 (EdsfPersonaStoreSetPhonesData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, _edsf_persona_store_set_phones);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, _edsf_persona_store_set_phones_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	_tmp1_ = persona;
	_tmp2_ = _g_object_ref0 (_tmp1_);
	_g_object_unref0 (_data_->persona);
	_data_->persona = _tmp2_;
	_tmp3_ = phones;
	_tmp4_ = _g_object_ref0 (_tmp3_);
	_g_object_unref0 (_data_->phones);
	_data_->phones = _tmp4_;
	_edsf_persona_store_set_phones_co (_data_);
}


void _edsf_persona_store_set_phones_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error) {
	EdsfPersonaStoreSetPhonesData* _data_;
	if (g_simple_async_result_propagate_error (G_SIMPLE_ASYNC_RESULT (_res_), error)) {
		return;
	}
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


static void _edsf_persona_store_set_phones_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	EdsfPersonaStoreSetPhonesData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	_edsf_persona_store_set_phones_co (_data_);
}


static gboolean _edsf_persona_store_set_phones_co (EdsfPersonaStoreSetPhonesData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_tmp0_ = _data_->self->priv->_always_writeable_properties;
	_data_->_tmp0__length1 = _data_->self->priv->_always_writeable_properties_length1;
	if (!_vala_string_array_contains (_data_->_tmp0_, _data_->_tmp0__length1, "phone-numbers")) {
		_data_->_tmp1_ = NULL;
		_data_->_tmp1_ = _ ("Phone numbers are not writeable on this contact.");
		_data_->_tmp2_ = g_error_new_literal (FOLKS_PROPERTY_ERROR, FOLKS_PROPERTY_ERROR_NOT_WRITEABLE, _data_->_tmp1_);
		_data_->_inner_error_ = _data_->_tmp2_;
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	_data_->_tmp3_ = _data_->phones;
	_data_->_tmp4_ = _data_->persona;
	_data_->_tmp5_ = folks_phone_details_get_phone_numbers ((FolksPhoneDetails*) _data_->_tmp4_);
	_data_->_tmp6_ = _data_->_tmp5_;
	_data_->_tmp7_ = FALSE;
	_data_->_tmp7_ = folks_internal_equal_sets (FOLKS_TYPE_PHONE_FIELD_DETAILS, (GBoxedCopyFunc) g_object_ref, g_object_unref, _data_->_tmp3_, _data_->_tmp6_);
	if (_data_->_tmp7_) {
		if (_data_->_state_ == 0) {
			g_simple_async_result_complete_in_idle (_data_->_async_result);
		} else {
			g_simple_async_result_complete (_data_->_async_result);
		}
		g_object_unref (_data_->_async_result);
		return FALSE;
	}
	_data_->_tmp8_ = _data_->persona;
	_data_->_tmp9_ = edsf_persona_get_contact (_data_->_tmp8_);
	_data_->_tmp10_ = _data_->_tmp9_;
	_data_->_tmp11_ = _data_->phones;
	_edsf_persona_store_set_contact_attributes_string (_data_->self, _data_->_tmp10_, _data_->_tmp11_, "TEL", E_CONTACT_TEL);
	_data_->_tmp12_ = _data_->persona;
	_data_->_state_ = 1;
	_edsf_persona_store_commit_modified_property (_data_->self, _data_->_tmp12_, "phone-numbers", _edsf_persona_store_set_phones_ready, _data_);
	return FALSE;
	_state_1:
	_edsf_persona_store_commit_modified_property_finish (_data_->self, _data_->_res_, &_data_->_inner_error_);
	if (_data_->_inner_error_ != NULL) {
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static void _edsf_persona_store_set_postal_addresses_data_free (gpointer _data) {
	EdsfPersonaStoreSetPostalAddressesData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->persona);
	_g_object_unref0 (_data_->postal_fds);
	_g_object_unref0 (_data_->self);
	g_slice_free (EdsfPersonaStoreSetPostalAddressesData, _data_);
}


void _edsf_persona_store_set_postal_addresses (EdsfPersonaStore* self, EdsfPersona* persona, GeeSet* postal_fds, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	EdsfPersonaStoreSetPostalAddressesData* _data_;
	EdsfPersonaStore* _tmp0_;
	EdsfPersona* _tmp1_;
	EdsfPersona* _tmp2_;
	GeeSet* _tmp3_;
	GeeSet* _tmp4_;
	_data_ = g_slice_new0 (EdsfPersonaStoreSetPostalAddressesData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, _edsf_persona_store_set_postal_addresses);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, _edsf_persona_store_set_postal_addresses_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	_tmp1_ = persona;
	_tmp2_ = _g_object_ref0 (_tmp1_);
	_g_object_unref0 (_data_->persona);
	_data_->persona = _tmp2_;
	_tmp3_ = postal_fds;
	_tmp4_ = _g_object_ref0 (_tmp3_);
	_g_object_unref0 (_data_->postal_fds);
	_data_->postal_fds = _tmp4_;
	_edsf_persona_store_set_postal_addresses_co (_data_);
}


void _edsf_persona_store_set_postal_addresses_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error) {
	EdsfPersonaStoreSetPostalAddressesData* _data_;
	if (g_simple_async_result_propagate_error (G_SIMPLE_ASYNC_RESULT (_res_), error)) {
		return;
	}
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


static void _edsf_persona_store_set_postal_addresses_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	EdsfPersonaStoreSetPostalAddressesData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	_edsf_persona_store_set_postal_addresses_co (_data_);
}


static gboolean _edsf_persona_store_set_postal_addresses_co (EdsfPersonaStoreSetPostalAddressesData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_tmp0_ = _data_->self->priv->_always_writeable_properties;
	_data_->_tmp0__length1 = _data_->self->priv->_always_writeable_properties_length1;
	if (!_vala_string_array_contains (_data_->_tmp0_, _data_->_tmp0__length1, "postal-addresses")) {
		_data_->_tmp1_ = NULL;
		_data_->_tmp1_ = _ ("Postal addresses are not writeable on this contact.");
		_data_->_tmp2_ = g_error_new_literal (FOLKS_PROPERTY_ERROR, FOLKS_PROPERTY_ERROR_NOT_WRITEABLE, _data_->_tmp1_);
		_data_->_inner_error_ = _data_->_tmp2_;
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	_data_->_tmp3_ = _data_->postal_fds;
	_data_->_tmp4_ = _data_->persona;
	_data_->_tmp5_ = folks_postal_address_details_get_postal_addresses ((FolksPostalAddressDetails*) _data_->_tmp4_);
	_data_->_tmp6_ = _data_->_tmp5_;
	_data_->_tmp7_ = FALSE;
	_data_->_tmp7_ = folks_internal_equal_sets (FOLKS_TYPE_POSTAL_ADDRESS_FIELD_DETAILS, (GBoxedCopyFunc) g_object_ref, g_object_unref, _data_->_tmp3_, _data_->_tmp6_);
	if (_data_->_tmp7_) {
		if (_data_->_state_ == 0) {
			g_simple_async_result_complete_in_idle (_data_->_async_result);
		} else {
			g_simple_async_result_complete (_data_->_async_result);
		}
		g_object_unref (_data_->_async_result);
		return FALSE;
	}
	_data_->_tmp8_ = _data_->persona;
	_data_->_tmp9_ = edsf_persona_get_contact (_data_->_tmp8_);
	_data_->_tmp10_ = _data_->_tmp9_;
	_data_->_tmp11_ = _data_->postal_fds;
	_edsf_persona_store_set_contact_postal_addresses (_data_->self, _data_->_tmp10_, _data_->_tmp11_);
	_data_->_tmp12_ = _data_->persona;
	_data_->_state_ = 1;
	_edsf_persona_store_commit_modified_property (_data_->self, _data_->_tmp12_, "postal-addresses", _edsf_persona_store_set_postal_addresses_ready, _data_);
	return FALSE;
	_state_1:
	_edsf_persona_store_commit_modified_property_finish (_data_->self, _data_->_res_, &_data_->_inner_error_);
	if (_data_->_inner_error_ != NULL) {
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static void __lambda3_ (EdsfPersonaStore* self, EVCardAttribute* attr, FolksPostalAddress* address) {
	EVCardAttribute* _tmp0_;
	FolksPostalAddress* _tmp1_;
	const gchar* _tmp2_;
	const gchar* _tmp3_;
	EVCardAttribute* _tmp4_;
	FolksPostalAddress* _tmp5_;
	const gchar* _tmp6_;
	const gchar* _tmp7_;
	EVCardAttribute* _tmp8_;
	FolksPostalAddress* _tmp9_;
	const gchar* _tmp10_;
	const gchar* _tmp11_;
	EVCardAttribute* _tmp12_;
	FolksPostalAddress* _tmp13_;
	const gchar* _tmp14_;
	const gchar* _tmp15_;
	EVCardAttribute* _tmp16_;
	FolksPostalAddress* _tmp17_;
	const gchar* _tmp18_;
	const gchar* _tmp19_;
	EVCardAttribute* _tmp20_;
	FolksPostalAddress* _tmp21_;
	const gchar* _tmp22_;
	const gchar* _tmp23_;
	EVCardAttribute* _tmp24_;
	FolksPostalAddress* _tmp25_;
	const gchar* _tmp26_;
	const gchar* _tmp27_;
	g_return_if_fail (attr != NULL);
	g_return_if_fail (address != NULL);
	_tmp0_ = attr;
	_tmp1_ = address;
	_tmp2_ = folks_postal_address_get_po_box (_tmp1_);
	_tmp3_ = _tmp2_;
	e_vcard_attribute_add_value (_tmp0_, _tmp3_);
	_tmp4_ = attr;
	_tmp5_ = address;
	_tmp6_ = folks_postal_address_get_extension (_tmp5_);
	_tmp7_ = _tmp6_;
	e_vcard_attribute_add_value (_tmp4_, _tmp7_);
	_tmp8_ = attr;
	_tmp9_ = address;
	_tmp10_ = folks_postal_address_get_street (_tmp9_);
	_tmp11_ = _tmp10_;
	e_vcard_attribute_add_value (_tmp8_, _tmp11_);
	_tmp12_ = attr;
	_tmp13_ = address;
	_tmp14_ = folks_postal_address_get_locality (_tmp13_);
	_tmp15_ = _tmp14_;
	e_vcard_attribute_add_value (_tmp12_, _tmp15_);
	_tmp16_ = attr;
	_tmp17_ = address;
	_tmp18_ = folks_postal_address_get_region (_tmp17_);
	_tmp19_ = _tmp18_;
	e_vcard_attribute_add_value (_tmp16_, _tmp19_);
	_tmp20_ = attr;
	_tmp21_ = address;
	_tmp22_ = folks_postal_address_get_postal_code (_tmp21_);
	_tmp23_ = _tmp22_;
	e_vcard_attribute_add_value (_tmp20_, _tmp23_);
	_tmp24_ = attr;
	_tmp25_ = address;
	_tmp26_ = folks_postal_address_get_country (_tmp25_);
	_tmp27_ = _tmp26_;
	e_vcard_attribute_add_value (_tmp24_, _tmp27_);
}


static void ___lambda3__edsf_persona_store_field_to_attribute (EVCardAttribute* attr, gconstpointer value, gpointer self) {
	__lambda3_ (self, attr, value);
}


static void _edsf_persona_store_set_contact_postal_addresses (EdsfPersonaStore* self, EContact* contact, GeeSet* postal_fds) {
	EContact* _tmp0_;
	GeeSet* _tmp1_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (contact != NULL);
	g_return_if_fail (postal_fds != NULL);
	_tmp0_ = contact;
	_tmp1_ = postal_fds;
	_edsf_persona_store_set_contact_attributes (self, FOLKS_TYPE_POSTAL_ADDRESS, (GBoxedCopyFunc) g_object_ref, g_object_unref, _tmp0_, _tmp1_, ___lambda3__edsf_persona_store_field_to_attribute, self, "ADR", E_CONTACT_ADDRESS);
}


static void __vala_EVCardAttribute_free0_ (gpointer var) {
	(var == NULL) ? NULL : (var = (_vala_EVCardAttribute_free (var), NULL));
}


static void _g_list_free___vala_EVCardAttribute_free0_ (GList* self) {
	g_list_foreach (self, (GFunc) __vala_EVCardAttribute_free0_, NULL);
	g_list_free (self);
}


static void _edsf_persona_store_set_contact_attributes (EdsfPersonaStore* self, GType t_type, GBoxedCopyFunc t_dup_func, GDestroyNotify t_destroy_func, EContact* contact, GeeSet* new_attributes, EdsfPersonaStoreFieldToAttribute fill_attribute, void* fill_attribute_target, const gchar* attrib_name, EContactField field_id) {
	GList* attributes = NULL;
	EContact* _tmp47_;
	EContactField _tmp48_;
	GList* _tmp49_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (contact != NULL);
	g_return_if_fail (new_attributes != NULL);
	g_return_if_fail (attrib_name != NULL);
	attributes = NULL;
	{
		GeeIterator* _e_it = NULL;
		GeeSet* _tmp0_;
		GeeIterator* _tmp1_ = NULL;
		_tmp0_ = new_attributes;
		_tmp1_ = gee_iterable_iterator ((GeeIterable*) _tmp0_);
		_e_it = _tmp1_;
		while (TRUE) {
			GeeIterator* _tmp2_;
			gboolean _tmp3_ = FALSE;
			FolksAbstractFieldDetails* e = NULL;
			GeeIterator* _tmp4_;
			gpointer _tmp5_ = NULL;
			EVCardAttribute* attr = NULL;
			const gchar* _tmp6_;
			EVCardAttribute* _tmp7_;
			EdsfPersonaStoreFieldToAttribute _tmp8_;
			void* _tmp8__target;
			EVCardAttribute* _tmp9_;
			FolksAbstractFieldDetails* _tmp10_;
			gconstpointer _tmp11_;
			gconstpointer _tmp12_;
			EVCardAttribute* _tmp46_;
			_tmp2_ = _e_it;
			_tmp3_ = gee_iterator_next (_tmp2_);
			if (!_tmp3_) {
				break;
			}
			_tmp4_ = _e_it;
			_tmp5_ = gee_iterator_get (_tmp4_);
			e = (FolksAbstractFieldDetails*) _tmp5_;
			_tmp6_ = attrib_name;
			_tmp7_ = e_vcard_attribute_new (NULL, _tmp6_);
			attr = _tmp7_;
			_tmp8_ = fill_attribute;
			_tmp8__target = fill_attribute_target;
			_tmp9_ = attr;
			_tmp10_ = e;
			_tmp11_ = folks_abstract_field_details_get_value (_tmp10_);
			_tmp12_ = _tmp11_;
			_tmp8_ (_tmp9_, _tmp12_, _tmp8__target);
			{
				GeeIterator* _param_name_it = NULL;
				FolksAbstractFieldDetails* _tmp13_;
				GeeMultiMap* _tmp14_;
				GeeMultiMap* _tmp15_;
				GeeSet* _tmp16_ = NULL;
				GeeSet* _tmp17_;
				GeeIterator* _tmp18_ = NULL;
				GeeIterator* _tmp19_;
				_tmp13_ = e;
				_tmp14_ = folks_abstract_field_details_get_parameters (_tmp13_);
				_tmp15_ = _tmp14_;
				_tmp16_ = gee_multi_map_get_keys (_tmp15_);
				_tmp17_ = _tmp16_;
				_tmp18_ = gee_iterable_iterator ((GeeIterable*) _tmp17_);
				_tmp19_ = _tmp18_;
				_g_object_unref0 (_tmp17_);
				_param_name_it = _tmp19_;
				while (TRUE) {
					GeeIterator* _tmp20_;
					gboolean _tmp21_ = FALSE;
					gchar* param_name = NULL;
					GeeIterator* _tmp22_;
					gpointer _tmp23_ = NULL;
					EVCardAttributeParam* param = NULL;
					const gchar* _tmp24_;
					gchar* _tmp25_ = NULL;
					gchar* _tmp26_;
					EVCardAttributeParam* _tmp27_;
					EVCardAttributeParam* _tmp28_;
					EVCardAttribute* _tmp43_;
					EVCardAttributeParam* _tmp44_;
					EVCardAttributeParam* _tmp45_;
					_tmp20_ = _param_name_it;
					_tmp21_ = gee_iterator_next (_tmp20_);
					if (!_tmp21_) {
						break;
					}
					_tmp22_ = _param_name_it;
					_tmp23_ = gee_iterator_get (_tmp22_);
					param_name = (gchar*) _tmp23_;
					_tmp24_ = param_name;
					_tmp25_ = g_utf8_strup (_tmp24_, (gssize) (-1));
					_tmp26_ = _tmp25_;
					_tmp27_ = e_vcard_attribute_param_new (_tmp26_);
					_tmp28_ = _tmp27_;
					_g_free0 (_tmp26_);
					param = _tmp28_;
					{
						GeeIterator* _param_val_it = NULL;
						FolksAbstractFieldDetails* _tmp29_;
						GeeMultiMap* _tmp30_;
						GeeMultiMap* _tmp31_;
						const gchar* _tmp32_;
						GeeCollection* _tmp33_ = NULL;
						GeeCollection* _tmp34_;
						GeeIterator* _tmp35_ = NULL;
						GeeIterator* _tmp36_;
						_tmp29_ = e;
						_tmp30_ = folks_abstract_field_details_get_parameters (_tmp29_);
						_tmp31_ = _tmp30_;
						_tmp32_ = param_name;
						_tmp33_ = gee_multi_map_get (_tmp31_, _tmp32_);
						_tmp34_ = _tmp33_;
						_tmp35_ = gee_iterable_iterator ((GeeIterable*) _tmp34_);
						_tmp36_ = _tmp35_;
						_g_object_unref0 (_tmp34_);
						_param_val_it = _tmp36_;
						while (TRUE) {
							GeeIterator* _tmp37_;
							gboolean _tmp38_ = FALSE;
							gchar* param_val = NULL;
							GeeIterator* _tmp39_;
							gpointer _tmp40_ = NULL;
							EVCardAttributeParam* _tmp41_;
							const gchar* _tmp42_;
							_tmp37_ = _param_val_it;
							_tmp38_ = gee_iterator_next (_tmp37_);
							if (!_tmp38_) {
								break;
							}
							_tmp39_ = _param_val_it;
							_tmp40_ = gee_iterator_get (_tmp39_);
							param_val = (gchar*) _tmp40_;
							_tmp41_ = param;
							_tmp42_ = param_val;
							e_vcard_attribute_param_add_value (_tmp41_, _tmp42_);
							_g_free0 (param_val);
						}
						_g_object_unref0 (_param_val_it);
					}
					_tmp43_ = attr;
					_tmp44_ = param;
					_tmp45_ = __vala_EVCardAttributeParam_copy0 (_tmp44_);
					e_vcard_attribute_add_param (_tmp43_, _tmp45_);
					__vala_EVCardAttributeParam_free0 (param);
					_g_free0 (param_name);
				}
				_g_object_unref0 (_param_name_it);
			}
			_tmp46_ = attr;
			attr = NULL;
			attributes = g_list_prepend (attributes, _tmp46_);
			__vala_EVCardAttribute_free0 (attr);
			_g_object_unref0 (e);
		}
		_g_object_unref0 (_e_it);
	}
	_tmp47_ = contact;
	_tmp48_ = field_id;
	_tmp49_ = attributes;
	e_contact_set_attributes (_tmp47_, _tmp48_, _tmp49_);
	__g_list_free___vala_EVCardAttribute_free0_0 (attributes);
}


static void __lambda2_ (EdsfPersonaStore* self, EVCardAttribute* attr, const gchar* value) {
	EVCardAttribute* _tmp0_;
	const gchar* _tmp1_;
	g_return_if_fail (attr != NULL);
	g_return_if_fail (value != NULL);
	_tmp0_ = attr;
	_tmp1_ = value;
	e_vcard_attribute_add_value (_tmp0_, _tmp1_);
}


static void ___lambda2__edsf_persona_store_field_to_attribute (EVCardAttribute* attr, gconstpointer value, gpointer self) {
	__lambda2_ (self, attr, value);
}


static void _edsf_persona_store_set_contact_attributes_string (EdsfPersonaStore* self, EContact* contact, GeeSet* new_attributes, const gchar* attrib_name, EContactField field_id) {
	EContact* _tmp0_;
	GeeSet* _tmp1_;
	const gchar* _tmp2_;
	EContactField _tmp3_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (contact != NULL);
	g_return_if_fail (new_attributes != NULL);
	g_return_if_fail (attrib_name != NULL);
	_tmp0_ = contact;
	_tmp1_ = new_attributes;
	_tmp2_ = attrib_name;
	_tmp3_ = field_id;
	_edsf_persona_store_set_contact_attributes (self, G_TYPE_STRING, (GBoxedCopyFunc) g_strdup, g_free, _tmp0_, _tmp1_, ___lambda2__edsf_persona_store_field_to_attribute, self, _tmp2_, _tmp3_);
}


static void _edsf_persona_store_set_full_name_data_free (gpointer _data) {
	EdsfPersonaStoreSetFullNameData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->persona);
	_g_free0 (_data_->full_name);
	_g_object_unref0 (_data_->self);
	g_slice_free (EdsfPersonaStoreSetFullNameData, _data_);
}


void _edsf_persona_store_set_full_name (EdsfPersonaStore* self, EdsfPersona* persona, const gchar* full_name, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	EdsfPersonaStoreSetFullNameData* _data_;
	EdsfPersonaStore* _tmp0_;
	EdsfPersona* _tmp1_;
	EdsfPersona* _tmp2_;
	const gchar* _tmp3_;
	gchar* _tmp4_;
	_data_ = g_slice_new0 (EdsfPersonaStoreSetFullNameData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, _edsf_persona_store_set_full_name);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, _edsf_persona_store_set_full_name_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	_tmp1_ = persona;
	_tmp2_ = _g_object_ref0 (_tmp1_);
	_g_object_unref0 (_data_->persona);
	_data_->persona = _tmp2_;
	_tmp3_ = full_name;
	_tmp4_ = g_strdup (_tmp3_);
	_g_free0 (_data_->full_name);
	_data_->full_name = _tmp4_;
	_edsf_persona_store_set_full_name_co (_data_);
}


void _edsf_persona_store_set_full_name_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error) {
	EdsfPersonaStoreSetFullNameData* _data_;
	if (g_simple_async_result_propagate_error (G_SIMPLE_ASYNC_RESULT (_res_), error)) {
		return;
	}
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


static void _edsf_persona_store_set_full_name_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	EdsfPersonaStoreSetFullNameData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	_edsf_persona_store_set_full_name_co (_data_);
}


static gboolean _edsf_persona_store_set_full_name_co (EdsfPersonaStoreSetFullNameData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_tmp0_ = _data_->self->priv->_always_writeable_properties;
	_data_->_tmp0__length1 = _data_->self->priv->_always_writeable_properties_length1;
	if (!_vala_string_array_contains (_data_->_tmp0_, _data_->_tmp0__length1, "full-name")) {
		_data_->_tmp1_ = NULL;
		_data_->_tmp1_ = _ ("Full name is not writeable on this contact.");
		_data_->_tmp2_ = g_error_new_literal (FOLKS_PROPERTY_ERROR, FOLKS_PROPERTY_ERROR_NOT_WRITEABLE, _data_->_tmp1_);
		_data_->_inner_error_ = _data_->_tmp2_;
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	_data_->_tmp3_ = _data_->full_name;
	_data_->_tmp4_ = g_strdup (_data_->_tmp3_);
	_data_->_full_name = _data_->_tmp4_;
	_data_->_tmp5_ = _data_->full_name;
	if (g_strcmp0 (_data_->_tmp5_, "") == 0) {
		_g_free0 (_data_->_full_name);
		_data_->_full_name = NULL;
	}
	_data_->_tmp6_ = _data_->persona;
	_data_->_tmp7_ = folks_name_details_get_full_name ((FolksNameDetails*) _data_->_tmp6_);
	_data_->_tmp8_ = _data_->_tmp7_;
	_data_->_tmp9_ = _data_->_full_name;
	if (g_strcmp0 (_data_->_tmp8_, _data_->_tmp9_) == 0) {
		_g_free0 (_data_->_full_name);
		if (_data_->_state_ == 0) {
			g_simple_async_result_complete_in_idle (_data_->_async_result);
		} else {
			g_simple_async_result_complete (_data_->_async_result);
		}
		g_object_unref (_data_->_async_result);
		return FALSE;
	}
	_data_->_tmp10_ = _data_->persona;
	_data_->_tmp11_ = edsf_persona_get_contact (_data_->_tmp10_);
	_data_->_tmp12_ = _data_->_tmp11_;
	_data_->_tmp13_ = 0;
	_data_->_tmp13_ = e_contact_field_id ("full_name");
	_data_->_tmp14_ = _data_->_full_name;
	e_contact_set (_data_->_tmp12_, _data_->_tmp13_, _data_->_tmp14_);
	_data_->_tmp15_ = _data_->persona;
	_data_->_state_ = 1;
	_edsf_persona_store_commit_modified_property (_data_->self, _data_->_tmp15_, "full-name", _edsf_persona_store_set_full_name_ready, _data_);
	return FALSE;
	_state_1:
	_edsf_persona_store_commit_modified_property_finish (_data_->self, _data_->_res_, &_data_->_inner_error_);
	if (_data_->_inner_error_ != NULL) {
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			_g_free0 (_data_->_full_name);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			_g_free0 (_data_->_full_name);
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	_g_free0 (_data_->_full_name);
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static void _edsf_persona_store_set_nickname_data_free (gpointer _data) {
	EdsfPersonaStoreSetNicknameData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->persona);
	_g_free0 (_data_->nickname);
	_g_object_unref0 (_data_->self);
	g_slice_free (EdsfPersonaStoreSetNicknameData, _data_);
}


void _edsf_persona_store_set_nickname (EdsfPersonaStore* self, EdsfPersona* persona, const gchar* nickname, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	EdsfPersonaStoreSetNicknameData* _data_;
	EdsfPersonaStore* _tmp0_;
	EdsfPersona* _tmp1_;
	EdsfPersona* _tmp2_;
	const gchar* _tmp3_;
	gchar* _tmp4_;
	_data_ = g_slice_new0 (EdsfPersonaStoreSetNicknameData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, _edsf_persona_store_set_nickname);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, _edsf_persona_store_set_nickname_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	_tmp1_ = persona;
	_tmp2_ = _g_object_ref0 (_tmp1_);
	_g_object_unref0 (_data_->persona);
	_data_->persona = _tmp2_;
	_tmp3_ = nickname;
	_tmp4_ = g_strdup (_tmp3_);
	_g_free0 (_data_->nickname);
	_data_->nickname = _tmp4_;
	_edsf_persona_store_set_nickname_co (_data_);
}


void _edsf_persona_store_set_nickname_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error) {
	EdsfPersonaStoreSetNicknameData* _data_;
	if (g_simple_async_result_propagate_error (G_SIMPLE_ASYNC_RESULT (_res_), error)) {
		return;
	}
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


static void _edsf_persona_store_set_nickname_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	EdsfPersonaStoreSetNicknameData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	_edsf_persona_store_set_nickname_co (_data_);
}


static gboolean _edsf_persona_store_set_nickname_co (EdsfPersonaStoreSetNicknameData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_tmp0_ = _data_->self->priv->_always_writeable_properties;
	_data_->_tmp0__length1 = _data_->self->priv->_always_writeable_properties_length1;
	if (!_vala_string_array_contains (_data_->_tmp0_, _data_->_tmp0__length1, "nickname")) {
		_data_->_tmp1_ = NULL;
		_data_->_tmp1_ = _ ("Nickname is not writeable on this contact.");
		_data_->_tmp2_ = g_error_new_literal (FOLKS_PROPERTY_ERROR, FOLKS_PROPERTY_ERROR_NOT_WRITEABLE, _data_->_tmp1_);
		_data_->_inner_error_ = _data_->_tmp2_;
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	_data_->_tmp3_ = _data_->nickname;
	_data_->_tmp4_ = g_strdup (_data_->_tmp3_);
	_data_->_nickname = _data_->_tmp4_;
	_data_->_tmp5_ = _data_->nickname;
	if (g_strcmp0 (_data_->_tmp5_, "") == 0) {
		_g_free0 (_data_->_nickname);
		_data_->_nickname = NULL;
	}
	_data_->_tmp6_ = _data_->persona;
	_data_->_tmp7_ = folks_name_details_get_nickname ((FolksNameDetails*) _data_->_tmp6_);
	_data_->_tmp8_ = _data_->_tmp7_;
	_data_->_tmp9_ = _data_->_nickname;
	if (g_strcmp0 (_data_->_tmp8_, _data_->_tmp9_) == 0) {
		_g_free0 (_data_->_nickname);
		if (_data_->_state_ == 0) {
			g_simple_async_result_complete_in_idle (_data_->_async_result);
		} else {
			g_simple_async_result_complete (_data_->_async_result);
		}
		g_object_unref (_data_->_async_result);
		return FALSE;
	}
	_data_->_tmp10_ = _data_->persona;
	_data_->_tmp11_ = edsf_persona_get_contact (_data_->_tmp10_);
	_data_->_tmp12_ = _data_->_tmp11_;
	_data_->_tmp13_ = 0;
	_data_->_tmp13_ = e_contact_field_id ("nickname");
	_data_->_tmp14_ = _data_->_nickname;
	e_contact_set (_data_->_tmp12_, _data_->_tmp13_, _data_->_tmp14_);
	_data_->_tmp15_ = _data_->persona;
	_data_->_state_ = 1;
	_edsf_persona_store_commit_modified_property (_data_->self, _data_->_tmp15_, "nickname", _edsf_persona_store_set_nickname_ready, _data_);
	return FALSE;
	_state_1:
	_edsf_persona_store_commit_modified_property_finish (_data_->self, _data_->_res_, &_data_->_inner_error_);
	if (_data_->_inner_error_ != NULL) {
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			_g_free0 (_data_->_nickname);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			_g_free0 (_data_->_nickname);
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	_g_free0 (_data_->_nickname);
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static void _edsf_persona_store_set_notes_data_free (gpointer _data) {
	EdsfPersonaStoreSetNotesData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->persona);
	_g_object_unref0 (_data_->notes);
	_g_object_unref0 (_data_->self);
	g_slice_free (EdsfPersonaStoreSetNotesData, _data_);
}


void _edsf_persona_store_set_notes (EdsfPersonaStore* self, EdsfPersona* persona, GeeSet* notes, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	EdsfPersonaStoreSetNotesData* _data_;
	EdsfPersonaStore* _tmp0_;
	EdsfPersona* _tmp1_;
	EdsfPersona* _tmp2_;
	GeeSet* _tmp3_;
	GeeSet* _tmp4_;
	_data_ = g_slice_new0 (EdsfPersonaStoreSetNotesData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, _edsf_persona_store_set_notes);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, _edsf_persona_store_set_notes_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	_tmp1_ = persona;
	_tmp2_ = _g_object_ref0 (_tmp1_);
	_g_object_unref0 (_data_->persona);
	_data_->persona = _tmp2_;
	_tmp3_ = notes;
	_tmp4_ = _g_object_ref0 (_tmp3_);
	_g_object_unref0 (_data_->notes);
	_data_->notes = _tmp4_;
	_edsf_persona_store_set_notes_co (_data_);
}


void _edsf_persona_store_set_notes_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error) {
	EdsfPersonaStoreSetNotesData* _data_;
	if (g_simple_async_result_propagate_error (G_SIMPLE_ASYNC_RESULT (_res_), error)) {
		return;
	}
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


static void _edsf_persona_store_set_notes_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	EdsfPersonaStoreSetNotesData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	_edsf_persona_store_set_notes_co (_data_);
}


static gboolean _edsf_persona_store_set_notes_co (EdsfPersonaStoreSetNotesData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_tmp0_ = _data_->self->priv->_always_writeable_properties;
	_data_->_tmp0__length1 = _data_->self->priv->_always_writeable_properties_length1;
	if (!_vala_string_array_contains (_data_->_tmp0_, _data_->_tmp0__length1, "notes")) {
		_data_->_tmp1_ = NULL;
		_data_->_tmp1_ = _ ("Notes are not writeable on this contact.");
		_data_->_tmp2_ = g_error_new_literal (FOLKS_PROPERTY_ERROR, FOLKS_PROPERTY_ERROR_NOT_WRITEABLE, _data_->_tmp1_);
		_data_->_inner_error_ = _data_->_tmp2_;
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	_data_->_tmp3_ = _data_->notes;
	_data_->_tmp4_ = _data_->persona;
	_data_->_tmp5_ = folks_note_details_get_notes ((FolksNoteDetails*) _data_->_tmp4_);
	_data_->_tmp6_ = _data_->_tmp5_;
	_data_->_tmp7_ = FALSE;
	_data_->_tmp7_ = folks_internal_equal_sets (FOLKS_TYPE_NOTE_FIELD_DETAILS, (GBoxedCopyFunc) g_object_ref, g_object_unref, _data_->_tmp3_, _data_->_tmp6_);
	if (_data_->_tmp7_) {
		if (_data_->_state_ == 0) {
			g_simple_async_result_complete_in_idle (_data_->_async_result);
		} else {
			g_simple_async_result_complete (_data_->_async_result);
		}
		g_object_unref (_data_->_async_result);
		return FALSE;
	}
	_data_->_tmp8_ = _data_->persona;
	_data_->_tmp9_ = edsf_persona_get_contact (_data_->_tmp8_);
	_data_->_tmp10_ = _data_->_tmp9_;
	_data_->_tmp11_ = _data_->notes;
	_edsf_persona_store_set_contact_notes (_data_->self, _data_->_tmp10_, _data_->_tmp11_);
	_data_->_tmp12_ = _data_->persona;
	_data_->_state_ = 1;
	_edsf_persona_store_commit_modified_property (_data_->self, _data_->_tmp12_, "notes", _edsf_persona_store_set_notes_ready, _data_);
	return FALSE;
	_state_1:
	_edsf_persona_store_commit_modified_property_finish (_data_->self, _data_->_res_, &_data_->_inner_error_);
	if (_data_->_inner_error_ != NULL) {
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static void _edsf_persona_store_set_contact_notes (EdsfPersonaStore* self, EContact* contact, GeeSet* notes) {
	gchar* note_str = NULL;
	gchar* _tmp0_;
	EContact* _tmp15_;
	EContactField _tmp16_ = 0;
	const gchar* _tmp17_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (contact != NULL);
	g_return_if_fail (notes != NULL);
	_tmp0_ = g_strdup ("");
	note_str = _tmp0_;
	{
		GeeIterator* _note_it = NULL;
		GeeSet* _tmp1_;
		GeeIterator* _tmp2_ = NULL;
		_tmp1_ = notes;
		_tmp2_ = gee_iterable_iterator ((GeeIterable*) _tmp1_);
		_note_it = _tmp2_;
		while (TRUE) {
			GeeIterator* _tmp3_;
			gboolean _tmp4_ = FALSE;
			FolksNoteFieldDetails* note = NULL;
			GeeIterator* _tmp5_;
			gpointer _tmp6_ = NULL;
			const gchar* _tmp7_;
			const gchar* _tmp10_;
			FolksNoteFieldDetails* _tmp11_;
			gconstpointer _tmp12_;
			const gchar* _tmp13_;
			gchar* _tmp14_;
			_tmp3_ = _note_it;
			_tmp4_ = gee_iterator_next (_tmp3_);
			if (!_tmp4_) {
				break;
			}
			_tmp5_ = _note_it;
			_tmp6_ = gee_iterator_get (_tmp5_);
			note = (FolksNoteFieldDetails*) _tmp6_;
			_tmp7_ = note_str;
			if (g_strcmp0 (_tmp7_, "") != 0) {
				const gchar* _tmp8_;
				gchar* _tmp9_;
				_tmp8_ = note_str;
				_tmp9_ = g_strconcat (_tmp8_, ". ", NULL);
				_g_free0 (note_str);
				note_str = _tmp9_;
			}
			_tmp10_ = note_str;
			_tmp11_ = note;
			_tmp12_ = folks_abstract_field_details_get_value ((FolksAbstractFieldDetails*) _tmp11_);
			_tmp13_ = _tmp12_;
			_tmp14_ = g_strconcat (_tmp10_, (const gchar*) _tmp13_, NULL);
			_g_free0 (note_str);
			note_str = _tmp14_;
			_g_object_unref0 (note);
		}
		_g_object_unref0 (_note_it);
	}
	_tmp15_ = contact;
	_tmp16_ = e_contact_field_id ("note");
	_tmp17_ = note_str;
	e_contact_set (_tmp15_, _tmp16_, _tmp17_);
	_g_free0 (note_str);
}


static void _edsf_persona_store_set_birthday_data_free (gpointer _data) {
	EdsfPersonaStoreSetBirthdayData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->persona);
	_g_date_time_unref0 (_data_->bday);
	_g_object_unref0 (_data_->self);
	g_slice_free (EdsfPersonaStoreSetBirthdayData, _data_);
}


void _edsf_persona_store_set_birthday (EdsfPersonaStore* self, EdsfPersona* persona, GDateTime* bday, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	EdsfPersonaStoreSetBirthdayData* _data_;
	EdsfPersonaStore* _tmp0_;
	EdsfPersona* _tmp1_;
	EdsfPersona* _tmp2_;
	GDateTime* _tmp3_;
	GDateTime* _tmp4_;
	_data_ = g_slice_new0 (EdsfPersonaStoreSetBirthdayData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, _edsf_persona_store_set_birthday);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, _edsf_persona_store_set_birthday_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	_tmp1_ = persona;
	_tmp2_ = _g_object_ref0 (_tmp1_);
	_g_object_unref0 (_data_->persona);
	_data_->persona = _tmp2_;
	_tmp3_ = bday;
	_tmp4_ = _g_date_time_ref0 (_tmp3_);
	_g_date_time_unref0 (_data_->bday);
	_data_->bday = _tmp4_;
	_edsf_persona_store_set_birthday_co (_data_);
}


void _edsf_persona_store_set_birthday_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error) {
	EdsfPersonaStoreSetBirthdayData* _data_;
	if (g_simple_async_result_propagate_error (G_SIMPLE_ASYNC_RESULT (_res_), error)) {
		return;
	}
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


static void _edsf_persona_store_set_birthday_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	EdsfPersonaStoreSetBirthdayData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	_edsf_persona_store_set_birthday_co (_data_);
}


static gboolean _edsf_persona_store_set_birthday_co (EdsfPersonaStoreSetBirthdayData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_tmp0_ = _data_->self->priv->_always_writeable_properties;
	_data_->_tmp0__length1 = _data_->self->priv->_always_writeable_properties_length1;
	if (!_vala_string_array_contains (_data_->_tmp0_, _data_->_tmp0__length1, "birthday")) {
		_data_->_tmp1_ = NULL;
		_data_->_tmp1_ = _ ("Birthday is not writeable on this contact.");
		_data_->_tmp2_ = g_error_new_literal (FOLKS_PROPERTY_ERROR, FOLKS_PROPERTY_ERROR_NOT_WRITEABLE, _data_->_tmp1_);
		_data_->_inner_error_ = _data_->_tmp2_;
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	_data_->_tmp5_ = _data_->persona;
	_data_->_tmp6_ = folks_birthday_details_get_birthday ((FolksBirthdayDetails*) _data_->_tmp5_);
	_data_->_tmp7_ = _data_->_tmp6_;
	if (_data_->_tmp7_ != NULL) {
		_data_->_tmp8_ = _data_->bday;
		_data_->_tmp4_ = _data_->_tmp8_ != NULL;
	} else {
		_data_->_tmp4_ = FALSE;
	}
	_data_->_tmp9_ = _data_->_tmp4_;
	if (_data_->_tmp9_) {
		_data_->_tmp10_ = _data_->persona;
		_data_->_tmp11_ = folks_birthday_details_get_birthday ((FolksBirthdayDetails*) _data_->_tmp10_);
		_data_->_tmp12_ = _data_->_tmp11_;
		_data_->_tmp13_ = _data_->bday;
		_data_->_tmp14_ = FALSE;
		_data_->_tmp14_ = g_date_time_equal ((GDateTime*) _data_->_tmp12_, (GDateTime*) _data_->_tmp13_);
		_data_->_tmp3_ = _data_->_tmp14_;
	} else {
		_data_->_tmp3_ = FALSE;
	}
	_data_->_tmp15_ = _data_->_tmp3_;
	if (_data_->_tmp15_) {
		if (_data_->_state_ == 0) {
			g_simple_async_result_complete_in_idle (_data_->_async_result);
		} else {
			g_simple_async_result_complete (_data_->_async_result);
		}
		g_object_unref (_data_->_async_result);
		return FALSE;
	}
	_data_->_tmp17_ = _data_->persona;
	_data_->_tmp18_ = folks_birthday_details_get_birthday ((FolksBirthdayDetails*) _data_->_tmp17_);
	_data_->_tmp19_ = _data_->_tmp18_;
	if (_data_->_tmp19_ == NULL) {
		_data_->_tmp20_ = _data_->bday;
		_data_->_tmp16_ = _data_->_tmp20_ == NULL;
	} else {
		_data_->_tmp16_ = FALSE;
	}
	_data_->_tmp21_ = _data_->_tmp16_;
	if (_data_->_tmp21_) {
		if (_data_->_state_ == 0) {
			g_simple_async_result_complete_in_idle (_data_->_async_result);
		} else {
			g_simple_async_result_complete (_data_->_async_result);
		}
		g_object_unref (_data_->_async_result);
		return FALSE;
	}
	_data_->_tmp22_ = _data_->persona;
	_data_->_tmp23_ = edsf_persona_get_contact (_data_->_tmp22_);
	_data_->_tmp24_ = _data_->_tmp23_;
	_data_->_tmp25_ = _data_->bday;
	_edsf_persona_store_set_contact_birthday (_data_->self, _data_->_tmp24_, _data_->_tmp25_);
	_data_->_tmp26_ = _data_->persona;
	_data_->_state_ = 1;
	_edsf_persona_store_commit_modified_property (_data_->self, _data_->_tmp26_, "birthday", _edsf_persona_store_set_birthday_ready, _data_);
	return FALSE;
	_state_1:
	_edsf_persona_store_commit_modified_property_finish (_data_->self, _data_->_res_, &_data_->_inner_error_);
	if (_data_->_inner_error_ != NULL) {
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static void _vala_EContactDate_free (EContactDate* self) {
	g_boxed_free (e_contact_date_get_type (), self);
}


static EContactDate* _vala_EContactDate_copy (EContactDate* self) {
	return g_boxed_copy (e_contact_date_get_type (), self);
}


static gpointer __vala_EContactDate_copy0 (gpointer self) {
	return self ? _vala_EContactDate_copy (self) : NULL;
}


static void _edsf_persona_store_set_contact_birthday (EdsfPersonaStore* self, EContact* contact, GDateTime* _bday) {
	EContactDate* _contact_bday = NULL;
	GDateTime* _tmp0_;
	EContact* _tmp17_;
	EContactField _tmp18_ = 0;
	EContactDate* _tmp19_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (contact != NULL);
	_contact_bday = NULL;
	_tmp0_ = _bday;
	if (_tmp0_ != NULL) {
		GDateTime* bday = NULL;
		GDateTime* _tmp1_;
		GDateTime* _tmp2_;
		GDateTime* bdaylocal = NULL;
		GDateTime* _tmp3_;
		GDateTime* _tmp4_ = NULL;
		EContactDate* contact_bday = NULL;
		EContactDate* _tmp5_;
		EContactDate* _tmp6_;
		GDateTime* _tmp7_;
		gint _tmp8_ = 0;
		EContactDate* _tmp9_;
		GDateTime* _tmp10_;
		gint _tmp11_ = 0;
		EContactDate* _tmp12_;
		GDateTime* _tmp13_;
		gint _tmp14_ = 0;
		EContactDate* _tmp15_;
		EContactDate* _tmp16_;
		_tmp1_ = _bday;
		_tmp2_ = _g_date_time_ref0 ((GDateTime*) _tmp1_);
		bday = _tmp2_;
		_tmp3_ = bday;
		_tmp4_ = g_date_time_to_local (_tmp3_);
		bdaylocal = _tmp4_;
		_tmp5_ = e_contact_date_new ();
		__vala_EContactDate_free0 (contact_bday);
		contact_bday = _tmp5_;
		_tmp6_ = contact_bday;
		_tmp7_ = bdaylocal;
		_tmp8_ = g_date_time_get_year (_tmp7_);
		_tmp6_->year = (guint) _tmp8_;
		_tmp9_ = contact_bday;
		_tmp10_ = bdaylocal;
		_tmp11_ = g_date_time_get_month (_tmp10_);
		_tmp9_->month = (guint) _tmp11_;
		_tmp12_ = contact_bday;
		_tmp13_ = bdaylocal;
		_tmp14_ = g_date_time_get_day_of_month (_tmp13_);
		_tmp12_->day = (guint) _tmp14_;
		_tmp15_ = contact_bday;
		_tmp16_ = __vala_EContactDate_copy0 (_tmp15_);
		__vala_EContactDate_free0 (_contact_bday);
		_contact_bday = _tmp16_;
		__vala_EContactDate_free0 (contact_bday);
		_g_date_time_unref0 (bdaylocal);
		_g_date_time_unref0 (bday);
	}
	_tmp17_ = contact;
	_tmp18_ = e_contact_field_id ("birth_date");
	_tmp19_ = _contact_bday;
	e_contact_set (_tmp17_, _tmp18_, _tmp19_);
	__vala_EContactDate_free0 (_contact_bday);
}


static void _edsf_persona_store_set_roles_data_free (gpointer _data) {
	EdsfPersonaStoreSetRolesData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->persona);
	_g_object_unref0 (_data_->roles);
	_g_object_unref0 (_data_->self);
	g_slice_free (EdsfPersonaStoreSetRolesData, _data_);
}


void _edsf_persona_store_set_roles (EdsfPersonaStore* self, EdsfPersona* persona, GeeSet* roles, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	EdsfPersonaStoreSetRolesData* _data_;
	EdsfPersonaStore* _tmp0_;
	EdsfPersona* _tmp1_;
	EdsfPersona* _tmp2_;
	GeeSet* _tmp3_;
	GeeSet* _tmp4_;
	_data_ = g_slice_new0 (EdsfPersonaStoreSetRolesData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, _edsf_persona_store_set_roles);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, _edsf_persona_store_set_roles_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	_tmp1_ = persona;
	_tmp2_ = _g_object_ref0 (_tmp1_);
	_g_object_unref0 (_data_->persona);
	_data_->persona = _tmp2_;
	_tmp3_ = roles;
	_tmp4_ = _g_object_ref0 (_tmp3_);
	_g_object_unref0 (_data_->roles);
	_data_->roles = _tmp4_;
	_edsf_persona_store_set_roles_co (_data_);
}


void _edsf_persona_store_set_roles_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error) {
	EdsfPersonaStoreSetRolesData* _data_;
	if (g_simple_async_result_propagate_error (G_SIMPLE_ASYNC_RESULT (_res_), error)) {
		return;
	}
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


static void _edsf_persona_store_set_roles_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	EdsfPersonaStoreSetRolesData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	_edsf_persona_store_set_roles_co (_data_);
}


static gboolean _edsf_persona_store_set_roles_co (EdsfPersonaStoreSetRolesData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_tmp0_ = _data_->self->priv->_always_writeable_properties;
	_data_->_tmp0__length1 = _data_->self->priv->_always_writeable_properties_length1;
	if (!_vala_string_array_contains (_data_->_tmp0_, _data_->_tmp0__length1, "roles")) {
		_data_->_tmp1_ = NULL;
		_data_->_tmp1_ = _ ("Roles are not writeable on this contact.");
		_data_->_tmp2_ = g_error_new_literal (FOLKS_PROPERTY_ERROR, FOLKS_PROPERTY_ERROR_NOT_WRITEABLE, _data_->_tmp1_);
		_data_->_inner_error_ = _data_->_tmp2_;
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	_data_->_tmp3_ = _data_->roles;
	_data_->_tmp4_ = _data_->persona;
	_data_->_tmp5_ = folks_role_details_get_roles ((FolksRoleDetails*) _data_->_tmp4_);
	_data_->_tmp6_ = _data_->_tmp5_;
	_data_->_tmp7_ = FALSE;
	_data_->_tmp7_ = folks_internal_equal_sets (FOLKS_TYPE_ROLE_FIELD_DETAILS, (GBoxedCopyFunc) g_object_ref, g_object_unref, _data_->_tmp3_, _data_->_tmp6_);
	if (_data_->_tmp7_) {
		if (_data_->_state_ == 0) {
			g_simple_async_result_complete_in_idle (_data_->_async_result);
		} else {
			g_simple_async_result_complete (_data_->_async_result);
		}
		g_object_unref (_data_->_async_result);
		return FALSE;
	}
	_data_->_tmp8_ = _data_->persona;
	_data_->_tmp9_ = edsf_persona_get_contact (_data_->_tmp8_);
	_data_->_tmp10_ = _data_->_tmp9_;
	_data_->_tmp11_ = _data_->roles;
	_edsf_persona_store_set_contact_roles (_data_->self, _data_->_tmp10_, _data_->_tmp11_);
	_data_->_tmp12_ = _data_->persona;
	_data_->_state_ = 1;
	_edsf_persona_store_commit_modified_property (_data_->self, _data_->_tmp12_, "roles", _edsf_persona_store_set_roles_ready, _data_);
	return FALSE;
	_state_1:
	_edsf_persona_store_commit_modified_property_finish (_data_->self, _data_->_res_, &_data_->_inner_error_);
	if (_data_->_inner_error_ != NULL) {
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static void _edsf_persona_store_set_contact_roles (EdsfPersonaStore* self, EContact* contact, GeeSet* roles) {
	EVCard* vcard = NULL;
	EContact* _tmp0_;
	EVCard* _tmp1_;
	EVCard* _tmp2_;
	gchar* org = NULL;
	gchar* org_unit = NULL;
	gchar* office = NULL;
	gchar* title = NULL;
	gchar* role = NULL;
	gchar* manager = NULL;
	gchar* assistant = NULL;
	gint count = 0;
	EContact* _tmp147_;
	EContactField _tmp148_ = 0;
	const gchar* _tmp149_;
	EContact* _tmp150_;
	EContactField _tmp151_ = 0;
	const gchar* _tmp152_;
	EContact* _tmp153_;
	EContactField _tmp154_ = 0;
	const gchar* _tmp155_;
	EContact* _tmp156_;
	EContactField _tmp157_ = 0;
	const gchar* _tmp158_;
	EContact* _tmp159_;
	EContactField _tmp160_ = 0;
	const gchar* _tmp161_;
	EContact* _tmp162_;
	EContactField _tmp163_ = 0;
	const gchar* _tmp164_;
	EContact* _tmp165_;
	EContactField _tmp166_ = 0;
	const gchar* _tmp167_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (contact != NULL);
	g_return_if_fail (roles != NULL);
	_tmp0_ = contact;
	_tmp1_ = _g_object_ref0 (G_TYPE_CHECK_INSTANCE_CAST (_tmp0_, e_vcard_get_type (), EVCard));
	vcard = _tmp1_;
	_tmp2_ = vcard;
	e_vcard_remove_attributes (_tmp2_, NULL, "X-ROLES");
	org = NULL;
	org_unit = NULL;
	office = NULL;
	title = NULL;
	role = NULL;
	manager = NULL;
	assistant = NULL;
	count = 0;
	{
		GeeIterator* _role_fd_it = NULL;
		GeeSet* _tmp3_;
		GeeIterator* _tmp4_ = NULL;
		_tmp3_ = roles;
		_tmp4_ = gee_iterable_iterator ((GeeIterable*) _tmp3_);
		_role_fd_it = _tmp4_;
		while (TRUE) {
			GeeIterator* _tmp5_;
			gboolean _tmp6_ = FALSE;
			FolksRoleFieldDetails* role_fd = NULL;
			GeeIterator* _tmp7_;
			gpointer _tmp8_ = NULL;
			gint _tmp9_;
			gint _tmp146_;
			_tmp5_ = _role_fd_it;
			_tmp6_ = gee_iterator_next (_tmp5_);
			if (!_tmp6_) {
				break;
			}
			_tmp7_ = _role_fd_it;
			_tmp8_ = gee_iterator_get (_tmp7_);
			role_fd = (FolksRoleFieldDetails*) _tmp8_;
			_tmp9_ = count;
			if (_tmp9_ == 0) {
				FolksRoleFieldDetails* _tmp10_;
				gconstpointer _tmp11_;
				FolksRole* _tmp12_;
				const gchar* _tmp13_;
				const gchar* _tmp14_;
				gchar* _tmp15_;
				FolksRoleFieldDetails* _tmp16_;
				gconstpointer _tmp17_;
				FolksRole* _tmp18_;
				const gchar* _tmp19_;
				const gchar* _tmp20_;
				gchar* _tmp21_;
				FolksRoleFieldDetails* _tmp22_;
				gconstpointer _tmp23_;
				FolksRole* _tmp24_;
				const gchar* _tmp25_;
				const gchar* _tmp26_;
				gchar* _tmp27_;
				GeeCollection* org_unit_values = NULL;
				FolksRoleFieldDetails* _tmp28_;
				GeeCollection* _tmp29_ = NULL;
				gboolean _tmp30_ = FALSE;
				GeeCollection* _tmp31_;
				gboolean _tmp35_;
				GeeCollection* office_values = NULL;
				FolksRoleFieldDetails* _tmp42_;
				GeeCollection* _tmp43_ = NULL;
				gboolean _tmp44_ = FALSE;
				GeeCollection* _tmp45_;
				gboolean _tmp49_;
				GeeCollection* manager_values = NULL;
				FolksRoleFieldDetails* _tmp56_;
				GeeCollection* _tmp57_ = NULL;
				gboolean _tmp58_ = FALSE;
				GeeCollection* _tmp59_;
				gboolean _tmp63_;
				GeeCollection* assistant_values = NULL;
				FolksRoleFieldDetails* _tmp70_;
				GeeCollection* _tmp71_ = NULL;
				gboolean _tmp72_ = FALSE;
				GeeCollection* _tmp73_;
				gboolean _tmp77_;
				_tmp10_ = role_fd;
				_tmp11_ = folks_abstract_field_details_get_value ((FolksAbstractFieldDetails*) _tmp10_);
				_tmp12_ = _tmp11_;
				_tmp13_ = folks_role_get_organisation_name ((FolksRole*) _tmp12_);
				_tmp14_ = _tmp13_;
				_tmp15_ = g_strdup (_tmp14_);
				_g_free0 (org);
				org = _tmp15_;
				_tmp16_ = role_fd;
				_tmp17_ = folks_abstract_field_details_get_value ((FolksAbstractFieldDetails*) _tmp16_);
				_tmp18_ = _tmp17_;
				_tmp19_ = folks_role_get_title ((FolksRole*) _tmp18_);
				_tmp20_ = _tmp19_;
				_tmp21_ = g_strdup (_tmp20_);
				_g_free0 (title);
				title = _tmp21_;
				_tmp22_ = role_fd;
				_tmp23_ = folks_abstract_field_details_get_value ((FolksAbstractFieldDetails*) _tmp22_);
				_tmp24_ = _tmp23_;
				_tmp25_ = folks_role_get_role ((FolksRole*) _tmp24_);
				_tmp26_ = _tmp25_;
				_tmp27_ = g_strdup (_tmp26_);
				_g_free0 (role);
				role = _tmp27_;
				_tmp28_ = role_fd;
				_tmp29_ = folks_abstract_field_details_get_parameter_values ((FolksAbstractFieldDetails*) _tmp28_, "org_unit");
				org_unit_values = _tmp29_;
				_tmp31_ = org_unit_values;
				if (_tmp31_ != NULL) {
					GeeCollection* _tmp32_;
					gint _tmp33_;
					gint _tmp34_;
					_tmp32_ = org_unit_values;
					_tmp33_ = gee_collection_get_size (G_TYPE_CHECK_INSTANCE_CAST (_tmp32_, GEE_TYPE_COLLECTION, GeeCollection));
					_tmp34_ = _tmp33_;
					_tmp30_ = _tmp34_ > 0;
				} else {
					_tmp30_ = FALSE;
				}
				_tmp35_ = _tmp30_;
				if (_tmp35_) {
					GeeCollection* _tmp36_;
					gint _tmp37_ = 0;
					gpointer* _tmp38_ = NULL;
					gchar** _tmp39_;
					gint _tmp39__length1;
					const gchar* _tmp40_;
					gchar* _tmp41_;
					_tmp36_ = org_unit_values;
					_tmp38_ = gee_collection_to_array (G_TYPE_CHECK_INSTANCE_CAST (_tmp36_, GEE_TYPE_COLLECTION, GeeCollection), &_tmp37_);
					_tmp39_ = _tmp38_;
					_tmp39__length1 = _tmp37_;
					_tmp40_ = _tmp39_[0];
					_tmp41_ = g_strdup (_tmp40_);
					_g_free0 (org_unit);
					org_unit = _tmp41_;
					_tmp39_ = (_vala_array_free (_tmp39_, _tmp39__length1, (GDestroyNotify) g_free), NULL);
				}
				_tmp42_ = role_fd;
				_tmp43_ = folks_abstract_field_details_get_parameter_values ((FolksAbstractFieldDetails*) _tmp42_, "office");
				office_values = _tmp43_;
				_tmp45_ = office_values;
				if (_tmp45_ != NULL) {
					GeeCollection* _tmp46_;
					gint _tmp47_;
					gint _tmp48_;
					_tmp46_ = office_values;
					_tmp47_ = gee_collection_get_size (G_TYPE_CHECK_INSTANCE_CAST (_tmp46_, GEE_TYPE_COLLECTION, GeeCollection));
					_tmp48_ = _tmp47_;
					_tmp44_ = _tmp48_ > 0;
				} else {
					_tmp44_ = FALSE;
				}
				_tmp49_ = _tmp44_;
				if (_tmp49_) {
					GeeCollection* _tmp50_;
					gint _tmp51_ = 0;
					gpointer* _tmp52_ = NULL;
					gchar** _tmp53_;
					gint _tmp53__length1;
					const gchar* _tmp54_;
					gchar* _tmp55_;
					_tmp50_ = office_values;
					_tmp52_ = gee_collection_to_array (G_TYPE_CHECK_INSTANCE_CAST (_tmp50_, GEE_TYPE_COLLECTION, GeeCollection), &_tmp51_);
					_tmp53_ = _tmp52_;
					_tmp53__length1 = _tmp51_;
					_tmp54_ = _tmp53_[0];
					_tmp55_ = g_strdup (_tmp54_);
					_g_free0 (office);
					office = _tmp55_;
					_tmp53_ = (_vala_array_free (_tmp53_, _tmp53__length1, (GDestroyNotify) g_free), NULL);
				}
				_tmp56_ = role_fd;
				_tmp57_ = folks_abstract_field_details_get_parameter_values ((FolksAbstractFieldDetails*) _tmp56_, "manager");
				manager_values = _tmp57_;
				_tmp59_ = manager_values;
				if (_tmp59_ != NULL) {
					GeeCollection* _tmp60_;
					gint _tmp61_;
					gint _tmp62_;
					_tmp60_ = manager_values;
					_tmp61_ = gee_collection_get_size (G_TYPE_CHECK_INSTANCE_CAST (_tmp60_, GEE_TYPE_COLLECTION, GeeCollection));
					_tmp62_ = _tmp61_;
					_tmp58_ = _tmp62_ > 0;
				} else {
					_tmp58_ = FALSE;
				}
				_tmp63_ = _tmp58_;
				if (_tmp63_) {
					GeeCollection* _tmp64_;
					gint _tmp65_ = 0;
					gpointer* _tmp66_ = NULL;
					gchar** _tmp67_;
					gint _tmp67__length1;
					const gchar* _tmp68_;
					gchar* _tmp69_;
					_tmp64_ = manager_values;
					_tmp66_ = gee_collection_to_array (G_TYPE_CHECK_INSTANCE_CAST (_tmp64_, GEE_TYPE_COLLECTION, GeeCollection), &_tmp65_);
					_tmp67_ = _tmp66_;
					_tmp67__length1 = _tmp65_;
					_tmp68_ = _tmp67_[0];
					_tmp69_ = g_strdup (_tmp68_);
					_g_free0 (manager);
					manager = _tmp69_;
					_tmp67_ = (_vala_array_free (_tmp67_, _tmp67__length1, (GDestroyNotify) g_free), NULL);
				}
				_tmp70_ = role_fd;
				_tmp71_ = folks_abstract_field_details_get_parameter_values ((FolksAbstractFieldDetails*) _tmp70_, "assistant");
				assistant_values = _tmp71_;
				_tmp73_ = assistant_values;
				if (_tmp73_ != NULL) {
					GeeCollection* _tmp74_;
					gint _tmp75_;
					gint _tmp76_;
					_tmp74_ = assistant_values;
					_tmp75_ = gee_collection_get_size (G_TYPE_CHECK_INSTANCE_CAST (_tmp74_, GEE_TYPE_COLLECTION, GeeCollection));
					_tmp76_ = _tmp75_;
					_tmp72_ = _tmp76_ > 0;
				} else {
					_tmp72_ = FALSE;
				}
				_tmp77_ = _tmp72_;
				if (_tmp77_) {
					GeeCollection* _tmp78_;
					gint _tmp79_ = 0;
					gpointer* _tmp80_ = NULL;
					gchar** _tmp81_;
					gint _tmp81__length1;
					const gchar* _tmp82_;
					gchar* _tmp83_;
					_tmp78_ = assistant_values;
					_tmp80_ = gee_collection_to_array (G_TYPE_CHECK_INSTANCE_CAST (_tmp78_, GEE_TYPE_COLLECTION, GeeCollection), &_tmp79_);
					_tmp81_ = _tmp80_;
					_tmp81__length1 = _tmp79_;
					_tmp82_ = _tmp81_[0];
					_tmp83_ = g_strdup (_tmp82_);
					_g_free0 (assistant);
					assistant = _tmp83_;
					_tmp81_ = (_vala_array_free (_tmp81_, _tmp81__length1, (GDestroyNotify) g_free), NULL);
				}
				_g_object_unref0 (assistant_values);
				_g_object_unref0 (manager_values);
				_g_object_unref0 (office_values);
				_g_object_unref0 (org_unit_values);
			} else {
				EVCardAttribute* attr = NULL;
				EVCardAttribute* _tmp84_;
				EVCardAttribute* _tmp85_;
				FolksRoleFieldDetails* _tmp86_;
				gconstpointer _tmp87_;
				FolksRole* _tmp88_;
				const gchar* _tmp89_;
				const gchar* _tmp90_;
				EVCardAttributeParam* param1 = NULL;
				EVCardAttributeParam* _tmp91_;
				EVCardAttributeParam* _tmp92_;
				FolksRoleFieldDetails* _tmp93_;
				gconstpointer _tmp94_;
				FolksRole* _tmp95_;
				const gchar* _tmp96_;
				const gchar* _tmp97_;
				EVCardAttribute* _tmp98_;
				EVCardAttributeParam* _tmp99_;
				EVCardAttributeParam* _tmp100_;
				EVCardAttributeParam* param2 = NULL;
				EVCardAttributeParam* _tmp101_;
				EVCardAttributeParam* _tmp102_;
				FolksRoleFieldDetails* _tmp103_;
				gconstpointer _tmp104_;
				FolksRole* _tmp105_;
				const gchar* _tmp106_;
				const gchar* _tmp107_;
				EVCardAttribute* _tmp108_;
				EVCardAttributeParam* _tmp109_;
				EVCardAttributeParam* _tmp110_;
				EContact* _tmp144_;
				EVCardAttribute* _tmp145_;
				_tmp84_ = e_vcard_attribute_new (NULL, "X-ROLES");
				attr = _tmp84_;
				_tmp85_ = attr;
				_tmp86_ = role_fd;
				_tmp87_ = folks_abstract_field_details_get_value ((FolksAbstractFieldDetails*) _tmp86_);
				_tmp88_ = _tmp87_;
				_tmp89_ = folks_role_get_role ((FolksRole*) _tmp88_);
				_tmp90_ = _tmp89_;
				e_vcard_attribute_add_value (_tmp85_, _tmp90_);
				_tmp91_ = e_vcard_attribute_param_new ("organisation_name");
				param1 = _tmp91_;
				_tmp92_ = param1;
				_tmp93_ = role_fd;
				_tmp94_ = folks_abstract_field_details_get_value ((FolksAbstractFieldDetails*) _tmp93_);
				_tmp95_ = _tmp94_;
				_tmp96_ = folks_role_get_organisation_name ((FolksRole*) _tmp95_);
				_tmp97_ = _tmp96_;
				e_vcard_attribute_param_add_value (_tmp92_, _tmp97_);
				_tmp98_ = attr;
				_tmp99_ = param1;
				_tmp100_ = __vala_EVCardAttributeParam_copy0 (_tmp99_);
				e_vcard_attribute_add_param (_tmp98_, _tmp100_);
				_tmp101_ = e_vcard_attribute_param_new ("title");
				param2 = _tmp101_;
				_tmp102_ = param2;
				_tmp103_ = role_fd;
				_tmp104_ = folks_abstract_field_details_get_value ((FolksAbstractFieldDetails*) _tmp103_);
				_tmp105_ = _tmp104_;
				_tmp106_ = folks_role_get_title ((FolksRole*) _tmp105_);
				_tmp107_ = _tmp106_;
				e_vcard_attribute_param_add_value (_tmp102_, _tmp107_);
				_tmp108_ = attr;
				_tmp109_ = param2;
				_tmp110_ = __vala_EVCardAttributeParam_copy0 (_tmp109_);
				e_vcard_attribute_add_param (_tmp108_, _tmp110_);
				{
					GeeIterator* _param_name_it = NULL;
					FolksRoleFieldDetails* _tmp111_;
					GeeMultiMap* _tmp112_;
					GeeMultiMap* _tmp113_;
					GeeSet* _tmp114_ = NULL;
					GeeSet* _tmp115_;
					GeeIterator* _tmp116_ = NULL;
					GeeIterator* _tmp117_;
					_tmp111_ = role_fd;
					_tmp112_ = folks_abstract_field_details_get_parameters ((FolksAbstractFieldDetails*) _tmp111_);
					_tmp113_ = _tmp112_;
					_tmp114_ = gee_multi_map_get_keys (_tmp113_);
					_tmp115_ = _tmp114_;
					_tmp116_ = gee_iterable_iterator ((GeeIterable*) _tmp115_);
					_tmp117_ = _tmp116_;
					_g_object_unref0 (_tmp115_);
					_param_name_it = _tmp117_;
					while (TRUE) {
						GeeIterator* _tmp118_;
						gboolean _tmp119_ = FALSE;
						gchar* param_name = NULL;
						GeeIterator* _tmp120_;
						gpointer _tmp121_ = NULL;
						EVCardAttributeParam* param3 = NULL;
						const gchar* _tmp122_;
						gchar* _tmp123_ = NULL;
						gchar* _tmp124_;
						EVCardAttributeParam* _tmp125_;
						EVCardAttributeParam* _tmp126_;
						EVCardAttribute* _tmp141_;
						EVCardAttributeParam* _tmp142_;
						EVCardAttributeParam* _tmp143_;
						_tmp118_ = _param_name_it;
						_tmp119_ = gee_iterator_next (_tmp118_);
						if (!_tmp119_) {
							break;
						}
						_tmp120_ = _param_name_it;
						_tmp121_ = gee_iterator_get (_tmp120_);
						param_name = (gchar*) _tmp121_;
						_tmp122_ = param_name;
						_tmp123_ = g_utf8_strup (_tmp122_, (gssize) (-1));
						_tmp124_ = _tmp123_;
						_tmp125_ = e_vcard_attribute_param_new (_tmp124_);
						_tmp126_ = _tmp125_;
						_g_free0 (_tmp124_);
						param3 = _tmp126_;
						{
							GeeIterator* _param_val_it = NULL;
							FolksRoleFieldDetails* _tmp127_;
							GeeMultiMap* _tmp128_;
							GeeMultiMap* _tmp129_;
							const gchar* _tmp130_;
							GeeCollection* _tmp131_ = NULL;
							GeeCollection* _tmp132_;
							GeeIterator* _tmp133_ = NULL;
							GeeIterator* _tmp134_;
							_tmp127_ = role_fd;
							_tmp128_ = folks_abstract_field_details_get_parameters ((FolksAbstractFieldDetails*) _tmp127_);
							_tmp129_ = _tmp128_;
							_tmp130_ = param_name;
							_tmp131_ = gee_multi_map_get (_tmp129_, _tmp130_);
							_tmp132_ = _tmp131_;
							_tmp133_ = gee_iterable_iterator ((GeeIterable*) _tmp132_);
							_tmp134_ = _tmp133_;
							_g_object_unref0 (_tmp132_);
							_param_val_it = _tmp134_;
							while (TRUE) {
								GeeIterator* _tmp135_;
								gboolean _tmp136_ = FALSE;
								gchar* param_val = NULL;
								GeeIterator* _tmp137_;
								gpointer _tmp138_ = NULL;
								EVCardAttributeParam* _tmp139_;
								const gchar* _tmp140_;
								_tmp135_ = _param_val_it;
								_tmp136_ = gee_iterator_next (_tmp135_);
								if (!_tmp136_) {
									break;
								}
								_tmp137_ = _param_val_it;
								_tmp138_ = gee_iterator_get (_tmp137_);
								param_val = (gchar*) _tmp138_;
								_tmp139_ = param3;
								_tmp140_ = param_val;
								e_vcard_attribute_param_add_value (_tmp139_, _tmp140_);
								_g_free0 (param_val);
							}
							_g_object_unref0 (_param_val_it);
						}
						_tmp141_ = attr;
						_tmp142_ = param3;
						_tmp143_ = __vala_EVCardAttributeParam_copy0 (_tmp142_);
						e_vcard_attribute_add_param (_tmp141_, _tmp143_);
						__vala_EVCardAttributeParam_free0 (param3);
						_g_free0 (param_name);
					}
					_g_object_unref0 (_param_name_it);
				}
				_tmp144_ = contact;
				_tmp145_ = attr;
				attr = NULL;
				e_vcard_add_attribute ((EVCard*) _tmp144_, _tmp145_);
				__vala_EVCardAttributeParam_free0 (param2);
				__vala_EVCardAttributeParam_free0 (param1);
				__vala_EVCardAttribute_free0 (attr);
			}
			_tmp146_ = count;
			count = _tmp146_ + 1;
			_g_object_unref0 (role_fd);
		}
		_g_object_unref0 (_role_fd_it);
	}
	_tmp147_ = contact;
	_tmp148_ = e_contact_field_id ("org");
	_tmp149_ = org;
	e_contact_set (_tmp147_, _tmp148_, _tmp149_);
	_tmp150_ = contact;
	_tmp151_ = e_contact_field_id ("org_unit");
	_tmp152_ = org_unit;
	e_contact_set (_tmp150_, _tmp151_, _tmp152_);
	_tmp153_ = contact;
	_tmp154_ = e_contact_field_id ("office");
	_tmp155_ = office;
	e_contact_set (_tmp153_, _tmp154_, _tmp155_);
	_tmp156_ = contact;
	_tmp157_ = e_contact_field_id ("title");
	_tmp158_ = title;
	e_contact_set (_tmp156_, _tmp157_, _tmp158_);
	_tmp159_ = contact;
	_tmp160_ = e_contact_field_id ("role");
	_tmp161_ = role;
	e_contact_set (_tmp159_, _tmp160_, _tmp161_);
	_tmp162_ = contact;
	_tmp163_ = e_contact_field_id ("manager");
	_tmp164_ = manager;
	e_contact_set (_tmp162_, _tmp163_, _tmp164_);
	_tmp165_ = contact;
	_tmp166_ = e_contact_field_id ("assistant");
	_tmp167_ = assistant;
	e_contact_set (_tmp165_, _tmp166_, _tmp167_);
	_g_free0 (assistant);
	_g_free0 (manager);
	_g_free0 (role);
	_g_free0 (title);
	_g_free0 (office);
	_g_free0 (org_unit);
	_g_free0 (org);
	_g_object_unref0 (vcard);
}


static void _edsf_persona_store_set_structured_name_data_free (gpointer _data) {
	EdsfPersonaStoreSetStructuredNameData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->persona);
	_g_object_unref0 (_data_->sname);
	_g_object_unref0 (_data_->self);
	g_slice_free (EdsfPersonaStoreSetStructuredNameData, _data_);
}


void _edsf_persona_store_set_structured_name (EdsfPersonaStore* self, EdsfPersona* persona, FolksStructuredName* sname, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	EdsfPersonaStoreSetStructuredNameData* _data_;
	EdsfPersonaStore* _tmp0_;
	EdsfPersona* _tmp1_;
	EdsfPersona* _tmp2_;
	FolksStructuredName* _tmp3_;
	FolksStructuredName* _tmp4_;
	_data_ = g_slice_new0 (EdsfPersonaStoreSetStructuredNameData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, _edsf_persona_store_set_structured_name);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, _edsf_persona_store_set_structured_name_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	_tmp1_ = persona;
	_tmp2_ = _g_object_ref0 (_tmp1_);
	_g_object_unref0 (_data_->persona);
	_data_->persona = _tmp2_;
	_tmp3_ = sname;
	_tmp4_ = _g_object_ref0 (_tmp3_);
	_g_object_unref0 (_data_->sname);
	_data_->sname = _tmp4_;
	_edsf_persona_store_set_structured_name_co (_data_);
}


void _edsf_persona_store_set_structured_name_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error) {
	EdsfPersonaStoreSetStructuredNameData* _data_;
	if (g_simple_async_result_propagate_error (G_SIMPLE_ASYNC_RESULT (_res_), error)) {
		return;
	}
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


static void _edsf_persona_store_set_structured_name_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	EdsfPersonaStoreSetStructuredNameData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	_edsf_persona_store_set_structured_name_co (_data_);
}


static gboolean _edsf_persona_store_set_structured_name_co (EdsfPersonaStoreSetStructuredNameData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_tmp0_ = _data_->self->priv->_always_writeable_properties;
	_data_->_tmp0__length1 = _data_->self->priv->_always_writeable_properties_length1;
	if (!_vala_string_array_contains (_data_->_tmp0_, _data_->_tmp0__length1, "structured-name")) {
		_data_->_tmp1_ = NULL;
		_data_->_tmp1_ = _ ("Structured name is not writeable on this contact.");
		_data_->_tmp2_ = g_error_new_literal (FOLKS_PROPERTY_ERROR, FOLKS_PROPERTY_ERROR_NOT_WRITEABLE, _data_->_tmp1_);
		_data_->_inner_error_ = _data_->_tmp2_;
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	_data_->_tmp5_ = _data_->persona;
	_data_->_tmp6_ = folks_name_details_get_structured_name ((FolksNameDetails*) _data_->_tmp5_);
	_data_->_tmp7_ = _data_->_tmp6_;
	if (_data_->_tmp7_ != NULL) {
		_data_->_tmp8_ = _data_->sname;
		_data_->_tmp4_ = _data_->_tmp8_ != NULL;
	} else {
		_data_->_tmp4_ = FALSE;
	}
	_data_->_tmp9_ = _data_->_tmp4_;
	if (_data_->_tmp9_) {
		_data_->_tmp10_ = _data_->persona;
		_data_->_tmp11_ = folks_name_details_get_structured_name ((FolksNameDetails*) _data_->_tmp10_);
		_data_->_tmp12_ = _data_->_tmp11_;
		_data_->_tmp13_ = _data_->sname;
		_data_->_tmp14_ = FALSE;
		_data_->_tmp14_ = folks_structured_name_equal (G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp12_, FOLKS_TYPE_STRUCTURED_NAME, FolksStructuredName), G_TYPE_CHECK_INSTANCE_CAST (_data_->_tmp13_, FOLKS_TYPE_STRUCTURED_NAME, FolksStructuredName));
		_data_->_tmp3_ = _data_->_tmp14_;
	} else {
		_data_->_tmp3_ = FALSE;
	}
	_data_->_tmp15_ = _data_->_tmp3_;
	if (_data_->_tmp15_) {
		if (_data_->_state_ == 0) {
			g_simple_async_result_complete_in_idle (_data_->_async_result);
		} else {
			g_simple_async_result_complete (_data_->_async_result);
		}
		g_object_unref (_data_->_async_result);
		return FALSE;
	}
	_data_->_tmp17_ = _data_->persona;
	_data_->_tmp18_ = folks_name_details_get_structured_name ((FolksNameDetails*) _data_->_tmp17_);
	_data_->_tmp19_ = _data_->_tmp18_;
	if (_data_->_tmp19_ == NULL) {
		_data_->_tmp20_ = _data_->sname;
		_data_->_tmp16_ = _data_->_tmp20_ == NULL;
	} else {
		_data_->_tmp16_ = FALSE;
	}
	_data_->_tmp21_ = _data_->_tmp16_;
	if (_data_->_tmp21_) {
		if (_data_->_state_ == 0) {
			g_simple_async_result_complete_in_idle (_data_->_async_result);
		} else {
			g_simple_async_result_complete (_data_->_async_result);
		}
		g_object_unref (_data_->_async_result);
		return FALSE;
	}
	_data_->_tmp22_ = _data_->persona;
	_data_->_tmp23_ = edsf_persona_get_contact (_data_->_tmp22_);
	_data_->_tmp24_ = _data_->_tmp23_;
	_data_->_tmp25_ = _data_->sname;
	_edsf_persona_store_set_contact_name (_data_->self, _data_->_tmp24_, _data_->_tmp25_);
	_data_->_tmp26_ = _data_->persona;
	_data_->_state_ = 1;
	_edsf_persona_store_commit_modified_property (_data_->self, _data_->_tmp26_, "structured-name", _edsf_persona_store_set_structured_name_ready, _data_);
	return FALSE;
	_state_1:
	_edsf_persona_store_commit_modified_property_finish (_data_->self, _data_->_res_, &_data_->_inner_error_);
	if (_data_->_inner_error_ != NULL) {
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static void _vala_EContactName_free (EContactName* self) {
	g_boxed_free (e_contact_name_get_type (), self);
}


static void _edsf_persona_store_set_contact_name (EdsfPersonaStore* self, EContact* contact, FolksStructuredName* _sname) {
	EContactName* contact_name = NULL;
	EContactName* _tmp0_;
	FolksStructuredName* _tmp1_;
	EContact* _tmp29_;
	EContactField _tmp30_ = 0;
	EContactName* _tmp31_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (contact != NULL);
	_tmp0_ = e_contact_name_new ();
	contact_name = _tmp0_;
	_tmp1_ = _sname;
	if (_tmp1_ != NULL) {
		FolksStructuredName* sname = NULL;
		FolksStructuredName* _tmp2_;
		FolksStructuredName* _tmp3_;
		EContactName* _tmp4_;
		FolksStructuredName* _tmp5_;
		const gchar* _tmp6_;
		const gchar* _tmp7_;
		gchar* _tmp8_;
		EContactName* _tmp9_;
		FolksStructuredName* _tmp10_;
		const gchar* _tmp11_;
		const gchar* _tmp12_;
		gchar* _tmp13_;
		EContactName* _tmp14_;
		FolksStructuredName* _tmp15_;
		const gchar* _tmp16_;
		const gchar* _tmp17_;
		gchar* _tmp18_;
		EContactName* _tmp19_;
		FolksStructuredName* _tmp20_;
		const gchar* _tmp21_;
		const gchar* _tmp22_;
		gchar* _tmp23_;
		EContactName* _tmp24_;
		FolksStructuredName* _tmp25_;
		const gchar* _tmp26_;
		const gchar* _tmp27_;
		gchar* _tmp28_;
		_tmp2_ = _sname;
		_tmp3_ = _g_object_ref0 (G_TYPE_CHECK_INSTANCE_CAST (_tmp2_, FOLKS_TYPE_STRUCTURED_NAME, FolksStructuredName));
		sname = _tmp3_;
		_tmp4_ = contact_name;
		_tmp5_ = sname;
		_tmp6_ = folks_structured_name_get_family_name (_tmp5_);
		_tmp7_ = _tmp6_;
		_tmp8_ = g_strdup (_tmp7_);
		_g_free0 (_tmp4_->family);
		_tmp4_->family = _tmp8_;
		_tmp9_ = contact_name;
		_tmp10_ = sname;
		_tmp11_ = folks_structured_name_get_given_name (_tmp10_);
		_tmp12_ = _tmp11_;
		_tmp13_ = g_strdup (_tmp12_);
		_g_free0 (_tmp9_->given);
		_tmp9_->given = _tmp13_;
		_tmp14_ = contact_name;
		_tmp15_ = sname;
		_tmp16_ = folks_structured_name_get_additional_names (_tmp15_);
		_tmp17_ = _tmp16_;
		_tmp18_ = g_strdup (_tmp17_);
		_g_free0 (_tmp14_->additional);
		_tmp14_->additional = _tmp18_;
		_tmp19_ = contact_name;
		_tmp20_ = sname;
		_tmp21_ = folks_structured_name_get_suffixes (_tmp20_);
		_tmp22_ = _tmp21_;
		_tmp23_ = g_strdup (_tmp22_);
		_g_free0 (_tmp19_->suffixes);
		_tmp19_->suffixes = _tmp23_;
		_tmp24_ = contact_name;
		_tmp25_ = sname;
		_tmp26_ = folks_structured_name_get_prefixes (_tmp25_);
		_tmp27_ = _tmp26_;
		_tmp28_ = g_strdup (_tmp27_);
		_g_free0 (_tmp24_->prefixes);
		_tmp24_->prefixes = _tmp28_;
		_g_object_unref0 (sname);
	}
	_tmp29_ = contact;
	_tmp30_ = e_contact_field_id ("name");
	_tmp31_ = contact_name;
	e_contact_set (_tmp29_, _tmp30_, _tmp31_);
	__vala_EContactName_free0 (contact_name);
}


static void _edsf_persona_store_set_im_fds_data_free (gpointer _data) {
	EdsfPersonaStoreSetImFdsData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->persona);
	_g_object_unref0 (_data_->im_fds);
	_g_object_unref0 (_data_->self);
	g_slice_free (EdsfPersonaStoreSetImFdsData, _data_);
}


void _edsf_persona_store_set_im_fds (EdsfPersonaStore* self, EdsfPersona* persona, GeeMultiMap* im_fds, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	EdsfPersonaStoreSetImFdsData* _data_;
	EdsfPersonaStore* _tmp0_;
	EdsfPersona* _tmp1_;
	EdsfPersona* _tmp2_;
	GeeMultiMap* _tmp3_;
	GeeMultiMap* _tmp4_;
	_data_ = g_slice_new0 (EdsfPersonaStoreSetImFdsData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, _edsf_persona_store_set_im_fds);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, _edsf_persona_store_set_im_fds_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	_tmp1_ = persona;
	_tmp2_ = _g_object_ref0 (_tmp1_);
	_g_object_unref0 (_data_->persona);
	_data_->persona = _tmp2_;
	_tmp3_ = im_fds;
	_tmp4_ = _g_object_ref0 (_tmp3_);
	_g_object_unref0 (_data_->im_fds);
	_data_->im_fds = _tmp4_;
	_edsf_persona_store_set_im_fds_co (_data_);
}


void _edsf_persona_store_set_im_fds_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error) {
	EdsfPersonaStoreSetImFdsData* _data_;
	if (g_simple_async_result_propagate_error (G_SIMPLE_ASYNC_RESULT (_res_), error)) {
		return;
	}
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


static void _edsf_persona_store_set_im_fds_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	EdsfPersonaStoreSetImFdsData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	_edsf_persona_store_set_im_fds_co (_data_);
}


static gboolean _edsf_persona_store_set_im_fds_co (EdsfPersonaStoreSetImFdsData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_tmp0_ = _data_->self->priv->_always_writeable_properties;
	_data_->_tmp0__length1 = _data_->self->priv->_always_writeable_properties_length1;
	if (!_vala_string_array_contains (_data_->_tmp0_, _data_->_tmp0__length1, "im-addresses")) {
		_data_->_tmp1_ = NULL;
		_data_->_tmp1_ = _ ("IM addresses are not writeable on this contact.");
		_data_->_tmp2_ = g_error_new_literal (FOLKS_PROPERTY_ERROR, FOLKS_PROPERTY_ERROR_NOT_WRITEABLE, _data_->_tmp1_);
		_data_->_inner_error_ = _data_->_tmp2_;
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	_data_->_tmp3_ = _data_->persona;
	_data_->_tmp4_ = folks_im_details_get_im_addresses ((FolksImDetails*) _data_->_tmp3_);
	_data_->_tmp5_ = _data_->_tmp4_;
	_data_->_tmp6_ = _data_->im_fds;
	_data_->_tmp7_ = FALSE;
	_data_->_tmp7_ = folks_utils_multi_map_str_afd_equal (_data_->_tmp5_, _data_->_tmp6_);
	if (_data_->_tmp7_) {
		if (_data_->_state_ == 0) {
			g_simple_async_result_complete_in_idle (_data_->_async_result);
		} else {
			g_simple_async_result_complete (_data_->_async_result);
		}
		g_object_unref (_data_->_async_result);
		return FALSE;
	}
	_data_->_tmp8_ = _data_->persona;
	_data_->_tmp9_ = edsf_persona_get_contact (_data_->_tmp8_);
	_data_->_tmp10_ = _data_->_tmp9_;
	_data_->_tmp11_ = _data_->im_fds;
	_edsf_persona_store_set_contact_im_fds (_data_->self, _data_->_tmp10_, _data_->_tmp11_);
	_data_->_tmp12_ = _data_->persona;
	_data_->_state_ = 1;
	_edsf_persona_store_commit_modified_property (_data_->self, _data_->_tmp12_, "im-addresses", _edsf_persona_store_set_im_fds_ready, _data_);
	return FALSE;
	_state_1:
	_edsf_persona_store_commit_modified_property_finish (_data_->self, _data_->_res_, &_data_->_inner_error_);
	if (_data_->_inner_error_ != NULL) {
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static void _edsf_persona_store_set_contact_im_fds (EdsfPersonaStore* self, EContact* contact, GeeMultiMap* im_fds) {
	GHashTable* im_eds_map = NULL;
	GHashTable* _tmp0_ = NULL;
	GHashTable* _tmp1_;
	GList* _tmp2_ = NULL;
	g_return_if_fail (self != NULL);
	g_return_if_fail (contact != NULL);
	g_return_if_fail (im_fds != NULL);
	_tmp0_ = _edsf_persona_get_im_eds_map ();
	im_eds_map = _tmp0_;
	_tmp1_ = im_eds_map;
	_tmp2_ = g_hash_table_get_values (_tmp1_);
	{
		GList* field_id_collection = NULL;
		GList* field_id_it = NULL;
		field_id_collection = _tmp2_;
		for (field_id_it = field_id_collection; field_id_it != NULL; field_id_it = field_id_it->next) {
			EContactField field_id = 0;
			field_id = (EContactField) ((gintptr) field_id_it->data);
			{
				EContact* _tmp3_;
				EContactField _tmp4_;
				const gchar* _tmp5_ = NULL;
				_tmp3_ = contact;
				_tmp4_ = field_id;
				_tmp5_ = e_contact_vcard_attribute (_tmp4_);
				e_vcard_remove_attributes ((EVCard*) _tmp3_, NULL, _tmp5_);
			}
		}
		_g_list_free0 (field_id_collection);
	}
	{
		GeeIterator* _proto_it = NULL;
		GeeMultiMap* _tmp6_;
		GeeSet* _tmp7_ = NULL;
		GeeSet* _tmp8_;
		GeeIterator* _tmp9_ = NULL;
		GeeIterator* _tmp10_;
		_tmp6_ = im_fds;
		_tmp7_ = gee_multi_map_get_keys (_tmp6_);
		_tmp8_ = _tmp7_;
		_tmp9_ = gee_iterable_iterator ((GeeIterable*) _tmp8_);
		_tmp10_ = _tmp9_;
		_g_object_unref0 (_tmp8_);
		_proto_it = _tmp10_;
		while (TRUE) {
			GeeIterator* _tmp11_;
			gboolean _tmp12_ = FALSE;
			gchar* proto = NULL;
			GeeIterator* _tmp13_;
			gpointer _tmp14_ = NULL;
			GList* attributes = NULL;
			gchar* attrib_name = NULL;
			const gchar* _tmp15_;
			gchar* _tmp16_;
			gchar* _tmp17_;
			gchar* _tmp18_ = NULL;
			gchar* _tmp19_;
			gboolean added = FALSE;
			gboolean _tmp37_;
			_tmp11_ = _proto_it;
			_tmp12_ = gee_iterator_next (_tmp11_);
			if (!_tmp12_) {
				break;
			}
			_tmp13_ = _proto_it;
			_tmp14_ = gee_iterator_get (_tmp13_);
			proto = (gchar*) _tmp14_;
			attributes = NULL;
			_tmp15_ = proto;
			_tmp16_ = g_strconcat ("X-", _tmp15_, NULL);
			_tmp17_ = _tmp16_;
			_tmp18_ = g_utf8_strup (_tmp17_, (gssize) (-1));
			_tmp19_ = _tmp18_;
			_g_free0 (_tmp17_);
			attrib_name = _tmp19_;
			added = FALSE;
			{
				GeeIterator* _im_fd_it = NULL;
				GeeMultiMap* _tmp20_;
				const gchar* _tmp21_;
				GeeCollection* _tmp22_ = NULL;
				GeeCollection* _tmp23_;
				GeeIterator* _tmp24_ = NULL;
				GeeIterator* _tmp25_;
				_tmp20_ = im_fds;
				_tmp21_ = proto;
				_tmp22_ = gee_multi_map_get (_tmp20_, _tmp21_);
				_tmp23_ = _tmp22_;
				_tmp24_ = gee_iterable_iterator ((GeeIterable*) _tmp23_);
				_tmp25_ = _tmp24_;
				_g_object_unref0 (_tmp23_);
				_im_fd_it = _tmp25_;
				while (TRUE) {
					GeeIterator* _tmp26_;
					gboolean _tmp27_ = FALSE;
					FolksImFieldDetails* im_fd = NULL;
					GeeIterator* _tmp28_;
					gpointer _tmp29_ = NULL;
					EVCardAttribute* attr_n = NULL;
					const gchar* _tmp30_;
					EVCardAttribute* _tmp31_;
					EVCardAttribute* _tmp32_;
					FolksImFieldDetails* _tmp33_;
					gconstpointer _tmp34_;
					const gchar* _tmp35_;
					EVCardAttribute* _tmp36_;
					_tmp26_ = _im_fd_it;
					_tmp27_ = gee_iterator_next (_tmp26_);
					if (!_tmp27_) {
						break;
					}
					_tmp28_ = _im_fd_it;
					_tmp29_ = gee_iterator_get (_tmp28_);
					im_fd = (FolksImFieldDetails*) _tmp29_;
					_tmp30_ = attrib_name;
					_tmp31_ = e_vcard_attribute_new (NULL, _tmp30_);
					attr_n = _tmp31_;
					_tmp32_ = attr_n;
					_tmp33_ = im_fd;
					_tmp34_ = folks_abstract_field_details_get_value ((FolksAbstractFieldDetails*) _tmp33_);
					_tmp35_ = _tmp34_;
					e_vcard_attribute_add_value (_tmp32_, (const gchar*) _tmp35_);
					_tmp36_ = attr_n;
					attr_n = NULL;
					attributes = g_list_prepend (attributes, _tmp36_);
					added = TRUE;
					__vala_EVCardAttribute_free0 (attr_n);
					_g_object_unref0 (im_fd);
				}
				_g_object_unref0 (_im_fd_it);
			}
			_tmp37_ = added;
			if (_tmp37_) {
				EContactField field_id_t = 0;
				GHashTable* _tmp38_;
				const gchar* _tmp39_;
				gconstpointer _tmp40_ = NULL;
				EContact* _tmp41_;
				EContactField _tmp42_;
				GList* _tmp43_;
				_tmp38_ = im_eds_map;
				_tmp39_ = proto;
				_tmp40_ = g_hash_table_lookup (_tmp38_, _tmp39_);
				field_id_t = (EContactField) ((gintptr) _tmp40_);
				_tmp41_ = contact;
				_tmp42_ = field_id_t;
				_tmp43_ = attributes;
				e_contact_set_attributes (_tmp41_, _tmp42_, _tmp43_);
			}
			_g_free0 (attrib_name);
			__g_list_free___vala_EVCardAttribute_free0_0 (attributes);
			_g_free0 (proto);
		}
		_g_object_unref0 (_proto_it);
	}
	_g_hash_table_unref0 (im_eds_map);
}


static void _edsf_persona_store_set_groups_data_free (gpointer _data) {
	EdsfPersonaStoreSetGroupsData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->persona);
	_g_object_unref0 (_data_->groups);
	_g_object_unref0 (_data_->self);
	g_slice_free (EdsfPersonaStoreSetGroupsData, _data_);
}


void _edsf_persona_store_set_groups (EdsfPersonaStore* self, EdsfPersona* persona, GeeSet* groups, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	EdsfPersonaStoreSetGroupsData* _data_;
	EdsfPersonaStore* _tmp0_;
	EdsfPersona* _tmp1_;
	EdsfPersona* _tmp2_;
	GeeSet* _tmp3_;
	GeeSet* _tmp4_;
	_data_ = g_slice_new0 (EdsfPersonaStoreSetGroupsData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, _edsf_persona_store_set_groups);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, _edsf_persona_store_set_groups_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	_tmp1_ = persona;
	_tmp2_ = _g_object_ref0 (_tmp1_);
	_g_object_unref0 (_data_->persona);
	_data_->persona = _tmp2_;
	_tmp3_ = groups;
	_tmp4_ = _g_object_ref0 (_tmp3_);
	_g_object_unref0 (_data_->groups);
	_data_->groups = _tmp4_;
	_edsf_persona_store_set_groups_co (_data_);
}


void _edsf_persona_store_set_groups_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error) {
	EdsfPersonaStoreSetGroupsData* _data_;
	if (g_simple_async_result_propagate_error (G_SIMPLE_ASYNC_RESULT (_res_), error)) {
		return;
	}
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


static void _edsf_persona_store_set_groups_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	EdsfPersonaStoreSetGroupsData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	_edsf_persona_store_set_groups_co (_data_);
}


static gboolean _edsf_persona_store_set_groups_co (EdsfPersonaStoreSetGroupsData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_tmp0_ = _data_->self->priv->_always_writeable_properties;
	_data_->_tmp0__length1 = _data_->self->priv->_always_writeable_properties_length1;
	if (!_vala_string_array_contains (_data_->_tmp0_, _data_->_tmp0__length1, "groups")) {
		_data_->_tmp1_ = NULL;
		_data_->_tmp1_ = _ ("Groups are not writeable on this contact.");
		_data_->_tmp2_ = g_error_new_literal (FOLKS_PROPERTY_ERROR, FOLKS_PROPERTY_ERROR_NOT_WRITEABLE, _data_->_tmp1_);
		_data_->_inner_error_ = _data_->_tmp2_;
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	_data_->_tmp3_ = _data_->groups;
	_data_->_tmp4_ = _data_->persona;
	_data_->_tmp5_ = folks_group_details_get_groups ((FolksGroupDetails*) _data_->_tmp4_);
	_data_->_tmp6_ = _data_->_tmp5_;
	_data_->_tmp7_ = FALSE;
	_data_->_tmp7_ = folks_internal_equal_sets (G_TYPE_STRING, (GBoxedCopyFunc) g_strdup, g_free, _data_->_tmp3_, _data_->_tmp6_);
	if (_data_->_tmp7_) {
		if (_data_->_state_ == 0) {
			g_simple_async_result_complete_in_idle (_data_->_async_result);
		} else {
			g_simple_async_result_complete (_data_->_async_result);
		}
		g_object_unref (_data_->_async_result);
		return FALSE;
	}
	_data_->_tmp8_ = _data_->persona;
	_data_->_tmp9_ = edsf_persona_get_contact (_data_->_tmp8_);
	_data_->_tmp10_ = _data_->_tmp9_;
	_data_->_tmp11_ = _data_->groups;
	_data_->_tmp12_ = _data_->persona;
	_data_->_tmp13_ = folks_favourite_details_get_is_favourite ((FolksFavouriteDetails*) _data_->_tmp12_);
	_data_->_tmp14_ = _data_->_tmp13_;
	_edsf_persona_store_set_contact_groups (_data_->self, _data_->_tmp10_, _data_->_tmp11_, _data_->_tmp14_);
	_data_->_tmp15_ = _data_->persona;
	_data_->_state_ = 1;
	_edsf_persona_store_commit_modified_property (_data_->self, _data_->_tmp15_, "groups", _edsf_persona_store_set_groups_ready, _data_);
	return FALSE;
	_state_1:
	_edsf_persona_store_commit_modified_property_finish (_data_->self, _data_->_res_, &_data_->_inner_error_);
	if (_data_->_inner_error_ != NULL) {
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static void _edsf_persona_store_set_system_groups_data_free (gpointer _data) {
	EdsfPersonaStoreSetSystemGroupsData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->persona);
	_g_object_unref0 (_data_->system_groups);
	_g_object_unref0 (_data_->self);
	g_slice_free (EdsfPersonaStoreSetSystemGroupsData, _data_);
}


void _edsf_persona_store_set_system_groups (EdsfPersonaStore* self, EdsfPersona* persona, GeeSet* system_groups, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	EdsfPersonaStoreSetSystemGroupsData* _data_;
	EdsfPersonaStore* _tmp0_;
	EdsfPersona* _tmp1_;
	EdsfPersona* _tmp2_;
	GeeSet* _tmp3_;
	GeeSet* _tmp4_;
	_data_ = g_slice_new0 (EdsfPersonaStoreSetSystemGroupsData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, _edsf_persona_store_set_system_groups);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, _edsf_persona_store_set_system_groups_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	_tmp1_ = persona;
	_tmp2_ = _g_object_ref0 (_tmp1_);
	_g_object_unref0 (_data_->persona);
	_data_->persona = _tmp2_;
	_tmp3_ = system_groups;
	_tmp4_ = _g_object_ref0 (_tmp3_);
	_g_object_unref0 (_data_->system_groups);
	_data_->system_groups = _tmp4_;
	_edsf_persona_store_set_system_groups_co (_data_);
}


void _edsf_persona_store_set_system_groups_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error) {
	EdsfPersonaStoreSetSystemGroupsData* _data_;
	if (g_simple_async_result_propagate_error (G_SIMPLE_ASYNC_RESULT (_res_), error)) {
		return;
	}
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


static void _edsf_persona_store_set_system_groups_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	EdsfPersonaStoreSetSystemGroupsData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	_edsf_persona_store_set_system_groups_co (_data_);
}


static gboolean _edsf_persona_store_set_system_groups_co (EdsfPersonaStoreSetSystemGroupsData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_tmp0_ = FALSE;
	_data_->_tmp0_ = _edsf_persona_store_is_google_contacts_address_book (_data_->self);
	if (!_data_->_tmp0_) {
		_data_->_tmp1_ = NULL;
		_data_->_tmp1_ = _ ("My Contacts is only available for Google Contacts");
		_data_->_tmp2_ = g_error_new_literal (FOLKS_PROPERTY_ERROR, FOLKS_PROPERTY_ERROR_NOT_WRITEABLE, _data_->_tmp1_);
		_data_->_inner_error_ = _data_->_tmp2_;
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	_data_->_tmp3_ = _data_->system_groups;
	_data_->_tmp4_ = _data_->persona;
	_data_->_tmp5_ = edsf_persona_get_system_groups (_data_->_tmp4_);
	_data_->_tmp6_ = _data_->_tmp5_;
	_data_->_tmp7_ = FALSE;
	_data_->_tmp7_ = folks_internal_equal_sets (G_TYPE_STRING, (GBoxedCopyFunc) g_strdup, g_free, _data_->_tmp3_, _data_->_tmp6_);
	if (_data_->_tmp7_) {
		if (_data_->_state_ == 0) {
			g_simple_async_result_complete_in_idle (_data_->_async_result);
		} else {
			g_simple_async_result_complete (_data_->_async_result);
		}
		g_object_unref (_data_->_async_result);
		return FALSE;
	}
	_data_->_tmp8_ = _data_->persona;
	_data_->_tmp9_ = edsf_persona_get_contact (_data_->_tmp8_);
	_data_->_tmp10_ = _data_->_tmp9_;
	_data_->_tmp11_ = _data_->system_groups;
	_edsf_persona_store_set_contact_system_groups (_data_->self, _data_->_tmp10_, _data_->_tmp11_);
	_data_->_tmp12_ = _data_->persona;
	_data_->_state_ = 1;
	_edsf_persona_store_commit_modified_property (_data_->self, _data_->_tmp12_, "system-groups", _edsf_persona_store_set_system_groups_ready, _data_);
	return FALSE;
	_state_1:
	_edsf_persona_store_commit_modified_property_finish (_data_->self, _data_->_res_, &_data_->_inner_error_);
	if (_data_->_inner_error_ != NULL) {
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static void _g_free0_ (gpointer var) {
	var = (g_free (var), NULL);
}


static void _g_list_free__g_free0_ (GList* self) {
	g_list_foreach (self, (GFunc) _g_free0_, NULL);
	g_list_free (self);
}


static void _edsf_persona_store_set_contact_groups (EdsfPersonaStore* self, EContact* contact, GeeSet* groups, gboolean is_favourite) {
	GList* categories = NULL;
	gboolean _tmp13_ = FALSE;
	gboolean _tmp14_;
	gboolean _tmp16_;
	EContact* _tmp18_;
	GList* _tmp19_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (contact != NULL);
	g_return_if_fail (groups != NULL);
	categories = NULL;
	{
		GeeIterator* _group_it = NULL;
		GeeSet* _tmp0_;
		GeeIterator* _tmp1_ = NULL;
		_tmp0_ = groups;
		_tmp1_ = gee_iterable_iterator ((GeeIterable*) _tmp0_);
		_group_it = _tmp1_;
		while (TRUE) {
			GeeIterator* _tmp2_;
			gboolean _tmp3_ = FALSE;
			gchar* group = NULL;
			GeeIterator* _tmp4_;
			gpointer _tmp5_ = NULL;
			const gchar* _tmp6_;
			const gchar* _tmp11_;
			gchar* _tmp12_;
			_tmp2_ = _group_it;
			_tmp3_ = gee_iterator_next (_tmp2_);
			if (!_tmp3_) {
				break;
			}
			_tmp4_ = _group_it;
			_tmp5_ = gee_iterator_get (_tmp4_);
			group = (gchar*) _tmp5_;
			_tmp6_ = group;
			if (g_strcmp0 (_tmp6_, "") == 0) {
				_g_free0 (group);
				continue;
			} else {
				gboolean _tmp7_ = FALSE;
				gboolean _tmp8_ = FALSE;
				gboolean _tmp10_;
				_tmp8_ = _edsf_persona_store_is_google_contacts_address_book (self);
				if (_tmp8_) {
					const gchar* _tmp9_;
					_tmp9_ = group;
					_tmp7_ = g_strcmp0 (_tmp9_, EDSF_PERSONA_STORE_android_favourite_group_name) == 0;
				} else {
					_tmp7_ = FALSE;
				}
				_tmp10_ = _tmp7_;
				if (_tmp10_) {
					_g_free0 (group);
					continue;
				}
			}
			_tmp11_ = group;
			_tmp12_ = g_strdup (_tmp11_);
			categories = g_list_prepend (categories, _tmp12_);
			_g_free0 (group);
		}
		_g_object_unref0 (_group_it);
	}
	_tmp14_ = is_favourite;
	if (_tmp14_) {
		gboolean _tmp15_ = FALSE;
		_tmp15_ = _edsf_persona_store_is_google_contacts_address_book (self);
		_tmp13_ = _tmp15_;
	} else {
		_tmp13_ = FALSE;
	}
	_tmp16_ = _tmp13_;
	if (_tmp16_) {
		gchar* _tmp17_;
		_tmp17_ = g_strdup (EDSF_PERSONA_STORE_android_favourite_group_name);
		categories = g_list_prepend (categories, _tmp17_);
	}
	_tmp18_ = contact;
	_tmp19_ = categories;
	e_contact_set (_tmp18_, E_CONTACT_CATEGORY_LIST, _tmp19_);
	__g_list_free__g_free0_0 (categories);
}


static EVCardAttribute* _vala_EVCardAttribute_copy (EVCardAttribute* self) {
	return g_boxed_copy (e_vcard_attribute_get_type (), self);
}


static gpointer __vala_EVCardAttribute_copy0 (gpointer self) {
	return self ? _vala_EVCardAttribute_copy (self) : NULL;
}


static void _edsf_persona_store_set_contact_system_groups (EdsfPersonaStore* self, EContact* contact, GeeSet* system_groups) {
	EVCard* vcard = NULL;
	EContact* _tmp0_;
	EVCard* _tmp1_;
	EVCardAttribute* prev_attr = NULL;
	EVCard* _tmp2_;
	EVCardAttribute* _tmp3_ = NULL;
	EVCardAttribute* _tmp4_;
	EVCardAttribute* new_attr = NULL;
	EVCardAttribute* _tmp7_;
	EVCard* _tmp20_;
	EVCardAttribute* _tmp21_;
	EVCardAttribute* _tmp22_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (contact != NULL);
	g_return_if_fail (system_groups != NULL);
	_tmp0_ = contact;
	_tmp1_ = _g_object_ref0 (G_TYPE_CHECK_INSTANCE_CAST (_tmp0_, e_vcard_get_type (), EVCard));
	vcard = _tmp1_;
	_tmp2_ = vcard;
	_tmp3_ = e_vcard_get_attribute (_tmp2_, "X-GOOGLE-SYSTEM-GROUP-IDS");
	prev_attr = _tmp3_;
	_tmp4_ = prev_attr;
	if (_tmp4_ != NULL) {
		EContact* _tmp5_;
		EVCardAttribute* _tmp6_;
		_tmp5_ = contact;
		_tmp6_ = prev_attr;
		e_vcard_remove_attribute ((EVCard*) _tmp5_, _tmp6_);
	}
	_tmp7_ = e_vcard_attribute_new ("", "X-GOOGLE-SYSTEM-GROUP-IDS");
	new_attr = _tmp7_;
	{
		GeeIterator* _group_it = NULL;
		GeeSet* _tmp8_;
		GeeIterator* _tmp9_ = NULL;
		_tmp8_ = system_groups;
		_tmp9_ = gee_iterable_iterator ((GeeIterable*) _tmp8_);
		_group_it = _tmp9_;
		while (TRUE) {
			GeeIterator* _tmp10_;
			gboolean _tmp11_ = FALSE;
			gchar* group = NULL;
			GeeIterator* _tmp12_;
			gpointer _tmp13_ = NULL;
			gboolean _tmp14_ = FALSE;
			const gchar* _tmp15_;
			gboolean _tmp17_;
			EVCardAttribute* _tmp18_;
			const gchar* _tmp19_;
			_tmp10_ = _group_it;
			_tmp11_ = gee_iterator_next (_tmp10_);
			if (!_tmp11_) {
				break;
			}
			_tmp12_ = _group_it;
			_tmp13_ = gee_iterator_get (_tmp12_);
			group = (gchar*) _tmp13_;
			_tmp15_ = group;
			if (_tmp15_ == NULL) {
				_tmp14_ = TRUE;
			} else {
				const gchar* _tmp16_;
				_tmp16_ = group;
				_tmp14_ = g_strcmp0 (_tmp16_, "") == 0;
			}
			_tmp17_ = _tmp14_;
			if (_tmp17_) {
				_g_free0 (group);
				continue;
			}
			_tmp18_ = new_attr;
			_tmp19_ = group;
			e_vcard_attribute_add_value (_tmp18_, _tmp19_);
			_g_free0 (group);
		}
		_g_object_unref0 (_group_it);
	}
	_tmp20_ = vcard;
	_tmp21_ = new_attr;
	_tmp22_ = __vala_EVCardAttribute_copy0 (_tmp21_);
	e_vcard_add_attribute (_tmp20_, _tmp22_);
	__vala_EVCardAttribute_free0 (new_attr);
	_g_object_unref0 (vcard);
}


static void _edsf_persona_store_set_gender_data_free (gpointer _data) {
	EdsfPersonaStoreSetGenderData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->persona);
	_g_object_unref0 (_data_->self);
	g_slice_free (EdsfPersonaStoreSetGenderData, _data_);
}


void _edsf_persona_store_set_gender (EdsfPersonaStore* self, EdsfPersona* persona, FolksGender gender, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	EdsfPersonaStoreSetGenderData* _data_;
	EdsfPersonaStore* _tmp0_;
	EdsfPersona* _tmp1_;
	EdsfPersona* _tmp2_;
	FolksGender _tmp3_;
	_data_ = g_slice_new0 (EdsfPersonaStoreSetGenderData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, _edsf_persona_store_set_gender);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, _edsf_persona_store_set_gender_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	_tmp1_ = persona;
	_tmp2_ = _g_object_ref0 (_tmp1_);
	_g_object_unref0 (_data_->persona);
	_data_->persona = _tmp2_;
	_tmp3_ = gender;
	_data_->gender = _tmp3_;
	_edsf_persona_store_set_gender_co (_data_);
}


void _edsf_persona_store_set_gender_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error) {
	EdsfPersonaStoreSetGenderData* _data_;
	if (g_simple_async_result_propagate_error (G_SIMPLE_ASYNC_RESULT (_res_), error)) {
		return;
	}
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


static void _edsf_persona_store_set_gender_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	EdsfPersonaStoreSetGenderData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	_edsf_persona_store_set_gender_co (_data_);
}


static gboolean _edsf_persona_store_set_gender_co (EdsfPersonaStoreSetGenderData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_tmp0_ = _data_->self->priv->_always_writeable_properties;
	_data_->_tmp0__length1 = _data_->self->priv->_always_writeable_properties_length1;
	if (!_vala_string_array_contains (_data_->_tmp0_, _data_->_tmp0__length1, "gender")) {
		_data_->_tmp1_ = NULL;
		_data_->_tmp1_ = _ ("Gender is not writeable on this contact.");
		_data_->_tmp2_ = g_error_new_literal (FOLKS_PROPERTY_ERROR, FOLKS_PROPERTY_ERROR_NOT_WRITEABLE, _data_->_tmp1_);
		_data_->_inner_error_ = _data_->_tmp2_;
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	_data_->_tmp3_ = _data_->gender;
	_data_->_tmp4_ = _data_->persona;
	_data_->_tmp5_ = folks_gender_details_get_gender ((FolksGenderDetails*) _data_->_tmp4_);
	_data_->_tmp6_ = _data_->_tmp5_;
	if (_data_->_tmp3_ == _data_->_tmp6_) {
		if (_data_->_state_ == 0) {
			g_simple_async_result_complete_in_idle (_data_->_async_result);
		} else {
			g_simple_async_result_complete (_data_->_async_result);
		}
		g_object_unref (_data_->_async_result);
		return FALSE;
	}
	_data_->_tmp7_ = _data_->persona;
	_data_->_tmp8_ = edsf_persona_get_contact (_data_->_tmp7_);
	_data_->_tmp9_ = _data_->_tmp8_;
	_data_->_tmp10_ = _data_->gender;
	_edsf_persona_store_set_contact_gender (_data_->self, _data_->_tmp9_, _data_->_tmp10_);
	_data_->_tmp11_ = _data_->persona;
	_data_->_state_ = 1;
	_edsf_persona_store_commit_modified_property (_data_->self, _data_->_tmp11_, "gender", _edsf_persona_store_set_gender_ready, _data_);
	return FALSE;
	_state_1:
	_edsf_persona_store_commit_modified_property_finish (_data_->self, _data_->_res_, &_data_->_inner_error_);
	if (_data_->_inner_error_ != NULL) {
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static void _edsf_persona_store_set_contact_gender (EdsfPersonaStore* self, EContact* contact, FolksGender gender) {
	EContact* _tmp0_;
	EVCardAttribute* new_attr = NULL;
	EVCardAttribute* _tmp1_;
	FolksGender _tmp2_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (contact != NULL);
	_tmp0_ = contact;
	_edsf_persona_store_remove_attribute (self, _tmp0_, EDSF_PERSONA_gender_attribute_name);
	_tmp1_ = e_vcard_attribute_new (NULL, EDSF_PERSONA_gender_attribute_name);
	new_attr = _tmp1_;
	_tmp2_ = gender;
	switch (_tmp2_) {
		case FOLKS_GENDER_UNSPECIFIED:
		{
			break;
		}
		case FOLKS_GENDER_MALE:
		{
			EVCardAttribute* _tmp3_;
			EContact* _tmp4_;
			EVCardAttribute* _tmp5_;
			_tmp3_ = new_attr;
			e_vcard_attribute_add_value (_tmp3_, EDSF_PERSONA_gender_male);
			_tmp4_ = contact;
			_tmp5_ = new_attr;
			new_attr = NULL;
			e_vcard_add_attribute ((EVCard*) _tmp4_, _tmp5_);
			break;
		}
		case FOLKS_GENDER_FEMALE:
		{
			EVCardAttribute* _tmp6_;
			EContact* _tmp7_;
			EVCardAttribute* _tmp8_;
			_tmp6_ = new_attr;
			e_vcard_attribute_add_value (_tmp6_, EDSF_PERSONA_gender_female);
			_tmp7_ = contact;
			_tmp8_ = new_attr;
			new_attr = NULL;
			e_vcard_add_attribute ((EVCard*) _tmp7_, _tmp8_);
			break;
		}
		default:
		break;
	}
	__vala_EVCardAttribute_free0 (new_attr);
}


static void _edsf_persona_store_set_anti_links_data_free (gpointer _data) {
	EdsfPersonaStoreSetAntiLinksData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->persona);
	_g_object_unref0 (_data_->anti_links);
	_g_object_unref0 (_data_->self);
	g_slice_free (EdsfPersonaStoreSetAntiLinksData, _data_);
}


void _edsf_persona_store_set_anti_links (EdsfPersonaStore* self, EdsfPersona* persona, GeeSet* anti_links, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	EdsfPersonaStoreSetAntiLinksData* _data_;
	EdsfPersonaStore* _tmp0_;
	EdsfPersona* _tmp1_;
	EdsfPersona* _tmp2_;
	GeeSet* _tmp3_;
	GeeSet* _tmp4_;
	_data_ = g_slice_new0 (EdsfPersonaStoreSetAntiLinksData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, _edsf_persona_store_set_anti_links);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, _edsf_persona_store_set_anti_links_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	_tmp1_ = persona;
	_tmp2_ = _g_object_ref0 (_tmp1_);
	_g_object_unref0 (_data_->persona);
	_data_->persona = _tmp2_;
	_tmp3_ = anti_links;
	_tmp4_ = _g_object_ref0 (_tmp3_);
	_g_object_unref0 (_data_->anti_links);
	_data_->anti_links = _tmp4_;
	_edsf_persona_store_set_anti_links_co (_data_);
}


void _edsf_persona_store_set_anti_links_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error) {
	EdsfPersonaStoreSetAntiLinksData* _data_;
	if (g_simple_async_result_propagate_error (G_SIMPLE_ASYNC_RESULT (_res_), error)) {
		return;
	}
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


static void _edsf_persona_store_set_anti_links_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	EdsfPersonaStoreSetAntiLinksData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	_edsf_persona_store_set_anti_links_co (_data_);
}


static gboolean _edsf_persona_store_set_anti_links_co (EdsfPersonaStoreSetAntiLinksData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_tmp0_ = _data_->self->priv->_always_writeable_properties;
	_data_->_tmp0__length1 = _data_->self->priv->_always_writeable_properties_length1;
	if (!_vala_string_array_contains (_data_->_tmp0_, _data_->_tmp0__length1, "anti-links")) {
		_data_->_tmp1_ = NULL;
		_data_->_tmp1_ = _ ("Anti-links are not writeable on this contact.");
		_data_->_tmp2_ = g_error_new_literal (FOLKS_PROPERTY_ERROR, FOLKS_PROPERTY_ERROR_NOT_WRITEABLE, _data_->_tmp1_);
		_data_->_inner_error_ = _data_->_tmp2_;
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	_data_->_tmp3_ = _data_->anti_links;
	_data_->_tmp4_ = _data_->persona;
	_data_->_tmp5_ = folks_anti_linkable_get_anti_links ((FolksAntiLinkable*) _data_->_tmp4_);
	_data_->_tmp6_ = _data_->_tmp5_;
	_data_->_tmp7_ = FALSE;
	_data_->_tmp7_ = folks_internal_equal_sets (G_TYPE_STRING, (GBoxedCopyFunc) g_strdup, g_free, _data_->_tmp3_, _data_->_tmp6_);
	if (_data_->_tmp7_) {
		if (_data_->_state_ == 0) {
			g_simple_async_result_complete_in_idle (_data_->_async_result);
		} else {
			g_simple_async_result_complete (_data_->_async_result);
		}
		g_object_unref (_data_->_async_result);
		return FALSE;
	}
	_data_->_tmp8_ = _data_->persona;
	_data_->_tmp9_ = edsf_persona_get_contact (_data_->_tmp8_);
	_data_->_tmp10_ = _data_->_tmp9_;
	_data_->_tmp11_ = _data_->anti_links;
	_edsf_persona_store_set_contact_anti_links (_data_->self, _data_->_tmp10_, _data_->_tmp11_);
	_data_->_tmp12_ = _data_->persona;
	_data_->_state_ = 1;
	_edsf_persona_store_commit_modified_property (_data_->self, _data_->_tmp12_, "anti-links", _edsf_persona_store_set_anti_links_ready, _data_);
	return FALSE;
	_state_1:
	_edsf_persona_store_commit_modified_property_finish (_data_->self, _data_->_res_, &_data_->_inner_error_);
	if (_data_->_inner_error_ != NULL) {
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static void _edsf_persona_store_set_contact_anti_links (EdsfPersonaStore* self, EContact* contact, GeeSet* anti_links) {
	EVCard* vcard = NULL;
	EContact* _tmp0_;
	EVCard* _tmp1_;
	EVCard* _tmp2_;
	gchar* persona_uid = NULL;
	const gchar* _tmp3_;
	const gchar* _tmp4_;
	EContact* _tmp5_;
	gchar* _tmp6_ = NULL;
	gchar* _tmp7_;
	gchar* _tmp8_;
	gchar* _tmp9_ = NULL;
	gchar* _tmp10_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (contact != NULL);
	g_return_if_fail (anti_links != NULL);
	_tmp0_ = contact;
	_tmp1_ = _g_object_ref0 (G_TYPE_CHECK_INSTANCE_CAST (_tmp0_, e_vcard_get_type (), EVCard));
	vcard = _tmp1_;
	_tmp2_ = vcard;
	e_vcard_remove_attributes (_tmp2_, NULL, EDSF_PERSONA_STORE_anti_links_attribute_name);
	_tmp3_ = folks_persona_store_get_id ((FolksPersonaStore*) self);
	_tmp4_ = _tmp3_;
	_tmp5_ = contact;
	g_object_get (_tmp5_, "id", &_tmp6_, NULL);
	_tmp7_ = _tmp6_;
	_tmp8_ = _tmp7_;
	_tmp9_ = folks_persona_build_uid (BACKEND_NAME, _tmp4_, _tmp8_);
	_tmp10_ = _tmp9_;
	_g_free0 (_tmp8_);
	persona_uid = _tmp10_;
	{
		GeeIterator* _anti_link_uid_it = NULL;
		GeeSet* _tmp11_;
		GeeIterator* _tmp12_ = NULL;
		_tmp11_ = anti_links;
		_tmp12_ = gee_iterable_iterator ((GeeIterable*) _tmp11_);
		_anti_link_uid_it = _tmp12_;
		while (TRUE) {
			GeeIterator* _tmp13_;
			gboolean _tmp14_ = FALSE;
			gchar* anti_link_uid = NULL;
			GeeIterator* _tmp15_;
			gpointer _tmp16_ = NULL;
			const gchar* _tmp17_;
			const gchar* _tmp18_;
			EVCardAttribute* attr = NULL;
			EVCardAttribute* _tmp19_;
			EVCardAttribute* _tmp20_;
			const gchar* _tmp21_;
			EContact* _tmp22_;
			EVCardAttribute* _tmp23_;
			_tmp13_ = _anti_link_uid_it;
			_tmp14_ = gee_iterator_next (_tmp13_);
			if (!_tmp14_) {
				break;
			}
			_tmp15_ = _anti_link_uid_it;
			_tmp16_ = gee_iterator_get (_tmp15_);
			anti_link_uid = (gchar*) _tmp16_;
			_tmp17_ = anti_link_uid;
			_tmp18_ = persona_uid;
			if (g_strcmp0 (_tmp17_, _tmp18_) == 0) {
				_g_free0 (anti_link_uid);
				continue;
			}
			_tmp19_ = e_vcard_attribute_new (NULL, EDSF_PERSONA_STORE_anti_links_attribute_name);
			attr = _tmp19_;
			_tmp20_ = attr;
			_tmp21_ = anti_link_uid;
			e_vcard_attribute_add_value (_tmp20_, _tmp21_);
			_tmp22_ = contact;
			_tmp23_ = attr;
			attr = NULL;
			e_vcard_add_attribute ((EVCard*) _tmp22_, _tmp23_);
			__vala_EVCardAttribute_free0 (attr);
			_g_free0 (anti_link_uid);
		}
		_g_object_unref0 (_anti_link_uid_it);
	}
	_g_free0 (persona_uid);
	_g_object_unref0 (vcard);
}


static void _edsf_persona_store_set_location_data_free (gpointer _data) {
	EdsfPersonaStoreSetLocationData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->persona);
	_g_object_unref0 (_data_->location);
	_g_object_unref0 (_data_->self);
	g_slice_free (EdsfPersonaStoreSetLocationData, _data_);
}


void _edsf_persona_store_set_location (EdsfPersonaStore* self, EdsfPersona* persona, FolksLocation* location, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	EdsfPersonaStoreSetLocationData* _data_;
	EdsfPersonaStore* _tmp0_;
	EdsfPersona* _tmp1_;
	EdsfPersona* _tmp2_;
	FolksLocation* _tmp3_;
	FolksLocation* _tmp4_;
	_data_ = g_slice_new0 (EdsfPersonaStoreSetLocationData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, _edsf_persona_store_set_location);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, _edsf_persona_store_set_location_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	_tmp1_ = persona;
	_tmp2_ = _g_object_ref0 (_tmp1_);
	_g_object_unref0 (_data_->persona);
	_data_->persona = _tmp2_;
	_tmp3_ = location;
	_tmp4_ = _g_object_ref0 (_tmp3_);
	_g_object_unref0 (_data_->location);
	_data_->location = _tmp4_;
	_edsf_persona_store_set_location_co (_data_);
}


void _edsf_persona_store_set_location_finish (EdsfPersonaStore* self, GAsyncResult* _res_, GError** error) {
	EdsfPersonaStoreSetLocationData* _data_;
	if (g_simple_async_result_propagate_error (G_SIMPLE_ASYNC_RESULT (_res_), error)) {
		return;
	}
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


static void _edsf_persona_store_set_location_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	EdsfPersonaStoreSetLocationData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	_edsf_persona_store_set_location_co (_data_);
}


static gboolean _edsf_persona_store_set_location_co (EdsfPersonaStoreSetLocationData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_tmp0_ = _data_->self->priv->_always_writeable_properties;
	_data_->_tmp0__length1 = _data_->self->priv->_always_writeable_properties_length1;
	if (!_vala_string_array_contains (_data_->_tmp0_, _data_->_tmp0__length1, "location")) {
		_data_->_tmp1_ = NULL;
		_data_->_tmp1_ = _ ("Location is not writeable on this contact.");
		_data_->_tmp2_ = g_error_new_literal (FOLKS_PROPERTY_ERROR, FOLKS_PROPERTY_ERROR_NOT_WRITEABLE, _data_->_tmp1_);
		_data_->_inner_error_ = _data_->_tmp2_;
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	_data_->_tmp3_ = _data_->persona;
	_data_->_tmp4_ = edsf_persona_get_contact (_data_->_tmp3_);
	_data_->_tmp5_ = _data_->_tmp4_;
	_data_->_tmp6_ = _data_->location;
	_edsf_persona_store_set_contact_location (_data_->self, _data_->_tmp5_, _data_->_tmp6_);
	_data_->_tmp7_ = _data_->persona;
	_data_->_state_ = 1;
	_edsf_persona_store_commit_modified_property (_data_->self, _data_->_tmp7_, "location", _edsf_persona_store_set_location_ready, _data_);
	return FALSE;
	_state_1:
	_edsf_persona_store_commit_modified_property_finish (_data_->self, _data_->_res_, &_data_->_inner_error_);
	if (_data_->_inner_error_ != NULL) {
		if (_data_->_inner_error_->domain == FOLKS_PROPERTY_ERROR) {
			g_simple_async_result_set_from_error (_data_->_async_result, _data_->_inner_error_);
			g_error_free (_data_->_inner_error_);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		} else {
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
			g_clear_error (&_data_->_inner_error_);
			return FALSE;
		}
	}
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static void _vala_EContactGeo_free (EContactGeo* self) {
	g_boxed_free (e_contact_geo_get_type (), self);
}


static void _edsf_persona_store_set_contact_location (EdsfPersonaStore* self, EContact* contact, FolksLocation* location) {
	FolksLocation* _tmp0_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (contact != NULL);
	_tmp0_ = location;
	if (_tmp0_ == NULL) {
		EContact* _tmp1_;
		_tmp1_ = contact;
		_edsf_persona_store_remove_attribute (self, _tmp1_, "GEO");
	} else {
		EContactGeo* geo = NULL;
		EContactGeo* _tmp2_;
		EContactGeo* _tmp3_;
		FolksLocation* _tmp4_;
		gdouble _tmp5_;
		EContactGeo* _tmp6_;
		FolksLocation* _tmp7_;
		gdouble _tmp8_;
		EContact* _tmp9_;
		EContactGeo* _tmp10_;
		_tmp2_ = e_contact_geo_new ();
		geo = _tmp2_;
		_tmp3_ = geo;
		_tmp4_ = location;
		_tmp5_ = _tmp4_->latitude;
		_tmp3_->latitude = _tmp5_;
		_tmp6_ = geo;
		_tmp7_ = location;
		_tmp8_ = _tmp7_->longitude;
		_tmp6_->longitude = _tmp8_;
		_tmp9_ = contact;
		_tmp10_ = geo;
		e_contact_set (_tmp9_, E_CONTACT_GEO, _tmp10_);
		__vala_EContactGeo_free0 (geo);
	}
}


static gboolean __edsf_persona_store_idle_process_gsource_func (gpointer self) {
	gboolean result;
	result = _edsf_persona_store_idle_process (self);
	return result;
}


static void _edsf_persona_store_idle_queue (EdsfPersonaStore* self, GSourceFunc callback, void* callback_target, GDestroyNotify callback_target_destroy_notify) {
	EdsfPersonaStoreIdleTask* task = NULL;
	EdsfPersonaStoreIdleTask* _tmp0_;
	EdsfPersonaStoreIdleTask* _tmp1_;
	GSourceFunc _tmp2_;
	void* _tmp2__target;
	GDestroyNotify _tmp2__target_destroy_notify;
	GeeQueue* _tmp3_;
	EdsfPersonaStoreIdleTask* _tmp4_;
	guint _tmp5_;
	g_return_if_fail (self != NULL);
	_tmp0_ = edsf_persona_store_idle_task_new ();
	task = _tmp0_;
	_tmp1_ = task;
	_tmp2_ = callback;
	_tmp2__target = callback_target;
	_tmp2__target_destroy_notify = callback_target_destroy_notify;
	callback_target_destroy_notify = NULL;
	(_tmp1_->callback_target_destroy_notify == NULL) ? NULL : (_tmp1_->callback_target_destroy_notify (_tmp1_->callback_target), NULL);
	_tmp1_->callback = NULL;
	_tmp1_->callback_target = NULL;
	_tmp1_->callback_target_destroy_notify = NULL;
	_tmp1_->callback = _tmp2_;
	_tmp1_->callback_target = _tmp2__target;
	_tmp1_->callback_target_destroy_notify = _tmp2__target_destroy_notify;
	_tmp3_ = self->priv->_idle_tasks;
	_tmp4_ = task;
	gee_collection_add ((GeeCollection*) _tmp3_, _tmp4_);
	_tmp5_ = self->priv->_idle_handle;
	if (_tmp5_ == ((guint) 0)) {
		guint _tmp6_ = 0U;
		_tmp6_ = g_idle_add_full (G_PRIORITY_DEFAULT_IDLE, __edsf_persona_store_idle_process_gsource_func, g_object_ref (self), g_object_unref);
		self->priv->_idle_handle = _tmp6_;
	}
	_edsf_persona_store_idle_task_unref0 (task);
	(callback_target_destroy_notify == NULL) ? NULL : (callback_target_destroy_notify (callback_target), NULL);
	callback = NULL;
	callback_target = NULL;
	callback_target_destroy_notify = NULL;
}


static gboolean _edsf_persona_store_idle_process (EdsfPersonaStore* self) {
	gboolean result = FALSE;
	EdsfPersonaStoreIdleTask* task = NULL;
	GeeQueue* _tmp0_;
	gpointer _tmp1_ = NULL;
	EdsfPersonaStoreIdleTask* _tmp2_;
	GeeQueue* _tmp9_;
	gpointer _tmp10_ = NULL;
	EdsfPersonaStoreIdleTask* _tmp11_;
	g_return_val_if_fail (self != NULL, FALSE);
	_tmp0_ = self->priv->_idle_tasks;
	_tmp1_ = gee_queue_peek (_tmp0_);
	task = (EdsfPersonaStoreIdleTask*) _tmp1_;
	_tmp2_ = task;
	if (_tmp2_ != NULL) {
		EdsfPersonaStoreIdleTask* _tmp3_;
		GSourceFunc _tmp4_;
		void* _tmp4__target;
		gboolean _tmp5_ = FALSE;
		GeeQueue* _tmp6_;
		gpointer _tmp7_ = NULL;
		EdsfPersonaStoreIdleTask* _tmp8_;
		_tmp3_ = task;
		_tmp4_ = _tmp3_->callback;
		_tmp4__target = _tmp3_->callback_target;
		_tmp5_ = _tmp4_ (_tmp4__target);
		if (_tmp5_) {
			result = TRUE;
			_edsf_persona_store_idle_task_unref0 (task);
			return result;
		}
		_tmp6_ = self->priv->_idle_tasks;
		_tmp7_ = gee_queue_poll (_tmp6_);
		_tmp8_ = (EdsfPersonaStoreIdleTask*) _tmp7_;
		_edsf_persona_store_idle_task_unref0 (_tmp8_);
	}
	_tmp9_ = self->priv->_idle_tasks;
	_tmp10_ = gee_queue_peek (_tmp9_);
	_edsf_persona_store_idle_task_unref0 (task);
	task = (EdsfPersonaStoreIdleTask*) _tmp10_;
	_tmp11_ = task;
	if (_tmp11_ == NULL) {
		self->priv->_idle_handle = (guint) 0;
		result = FALSE;
		_edsf_persona_store_idle_task_unref0 (task);
		return result;
	} else {
		result = TRUE;
		_edsf_persona_store_idle_task_unref0 (task);
		return result;
	}
	_edsf_persona_store_idle_task_unref0 (task);
}


static GeeLinkedList* _edsf_persona_store_copy_contacts (EdsfPersonaStore* self, GList* contacts) {
	GeeLinkedList* result = NULL;
	GeeLinkedList* copy = NULL;
	GeeLinkedList* _tmp0_;
	GList* _tmp1_;
	g_return_val_if_fail (self != NULL, NULL);
	_tmp0_ = gee_linked_list_new (e_contact_get_type (), (GBoxedCopyFunc) g_object_ref, g_object_unref, NULL, NULL, NULL);
	copy = _tmp0_;
	_tmp1_ = contacts;
	{
		GList* c_collection = NULL;
		GList* c_it = NULL;
		c_collection = _tmp1_;
		for (c_it = c_collection; c_it != NULL; c_it = c_it->next) {
			EContact* _tmp2_;
			EContact* c = NULL;
			_tmp2_ = _g_object_ref0 ((EContact*) c_it->data);
			c = _tmp2_;
			{
				GeeLinkedList* _tmp3_;
				EContact* _tmp4_;
				_tmp3_ = copy;
				_tmp4_ = c;
				gee_abstract_collection_add ((GeeAbstractCollection*) _tmp3_, _tmp4_);
				_g_object_unref0 (c);
			}
		}
	}
	result = copy;
	return result;
}


static GeeLinkedList* _edsf_persona_store_copy_contacts_ids (EdsfPersonaStore* self, GList* contacts_ids) {
	GeeLinkedList* result = NULL;
	GeeLinkedList* copy = NULL;
	GeeLinkedList* _tmp0_;
	GList* _tmp1_;
	g_return_val_if_fail (self != NULL, NULL);
	_tmp0_ = gee_linked_list_new (G_TYPE_STRING, (GBoxedCopyFunc) g_strdup, g_free, NULL, NULL, NULL);
	copy = _tmp0_;
	_tmp1_ = contacts_ids;
	{
		GList* s_collection = NULL;
		GList* s_it = NULL;
		s_collection = _tmp1_;
		for (s_it = s_collection; s_it != NULL; s_it = s_it->next) {
			const gchar* s = NULL;
			s = (const gchar*) s_it->data;
			{
				GeeLinkedList* _tmp2_;
				const gchar* _tmp3_;
				_tmp2_ = copy;
				_tmp3_ = s;
				gee_abstract_collection_add ((GeeAbstractCollection*) _tmp2_, _tmp3_);
			}
		}
	}
	result = copy;
	return result;
}


static Block4Data* block4_data_ref (Block4Data* _data4_) {
	g_atomic_int_inc (&_data4_->_ref_count_);
	return _data4_;
}


static void block4_data_unref (void * _userdata_) {
	Block4Data* _data4_;
	_data4_ = (Block4Data*) _userdata_;
	if (g_atomic_int_dec_and_test (&_data4_->_ref_count_)) {
		EdsfPersonaStore * self;
		self = _data4_->self;
		_g_object_unref0 (_data4_->copy);
		_g_object_unref0 (self);
		g_slice_free (Block4Data, _data4_);
	}
}


static gboolean __lambda4_ (Block4Data* _data4_) {
	EdsfPersonaStore * self;
	gboolean result = FALSE;
	gboolean _tmp0_ = FALSE;
	self = _data4_->self;
	_tmp0_ = _edsf_persona_store_contacts_added_idle (self, (GeeList*) _data4_->copy);
	result = _tmp0_;
	return result;
}


static gboolean ___lambda4__gsource_func (gpointer self) {
	gboolean result;
	result = __lambda4_ (self);
	return result;
}


static void _edsf_persona_store_contacts_added_cb (EdsfPersonaStore* self, GList* contacts) {
	Block4Data* _data4_;
	GList* _tmp0_;
	GeeLinkedList* _tmp1_ = NULL;
	g_return_if_fail (self != NULL);
	_data4_ = g_slice_new0 (Block4Data);
	_data4_->_ref_count_ = 1;
	_data4_->self = g_object_ref (self);
	_tmp0_ = contacts;
	_tmp1_ = _edsf_persona_store_copy_contacts (self, _tmp0_);
	_data4_->copy = _tmp1_;
	_edsf_persona_store_idle_queue (self, ___lambda4__gsource_func, block4_data_ref (_data4_), block4_data_unref);
	block4_data_unref (_data4_);
	_data4_ = NULL;
}


static gboolean _edsf_persona_store_contacts_added_idle (EdsfPersonaStore* self, GeeList* contacts) {
	gboolean result = FALSE;
	GeeHashSet* added_personas = NULL;
	gboolean _tmp0_;
	gboolean _tmp33_ = FALSE;
	GeeHashSet* _tmp34_;
	gint _tmp35_;
	gint _tmp36_;
	gboolean _tmp38_;
	g_return_val_if_fail (self != NULL, FALSE);
	g_return_val_if_fail (contacts != NULL, FALSE);
	_tmp0_ = self->priv->_is_quiescent;
	if (_tmp0_ == FALSE) {
		GeeHashSet* _tmp1_;
		GeeHashSet* _tmp3_;
		GeeHashSet* _tmp4_;
		_tmp1_ = self->priv->_pending_personas;
		if (_tmp1_ == NULL) {
			GeeHashSet* _tmp2_;
			_tmp2_ = gee_hash_set_new (EDSF_TYPE_PERSONA, (GBoxedCopyFunc) g_object_ref, g_object_unref, NULL, NULL, NULL, NULL, NULL, NULL);
			_g_object_unref0 (self->priv->_pending_personas);
			self->priv->_pending_personas = _tmp2_;
		}
		_tmp3_ = self->priv->_pending_personas;
		_tmp4_ = _g_object_ref0 (_tmp3_);
		_g_object_unref0 (added_personas);
		added_personas = _tmp4_;
	} else {
		GeeHashSet* _tmp5_;
		_tmp5_ = gee_hash_set_new (EDSF_TYPE_PERSONA, (GBoxedCopyFunc) g_object_ref, g_object_unref, NULL, NULL, NULL, NULL, NULL, NULL);
		_g_object_unref0 (added_personas);
		added_personas = _tmp5_;
	}
	{
		GeeList* _c_list = NULL;
		GeeList* _tmp6_;
		GeeList* _tmp7_;
		gint _c_size = 0;
		GeeList* _tmp8_;
		gint _tmp9_;
		gint _tmp10_;
		gint _c_index = 0;
		_tmp6_ = contacts;
		_tmp7_ = _g_object_ref0 (_tmp6_);
		_c_list = _tmp7_;
		_tmp8_ = _c_list;
		_tmp9_ = gee_collection_get_size ((GeeCollection*) _tmp8_);
		_tmp10_ = _tmp9_;
		_c_size = _tmp10_;
		_c_index = -1;
		while (TRUE) {
			gint _tmp11_;
			gint _tmp12_;
			gint _tmp13_;
			EContact* c = NULL;
			GeeList* _tmp14_;
			gint _tmp15_;
			gpointer _tmp16_ = NULL;
			gchar* iid = NULL;
			const gchar* _tmp17_;
			const gchar* _tmp18_;
			EContact* _tmp19_;
			gchar* _tmp20_ = NULL;
			GeeHashMap* _tmp21_;
			const gchar* _tmp22_;
			gboolean _tmp23_ = FALSE;
			_tmp11_ = _c_index;
			_c_index = _tmp11_ + 1;
			_tmp12_ = _c_index;
			_tmp13_ = _c_size;
			if (!(_tmp12_ < _tmp13_)) {
				break;
			}
			_tmp14_ = _c_list;
			_tmp15_ = _c_index;
			_tmp16_ = gee_list_get (_tmp14_, _tmp15_);
			c = (EContact*) _tmp16_;
			_tmp17_ = folks_persona_store_get_id ((FolksPersonaStore*) self);
			_tmp18_ = _tmp17_;
			_tmp19_ = c;
			_tmp20_ = edsf_persona_build_iid_from_contact (_tmp18_, _tmp19_);
			iid = _tmp20_;
			_tmp21_ = self->priv->_personas;
			_tmp22_ = iid;
			_tmp23_ = gee_abstract_map_has_key ((GeeAbstractMap*) _tmp21_, _tmp22_);
			if (_tmp23_ == FALSE) {
				EdsfPersona* persona = NULL;
				EContact* _tmp24_;
				EdsfPersona* _tmp25_;
				GeeHashMap* _tmp26_;
				EdsfPersona* _tmp27_;
				const gchar* _tmp28_;
				const gchar* _tmp29_;
				EdsfPersona* _tmp30_;
				GeeHashSet* _tmp31_;
				EdsfPersona* _tmp32_;
				_tmp24_ = c;
				_tmp25_ = edsf_persona_new (self, _tmp24_);
				persona = _tmp25_;
				_tmp26_ = self->priv->_personas;
				_tmp27_ = persona;
				_tmp28_ = folks_persona_get_iid ((FolksPersona*) _tmp27_);
				_tmp29_ = _tmp28_;
				_tmp30_ = persona;
				gee_abstract_map_set ((GeeAbstractMap*) _tmp26_, _tmp29_, _tmp30_);
				_tmp31_ = added_personas;
				_tmp32_ = persona;
				gee_abstract_collection_add ((GeeAbstractCollection*) _tmp31_, _tmp32_);
				_g_object_unref0 (persona);
			}
			_g_free0 (iid);
			_g_object_unref0 (c);
		}
		_g_object_unref0 (_c_list);
	}
	_tmp34_ = added_personas;
	_tmp35_ = gee_abstract_collection_get_size ((GeeCollection*) _tmp34_);
	_tmp36_ = _tmp35_;
	if (_tmp36_ > 0) {
		gboolean _tmp37_;
		_tmp37_ = self->priv->_is_quiescent;
		_tmp33_ = _tmp37_ == TRUE;
	} else {
		_tmp33_ = FALSE;
	}
	_tmp38_ = _tmp33_;
	if (_tmp38_) {
		GeeHashSet* _tmp39_;
		_tmp39_ = added_personas;
		_folks_persona_store_emit_personas_changed ((FolksPersonaStore*) self, (GeeSet*) _tmp39_, NULL, NULL, NULL, FOLKS_GROUP_DETAILS_CHANGE_REASON_NONE);
	}
	result = FALSE;
	_g_object_unref0 (added_personas);
	return result;
}


static Block5Data* block5_data_ref (Block5Data* _data5_) {
	g_atomic_int_inc (&_data5_->_ref_count_);
	return _data5_;
}


static void block5_data_unref (void * _userdata_) {
	Block5Data* _data5_;
	_data5_ = (Block5Data*) _userdata_;
	if (g_atomic_int_dec_and_test (&_data5_->_ref_count_)) {
		EdsfPersonaStore * self;
		self = _data5_->self;
		_g_object_unref0 (_data5_->copy);
		_g_object_unref0 (self);
		g_slice_free (Block5Data, _data5_);
	}
}


static gboolean __lambda6_ (Block5Data* _data5_) {
	EdsfPersonaStore * self;
	gboolean result = FALSE;
	gboolean _tmp0_ = FALSE;
	self = _data5_->self;
	_tmp0_ = _edsf_persona_store_contacts_changed_idle (self, (GeeList*) _data5_->copy);
	result = _tmp0_;
	return result;
}


static gboolean ___lambda6__gsource_func (gpointer self) {
	gboolean result;
	result = __lambda6_ (self);
	return result;
}


static void _edsf_persona_store_contacts_changed_cb (EdsfPersonaStore* self, GList* contacts) {
	Block5Data* _data5_;
	GList* _tmp0_;
	GeeLinkedList* _tmp1_ = NULL;
	g_return_if_fail (self != NULL);
	_data5_ = g_slice_new0 (Block5Data);
	_data5_->_ref_count_ = 1;
	_data5_->self = g_object_ref (self);
	_tmp0_ = contacts;
	_tmp1_ = _edsf_persona_store_copy_contacts (self, _tmp0_);
	_data5_->copy = _tmp1_;
	_edsf_persona_store_idle_queue (self, ___lambda6__gsource_func, block5_data_ref (_data5_), block5_data_unref);
	block5_data_unref (_data5_);
	_data5_ = NULL;
}


static gboolean _edsf_persona_store_contacts_changed_idle (EdsfPersonaStore* self, GeeList* contacts) {
	gboolean result = FALSE;
	g_return_val_if_fail (self != NULL, FALSE);
	g_return_val_if_fail (contacts != NULL, FALSE);
	{
		GeeList* _c_list = NULL;
		GeeList* _tmp0_;
		GeeList* _tmp1_;
		gint _c_size = 0;
		GeeList* _tmp2_;
		gint _tmp3_;
		gint _tmp4_;
		gint _c_index = 0;
		_tmp0_ = contacts;
		_tmp1_ = _g_object_ref0 (_tmp0_);
		_c_list = _tmp1_;
		_tmp2_ = _c_list;
		_tmp3_ = gee_collection_get_size ((GeeCollection*) _tmp2_);
		_tmp4_ = _tmp3_;
		_c_size = _tmp4_;
		_c_index = -1;
		while (TRUE) {
			gint _tmp5_;
			gint _tmp6_;
			gint _tmp7_;
			EContact* c = NULL;
			GeeList* _tmp8_;
			gint _tmp9_;
			gpointer _tmp10_ = NULL;
			gchar* iid = NULL;
			const gchar* _tmp11_;
			const gchar* _tmp12_;
			EContact* _tmp13_;
			gchar* _tmp14_ = NULL;
			EdsfPersona* persona = NULL;
			GeeHashMap* _tmp15_;
			const gchar* _tmp16_;
			gpointer _tmp17_ = NULL;
			EdsfPersona* _tmp18_;
			_tmp5_ = _c_index;
			_c_index = _tmp5_ + 1;
			_tmp6_ = _c_index;
			_tmp7_ = _c_size;
			if (!(_tmp6_ < _tmp7_)) {
				break;
			}
			_tmp8_ = _c_list;
			_tmp9_ = _c_index;
			_tmp10_ = gee_list_get (_tmp8_, _tmp9_);
			c = (EContact*) _tmp10_;
			_tmp11_ = folks_persona_store_get_id ((FolksPersonaStore*) self);
			_tmp12_ = _tmp11_;
			_tmp13_ = c;
			_tmp14_ = edsf_persona_build_iid_from_contact (_tmp12_, _tmp13_);
			iid = _tmp14_;
			_tmp15_ = self->priv->_personas;
			_tmp16_ = iid;
			_tmp17_ = gee_abstract_map_get ((GeeAbstractMap*) _tmp15_, _tmp16_);
			persona = (EdsfPersona*) _tmp17_;
			_tmp18_ = persona;
			if (_tmp18_ != NULL) {
				EdsfPersona* _tmp19_;
				EContact* _tmp20_;
				_tmp19_ = persona;
				_tmp20_ = c;
				_edsf_persona_update (G_TYPE_CHECK_INSTANCE_CAST (_tmp19_, EDSF_TYPE_PERSONA, EdsfPersona), _tmp20_);
			}
			_g_object_unref0 (persona);
			_g_free0 (iid);
			_g_object_unref0 (c);
		}
		_g_object_unref0 (_c_list);
	}
	result = FALSE;
	return result;
}


static Block6Data* block6_data_ref (Block6Data* _data6_) {
	g_atomic_int_inc (&_data6_->_ref_count_);
	return _data6_;
}


static void block6_data_unref (void * _userdata_) {
	Block6Data* _data6_;
	_data6_ = (Block6Data*) _userdata_;
	if (g_atomic_int_dec_and_test (&_data6_->_ref_count_)) {
		EdsfPersonaStore * self;
		self = _data6_->self;
		_g_object_unref0 (_data6_->copy);
		_g_object_unref0 (self);
		g_slice_free (Block6Data, _data6_);
	}
}


static gboolean __lambda5_ (Block6Data* _data6_) {
	EdsfPersonaStore * self;
	gboolean result = FALSE;
	gboolean _tmp0_ = FALSE;
	self = _data6_->self;
	_tmp0_ = _edsf_persona_store_contacts_removed_idle (self, (GeeList*) _data6_->copy);
	result = _tmp0_;
	return result;
}


static gboolean ___lambda5__gsource_func (gpointer self) {
	gboolean result;
	result = __lambda5_ (self);
	return result;
}


static void _edsf_persona_store_contacts_removed_cb (EdsfPersonaStore* self, GList* contacts_ids) {
	Block6Data* _data6_;
	GList* _tmp0_;
	GeeLinkedList* _tmp1_ = NULL;
	g_return_if_fail (self != NULL);
	_data6_ = g_slice_new0 (Block6Data);
	_data6_->_ref_count_ = 1;
	_data6_->self = g_object_ref (self);
	_tmp0_ = contacts_ids;
	_tmp1_ = _edsf_persona_store_copy_contacts_ids (self, _tmp0_);
	_data6_->copy = _tmp1_;
	_edsf_persona_store_idle_queue (self, ___lambda5__gsource_func, block6_data_ref (_data6_), block6_data_unref);
	block6_data_unref (_data6_);
	_data6_ = NULL;
}


static gboolean _edsf_persona_store_contacts_removed_idle (EdsfPersonaStore* self, GeeList* contacts_ids) {
	gboolean result = FALSE;
	GeeHashSet* removed_personas = NULL;
	GeeHashSet* _tmp0_;
	GeeHashSet* _tmp29_;
	gint _tmp30_;
	gint _tmp31_;
	g_return_val_if_fail (self != NULL, FALSE);
	g_return_val_if_fail (contacts_ids != NULL, FALSE);
	_tmp0_ = gee_hash_set_new (EDSF_TYPE_PERSONA, (GBoxedCopyFunc) g_object_ref, g_object_unref, NULL, NULL, NULL, NULL, NULL, NULL);
	removed_personas = _tmp0_;
	{
		GeeList* _contact_id_list = NULL;
		GeeList* _tmp1_;
		GeeList* _tmp2_;
		gint _contact_id_size = 0;
		GeeList* _tmp3_;
		gint _tmp4_;
		gint _tmp5_;
		gint _contact_id_index = 0;
		_tmp1_ = contacts_ids;
		_tmp2_ = _g_object_ref0 (_tmp1_);
		_contact_id_list = _tmp2_;
		_tmp3_ = _contact_id_list;
		_tmp4_ = gee_collection_get_size ((GeeCollection*) _tmp3_);
		_tmp5_ = _tmp4_;
		_contact_id_size = _tmp5_;
		_contact_id_index = -1;
		while (TRUE) {
			gint _tmp6_;
			gint _tmp7_;
			gint _tmp8_;
			gchar* contact_id = NULL;
			GeeList* _tmp9_;
			gint _tmp10_;
			gpointer _tmp11_ = NULL;
			gchar* iid = NULL;
			const gchar* _tmp12_;
			const gchar* _tmp13_;
			const gchar* _tmp14_;
			gchar* _tmp15_ = NULL;
			EdsfPersona* persona = NULL;
			GeeHashMap* _tmp16_;
			const gchar* _tmp17_;
			gpointer _tmp18_ = NULL;
			EdsfPersona* _tmp19_;
			_tmp6_ = _contact_id_index;
			_contact_id_index = _tmp6_ + 1;
			_tmp7_ = _contact_id_index;
			_tmp8_ = _contact_id_size;
			if (!(_tmp7_ < _tmp8_)) {
				break;
			}
			_tmp9_ = _contact_id_list;
			_tmp10_ = _contact_id_index;
			_tmp11_ = gee_list_get (_tmp9_, _tmp10_);
			contact_id = (gchar*) _tmp11_;
			_tmp12_ = folks_persona_store_get_id ((FolksPersonaStore*) self);
			_tmp13_ = _tmp12_;
			_tmp14_ = contact_id;
			_tmp15_ = edsf_persona_build_iid (_tmp13_, _tmp14_);
			iid = _tmp15_;
			_tmp16_ = self->priv->_personas;
			_tmp17_ = iid;
			_tmp18_ = gee_abstract_map_get ((GeeAbstractMap*) _tmp16_, _tmp17_);
			persona = (EdsfPersona*) _tmp18_;
			_tmp19_ = persona;
			if (_tmp19_ != NULL) {
				GeeHashSet* _tmp20_;
				EdsfPersona* _tmp21_;
				GeeHashMap* _tmp22_;
				EdsfPersona* _tmp23_;
				const gchar* _tmp24_;
				const gchar* _tmp25_;
				GeeHashSet* _tmp26_;
				_tmp20_ = removed_personas;
				_tmp21_ = persona;
				gee_abstract_collection_add ((GeeAbstractCollection*) _tmp20_, G_TYPE_CHECK_INSTANCE_CAST (_tmp21_, EDSF_TYPE_PERSONA, EdsfPersona));
				_tmp22_ = self->priv->_personas;
				_tmp23_ = persona;
				_tmp24_ = folks_persona_get_iid ((FolksPersona*) G_TYPE_CHECK_INSTANCE_CAST (_tmp23_, EDSF_TYPE_PERSONA, EdsfPersona));
				_tmp25_ = _tmp24_;
				gee_abstract_map_unset ((GeeAbstractMap*) _tmp22_, _tmp25_, NULL);
				_tmp26_ = self->priv->_pending_personas;
				if (_tmp26_ != NULL) {
					GeeHashSet* _tmp27_;
					EdsfPersona* _tmp28_;
					_tmp27_ = self->priv->_pending_personas;
					_tmp28_ = persona;
					gee_abstract_collection_remove ((GeeAbstractCollection*) _tmp27_, G_TYPE_CHECK_INSTANCE_CAST (_tmp28_, EDSF_TYPE_PERSONA, EdsfPersona));
				}
			}
			_g_object_unref0 (persona);
			_g_free0 (iid);
			_g_free0 (contact_id);
		}
		_g_object_unref0 (_contact_id_list);
	}
	_tmp29_ = removed_personas;
	_tmp30_ = gee_abstract_collection_get_size ((GeeCollection*) _tmp29_);
	_tmp31_ = _tmp30_;
	if (_tmp31_ > 0) {
		GeeHashSet* _tmp32_;
		_tmp32_ = removed_personas;
		_folks_persona_store_emit_personas_changed ((FolksPersonaStore*) self, NULL, (GeeSet*) _tmp32_, NULL, NULL, FOLKS_GROUP_DETAILS_CHANGE_REASON_NONE);
	}
	result = FALSE;
	_g_object_unref0 (removed_personas);
	return result;
}


static Block7Data* block7_data_ref (Block7Data* _data7_) {
	g_atomic_int_inc (&_data7_->_ref_count_);
	return _data7_;
}


static void block7_data_unref (void * _userdata_) {
	Block7Data* _data7_;
	_data7_ = (Block7Data*) _userdata_;
	if (g_atomic_int_dec_and_test (&_data7_->_ref_count_)) {
		EdsfPersonaStore * self;
		self = _data7_->self;
		_g_error_free0 (_data7_->err);
		_g_object_unref0 (self);
		g_slice_free (Block7Data, _data7_);
	}
}


static gboolean __lambda11_ (Block7Data* _data7_) {
	EdsfPersonaStore * self;
	gboolean result = FALSE;
	GError* _tmp0_;
	gboolean _tmp1_ = FALSE;
	self = _data7_->self;
	_tmp0_ = _data7_->err;
	_tmp1_ = _edsf_persona_store_contacts_complete_idle_cb (self, _tmp0_);
	result = _tmp1_;
	return result;
}


static gboolean ___lambda11__gsource_func (gpointer self) {
	gboolean result;
	result = __lambda11_ (self);
	return result;
}


static void _edsf_persona_store_contacts_complete_cb (EdsfPersonaStore* self, GError* err) {
	Block7Data* _data7_;
	GError* _tmp0_;
	GError* _tmp1_;
	GError* _tmp2_;
	const gchar* _tmp5_;
	const gchar* _tmp6_;
	g_return_if_fail (self != NULL);
	_data7_ = g_slice_new0 (Block7Data);
	_data7_->_ref_count_ = 1;
	_data7_->self = g_object_ref (self);
	_tmp0_ = err;
	_tmp1_ = _g_error_copy0 (_tmp0_);
	_g_error_free0 (_data7_->err);
	_data7_->err = _tmp1_;
	_tmp2_ = _data7_->err;
	if (_tmp2_ != NULL) {
		GError* _tmp3_;
		const gchar* _tmp4_;
		_tmp3_ = _data7_->err;
		_tmp4_ = _tmp3_->message;
		g_warning ("edsf-persona-store.vala:2499: Error in address book view query: %s", _tmp4_);
	}
	_tmp5_ = folks_persona_store_get_id ((FolksPersonaStore*) self);
	_tmp6_ = _tmp5_;
	folks_internal_profiling_point ("initial query complete in " "Edsf.PersonaStore (ID: %s)", _tmp6_, NULL);
	_edsf_persona_store_idle_queue (self, ___lambda11__gsource_func, block7_data_ref (_data7_), block7_data_unref);
	block7_data_unref (_data7_);
	_data7_ = NULL;
}


static gboolean _edsf_persona_store_contacts_complete_idle_cb (EdsfPersonaStore* self, GError* err) {
	gboolean result = FALSE;
	gboolean _tmp0_;
	g_return_val_if_fail (self != NULL, FALSE);
	_tmp0_ = self->priv->_is_quiescent;
	if (_tmp0_ == FALSE) {
		GError* _tmp1_;
		GeeHashSet* _tmp2_;
		_tmp1_ = err;
		if (_tmp1_ != NULL) {
			g_warning ("edsf-persona-store.vala:2519: %s", "Error is considered unrecoverable. " "Removing persona store.");
			g_signal_emit_by_name ((FolksPersonaStore*) self, "removed");
			result = FALSE;
			return result;
		}
		_tmp2_ = self->priv->_pending_personas;
		if (_tmp2_ != NULL) {
			GeeHashSet* _tmp3_;
			_tmp3_ = self->priv->_pending_personas;
			_folks_persona_store_emit_personas_changed ((FolksPersonaStore*) self, (GeeSet*) _tmp3_, NULL, NULL, NULL, FOLKS_GROUP_DETAILS_CHANGE_REASON_NONE);
			_g_object_unref0 (self->priv->_pending_personas);
			self->priv->_pending_personas = NULL;
		}
		self->priv->_is_quiescent = TRUE;
		g_object_notify ((GObject*) self, "is-quiescent");
	}
	result = FALSE;
	return result;
}


static GError* edsf_persona_store_e_client_error_to_property_error (EdsfPersonaStore* self, const gchar* property_name, GError* error_in) {
	GError* result = NULL;
	GError* _tmp0_;
	const gchar* _tmp29_ = NULL;
	const gchar* _tmp30_;
	GError* _tmp31_;
	const gchar* _tmp32_;
	GError* _tmp33_;
	g_return_val_if_fail (self != NULL, NULL);
	g_return_val_if_fail (property_name != NULL, NULL);
	_tmp0_ = error_in;
	if (_tmp0_->domain == E_BOOK_CLIENT_ERROR) {
		gboolean _tmp1_ = FALSE;
		gboolean _tmp2_ = FALSE;
		gboolean _tmp3_ = FALSE;
		gboolean _tmp4_ = FALSE;
		GError* _tmp5_;
		gboolean _tmp7_;
		gboolean _tmp9_;
		gboolean _tmp11_;
		gboolean _tmp13_;
		_tmp5_ = error_in;
		if (g_error_matches (_tmp5_, E_BOOK_CLIENT_ERROR, E_BOOK_CLIENT_ERROR_CONTACT_NOT_FOUND)) {
			_tmp4_ = TRUE;
		} else {
			GError* _tmp6_;
			_tmp6_ = error_in;
			_tmp4_ = g_error_matches (_tmp6_, E_BOOK_CLIENT_ERROR, E_BOOK_CLIENT_ERROR_NO_SUCH_BOOK);
		}
		_tmp7_ = _tmp4_;
		if (_tmp7_) {
			_tmp3_ = TRUE;
		} else {
			GError* _tmp8_;
			_tmp8_ = error_in;
			_tmp3_ = g_error_matches (_tmp8_, E_BOOK_CLIENT_ERROR, E_BOOK_CLIENT_ERROR_CONTACT_ID_ALREADY_EXISTS);
		}
		_tmp9_ = _tmp3_;
		if (_tmp9_) {
			_tmp2_ = TRUE;
		} else {
			GError* _tmp10_;
			_tmp10_ = error_in;
			_tmp2_ = g_error_matches (_tmp10_, E_BOOK_CLIENT_ERROR, E_BOOK_CLIENT_ERROR_NO_SUCH_SOURCE);
		}
		_tmp11_ = _tmp2_;
		if (_tmp11_) {
			_tmp1_ = TRUE;
		} else {
			GError* _tmp12_;
			_tmp12_ = error_in;
			_tmp1_ = g_error_matches (_tmp12_, E_BOOK_CLIENT_ERROR, E_BOOK_CLIENT_ERROR_NO_SPACE);
		}
		_tmp13_ = _tmp1_;
		if (_tmp13_) {
		}
	} else {
		GError* _tmp14_;
		GQuark _tmp15_;
		GQuark _tmp16_ = 0U;
		_tmp14_ = error_in;
		_tmp15_ = _tmp14_->domain;
		_tmp16_ = e_client_error_quark ();
		if (_tmp15_ == _tmp16_) {
			GError* _tmp17_;
			gint _tmp18_;
			_tmp17_ = error_in;
			_tmp18_ = _tmp17_->code;
			switch ((EClientError) _tmp18_) {
				case E_CLIENT_ERROR_REPOSITORY_OFFLINE:
				case E_CLIENT_ERROR_PERMISSION_DENIED:
				case E_CLIENT_ERROR_NOT_SUPPORTED:
				case E_CLIENT_ERROR_AUTHENTICATION_REQUIRED:
				{
					const gchar* _tmp19_ = NULL;
					const gchar* _tmp20_;
					GError* _tmp21_;
					const gchar* _tmp22_;
					GError* _tmp23_;
					_tmp19_ = _ ("Property %s is not writeable: %s");
					_tmp20_ = property_name;
					_tmp21_ = error_in;
					_tmp22_ = _tmp21_->message;
					_tmp23_ = g_error_new (FOLKS_PROPERTY_ERROR, FOLKS_PROPERTY_ERROR_NOT_WRITEABLE, _tmp19_, _tmp20_, _tmp22_);
					result = _tmp23_;
					return result;
				}
				case E_CLIENT_ERROR_INVALID_ARG:
				{
					const gchar* _tmp24_ = NULL;
					const gchar* _tmp25_;
					GError* _tmp26_;
					const gchar* _tmp27_;
					GError* _tmp28_;
					_tmp24_ = _ ("Invalid value for property %s: %s");
					_tmp25_ = property_name;
					_tmp26_ = error_in;
					_tmp27_ = _tmp26_->message;
					_tmp28_ = g_error_new (FOLKS_PROPERTY_ERROR, FOLKS_PROPERTY_ERROR_INVALID_VALUE, _tmp24_, _tmp25_, _tmp27_);
					result = _tmp28_;
					return result;
				}
				default:
				case E_CLIENT_ERROR_BUSY:
				case E_CLIENT_ERROR_DBUS_ERROR:
				case E_CLIENT_ERROR_OTHER_ERROR:
				case E_CLIENT_ERROR_COULD_NOT_CANCEL:
				case E_CLIENT_ERROR_AUTHENTICATION_FAILED:
				case E_CLIENT_ERROR_TLS_NOT_AVAILABLE:
				case E_CLIENT_ERROR_OFFLINE_UNAVAILABLE:
				case E_CLIENT_ERROR_UNSUPPORTED_AUTHENTICATION_METHOD:
				case E_CLIENT_ERROR_SEARCH_SIZE_LIMIT_EXCEEDED:
				case E_CLIENT_ERROR_SEARCH_TIME_LIMIT_EXCEEDED:
				case E_CLIENT_ERROR_INVALID_QUERY:
				case E_CLIENT_ERROR_QUERY_REFUSED:
				{
					break;
				}
			}
		}
	}
	_tmp29_ = _ ("Unknown error setting property %s: %s");
	_tmp30_ = property_name;
	_tmp31_ = error_in;
	_tmp32_ = _tmp31_->message;
	_tmp33_ = g_error_new (FOLKS_PROPERTY_ERROR, FOLKS_PROPERTY_ERROR_UNKNOWN_ERROR, _tmp29_, _tmp30_, _tmp32_);
	result = _tmp33_;
	return result;
}


static gboolean _edsf_persona_store_backend_name_matches (EdsfPersonaStore* self, const gchar* backend_name) {
	gboolean result = FALSE;
	ESource* _tmp0_;
	gboolean _tmp1_ = FALSE;
	g_return_val_if_fail (self != NULL, FALSE);
	g_return_val_if_fail (backend_name != NULL, FALSE);
	_tmp0_ = self->priv->_source;
	_tmp1_ = e_source_has_extension (_tmp0_, E_SOURCE_EXTENSION_ADDRESS_BOOK);
	if (_tmp1_) {
		ESourceAddressBook* extension = NULL;
		ESource* _tmp2_;
		ESourceExtension* _tmp3_ = NULL;
		ESourceAddressBook* _tmp4_;
		const gchar* _tmp5_ = NULL;
		const gchar* _tmp6_;
		_tmp2_ = self->priv->_source;
		_tmp3_ = e_source_get_extension (_tmp2_, E_SOURCE_EXTENSION_ADDRESS_BOOK);
		extension = G_TYPE_CHECK_INSTANCE_CAST (_tmp3_, e_source_address_book_get_type (), ESourceAddressBook);
		_tmp4_ = extension;
		_tmp5_ = e_source_backend_get_backend_name ((ESourceBackend*) _tmp4_);
		_tmp6_ = backend_name;
		result = g_strcmp0 (_tmp5_, _tmp6_) == 0;
		return result;
	}
	result = FALSE;
	return result;
}


gboolean _edsf_persona_store_is_google_contacts_address_book (EdsfPersonaStore* self) {
	gboolean result = FALSE;
	ESourceRegistry* _tmp0_;
	gboolean _tmp1_ = FALSE;
	g_return_val_if_fail (self != NULL, FALSE);
	_tmp0_ = self->priv->_source_registry;
	_vala_assert (_tmp0_ != NULL, "this._source_registry != null");
	_tmp1_ = _edsf_persona_store_backend_name_matches (self, "google");
	result = _tmp1_;
	return result;
}


static gboolean _edsf_persona_store_is_in_source_registry (EdsfPersonaStore* self) {
	gboolean result = FALSE;
	ESourceRegistry* _tmp0_;
	ESource* needle = NULL;
	ESourceRegistry* _tmp1_;
	const gchar* _tmp2_;
	const gchar* _tmp3_;
	ESource* _tmp4_ = NULL;
	gboolean _tmp5_ = FALSE;
	ESource* _tmp6_;
	gboolean _tmp9_;
	g_return_val_if_fail (self != NULL, FALSE);
	_tmp0_ = self->priv->_source_registry;
	_vala_assert (_tmp0_ != NULL, "this._source_registry != null");
	_tmp1_ = self->priv->_source_registry;
	_tmp2_ = folks_persona_store_get_id ((FolksPersonaStore*) self);
	_tmp3_ = _tmp2_;
	_tmp4_ = e_source_registry_ref_source (G_TYPE_CHECK_INSTANCE_CAST (_tmp1_, e_source_registry_get_type (), ESourceRegistry), _tmp3_);
	needle = _tmp4_;
	_tmp6_ = needle;
	if (_tmp6_ != NULL) {
		ESource* _tmp7_;
		gboolean _tmp8_ = FALSE;
		_tmp7_ = needle;
		_tmp8_ = e_source_has_extension (_tmp7_, E_SOURCE_EXTENSION_ADDRESS_BOOK);
		_tmp5_ = _tmp8_;
	} else {
		_tmp5_ = FALSE;
	}
	_tmp9_ = _tmp5_;
	if (_tmp9_) {
		result = TRUE;
		_g_object_unref0 (needle);
		return result;
	}
	result = FALSE;
	_g_object_unref0 (needle);
	return result;
}


static void _edsf_persona_store_source_registry_changed_cb (EdsfPersonaStore* self, ESource* list) {
	gboolean _tmp0_ = FALSE;
	g_return_if_fail (self != NULL);
	g_return_if_fail (list != NULL);
	_tmp0_ = _edsf_persona_store_is_in_source_registry (self);
	if (_tmp0_ == FALSE) {
		GeeHashSet* removed_personas = NULL;
		GeeHashSet* _tmp1_;
		GeeMapIterator* iter = NULL;
		GeeHashMap* _tmp2_;
		GeeMapIterator* _tmp3_ = NULL;
		GeeHashSet* _tmp10_;
		_tmp1_ = gee_hash_set_new (EDSF_TYPE_PERSONA, (GBoxedCopyFunc) g_object_ref, g_object_unref, NULL, NULL, NULL, NULL, NULL, NULL);
		removed_personas = _tmp1_;
		_tmp2_ = self->priv->_personas;
		_tmp3_ = gee_abstract_map_map_iterator ((GeeAbstractMap*) _tmp2_);
		iter = _tmp3_;
		while (TRUE) {
			GeeMapIterator* _tmp4_;
			gboolean _tmp5_ = FALSE;
			GeeHashSet* _tmp6_;
			GeeMapIterator* _tmp7_;
			gpointer _tmp8_ = NULL;
			EdsfPersona* _tmp9_;
			_tmp4_ = iter;
			_tmp5_ = gee_map_iterator_next (_tmp4_);
			if (!(_tmp5_ == TRUE)) {
				break;
			}
			_tmp6_ = removed_personas;
			_tmp7_ = iter;
			_tmp8_ = gee_map_iterator_get_value (_tmp7_);
			_tmp9_ = (EdsfPersona*) _tmp8_;
			gee_abstract_collection_add ((GeeAbstractCollection*) _tmp6_, _tmp9_);
			_g_object_unref0 (_tmp9_);
		}
		_tmp10_ = removed_personas;
		_folks_persona_store_emit_personas_changed ((FolksPersonaStore*) self, NULL, (GeeSet*) _tmp10_, NULL, NULL, FOLKS_GROUP_DETAILS_CHANGE_REASON_NONE);
		g_signal_emit_by_name ((FolksPersonaStore*) self, "removed");
		_g_object_unref0 (iter);
		_g_object_unref0 (removed_personas);
	}
}


static void _edsf_persona_store_update_trust_level (EdsfPersonaStore* self) {
	ESourceRegistry* _tmp0_;
	EBookClient* _tmp1_;
	gboolean _tmp2_ = FALSE;
	gboolean _tmp3_ = FALSE;
	EBookClient* _tmp4_;
	gboolean _tmp5_ = FALSE;
	gboolean _tmp6_;
	g_return_if_fail (self != NULL);
	_tmp0_ = self->priv->_source_registry;
	_vala_assert (_tmp0_ != NULL, "this._source_registry != null");
	_tmp1_ = self->priv->_addressbook;
	_vala_assert (_tmp1_ != NULL, "this._addressbook != null");
	_tmp2_ = _edsf_persona_store_backend_name_matches (self, "ldap");
	if (_tmp2_) {
		folks_persona_store_set_trust_level ((FolksPersonaStore*) self, FOLKS_PERSONA_STORE_TRUST_PARTIAL);
		return;
	}
	_tmp3_ = _edsf_persona_store_is_google_contacts_address_book (self);
	if (_tmp3_) {
		folks_persona_store_set_trust_level ((FolksPersonaStore*) self, FOLKS_PERSONA_STORE_TRUST_FULL);
	}
	_tmp4_ = self->priv->_addressbook;
	g_object_get ((EClient*) G_TYPE_CHECK_INSTANCE_CAST (_tmp4_, e_book_client_get_type (), EBookClient), "readonly", &_tmp5_, NULL);
	_tmp6_ = _tmp5_;
	if (_tmp6_) {
		folks_persona_store_set_trust_level ((FolksPersonaStore*) self, FOLKS_PERSONA_STORE_TRUST_PARTIAL);
	} else {
		folks_persona_store_set_trust_level ((FolksPersonaStore*) self, FOLKS_PERSONA_STORE_TRUST_FULL);
	}
}


static void _edsf_persona_store_source_changed_cb (EdsfPersonaStore* self) {
	g_return_if_fail (self != NULL);
	_edsf_persona_store_notify_if_default (self);
}


static void _edsf_persona_store_notify_if_default (EdsfPersonaStore* self) {
	gboolean is_default = FALSE;
	ESourceRegistry* _tmp0_;
	g_return_if_fail (self != NULL);
	is_default = FALSE;
	_tmp0_ = self->priv->_source_registry;
	if (_tmp0_ != NULL) {
		ESource* default_source = NULL;
		ESourceRegistry* _tmp1_;
		ESource* _tmp2_ = NULL;
		gboolean _tmp3_ = FALSE;
		ESource* _tmp4_;
		gboolean _tmp9_;
		gboolean _tmp10_;
		gboolean _tmp11_;
		gboolean _tmp12_;
		_tmp1_ = self->priv->_source_registry;
		_tmp2_ = e_source_registry_ref_default_address_book (_tmp1_);
		default_source = _tmp2_;
		_tmp4_ = default_source;
		if (_tmp4_ != NULL) {
			ESource* _tmp5_;
			const gchar* _tmp6_ = NULL;
			ESource* _tmp7_;
			const gchar* _tmp8_ = NULL;
			_tmp5_ = self->priv->_source;
			_tmp6_ = e_source_get_uid (_tmp5_);
			_tmp7_ = default_source;
			_tmp8_ = e_source_get_uid (G_TYPE_CHECK_INSTANCE_CAST (_tmp7_, e_source_get_type (), ESource));
			_tmp3_ = g_strcmp0 (_tmp6_, _tmp8_) == 0;
		} else {
			_tmp3_ = FALSE;
		}
		_tmp9_ = _tmp3_;
		if (_tmp9_) {
			is_default = TRUE;
		}
		_tmp10_ = is_default;
		_tmp11_ = folks_persona_store_get_is_user_set_default ((FolksPersonaStore*) self);
		_tmp12_ = _tmp11_;
		if (_tmp10_ != _tmp12_) {
			gboolean _tmp13_;
			_tmp13_ = is_default;
			folks_persona_store_set_is_user_set_default ((FolksPersonaStore*) self, _tmp13_);
		}
		_g_object_unref0 (default_source);
	}
}


static const gchar* edsf_persona_store_real_get_type_id (FolksPersonaStore* base) {
	const gchar* result;
	EdsfPersonaStore* self;
	self = (EdsfPersonaStore*) base;
	result = BACKEND_NAME;
	return result;
}


static FolksMaybeBool edsf_persona_store_real_get_can_add_personas (FolksPersonaStore* base) {
	FolksMaybeBool result;
	EdsfPersonaStore* self;
	EBookClient* _tmp0_;
	FolksMaybeBool _tmp1_ = 0;
	EBookClient* _tmp2_;
	gboolean _tmp3_ = FALSE;
	gboolean _tmp4_;
	FolksMaybeBool _tmp5_;
	self = (EdsfPersonaStore*) base;
	_tmp0_ = self->priv->_addressbook;
	if (_tmp0_ == NULL) {
		result = FOLKS_MAYBE_BOOL_FALSE;
		return result;
	}
	_tmp2_ = self->priv->_addressbook;
	g_object_get ((EClient*) G_TYPE_CHECK_INSTANCE_CAST (_tmp2_, e_book_client_get_type (), EBookClient), "readonly", &_tmp3_, NULL);
	_tmp4_ = _tmp3_;
	if (_tmp4_) {
		_tmp1_ = FOLKS_MAYBE_BOOL_FALSE;
	} else {
		_tmp1_ = FOLKS_MAYBE_BOOL_TRUE;
	}
	_tmp5_ = _tmp1_;
	result = _tmp5_;
	return result;
}


static FolksMaybeBool edsf_persona_store_real_get_can_alias_personas (FolksPersonaStore* base) {
	FolksMaybeBool result;
	EdsfPersonaStore* self;
	self = (EdsfPersonaStore*) base;
	result = FOLKS_MAYBE_BOOL_FALSE;
	return result;
}


static FolksMaybeBool edsf_persona_store_real_get_can_group_personas (FolksPersonaStore* base) {
	FolksMaybeBool result;
	EdsfPersonaStore* self;
	FolksMaybeBool _tmp0_ = 0;
	gchar** _tmp1_;
	gint _tmp1__length1;
	FolksMaybeBool _tmp2_;
	self = (EdsfPersonaStore*) base;
	_tmp1_ = self->priv->_always_writeable_properties;
	_tmp1__length1 = self->priv->_always_writeable_properties_length1;
	if (_vala_string_array_contains (_tmp1_, _tmp1__length1, "groups")) {
		_tmp0_ = FOLKS_MAYBE_BOOL_TRUE;
	} else {
		_tmp0_ = FOLKS_MAYBE_BOOL_FALSE;
	}
	_tmp2_ = _tmp0_;
	result = _tmp2_;
	return result;
}


static FolksMaybeBool edsf_persona_store_real_get_can_remove_personas (FolksPersonaStore* base) {
	FolksMaybeBool result;
	EdsfPersonaStore* self;
	EBookClient* _tmp0_;
	FolksMaybeBool _tmp1_ = 0;
	EBookClient* _tmp2_;
	gboolean _tmp3_ = FALSE;
	gboolean _tmp4_;
	FolksMaybeBool _tmp5_;
	self = (EdsfPersonaStore*) base;
	_tmp0_ = self->priv->_addressbook;
	if (_tmp0_ == NULL) {
		result = FOLKS_MAYBE_BOOL_FALSE;
		return result;
	}
	_tmp2_ = self->priv->_addressbook;
	g_object_get ((EClient*) G_TYPE_CHECK_INSTANCE_CAST (_tmp2_, e_book_client_get_type (), EBookClient), "readonly", &_tmp3_, NULL);
	_tmp4_ = _tmp3_;
	if (_tmp4_) {
		_tmp1_ = FOLKS_MAYBE_BOOL_FALSE;
	} else {
		_tmp1_ = FOLKS_MAYBE_BOOL_TRUE;
	}
	_tmp5_ = _tmp1_;
	result = _tmp5_;
	return result;
}


static gboolean edsf_persona_store_real_get_is_prepared (FolksPersonaStore* base) {
	gboolean result;
	EdsfPersonaStore* self;
	gboolean _tmp0_;
	self = (EdsfPersonaStore*) base;
	_tmp0_ = self->priv->_is_prepared;
	result = _tmp0_;
	return result;
}


static gchar** edsf_persona_store_real_get_always_writeable_properties (FolksPersonaStore* base, int* result_length1) {
	gchar** result;
	EdsfPersonaStore* self;
	gboolean _tmp0_ = FALSE;
	EBookClient* _tmp1_;
	gboolean _tmp5_;
	gchar** _tmp8_;
	gint _tmp8__length1;
	gchar** _tmp9_;
	gint _tmp9__length1;
	self = (EdsfPersonaStore*) base;
	_tmp1_ = self->priv->_addressbook;
	if (_tmp1_ == NULL) {
		_tmp0_ = TRUE;
	} else {
		EBookClient* _tmp2_;
		gboolean _tmp3_ = FALSE;
		gboolean _tmp4_;
		_tmp2_ = self->priv->_addressbook;
		g_object_get ((EClient*) G_TYPE_CHECK_INSTANCE_CAST (_tmp2_, e_book_client_get_type (), EBookClient), "readonly", &_tmp3_, NULL);
		_tmp4_ = _tmp3_;
		_tmp0_ = _tmp4_ == TRUE;
	}
	_tmp5_ = _tmp0_;
	if (_tmp5_) {
		gchar** _tmp6_;
		gint _tmp6__length1;
		gchar** _tmp7_;
		gint _tmp7__length1;
		_tmp6_ = edsf_persona_store__always_writeable_properties_empty;
		_tmp6__length1 = edsf_persona_store__always_writeable_properties_empty_length1;
		_tmp7_ = _tmp6_;
		_tmp7__length1 = _tmp6__length1;
		if (result_length1) {
			*result_length1 = _tmp7__length1;
		}
		result = _tmp7_;
		return result;
	}
	_tmp8_ = self->priv->_always_writeable_properties;
	_tmp8__length1 = self->priv->_always_writeable_properties_length1;
	_tmp9_ = _tmp8_;
	_tmp9__length1 = _tmp8__length1;
	if (result_length1) {
		*result_length1 = _tmp9__length1;
	}
	result = _tmp9_;
	return result;
}


static gboolean edsf_persona_store_real_get_is_quiescent (FolksPersonaStore* base) {
	gboolean result;
	EdsfPersonaStore* self;
	gboolean _tmp0_;
	self = (EdsfPersonaStore*) base;
	_tmp0_ = self->priv->_is_quiescent;
	result = _tmp0_;
	return result;
}


static GeeMap* edsf_persona_store_real_get_personas (FolksPersonaStore* base) {
	GeeMap* result;
	EdsfPersonaStore* self;
	GeeMap* _tmp0_;
	self = (EdsfPersonaStore*) base;
	_tmp0_ = self->priv->_personas_ro;
	result = _tmp0_;
	return result;
}


ESource* edsf_persona_store_get_source (EdsfPersonaStore* self) {
	ESource* result;
	ESource* _tmp0_;
	g_return_val_if_fail (self != NULL, NULL);
	_tmp0_ = self->priv->_source;
	result = _tmp0_;
	return result;
}


static void edsf_persona_store_set_source (EdsfPersonaStore* self, ESource* value) {
	ESource* _tmp0_;
	ESource* _tmp1_;
	g_return_if_fail (self != NULL);
	_tmp0_ = value;
	_tmp1_ = _g_object_ref0 (_tmp0_);
	_g_object_unref0 (self->priv->_source);
	self->priv->_source = _tmp1_;
	g_object_notify ((GObject *) self, "source");
}


static void __edsf_persona_store_source_changed_cb_e_source_changed (ESource* _sender, gpointer self) {
	_edsf_persona_store_source_changed_cb (self);
}


static GObject * edsf_persona_store_constructor (GType type, guint n_construct_properties, GObjectConstructParam * construct_properties) {
	GObject * obj;
	GObjectClass * parent_class;
	EdsfPersonaStore * self;
	GeeHashMap* _tmp0_;
	GeeHashMap* _tmp1_;
	GeeMap* _tmp2_;
	GeeMap* _tmp3_;
	gchar* _tmp4_;
	ESource* _tmp5_;
	parent_class = G_OBJECT_CLASS (edsf_persona_store_parent_class);
	obj = parent_class->constructor (type, n_construct_properties, construct_properties);
	self = G_TYPE_CHECK_INSTANCE_CAST (obj, EDSF_TYPE_PERSONA_STORE, EdsfPersonaStore);
	_tmp0_ = gee_hash_map_new (G_TYPE_STRING, (GBoxedCopyFunc) g_strdup, g_free, EDSF_TYPE_PERSONA, (GBoxedCopyFunc) g_object_ref, g_object_unref, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL);
	_g_object_unref0 (self->priv->_personas);
	self->priv->_personas = _tmp0_;
	_tmp1_ = self->priv->_personas;
	_tmp2_ = gee_abstract_map_get_read_only_view ((GeeAbstractMap*) _tmp1_);
	_tmp3_ = _tmp2_;
	_g_object_unref0 (self->priv->_personas_ro);
	self->priv->_personas_ro = _tmp3_;
	_tmp4_ = g_strdup ("(contains \"x-evolution-any-field\" \"\")");
	_g_free0 (self->priv->_query_str);
	self->priv->_query_str = _tmp4_;
	_tmp5_ = self->priv->_source;
	g_signal_connect_object (_tmp5_, "changed", (GCallback) __edsf_persona_store_source_changed_cb_e_source_changed, self, 0);
	return obj;
}


static EdsfPersonaStoreIdleTask* edsf_persona_store_idle_task_construct (GType object_type) {
	EdsfPersonaStoreIdleTask* self = NULL;
	self = (EdsfPersonaStoreIdleTask*) g_type_create_instance (object_type);
	return self;
}


static EdsfPersonaStoreIdleTask* edsf_persona_store_idle_task_new (void) {
	return edsf_persona_store_idle_task_construct (EDSF_PERSONA_STORE_TYPE_IDLE_TASK);
}


static void edsf_persona_store_value_idle_task_init (GValue* value) {
	value->data[0].v_pointer = NULL;
}


static void edsf_persona_store_value_idle_task_free_value (GValue* value) {
	if (value->data[0].v_pointer) {
		edsf_persona_store_idle_task_unref (value->data[0].v_pointer);
	}
}


static void edsf_persona_store_value_idle_task_copy_value (const GValue* src_value, GValue* dest_value) {
	if (src_value->data[0].v_pointer) {
		dest_value->data[0].v_pointer = edsf_persona_store_idle_task_ref (src_value->data[0].v_pointer);
	} else {
		dest_value->data[0].v_pointer = NULL;
	}
}


static gpointer edsf_persona_store_value_idle_task_peek_pointer (const GValue* value) {
	return value->data[0].v_pointer;
}


static gchar* edsf_persona_store_value_idle_task_collect_value (GValue* value, guint n_collect_values, GTypeCValue* collect_values, guint collect_flags) {
	if (collect_values[0].v_pointer) {
		EdsfPersonaStoreIdleTask* object;
		object = collect_values[0].v_pointer;
		if (object->parent_instance.g_class == NULL) {
			return g_strconcat ("invalid unclassed object pointer for value type `", G_VALUE_TYPE_NAME (value), "'", NULL);
		} else if (!g_value_type_compatible (G_TYPE_FROM_INSTANCE (object), G_VALUE_TYPE (value))) {
			return g_strconcat ("invalid object type `", g_type_name (G_TYPE_FROM_INSTANCE (object)), "' for value type `", G_VALUE_TYPE_NAME (value), "'", NULL);
		}
		value->data[0].v_pointer = edsf_persona_store_idle_task_ref (object);
	} else {
		value->data[0].v_pointer = NULL;
	}
	return NULL;
}


static gchar* edsf_persona_store_value_idle_task_lcopy_value (const GValue* value, guint n_collect_values, GTypeCValue* collect_values, guint collect_flags) {
	EdsfPersonaStoreIdleTask** object_p;
	object_p = collect_values[0].v_pointer;
	if (!object_p) {
		return g_strdup_printf ("value location for `%s' passed as NULL", G_VALUE_TYPE_NAME (value));
	}
	if (!value->data[0].v_pointer) {
		*object_p = NULL;
	} else if (collect_flags & G_VALUE_NOCOPY_CONTENTS) {
		*object_p = value->data[0].v_pointer;
	} else {
		*object_p = edsf_persona_store_idle_task_ref (value->data[0].v_pointer);
	}
	return NULL;
}


static GParamSpec* edsf_persona_store_param_spec_idle_task (const gchar* name, const gchar* nick, const gchar* blurb, GType object_type, GParamFlags flags) {
	EdsfPersonaStoreParamSpecIdleTask* spec;
	g_return_val_if_fail (g_type_is_a (object_type, EDSF_PERSONA_STORE_TYPE_IDLE_TASK), NULL);
	spec = g_param_spec_internal (G_TYPE_PARAM_OBJECT, name, nick, blurb, flags);
	G_PARAM_SPEC (spec)->value_type = object_type;
	return G_PARAM_SPEC (spec);
}


static gpointer edsf_persona_store_value_get_idle_task (const GValue* value) {
	g_return_val_if_fail (G_TYPE_CHECK_VALUE_TYPE (value, EDSF_PERSONA_STORE_TYPE_IDLE_TASK), NULL);
	return value->data[0].v_pointer;
}


static void edsf_persona_store_value_set_idle_task (GValue* value, gpointer v_object) {
	EdsfPersonaStoreIdleTask* old;
	g_return_if_fail (G_TYPE_CHECK_VALUE_TYPE (value, EDSF_PERSONA_STORE_TYPE_IDLE_TASK));
	old = value->data[0].v_pointer;
	if (v_object) {
		g_return_if_fail (G_TYPE_CHECK_INSTANCE_TYPE (v_object, EDSF_PERSONA_STORE_TYPE_IDLE_TASK));
		g_return_if_fail (g_value_type_compatible (G_TYPE_FROM_INSTANCE (v_object), G_VALUE_TYPE (value)));
		value->data[0].v_pointer = v_object;
		edsf_persona_store_idle_task_ref (value->data[0].v_pointer);
	} else {
		value->data[0].v_pointer = NULL;
	}
	if (old) {
		edsf_persona_store_idle_task_unref (old);
	}
}


static void edsf_persona_store_value_take_idle_task (GValue* value, gpointer v_object) {
	EdsfPersonaStoreIdleTask* old;
	g_return_if_fail (G_TYPE_CHECK_VALUE_TYPE (value, EDSF_PERSONA_STORE_TYPE_IDLE_TASK));
	old = value->data[0].v_pointer;
	if (v_object) {
		g_return_if_fail (G_TYPE_CHECK_INSTANCE_TYPE (v_object, EDSF_PERSONA_STORE_TYPE_IDLE_TASK));
		g_return_if_fail (g_value_type_compatible (G_TYPE_FROM_INSTANCE (v_object), G_VALUE_TYPE (value)));
		value->data[0].v_pointer = v_object;
	} else {
		value->data[0].v_pointer = NULL;
	}
	if (old) {
		edsf_persona_store_idle_task_unref (old);
	}
}


static void edsf_persona_store_idle_task_class_init (EdsfPersonaStoreIdleTaskClass * klass) {
	edsf_persona_store_idle_task_parent_class = g_type_class_peek_parent (klass);
	EDSF_PERSONA_STORE_IDLE_TASK_CLASS (klass)->finalize = edsf_persona_store_idle_task_finalize;
}


static void edsf_persona_store_idle_task_instance_init (EdsfPersonaStoreIdleTask * self) {
	self->ref_count = 1;
}


static void edsf_persona_store_idle_task_finalize (EdsfPersonaStoreIdleTask* obj) {
	EdsfPersonaStoreIdleTask * self;
	self = G_TYPE_CHECK_INSTANCE_CAST (obj, EDSF_PERSONA_STORE_TYPE_IDLE_TASK, EdsfPersonaStoreIdleTask);
	(self->callback_target_destroy_notify == NULL) ? NULL : (self->callback_target_destroy_notify (self->callback_target), NULL);
	self->callback = NULL;
	self->callback_target = NULL;
	self->callback_target_destroy_notify = NULL;
}


static GType edsf_persona_store_idle_task_get_type (void) {
	static volatile gsize edsf_persona_store_idle_task_type_id__volatile = 0;
	if (g_once_init_enter (&edsf_persona_store_idle_task_type_id__volatile)) {
		static const GTypeValueTable g_define_type_value_table = { edsf_persona_store_value_idle_task_init, edsf_persona_store_value_idle_task_free_value, edsf_persona_store_value_idle_task_copy_value, edsf_persona_store_value_idle_task_peek_pointer, "p", edsf_persona_store_value_idle_task_collect_value, "p", edsf_persona_store_value_idle_task_lcopy_value };
		static const GTypeInfo g_define_type_info = { sizeof (EdsfPersonaStoreIdleTaskClass), (GBaseInitFunc) NULL, (GBaseFinalizeFunc) NULL, (GClassInitFunc) edsf_persona_store_idle_task_class_init, (GClassFinalizeFunc) NULL, NULL, sizeof (EdsfPersonaStoreIdleTask), 0, (GInstanceInitFunc) edsf_persona_store_idle_task_instance_init, &g_define_type_value_table };
		static const GTypeFundamentalInfo g_define_type_fundamental_info = { (G_TYPE_FLAG_CLASSED | G_TYPE_FLAG_INSTANTIATABLE | G_TYPE_FLAG_DERIVABLE | G_TYPE_FLAG_DEEP_DERIVABLE) };
		GType edsf_persona_store_idle_task_type_id;
		edsf_persona_store_idle_task_type_id = g_type_register_fundamental (g_type_fundamental_next (), "EdsfPersonaStoreIdleTask", &g_define_type_info, &g_define_type_fundamental_info, 0);
		g_once_init_leave (&edsf_persona_store_idle_task_type_id__volatile, edsf_persona_store_idle_task_type_id);
	}
	return edsf_persona_store_idle_task_type_id__volatile;
}


static gpointer edsf_persona_store_idle_task_ref (gpointer instance) {
	EdsfPersonaStoreIdleTask* self;
	self = instance;
	g_atomic_int_inc (&self->ref_count);
	return instance;
}


static void edsf_persona_store_idle_task_unref (gpointer instance) {
	EdsfPersonaStoreIdleTask* self;
	self = instance;
	if (g_atomic_int_dec_and_test (&self->ref_count)) {
		EDSF_PERSONA_STORE_IDLE_TASK_GET_CLASS (self)->finalize (self);
		g_type_free_instance ((GTypeInstance *) self);
	}
}


static void edsf_persona_store_class_init (EdsfPersonaStoreClass * klass) {
	gchar** _tmp0_ = NULL;
	edsf_persona_store_parent_class = g_type_class_peek_parent (klass);
	g_type_class_add_private (klass, sizeof (EdsfPersonaStorePrivate));
	FOLKS_PERSONA_STORE_CLASS (klass)->add_persona_from_details = edsf_persona_store_real_add_persona_from_details;
	FOLKS_PERSONA_STORE_CLASS (klass)->add_persona_from_details_finish = edsf_persona_store_real_add_persona_from_details_finish;
	FOLKS_PERSONA_STORE_CLASS (klass)->remove_persona = edsf_persona_store_real_remove_persona;
	FOLKS_PERSONA_STORE_CLASS (klass)->remove_persona_finish = edsf_persona_store_real_remove_persona_finish;
	FOLKS_PERSONA_STORE_CLASS (klass)->prepare = edsf_persona_store_real_prepare;
	FOLKS_PERSONA_STORE_CLASS (klass)->prepare_finish = edsf_persona_store_real_prepare_finish;
	FOLKS_PERSONA_STORE_CLASS (klass)->get_type_id = edsf_persona_store_real_get_type_id;
	FOLKS_PERSONA_STORE_CLASS (klass)->get_can_add_personas = edsf_persona_store_real_get_can_add_personas;
	FOLKS_PERSONA_STORE_CLASS (klass)->get_can_alias_personas = edsf_persona_store_real_get_can_alias_personas;
	FOLKS_PERSONA_STORE_CLASS (klass)->get_can_group_personas = edsf_persona_store_real_get_can_group_personas;
	FOLKS_PERSONA_STORE_CLASS (klass)->get_can_remove_personas = edsf_persona_store_real_get_can_remove_personas;
	FOLKS_PERSONA_STORE_CLASS (klass)->get_is_prepared = edsf_persona_store_real_get_is_prepared;
	FOLKS_PERSONA_STORE_CLASS (klass)->get_always_writeable_properties = edsf_persona_store_real_get_always_writeable_properties;
	FOLKS_PERSONA_STORE_CLASS (klass)->get_is_quiescent = edsf_persona_store_real_get_is_quiescent;
	FOLKS_PERSONA_STORE_CLASS (klass)->get_personas = edsf_persona_store_real_get_personas;
	G_OBJECT_CLASS (klass)->get_property = _vala_edsf_persona_store_get_property;
	G_OBJECT_CLASS (klass)->set_property = _vala_edsf_persona_store_set_property;
	G_OBJECT_CLASS (klass)->constructor = edsf_persona_store_constructor;
	G_OBJECT_CLASS (klass)->finalize = edsf_persona_store_finalize;
	/**
	   * The type of persona store this is.
	   *
	   * See {@link Folks.PersonaStore.type_id}.
	   *
	   * @since 0.6.0
	   */
	g_object_class_install_property (G_OBJECT_CLASS (klass), EDSF_PERSONA_STORE_TYPE_ID, g_param_spec_string ("type-id", "type-id", "type-id", NULL, G_PARAM_STATIC_NAME | G_PARAM_STATIC_NICK | G_PARAM_STATIC_BLURB | G_PARAM_READABLE));
	/**
	   * Whether this PersonaStore can add {@link Folks.Persona}s.
	   *
	   * See {@link Folks.PersonaStore.can_add_personas}.
	   *
	   * @since 0.6.0
	   */
	g_object_class_install_property (G_OBJECT_CLASS (klass), EDSF_PERSONA_STORE_CAN_ADD_PERSONAS, g_param_spec_enum ("can-add-personas", "can-add-personas", "can-add-personas", FOLKS_TYPE_MAYBE_BOOL, 0, G_PARAM_STATIC_NAME | G_PARAM_STATIC_NICK | G_PARAM_STATIC_BLURB | G_PARAM_READABLE));
	/**
	   * Whether this PersonaStore can set the alias of {@link Folks.Persona}s.
	   *
	   * See {@link Folks.PersonaStore.can_alias_personas}.
	   *
	   * @since 0.6.0
	   */
	g_object_class_install_property (G_OBJECT_CLASS (klass), EDSF_PERSONA_STORE_CAN_ALIAS_PERSONAS, g_param_spec_enum ("can-alias-personas", "can-alias-personas", "can-alias-personas", FOLKS_TYPE_MAYBE_BOOL, 0, G_PARAM_STATIC_NAME | G_PARAM_STATIC_NICK | G_PARAM_STATIC_BLURB | G_PARAM_READABLE));
	/**
	   * Whether this PersonaStore can set the groups of {@link Folks.Persona}s.
	   *
	   * See {@link Folks.PersonaStore.can_group_personas}.
	   *
	   * @since 0.6.0
	   */
	g_object_class_install_property (G_OBJECT_CLASS (klass), EDSF_PERSONA_STORE_CAN_GROUP_PERSONAS, g_param_spec_enum ("can-group-personas", "can-group-personas", "can-group-personas", FOLKS_TYPE_MAYBE_BOOL, 0, G_PARAM_STATIC_NAME | G_PARAM_STATIC_NICK | G_PARAM_STATIC_BLURB | G_PARAM_READABLE));
	/**
	   * Whether this PersonaStore can remove {@link Folks.Persona}s.
	   *
	   * See {@link Folks.PersonaStore.can_remove_personas}.
	   *
	   * @since 0.6.0
	   */
	g_object_class_install_property (G_OBJECT_CLASS (klass), EDSF_PERSONA_STORE_CAN_REMOVE_PERSONAS, g_param_spec_enum ("can-remove-personas", "can-remove-personas", "can-remove-personas", FOLKS_TYPE_MAYBE_BOOL, 0, G_PARAM_STATIC_NAME | G_PARAM_STATIC_NICK | G_PARAM_STATIC_BLURB | G_PARAM_READABLE));
	/**
	   * Whether this PersonaStore has been prepared.
	   *
	   * See {@link Folks.PersonaStore.is_prepared}.
	   *
	   * @since 0.6.0
	   */
	g_object_class_install_property (G_OBJECT_CLASS (klass), EDSF_PERSONA_STORE_IS_PREPARED, g_param_spec_boolean ("is-prepared", "is-prepared", "is-prepared", FALSE, G_PARAM_STATIC_NAME | G_PARAM_STATIC_NICK | G_PARAM_STATIC_BLURB | G_PARAM_READABLE));
	/**
	   * {@inheritDoc}
	   *
	   * @since 0.6.2
	   */
	g_object_class_install_property (G_OBJECT_CLASS (klass), EDSF_PERSONA_STORE_ALWAYS_WRITEABLE_PROPERTIES, g_param_spec_boxed ("always-writeable-properties", "always-writeable-properties", "always-writeable-properties", G_TYPE_STRV, G_PARAM_STATIC_NAME | G_PARAM_STATIC_NICK | G_PARAM_STATIC_BLURB | G_PARAM_READABLE));
	g_object_class_install_property (G_OBJECT_CLASS (klass), EDSF_PERSONA_STORE_IS_QUIESCENT, g_param_spec_boolean ("is-quiescent", "is-quiescent", "is-quiescent", FALSE, G_PARAM_STATIC_NAME | G_PARAM_STATIC_NICK | G_PARAM_STATIC_BLURB | G_PARAM_READABLE));
	/**
	   * The {@link Persona}s exposed by this PersonaStore.
	   *
	   * See {@link Folks.PersonaStore.personas}.
	   *
	   * @since 0.6.0
	   */
	g_object_class_install_property (G_OBJECT_CLASS (klass), EDSF_PERSONA_STORE_PERSONAS, g_param_spec_object ("personas", "personas", "personas", GEE_TYPE_MAP, G_PARAM_STATIC_NAME | G_PARAM_STATIC_NICK | G_PARAM_STATIC_BLURB | G_PARAM_READABLE));
	/**
	   * The EDS {@link E.Source} associated with this persona store.
	   *
	   * @since 0.6.6
	   */
	g_object_class_install_property (G_OBJECT_CLASS (klass), EDSF_PERSONA_STORE_SOURCE, g_param_spec_object ("source", "source", "source", e_source_get_type (), G_PARAM_STATIC_NAME | G_PARAM_STATIC_NICK | G_PARAM_STATIC_BLURB | G_PARAM_READABLE | G_PARAM_WRITABLE | G_PARAM_CONSTRUCT_ONLY));
	_tmp0_ = g_new0 (gchar*, 0 + 1);
	edsf_persona_store__always_writeable_properties_empty = _tmp0_;
	edsf_persona_store__always_writeable_properties_empty_length1 = 0;
}


static void edsf_persona_store_instance_init (EdsfPersonaStore * self) {
	gchar** _tmp0_ = NULL;
	GeeLinkedList* _tmp1_;
	self->priv = EDSF_PERSONA_STORE_GET_PRIVATE (self);
	g_static_rec_mutex_init (&self->priv->__lock__personas);
	self->priv->_is_prepared = FALSE;
	self->priv->_prepare_pending = FALSE;
	self->priv->_is_quiescent = FALSE;
	self->priv->_pending_personas = NULL;
	self->priv->_addressbook = NULL;
	self->priv->_ebookview = NULL;
	self->priv->_source_registry = NULL;
	_tmp0_ = g_new0 (gchar*, 0 + 1);
	self->priv->_always_writeable_properties = _tmp0_;
	self->priv->_always_writeable_properties_length1 = 0;
	self->priv->__always_writeable_properties_size_ = self->priv->_always_writeable_properties_length1;
	self->priv->_open_address_book_error = NULL;
	self->priv->_open_address_book_callback = NULL;
	_tmp1_ = gee_linked_list_new (EDSF_PERSONA_STORE_TYPE_IDLE_TASK, (GBoxedCopyFunc) edsf_persona_store_idle_task_ref, edsf_persona_store_idle_task_unref, NULL, NULL, NULL);
	self->priv->_idle_tasks = (GeeQueue*) _tmp1_;
	self->priv->_idle_handle = (guint) 0;
}


static void edsf_persona_store_finalize (GObject* obj) {
	EdsfPersonaStore * self;
	GError * _inner_error_ = NULL;
	self = G_TYPE_CHECK_INSTANCE_CAST (obj, EDSF_TYPE_PERSONA_STORE, EdsfPersonaStore);
	{
		EBookClientView* _tmp0_;
		EBookClient* _tmp10_;
		ESourceRegistry* _tmp14_;
		_tmp0_ = self->priv->_ebookview;
		if (_tmp0_ != NULL) {
			EBookClientView* _tmp1_;
			guint _tmp2_ = 0U;
			EBookClientView* _tmp3_;
			guint _tmp4_ = 0U;
			EBookClientView* _tmp5_;
			guint _tmp6_ = 0U;
			EBookClientView* _tmp7_;
			guint _tmp8_ = 0U;
			EBookClientView* _tmp9_;
			_tmp1_ = self->priv->_ebookview;
			g_signal_parse_name ("objects-added", e_book_client_view_get_type (), &_tmp2_, NULL, FALSE);
			g_signal_handlers_disconnect_matched (G_TYPE_CHECK_INSTANCE_CAST (_tmp1_, e_book_client_view_get_type (), EBookClientView), G_SIGNAL_MATCH_ID | G_SIGNAL_MATCH_FUNC | G_SIGNAL_MATCH_DATA, _tmp2_, 0, NULL, (GCallback) __edsf_persona_store_contacts_added_cb_e_book_client_view_objects_added, self);
			_tmp3_ = self->priv->_ebookview;
			g_signal_parse_name ("objects-removed", e_book_client_view_get_type (), &_tmp4_, NULL, FALSE);
			g_signal_handlers_disconnect_matched (G_TYPE_CHECK_INSTANCE_CAST (_tmp3_, e_book_client_view_get_type (), EBookClientView), G_SIGNAL_MATCH_ID | G_SIGNAL_MATCH_FUNC | G_SIGNAL_MATCH_DATA, _tmp4_, 0, NULL, (GCallback) __edsf_persona_store_contacts_removed_cb_e_book_client_view_objects_removed, self);
			_tmp5_ = self->priv->_ebookview;
			g_signal_parse_name ("objects-modified", e_book_client_view_get_type (), &_tmp6_, NULL, FALSE);
			g_signal_handlers_disconnect_matched (G_TYPE_CHECK_INSTANCE_CAST (_tmp5_, e_book_client_view_get_type (), EBookClientView), G_SIGNAL_MATCH_ID | G_SIGNAL_MATCH_FUNC | G_SIGNAL_MATCH_DATA, _tmp6_, 0, NULL, (GCallback) __edsf_persona_store_contacts_changed_cb_e_book_client_view_objects_modified, self);
			_tmp7_ = self->priv->_ebookview;
			g_signal_parse_name ("complete", e_book_client_view_get_type (), &_tmp8_, NULL, FALSE);
			g_signal_handlers_disconnect_matched (G_TYPE_CHECK_INSTANCE_CAST (_tmp7_, e_book_client_view_get_type (), EBookClientView), G_SIGNAL_MATCH_ID | G_SIGNAL_MATCH_FUNC | G_SIGNAL_MATCH_DATA, _tmp8_, 0, NULL, (GCallback) __edsf_persona_store_contacts_complete_cb_e_book_client_view_complete, self);
			_tmp9_ = self->priv->_ebookview;
			e_book_client_view_stop (G_TYPE_CHECK_INSTANCE_CAST (_tmp9_, e_book_client_view_get_type (), EBookClientView), &_inner_error_);
			if (_inner_error_ != NULL) {
				goto __catch5_g_error;
			}
			_g_object_unref0 (self->priv->_ebookview);
			self->priv->_ebookview = NULL;
		}
		_tmp10_ = self->priv->_addressbook;
		if (_tmp10_ != NULL) {
			EBookClient* _tmp11_;
			guint _tmp12_ = 0U;
			GQuark _tmp13_ = 0U;
			_tmp11_ = self->priv->_addressbook;
			g_signal_parse_name ("notify::readonly", G_TYPE_OBJECT, &_tmp12_, &_tmp13_, TRUE);
			g_signal_handlers_disconnect_matched ((GObject*) G_TYPE_CHECK_INSTANCE_CAST (_tmp11_, e_book_client_get_type (), EBookClient), G_SIGNAL_MATCH_ID | G_SIGNAL_MATCH_DETAIL | G_SIGNAL_MATCH_FUNC | G_SIGNAL_MATCH_DATA, _tmp12_, _tmp13_, NULL, (GCallback) __edsf_persona_store_address_book_notify_read_only_cb_g_object_notify, self);
			_g_object_unref0 (self->priv->_addressbook);
			self->priv->_addressbook = NULL;
		}
		_tmp14_ = self->priv->_source_registry;
		if (_tmp14_ != NULL) {
			ESourceRegistry* _tmp15_;
			guint _tmp16_ = 0U;
			ESourceRegistry* _tmp17_;
			guint _tmp18_ = 0U;
			_tmp15_ = self->priv->_source_registry;
			g_signal_parse_name ("source-removed", e_source_registry_get_type (), &_tmp16_, NULL, FALSE);
			g_signal_handlers_disconnect_matched (G_TYPE_CHECK_INSTANCE_CAST (_tmp15_, e_source_registry_get_type (), ESourceRegistry), G_SIGNAL_MATCH_ID | G_SIGNAL_MATCH_FUNC | G_SIGNAL_MATCH_DATA, _tmp16_, 0, NULL, (GCallback) __edsf_persona_store_source_registry_changed_cb_e_source_registry_source_removed, self);
			_tmp17_ = self->priv->_source_registry;
			g_signal_parse_name ("source-disabled", e_source_registry_get_type (), &_tmp18_, NULL, FALSE);
			g_signal_handlers_disconnect_matched (G_TYPE_CHECK_INSTANCE_CAST (_tmp17_, e_source_registry_get_type (), ESourceRegistry), G_SIGNAL_MATCH_ID | G_SIGNAL_MATCH_FUNC | G_SIGNAL_MATCH_DATA, _tmp18_, 0, NULL, (GCallback) __edsf_persona_store_source_registry_changed_cb_e_source_registry_source_disabled, self);
			_g_object_unref0 (self->priv->_source_registry);
			self->priv->_source_registry = NULL;
		}
	}
	goto __finally5;
	__catch5_g_error:
	{
		GError* e = NULL;
		GError* _tmp19_;
		const gchar* _tmp20_;
		e = _inner_error_;
		_inner_error_ = NULL;
		_tmp19_ = e;
		_tmp20_ = _tmp19_->message;
		g_warning ("edsf-persona-store.vala:368: ~PersonaStore: %s\n", _tmp20_);
		_g_error_free0 (e);
	}
	__finally5:
	if (_inner_error_ != NULL) {
		g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _inner_error_->message, g_quark_to_string (_inner_error_->domain), _inner_error_->code);
		g_clear_error (&_inner_error_);
	}
	g_static_rec_mutex_free (&self->priv->__lock__personas);
	_g_object_unref0 (self->priv->_personas);
	_g_object_unref0 (self->priv->_personas_ro);
	_g_object_unref0 (self->priv->_pending_personas);
	_g_object_unref0 (self->priv->_addressbook);
	_g_object_unref0 (self->priv->_ebookview);
	_g_object_unref0 (self->priv->_source_registry);
	_g_free0 (self->priv->_query_str);
	self->priv->_always_writeable_properties = (_vala_array_free (self->priv->_always_writeable_properties, self->priv->_always_writeable_properties_length1, (GDestroyNotify) g_free), NULL);
	_g_object_unref0 (self->priv->_source);
	_g_error_free0 (self->priv->_open_address_book_error);
	(self->priv->_open_address_book_callback_target_destroy_notify == NULL) ? NULL : (self->priv->_open_address_book_callback_target_destroy_notify (self->priv->_open_address_book_callback_target), NULL);
	self->priv->_open_address_book_callback = NULL;
	self->priv->_open_address_book_callback_target = NULL;
	self->priv->_open_address_book_callback_target_destroy_notify = NULL;
	_g_object_unref0 (self->priv->_idle_tasks);
	G_OBJECT_CLASS (edsf_persona_store_parent_class)->finalize (obj);
}


/**
 * A persona store representing a single EDS address book.
 *
 * The persona store will contain {@link Edsf.Persona}s for each contact in the
 * address book it represents.
 */
GType edsf_persona_store_get_type (void) {
	static volatile gsize edsf_persona_store_type_id__volatile = 0;
	if (g_once_init_enter (&edsf_persona_store_type_id__volatile)) {
		static const GTypeInfo g_define_type_info = { sizeof (EdsfPersonaStoreClass), (GBaseInitFunc) NULL, (GBaseFinalizeFunc) NULL, (GClassInitFunc) edsf_persona_store_class_init, (GClassFinalizeFunc) NULL, NULL, sizeof (EdsfPersonaStore), 0, (GInstanceInitFunc) edsf_persona_store_instance_init, NULL };
		GType edsf_persona_store_type_id;
		edsf_persona_store_type_id = g_type_register_static (FOLKS_TYPE_PERSONA_STORE, "EdsfPersonaStore", &g_define_type_info, 0);
		g_once_init_leave (&edsf_persona_store_type_id__volatile, edsf_persona_store_type_id);
	}
	return edsf_persona_store_type_id__volatile;
}


static void _vala_edsf_persona_store_get_property (GObject * object, guint property_id, GValue * value, GParamSpec * pspec) {
	EdsfPersonaStore * self;
	self = G_TYPE_CHECK_INSTANCE_CAST (object, EDSF_TYPE_PERSONA_STORE, EdsfPersonaStore);
	switch (property_id) {
		case EDSF_PERSONA_STORE_TYPE_ID:
		g_value_set_string (value, folks_persona_store_get_type_id ((FolksPersonaStore*) self));
		break;
		case EDSF_PERSONA_STORE_CAN_ADD_PERSONAS:
		g_value_set_enum (value, folks_persona_store_get_can_add_personas ((FolksPersonaStore*) self));
		break;
		case EDSF_PERSONA_STORE_CAN_ALIAS_PERSONAS:
		g_value_set_enum (value, folks_persona_store_get_can_alias_personas ((FolksPersonaStore*) self));
		break;
		case EDSF_PERSONA_STORE_CAN_GROUP_PERSONAS:
		g_value_set_enum (value, folks_persona_store_get_can_group_personas ((FolksPersonaStore*) self));
		break;
		case EDSF_PERSONA_STORE_CAN_REMOVE_PERSONAS:
		g_value_set_enum (value, folks_persona_store_get_can_remove_personas ((FolksPersonaStore*) self));
		break;
		case EDSF_PERSONA_STORE_IS_PREPARED:
		g_value_set_boolean (value, folks_persona_store_get_is_prepared ((FolksPersonaStore*) self));
		break;
		case EDSF_PERSONA_STORE_ALWAYS_WRITEABLE_PROPERTIES:
		{
			int length;
			g_value_set_boxed (value, folks_persona_store_get_always_writeable_properties ((FolksPersonaStore*) self, &length));
		}
		break;
		case EDSF_PERSONA_STORE_IS_QUIESCENT:
		g_value_set_boolean (value, folks_persona_store_get_is_quiescent ((FolksPersonaStore*) self));
		break;
		case EDSF_PERSONA_STORE_PERSONAS:
		g_value_set_object (value, folks_persona_store_get_personas ((FolksPersonaStore*) self));
		break;
		case EDSF_PERSONA_STORE_SOURCE:
		g_value_set_object (value, edsf_persona_store_get_source (self));
		break;
		default:
		G_OBJECT_WARN_INVALID_PROPERTY_ID (object, property_id, pspec);
		break;
	}
}


static void _vala_edsf_persona_store_set_property (GObject * object, guint property_id, const GValue * value, GParamSpec * pspec) {
	EdsfPersonaStore * self;
	self = G_TYPE_CHECK_INSTANCE_CAST (object, EDSF_TYPE_PERSONA_STORE, EdsfPersonaStore);
	switch (property_id) {
		case EDSF_PERSONA_STORE_SOURCE:
		edsf_persona_store_set_source (self, g_value_get_object (value));
		break;
		default:
		G_OBJECT_WARN_INVALID_PROPERTY_ID (object, property_id, pspec);
		break;
	}
}


static void _vala_array_destroy (gpointer array, gint array_length, GDestroyNotify destroy_func) {
	if ((array != NULL) && (destroy_func != NULL)) {
		int i;
		for (i = 0; i < array_length; i = i + 1) {
			if (((gpointer*) array)[i] != NULL) {
				destroy_func (((gpointer*) array)[i]);
			}
		}
	}
}


static void _vala_array_free (gpointer array, gint array_length, GDestroyNotify destroy_func) {
	_vala_array_destroy (array, array_length, destroy_func);
	g_free (array);
}


static gint _vala_array_length (gpointer array) {
	int length;
	length = 0;
	if (array) {
		while (((gpointer*) array)[length]) {
			length++;
		}
	}
	return length;
}



